(window.webpackJsonp=window.webpackJsonp||[]).push([[213],{273:function(s,a,n){s.exports=n.p+"assets/img/spring-springframework-aop-63.927a82a4.png"},3646:function(s,a,n){"use strict";n.r(a);var e=n(7),t=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"spring进阶-spring-aop实现原理详解之cglib代理实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring进阶-spring-aop实现原理详解之cglib代理实现"}},[s._v("#")]),s._v(" Spring进阶 - Spring AOP实现原理详解之Cglib代理实现")]),s._v(" "),a("blockquote",[a("p",[s._v("我们在前文中已经介绍了SpringAOP的切面实现和创建动态代理的过程，那么动态代理是如何工作的呢？本文主要介绍Cglib动态代理的案例和SpringAOP实现的原理。@pdai")])]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#spring%E8%BF%9B%E9%98%B6---spring-aop%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B9%8Bcglib%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0"}},[s._v("Spring进阶 - Spring AOP实现原理详解之Cglib代理实现")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E5%BC%95%E5%85%A5"}},[s._v("引入")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E8%A6%81%E8%A7%A3%E5%86%B3%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98"}},[s._v("动态代理要解决什么问题？")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BB%A3%E7%90%86"}},[s._v("什么是代理？")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"}},[s._v("什么是动态代理？")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BB%80%E4%B9%88%E6%98%AFcglib-springaop%E5%92%8Ccglib%E6%98%AF%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB"}},[s._v("什么是Cglib? SpringAOP和Cglib是什么关系？")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#cglib%E4%BB%A3%E7%90%86%E7%9A%84%E6%A1%88%E4%BE%8B"}},[s._v("Cglib代理的案例")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#pom%E5%8C%85%E4%BE%9D%E8%B5%96"}},[s._v("pom包依赖")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E5%AE%9A%E4%B9%89%E5%AE%9E%E4%BD%93"}},[s._v("定义实体")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E8%A2%AB%E4%BB%A3%E7%90%86%E7%9A%84%E7%B1%BB"}},[s._v("被代理的类")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#cglib%E4%BB%A3%E7%90%86"}},[s._v("cglib代理")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86"}},[s._v("使用代理")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"}},[s._v("简单测试")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#cglib%E4%BB%A3%E7%90%86%E7%9A%84%E6%B5%81%E7%A8%8B"}},[s._v("Cglib代理的流程")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#springaop%E4%B8%ADcglib%E4%BB%A3%E7%90%86%E7%9A%84%E5%AE%9E%E7%8E%B0"}},[s._v("SpringAOP中Cglib代理的实现")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E7%A4%BA%E4%BE%8B%E6%BA%90%E7%A0%81"}},[s._v("示例源码")])])])])]),s._v(" "),a("h2",{attrs:{id:"引入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引入"}},[s._v("#")]),s._v(" 引入")]),s._v(" "),a("hr"),s._v(" "),a("blockquote",[a("p",[s._v("我们在前文中已经介绍了SpringAOP的切面实现和创建动态代理的过程，那么动态代理是如何工作的呢？本文主要介绍Cglib动态代理的案例和SpringAOP实现的原理。")])]),s._v(" "),a("p",[s._v("要了解动态代理是如何工作的，首先需要了解")]),s._v(" "),a("ul",[a("li",[s._v("什么是代理模式？")]),s._v(" "),a("li",[s._v("什么是动态代理？")]),s._v(" "),a("li",[s._v("什么是Cglib？")]),s._v(" "),a("li",[s._v("SpringAOP和Cglib是什么关系？")])]),s._v(" "),a("h3",{attrs:{id:"动态代理要解决什么问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态代理要解决什么问题"}},[s._v("#")]),s._v(" 动态代理要解决什么问题？")]),s._v(" "),a("h4",{attrs:{id:"什么是代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是代理"}},[s._v("#")]),s._v(" 什么是代理？")]),s._v(" "),a("p",[a("strong",[s._v("代理模式")]),s._v("(Proxy pattern): 为另一个对象提供一个替身或占位符以控制对这个对象的访问")]),s._v(" "),a("p",[a("img",{attrs:{src:n(964),alt:""}})]),s._v(" "),a("p",[s._v("举个简单的例子：")]),s._v(" "),a("p",[s._v("我(client)如果要买(doOperation)房，可以找中介(proxy)买房，中介直接和卖方(target)买房。中介和卖方都实现买卖(doOperation)的操作。中介就是代理(proxy)。")]),s._v(" "),a("h4",{attrs:{id:"什么是动态代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是动态代理"}},[s._v("#")]),s._v(" 什么是动态代理？")]),s._v(" "),a("blockquote",[a("p",[s._v("动态代理就是，在程序运行期，创建目标对象的代理对象，并对目标对象中的方法进行功能性增强的一种技术。")])]),s._v(" "),a("p",[s._v("在生成代理对象的过程中，目标对象不变，代理对象中的方法是目标对象方法的增强方法。可以理解为运行期间，对象中方法的动态拦截，在拦截方法的前后执行功能操作。")]),s._v(" "),a("p",[a("img",{attrs:{src:n(965),alt:""}})]),s._v(" "),a("h3",{attrs:{id:"什么是cglib-springaop和cglib是什么关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是cglib-springaop和cglib是什么关系"}},[s._v("#")]),s._v(" 什么是Cglib? SpringAOP和Cglib是什么关系？")]),s._v(" "),a("blockquote",[a("p",[s._v("Cglib是一个强大的、高性能的代码生成包，它广泛被许多AOP框架使用，为他们提供方法的拦截。")])]),s._v(" "),a("p",[a("img",{attrs:{src:n(966),alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("最底层是字节码，字节码相关的知识请参考 "),a("a",{attrs:{href:"https://pdai.tech/md/java/jvm/java-jvm-class.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("JVM基础 - 类字节码详解"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("ASM是操作字节码的工具")]),s._v(" "),a("li",[s._v("cglib基于ASM字节码工具操作字节码（即动态生成代理，对方法进行增强）")]),s._v(" "),a("li",[s._v("SpringAOP基于cglib进行封装，实现cglib方式的动态代理")])]),s._v(" "),a("h1",{attrs:{id:"cglib代理的案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cglib代理的案例"}},[s._v("#")]),s._v(" Cglib代理的案例")]),s._v(" "),a("hr"),s._v(" "),a("blockquote",[a("p",[s._v("这里我们写一个使用cglib的简单例子。@pdai")])]),s._v(" "),a("h3",{attrs:{id:"pom包依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pom包依赖"}},[s._v("#")]),s._v(" pom包依赖")]),s._v(" "),a("p",[s._v("引入cglib的依赖包")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <parent>\n        <artifactId>tech-pdai-spring-demos</artifactId>\n        <groupId>tech.pdai</groupId>\n        <version>1.0-SNAPSHOT</version>\n    </parent>\n    <modelVersion>4.0.0</modelVersion>\n\n    <artifactId>007-spring-framework-demo-aop-proxy-cglib</artifactId>\n\n    <properties>\n        <maven.compiler.source>8</maven.compiler.source>\n        <maven.compiler.target>8</maven.compiler.target>\n    </properties>\n\n    <dependencies>\n        \x3c!-- https://mvnrepository.com/artifact/cglib/cglib --\x3e\n        <dependency>\n            <groupId>cglib</groupId>\n            <artifactId>cglib</artifactId>\n            <version>3.3.0</version>\n        </dependency>\n    </dependencies>\n\n</project>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("h3",{attrs:{id:"定义实体"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义实体"}},[s._v("#")]),s._v(" 定义实体")]),s._v(" "),a("p",[s._v("User")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("package tech.pdai.springframework.entity;\n\n/**\n * @author pdai\n */\npublic class User {\n\n    /**\n     * user's name.\n     */\n    private String name;\n\n    /**\n     * user's age.\n     */\n    private int age;\n\n    /**\n     * init.\n     *\n     * @param name name\n     * @param age  age\n     */\n    public User(String name, int age) {\n        this.name = name;\n        this.age = age;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public int getAge() {\n        return age;\n    }\n\n    public void setAge(int age) {\n        this.age = age;\n    }\n\n    @Override\n    public String toString() {\n        return \"User{\" +\n                \"name='\" + name + '\\'' +\n                \", age=\" + age +\n                '}';\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br")])]),a("h3",{attrs:{id:"被代理的类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#被代理的类"}},[s._v("#")]),s._v(" 被代理的类")]),s._v(" "),a("p",[s._v("即目标类, 对被代理的类中的方法进行增强")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('package tech.pdai.springframework.service;\n\nimport java.util.Collections;\nimport java.util.List;\n\nimport tech.pdai.springframework.entity.User;\n\n/**\n * @author pdai\n */\npublic class UserServiceImpl {\n\n    /**\n     * find user list.\n     *\n     * @return user list\n     */\n    public List<User> findUserList() {\n        return Collections.singletonList(new User("pdai", 18));\n    }\n\n    /**\n     * add user\n     */\n    public void addUser() {\n        // do something\n    }\n\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("h3",{attrs:{id:"cglib代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cglib代理"}},[s._v("#")]),s._v(" cglib代理")]),s._v(" "),a("p",[s._v("cglib代理类，需要实现MethodInterceptor接口，并指定代理目标类target")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('package tech.pdai.springframework.proxy;\n\nimport java.lang.reflect.Method;\n\nimport net.sf.cglib.proxy.Enhancer;\nimport net.sf.cglib.proxy.MethodInterceptor;\nimport net.sf.cglib.proxy.MethodProxy;\n\n/**\n * This class is for proxy demo.\n *\n * @author pdai\n */\npublic class UserLogProxy implements MethodInterceptor {\n\n    /**\n     * 业务类对象，供代理方法中进行真正的业务方法调用\n     */\n    private Object target;\n\n    public Object getUserLogProxy(Object target) {\n        //给业务对象赋值\n        this.target = target;\n        //创建加强器，用来创建动态代理类\n        Enhancer enhancer = new Enhancer();\n        //为加强器指定要代理的业务类（即：为下面生成的代理类指定父类）\n        enhancer.setSuperclass(this.target.getClass());\n        //设置回调：对于代理类上所有方法的调用，都会调用CallBack，而Callback则需要实现intercept()方法进行拦\n        enhancer.setCallback(this);\n        // 创建动态代理类对象并返回\n        return enhancer.create();\n    }\n\n    // 实现回调方法\n    @Override\n    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {\n        // log - before method\n        System.out.println("[before] execute method: " + method.getName());\n\n        // call method\n        Object result = proxy.invokeSuper(obj, args);\n\n        // log - after method\n        System.out.println("[after] execute method: " + method.getName() + ", return value: " + result);\n        return null;\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br")])]),a("h3",{attrs:{id:"使用代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用代理"}},[s._v("#")]),s._v(" 使用代理")]),s._v(" "),a("p",[s._v("启动类中指定代理目标并执行。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("package tech.pdai.springframework;\n\nimport tech.pdai.springframework.proxy.UserLogProxy;\nimport tech.pdai.springframework.service.UserServiceImpl;\n\n/**\n * Cglib proxy demo.\n *\n * @author pdai\n */\npublic class ProxyDemo {\n\n    /**\n     * main interface.\n     *\n     * @param args args\n     */\n    public static void main(String[] args) {\n        // proxy\n        UserServiceImpl userService = (UserServiceImpl) new UserLogProxy().getUserLogProxy(new UserServiceImpl());\n\n        // call methods\n        userService.findUserList();\n        userService.addUser();\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h3",{attrs:{id:"简单测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单测试"}},[s._v("#")]),s._v(" 简单测试")]),s._v(" "),a("p",[s._v("我们启动上述类main 函数，执行的结果如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[before] execute method: findUserList\n[after] execute method: findUserList, return value: [User{name='pdai', age=18}]\n[before] execute method: addUser\n[after] execute method: addUser, return value: null\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h1",{attrs:{id:"cglib代理的流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cglib代理的流程"}},[s._v("#")]),s._v(" Cglib代理的流程")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("我们把上述Demo的主要流程画出来，你便能很快理解")]),s._v(" "),a("p",[a("img",{attrs:{src:n(273),alt:""}})]),s._v(" "),a("p",[s._v("更多细节：")]),s._v(" "),a("ul",[a("li",[s._v("在上图中，我们可以通过在Enhancer中配置更多的参数来控制代理的行为，比如如果只希望增强这个类中的一个方法（而不是所有方法），那就增加callbackFilter来对目标类中方法进行过滤；Enhancer可以有更多的参数类配置其行为，不过我们在学习上述主要的流程就够了。")]),s._v(" "),a("li",[s._v("final方法为什么不能被代理？很显然final方法没法被子类覆盖，当然不能代理了。")]),s._v(" "),a("li",[s._v("Mockito为什么不能mock静态方法？因为mockito也是基于cglib动态代理来实现的，static方法也不能被子类覆盖，所以显然不能mock。但PowerMock可以mock静态方法，因为它直接在bytecode上工作，更多可以看"),a("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mockito单元测试"),a("OutboundLink")],1),s._v("。（pdai: 通了没？是不是so easy...）")])]),s._v(" "),a("h1",{attrs:{id:"springaop中cglib代理的实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springaop中cglib代理的实现"}},[s._v("#")]),s._v(" SpringAOP中Cglib代理的实现")]),s._v(" "),a("hr"),s._v(" "),a("blockquote",[a("p",[s._v("SpringAOP封装了cglib，通过其进行动态代理的创建。")])]),s._v(" "),a("p",[s._v("我们看下CglibAopProxy的getProxy方法")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('@Override\npublic Object getProxy() {\n  return getProxy(null);\n}\n\n@Override\npublic Object getProxy(@Nullable ClassLoader classLoader) {\n  if (logger.isTraceEnabled()) {\n    logger.trace("Creating CGLIB proxy: " + this.advised.getTargetSource());\n  }\n\n  try {\n    Class<?> rootClass = this.advised.getTargetClass();\n    Assert.state(rootClass != null, "Target class must be available for creating a CGLIB proxy");\n\n    // 上面流程图中的目标类\n    Class<?> proxySuperClass = rootClass;\n    if (rootClass.getName().contains(ClassUtils.CGLIB_CLASS_SEPARATOR)) {\n      proxySuperClass = rootClass.getSuperclass();\n      Class<?>[] additionalInterfaces = rootClass.getInterfaces();\n      for (Class<?> additionalInterface : additionalInterfaces) {\n        this.advised.addInterface(additionalInterface);\n      }\n    }\n\n    // Validate the class, writing log messages as necessary.\n    validateClassIfNecessary(proxySuperClass, classLoader);\n\n    // 重点看这里，就是上图的enhancer，设置各种参数来构建\n    Enhancer enhancer = createEnhancer();\n    if (classLoader != null) {\n      enhancer.setClassLoader(classLoader);\n      if (classLoader instanceof SmartClassLoader &&\n          ((SmartClassLoader) classLoader).isClassReloadable(proxySuperClass)) {\n        enhancer.setUseCache(false);\n      }\n    }\n    enhancer.setSuperclass(proxySuperClass);\n    enhancer.setInterfaces(AopProxyUtils.completeProxiedInterfaces(this.advised));\n    enhancer.setNamingPolicy(SpringNamingPolicy.INSTANCE);\n    enhancer.setStrategy(new ClassLoaderAwareGeneratorStrategy(classLoader));\n\n    // 设置callback回调接口，即方法的增强点\n    Callback[] callbacks = getCallbacks(rootClass);\n    Class<?>[] types = new Class<?>[callbacks.length];\n    for (int x = 0; x < types.length; x++) {\n      types[x] = callbacks[x].getClass();\n    }\n    // 上节说到的filter\n    enhancer.setCallbackFilter(new ProxyCallbackFilter(\n        this.advised.getConfigurationOnlyCopy(), this.fixedInterceptorMap, this.fixedInterceptorOffset));\n    enhancer.setCallbackTypes(types);\n\n    // 重点：创建proxy和其实例\n    return createProxyClassAndInstance(enhancer, callbacks);\n  }\n  catch (CodeGenerationException | IllegalArgumentException ex) {\n    throw new AopConfigException("Could not generate CGLIB subclass of " + this.advised.getTargetClass() +\n        ": Common causes of this problem include using a final class or a non-visible class",\n        ex);\n  }\n  catch (Throwable ex) {\n    // TargetSource.getTarget() failed\n    throw new AopConfigException("Unexpected AOP exception", ex);\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br")])]),a("p",[s._v("获取callback的方法如下，提几个理解的要点吧，具体读者在学习的时候建议把我的例子跑一下，然后打一个断点进行理解。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("rootClass")]),s._v(": 即目标代理类")]),s._v(" "),a("li",[a("code",[s._v("advised")]),s._v(": 包含上文中我们获取到的advisor增强器的集合")]),s._v(" "),a("li",[a("code",[s._v("exposeProxy")]),s._v(": 在xml配置文件中配置的，背景就是如果在事务A中使用了代理，事务A调用了目标类的的方法a，在方法a中又调用目标类的方法b，方法a，b同时都是要被增强的方法，如果不配置exposeProxy属性，方法b的增强将会失效，如果配置exposeProxy，方法b在方法a的执行中也会被增强了")]),s._v(" "),a("li",[a("code",[s._v("DynamicAdvisedInterceptor")]),s._v(": 拦截器将advised(包含上文中我们获取到的advisor增强器)构建配置的AOP的callback（第一个callback)")]),s._v(" "),a("li",[a("code",[s._v("targetInterceptor")]),s._v(": xml配置的optimize属性使用的（第二个callback)")]),s._v(" "),a("li",[s._v("最后连同其它5个默认的Interceptor 返回作为cglib的拦截器链，之后通过CallbackFilter的accpet方法返回的索引从这个集合中返回对应的拦截增强器执行增强操作。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('private Callback[] getCallbacks(Class<?> rootClass) throws Exception {\n  // Parameters used for optimization choices...\n  boolean exposeProxy = this.advised.isExposeProxy();\n  boolean isFrozen = this.advised.isFrozen();\n  boolean isStatic = this.advised.getTargetSource().isStatic();\n\n  // Choose an "aop" interceptor (used for AOP calls).\n  Callback aopInterceptor = new DynamicAdvisedInterceptor(this.advised);\n\n  // Choose a "straight to target" interceptor. (used for calls that are\n  // unadvised but can return this). May be required to expose the proxy.\n  Callback targetInterceptor;\n  if (exposeProxy) {\n    targetInterceptor = (isStatic ?\n        new StaticUnadvisedExposedInterceptor(this.advised.getTargetSource().getTarget()) :\n        new DynamicUnadvisedExposedInterceptor(this.advised.getTargetSource()));\n  }\n  else {\n    targetInterceptor = (isStatic ?\n        new StaticUnadvisedInterceptor(this.advised.getTargetSource().getTarget()) :\n        new DynamicUnadvisedInterceptor(this.advised.getTargetSource()));\n  }\n\n  // Choose a "direct to target" dispatcher (used for\n  // unadvised calls to static targets that cannot return this).\n  Callback targetDispatcher = (isStatic ?\n      new StaticDispatcher(this.advised.getTargetSource().getTarget()) : new SerializableNoOp());\n\n  Callback[] mainCallbacks = new Callback[] {\n      aopInterceptor,  // \n      targetInterceptor,  // invoke target without considering advice, if optimized\n      new SerializableNoOp(),  // no override for methods mapped to this\n      targetDispatcher, this.advisedDispatcher,\n      new EqualsInterceptor(this.advised),\n      new HashCodeInterceptor(this.advised)\n  };\n\n  Callback[] callbacks;\n\n  // If the target is a static one and the advice chain is frozen,\n  // then we can make some optimizations by sending the AOP calls\n  // direct to the target using the fixed chain for that method.\n  if (isStatic && isFrozen) {\n    Method[] methods = rootClass.getMethods();\n    Callback[] fixedCallbacks = new Callback[methods.length];\n    this.fixedInterceptorMap = CollectionUtils.newHashMap(methods.length);\n\n    // TODO: small memory optimization here (can skip creation for methods with no advice)\n    for (int x = 0; x < methods.length; x++) {\n      Method method = methods[x];\n      List<Object> chain = this.advised.getInterceptorsAndDynamicInterceptionAdvice(method, rootClass);\n      fixedCallbacks[x] = new FixedChainStaticTargetInterceptor(\n          chain, this.advised.getTargetSource().getTarget(), this.advised.getTargetClass());\n      this.fixedInterceptorMap.put(method, x);\n    }\n\n    // Now copy both the callbacks from mainCallbacks\n    // and fixedCallbacks into the callbacks array.\n    callbacks = new Callback[mainCallbacks.length + fixedCallbacks.length];\n    System.arraycopy(mainCallbacks, 0, callbacks, 0, mainCallbacks.length);\n    System.arraycopy(fixedCallbacks, 0, callbacks, mainCallbacks.length, fixedCallbacks.length);\n    this.fixedInterceptorOffset = mainCallbacks.length;\n  }\n  else {\n    callbacks = mainCallbacks;\n  }\n  return callbacks;\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br")])]),a("p",[s._v("可以结合调试，方便理解")]),s._v(" "),a("p",[a("img",{attrs:{src:n(967),alt:""}})]),s._v(" "),a("h1",{attrs:{id:"示例源码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例源码"}},[s._v("#")]),s._v(" 示例源码")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("https://github.com/realpdai/tech-pdai-spring-demos")])])}),[],!1,null,null,null);a.default=t.exports},964:function(s,a){s.exports="data:image/png;base64,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"},965:function(s,a,n){s.exports=n.p+"assets/img/spring-springframework-aop-61.bc036e16.png"},966:function(s,a,n){s.exports=n.p+"assets/img/spring-springframework-aop-62.63b92ba8.png"},967:function(s,a,n){s.exports=n.p+"assets/img/spring-springframework-aop-64.108c9b18.png"}}]);