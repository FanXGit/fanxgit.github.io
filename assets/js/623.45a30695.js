(window.webpackJsonp=window.webpackJsonp||[]).push([[623],{3988:function(t,s,e){"use strict";e.r(s);var n=e(7),a=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"工具-netstat查看服务及监听端口详解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#工具-netstat查看服务及监听端口详解"}},[t._v("#")]),t._v(" 工具: netstat查看服务及监听端口详解")]),t._v(" "),s("p",[t._v("==================================================")]),t._v(" "),s("blockquote",[s("p",[t._v("在Linux使用过程中，需要了解当前系统开放了哪些端口，并且要查看开放这些端口的具体进程和用户，可以通过netstat命令进行简单查询. @pdai")])]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#netstat%E7%9A%84%E5%8F%82%E6%95%B0",target:"_blank",rel:"noopener noreferrer"}},[t._v("netstat的参数"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#netstat%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9",target:"_blank",rel:"noopener noreferrer"}},[t._v("netstat输出内容"),s("OutboundLink")],1),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#proto-recv-q-send-q",target:"_blank",rel:"noopener noreferrer"}},[t._v("Proto，Recv-Q，Send-Q"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#local-address",target:"_blank",rel:"noopener noreferrer"}},[t._v("Local Address"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#foreign-address",target:"_blank",rel:"noopener noreferrer"}},[t._v("Foreign Address"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#state",target:"_blank",rel:"noopener noreferrer"}},[t._v("State"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#pid-program",target:"_blank",rel:"noopener noreferrer"}},[t._v("PID/Program"),s("OutboundLink")],1)])])]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%91%BD%E4%BB%A4",target:"_blank",rel:"noopener noreferrer"}},[t._v("常用的一些命令"),s("OutboundLink")],1),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#%E6%98%BE%E7%A4%BA%E5%8D%8F%E8%AE%AE%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%E5%92%8Ctcp-ip%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5",target:"_blank",rel:"noopener noreferrer"}},[t._v("显示协议统计信息和TCP/IP网络连接"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#%E6%9F%A5%E7%9C%8B%E6%9C%AC%E6%9C%BA%E7%9B%91%E5%90%AC%E7%9A%84%E7%AB%AF%E5%8F%A3",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看本机监听的端口"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#%E6%9F%A5%E7%9C%8B%E6%9C%AC%E6%9C%BA%E8%B7%AF%E7%94%B1%E8%A1%A8",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看本机路由表"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E7%AB%AF%E5%8F%A3",target:"_blank",rel:"noopener noreferrer"}},[t._v("列出所有端口"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E7%9A%84tcp%E7%AB%AF%E5%8F%A3",target:"_blank",rel:"noopener noreferrer"}},[t._v("列出所有的TCP端口"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E7%9A%84udp%E7%AB%AF%E5%8F%A3",target:"_blank",rel:"noopener noreferrer"}},[t._v("列出所有的UDP端口"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E7%9B%91%E5%90%ACtcp%E7%AB%AF%E5%8F%A3%E7%9A%84socket",target:"_blank",rel:"noopener noreferrer"}},[t._v("列出所有监听TCP端口的socket"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E7%9B%91%E5%90%ACudp%E7%AB%AF%E5%8F%A3%E7%9A%84socket",target:"_blank",rel:"noopener noreferrer"}},[t._v("列出所有监听UDP端口的socket"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#%E6%89%BE%E5%87%BA%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E7%9A%84%E7%AB%AF%E5%8F%A3",target:"_blank",rel:"noopener noreferrer"}},[t._v("找出程序运行的端口"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pdai.tech/md/develop/protocol/dev-protocol-tool-netstat.html#%E5%87%A0%E4%B8%AA%E6%9C%89%E7%94%A8%E6%9F%A5%E6%89%BE",target:"_blank",rel:"noopener noreferrer"}},[t._v("几个有用查找"),s("OutboundLink")],1)])])])]),t._v(" "),s("h1",{attrs:{id:"netstat的参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#netstat的参数"}},[t._v("#")]),t._v(" netstat的参数")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("netstat命令各个参数说明如下：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("-a   或–all                             显示所有连线中的Socket。\n-A                                       <网络类型>或–<网络类型> 列出该网络类型连线中的相关地址。\n-c   或–continuous               持续列出网络状态。\n-C 或–cache                       显示路由器配置的快取信息。\n-e  或–extend                     显示网络其他相关信息。\n-F  或 –fib                          显示FIB。\n-g  或–groups                     显示多重广播功能群组组员名单。\n-h  或–help                        在线帮助。\n-i   或–interfaces                 显示网络界面信息表单。\n-l  或–listening                    显示监控中的服务器的Socket。\n-M   或–masquerade           显示伪装的网络连线。\n-n  或–numeric                   直接使用IP地址，而不通过域名服务器。\n-N   或–netlink或–symbolic  显示网络硬件外围设备的符号连接名称。\n-o  或–timers                      显示计时器。\n-p   或–programs                显示正在使用Socket的程序识别码和程序名称。\n-r  或–route                        显示 Routing Table。\n-s  或–statistice 显示网络工作信息统计表。\n-t  或–tcp 显示TCP 传输协议的连线状况。\n-u或–udp 显示UDP传输协议的连线状况。\n-v或–verbose 显示指令执行过程。\n-V 或–version 显示版本信息。\n-w或–raw 显示RAW传输协议的连线状况。\n-x或–unix 此参数的效果和指定”-A unix”参数相同。\n–ip或–inet 此参数的效果和指定”-A inet”参数相同。\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br")])]),s("h1",{attrs:{id:"netstat输出内容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#netstat输出内容"}},[t._v("#")]),t._v(" netstat输出内容")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("以查看当前所有tcp/udp端口为例：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@pdai-centos ~]# netstat -tulnp\nActive Internet connections (servers and established)\nProto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   \ntcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1904/sshd           \ntcp        0      0 127.0.0.1:631               0.0.0.0:*                   LISTEN      1750/cupsd          \ntcp        0      0 0.0.0.0:44567               0.0.0.0:*                   LISTEN      1713/rpc.statd      \ntcp        0      0 0.0.0.0:10050               0.0.0.0:*                   LISTEN      1965/zabbix_agentd  \ntcp        0      0 172.172.230.xxx:3306        0.0.0.0:*                   LISTEN      31849/mysqld        \ntcp        0      0 0.0.0.0:111                 0.0.0.0:*                   LISTEN      1576/rpcbind        \ntcp        0      0 172.172.230.xxx:46327       172.172.100.3:80            TIME_WAIT   -                   \ntcp        0      0 172.172.230.xxx:46329       172.172.100.3:80            TIME_WAIT   -                   \ntcp        0     52 172.172.230.xxx:22          172.172.173.222:50043       ESTABLISHED 6095/sshd           \ntcp        0      0 172.172.230.xxx:46326       172.172.100.3:80            TIME_WAIT   -                   \ntcp        0      0 172.172.230.xxx:5401        172.172.100.3:443           TIME_WAIT   -                   \ntcp        0      0 :::22                       :::*                        LISTEN      1904/sshd           \ntcp        0      0 ::1:631                     :::*                        LISTEN      1750/cupsd          \ntcp        0      0 :::11776                    :::*                        LISTEN      1713/rpc.statd      \ntcp        0      0 :::10050                    :::*                        LISTEN      1965/zabbix_agentd  \ntcp        0      0 :::111                      :::*                        LISTEN      1576/rpcbind       \n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br")])]),s("p",[t._v("对上述返回内容进一步解释如下：")]),t._v(" "),s("h3",{attrs:{id:"proto-recv-q-send-q"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#proto-recv-q-send-q"}},[t._v("#")]),t._v(" Proto，Recv-Q，Send-Q")]),t._v(" "),s("p",[s("strong",[t._v("Proto")]),t._v(":协议名（tcp协议还是udp协议)")]),t._v(" "),s("p",[s("strong",[t._v("recv-Q")]),t._v(": 网络接收队列")]),t._v(" "),s("p",[t._v("表示收到的数据已经在本地接收缓冲，但是还有多少没有被进程取走，recv() 如果接收队列Recv-Q一直处于阻塞状态，可能是遭受了拒绝服务 denial-of-service 攻击。")]),t._v(" "),s("p",[s("strong",[t._v("send-Q")]),t._v(": 网路发送队列 对方没有收到的数据或者说没有Ack的,还是本地缓冲区. 如果发送队列Send-Q不能很快的清零，可能是有应用向外发送数据包过快，或者是对方接收数据包不够快。")]),t._v(" "),s("p",[t._v("这两个值通常应该为0，如果不为0可能是有问题的。packets在两个队列里都不应该有堆积状态。可接受短暂的非0情况。")]),t._v(" "),s("p",[t._v("从步骤一的结果中可以看到22端口对应的链路的 send-Q中堆积了大量的数据包 ,可以判定是发送数据给目的地址的时候出现了阻塞的问题，导致了包堆积在本地缓存中，不能成功发出去。")]),t._v(" "),s("h3",{attrs:{id:"local-address"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#local-address"}},[t._v("#")]),t._v(" Local Address")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Local Address 部分的0.0.0.0:22 表示监听服务器上所有ip地址的所有(0.0.0.0表示本地所有ip)，比如你的服务器是有172.172.230.210和 172.172.230.11两个ip地址，那么0.0.0.0:22此时表示监听172.172.230.210,172.172.230.xxx,127.0.0.1三个地址的22端口")])]),t._v(" "),s("li",[s("p",[s("code",[t._v(":::22")]),t._v(' 这个也表示监听本地所有ip的22端口，跟上面的区别是这里表示的是IPv6地址，上面的0.0.0.0表示的是本地所有IPv4地址 NOTE “:::” 这三个: 的前两个"::"，是"0:0:0:0:0:0:0:0"的缩写，相当于IPv6的"0.0.0.0"，就是本机的所有IPv6地址，第三个:是IP和端口的分隔符')])]),t._v(" "),s("li",[s("p",[s("code",[t._v("127.0.0.1:631")]),t._v(" 这个表示监听本机的loopback地址的631端口(如果某个服务只监听了回环地址，那么只能在本机进行访问，无法通过tcp/ip 协议进行远程访问)")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("::1:631")]),t._v(" 这个表示监听IPv6的回环地址的631端口,::1这个表示IPv6的loopback地址")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("172.172.230.xxx:3306")]),t._v(" 这里我们看到我们的mysqld进程监听的是172.172.230.xxx的3306端口,这是因为我们在启动的时候指定了bind_address=172.172.230.xxx参数，如果不指定bind_address的话，mysqld默认监听:::3306(本机所有ip地址的3306端口 -IPv6)")])])]),t._v(" "),s("h3",{attrs:{id:"foreign-address"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#foreign-address"}},[t._v("#")]),t._v(" Foreign Address")]),t._v(" "),s("p",[t._v("与本机端口通信的外部socket。显示规则与Local Address相同")]),t._v(" "),s("h3",{attrs:{id:"state"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#state"}},[t._v("#")]),t._v(" State")]),t._v(" "),s("p",[t._v("共有11种链路状态 + Unknown，共计12种state值，前面11种是按照TCP连接建立的三次握手和TCP连接断开的四次挥手过程来描述的。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("状态")]),t._v(" "),s("th",[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("LISTEN")]),t._v(" "),s("td",[t._v("首先服务端需要打开一个socket进行监听，状态为LISTEN./* The socket is listening for incoming connections. 侦听来自远方TCP端口的连接请求 */")])]),t._v(" "),s("tr",[s("td",[t._v("SYN_SENT")]),t._v(" "),s("td",[t._v("客户端通过应用程序调用connect进行active open.于是客户端tcp发送一个SYN以请求建立一个连接.之后状态置为SYN_SENT./*The socket is actively attempting to establish a connection. 在发送连接请求后等待匹配的连接请求 */")])]),t._v(" "),s("tr",[s("td",[t._v("SYN_RECV")]),t._v(" "),s("td",[t._v("服务端应发出ACK确认客户端的 SYN,同时自己向客户端发送一个SYN. 之后状态置为SYN_RECV/* A connection request has been received from the network. 在收到和发送一个连接请求后等待对连接请求的确认 */")])]),t._v(" "),s("tr",[s("td",[t._v("ESTABLISHED")]),t._v(" "),s("td",[t._v("代表一个打开的连接，双方可以进行或已经在数据交互了。/* The socket has an established connection. 代表一个打开的连接，数据可以传送给用户 */")])]),t._v(" "),s("tr",[s("td",[t._v("FIN_WAIT1")]),t._v(" "),s("td",[t._v("主动关闭(active close)端应用程序调用close，于是其TCP发出FIN请求主动关闭连接，之后进入FIN_WAIT1状态./* The socket is closed, and the connection is shutting down. 等待远程TCP的连接中断请求，或先前的连接中断请求的确认 */")])]),t._v(" "),s("tr",[s("td",[t._v("CLOSE_WAIT")]),t._v(" "),s("td",[t._v("被动关闭(passive close)端TCP接到FIN后，就发出ACK以回应FIN请求(它的接收也作为文件结束符传递给上层应用程序),并进入CLOSE_WAIT./* The remote end has shut down, waiting for the socket to close. 等待从本地用户发来的连接中断请求 */")])]),t._v(" "),s("tr",[s("td",[t._v("FIN_WAIT2")]),t._v(" "),s("td",[t._v("主动关闭端接到ACK后，就进入了 FIN-WAIT-2 ./* Connection is closed, and the socket is waiting for a shutdown from the remote end. 从远程TCP等待连接中断请求 */")])]),t._v(" "),s("tr",[s("td",[t._v("LAST_ACK")]),t._v(" "),s("td",[t._v("被动关闭端一段时间后，接收到文件结束符的应用程 序将调用CLOSE关闭连接。这导致它的TCP也发送一个 FIN,等待对方的ACK.就进入了LAST-ACK ./* The remote end has shut down, and the socket is closed. Waiting for acknowledgement. 等待原来发向远程TCP的连接中断请求的确认 */")])]),t._v(" "),s("tr",[s("td",[t._v("TIME_WAIT")]),t._v(" "),s("td",[t._v("在主动关闭端接收到FIN后，TCP 就发送ACK包，并进入TIME-WAIT状态。/* The socket is waiting after close to handle packets still in the network.等待足够的时间以确保远程TCP接收到连接中断请求的确认 */")])]),t._v(" "),s("tr",[s("td",[t._v("CLOSING")]),t._v(" "),s("td",[t._v("比较少见./* Both sockets are shut down but we still don’t have all our data sent. 等待远程TCP对连接中断的确认 */")])]),t._v(" "),s("tr",[s("td",[t._v("CLOSED")]),t._v(" "),s("td",[t._v("被动关闭端在接受到ACK包后，就进入了closed的状态。连接结束./* The socket is not being used. 没有任何连接状态 */")])]),t._v(" "),s("tr",[s("td",[t._v("UNKNOWN")]),t._v(" "),s("td",[t._v("未知的Socket状态。/* The state of the socket is unknown. */")])])])]),t._v(" "),s("p",[t._v("备注")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("SYN")]),t._v(": (同步序列编号,Synchronize Sequence Numbers)该标志仅在三次握手建立TCP连接时有效。表示一个新的TCP连接请求。")]),t._v(" "),s("li",[s("code",[t._v("ACK")]),t._v(": (确认编号,Acknowledgement Number)是对TCP请求的确认标志,同时提示对端系统已经成功接收所有数据。")]),t._v(" "),s("li",[s("code",[t._v("FIN")]),t._v(": (结束标志,FINish)用来结束一个TCP回话.但对应端口仍处于开放状态,准备接收后续数据。")])]),t._v(" "),s("h3",{attrs:{id:"pid-program"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pid-program"}},[t._v("#")]),t._v(" PID/Program")]),t._v(" "),s("p",[t._v("PID即进程id，Program即使用该socket的应用程序")]),t._v(" "),s("h1",{attrs:{id:"常用的一些命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用的一些命令"}},[t._v("#")]),t._v(" 常用的一些命令")]),t._v(" "),s("hr"),t._v(" "),s("p",[s("code",[t._v("netstat -t/-u/-l/-r/-n")]),t._v("【显示网络相关信息,-t:TCP协议,-u:UDP协议,-l:监听,-r:路由,-n:显示IP地址和端口号】")]),t._v(" "),s("p",[t._v("注：以下返回内容中，我用xxx注释掉了一部分敏感ip地址。")]),t._v(" "),s("h3",{attrs:{id:"显示协议统计信息和tcp-ip网络连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#显示协议统计信息和tcp-ip网络连接"}},[t._v("#")]),t._v(" 显示协议统计信息和TCP/IP网络连接")]),t._v(" "),s("p",[t._v("注：删减了部分结果")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@pdai-centos ~]# netstat -ano\nActive Internet connections (servers and established)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       Timer\ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      off (0.00/0/0)\ntcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      off (0.00/0/0)\ntcp        0      0 172.21.0.14:443         120.242.11.29:15878     ESTABLISHED off (0.00/0/0)\ntcp        0      0 172.21.0.14:55758       169.254.0.4:80          TIME_WAIT   timewait (33.29/0/0)\ntcp        0   6728 172.21.0.14:443         183.249.4.28:52323      ESTABLISHED on (0.05/0/0)\ntcp6       0      0 :::3306                 :::*                    LISTEN      off (0.00/0/0)\nudp        0      0 0.0.0.0:68              0.0.0.0:*                           off (0.00/0/0)\nudp        0      0 172.21.0.14:123         0.0.0.0:*                           off (0.00/0/0)\nudp        0      0 127.0.0.1:123           0.0.0.0:*                           off (0.00/0/0)\nudp6       0      0 fe80::5054:ff:fe2b::123 :::*                                off (0.00/0/0)\nudp6       0      0 ::1:123                 :::*                                off (0.00/0/0)\nActive UNIX domain sockets (servers and established)\nProto RefCnt Flags       Type       State         I-Node   Path\nunix  2      [ ACC ]     STREAM     LISTENING     67561565 /usr/local/yd.socket.server\nunix  2      [ ACC ]     STREAM     LISTENING     13619    /var/run/acpid.socket\nunix  2      [ ACC ]     STREAM     LISTENING     12855    /var/run/lsm/ipc/simc\nunix  2      [ ACC ]     STREAM     LISTENING     12857    /var/run/lsm/ipc/sim\nunix  2      [ ]         DGRAM                    10062    /run/systemd/shutdownd\nunix  2      [ ]         DGRAM                    15773    \nunix  3      [ ]         STREAM     CONNECTED     67561623 \n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br")])]),s("h3",{attrs:{id:"查看本机监听的端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看本机监听的端口"}},[t._v("#")]),t._v(" 查看本机监听的端口")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@pdai-centos ~]# netstat -tlun\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State      \ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      \ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN                          \nudp        0      0 172.21.0.14:123         0.0.0.0:*                          \nudp        0      0 127.0.0.1:123           0.0.0.0:*                          \nudp6       0      0 fe80::5054:ff:fe2b::123 :::*                               \nudp6       0      0 ::1:123                 :::*   \n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("h3",{attrs:{id:"查看本机路由表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看本机路由表"}},[t._v("#")]),t._v(" 查看本机路由表")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@pdai-centos ~]# netstat -rn\nKernel IP routing table\nDestination     Gateway         Genmask         Flags   MSS Window  irtt Iface\n0.0.0.0         172.21.0.1      0.0.0.0         UG        0 0          0 eth0\n169.254.0.0     0.0.0.0         255.255.0.0     U         0 0          0 eth0\n172.21.0.0      0.0.0.0         255.255.240.0   U         0 0          0 eth0\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("h3",{attrs:{id:"列出所有端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#列出所有端口"}},[t._v("#")]),t._v(" 列出所有端口")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@pdai-centos ~]# netstat -a \nActive Internet connections (servers and established)\nProto Recv-Q Send-Q Local Address           Foreign Address         State      \ntcp        0      0 VM-0-14-cent:cslistener 0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:http            0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:us-srv          0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:https           0.0.0.0:*               LISTEN     \ntcp        0      0 pdai-centos:https    125.85.238.55:7123      TIME_WAIT  \ntcp        0      0 pdai-centos:https    39.144.22.5:50742       ESTABLISHED\n...\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("h3",{attrs:{id:"列出所有的tcp端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#列出所有的tcp端口"}},[t._v("#")]),t._v(" 列出所有的TCP端口")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@pdai-centos ~]# netstat -at\nActive Internet connections (servers and established)\nProto Recv-Q Send-Q Local Address           Foreign Address         State      \ntcp        0      0 VM-0-14-cent:cslistener 0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:http            0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:us-srv          0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:https           0.0.0.0:*               LISTEN     \ntcp        0      0 pdai-centos:https    39.144.22.xx:50742       FIN_WAIT2  \ntcp        0      0 pdai-centos:https    59.71.243.xx:6994      ESTABLISHED\ntcp        0      0 pdai-centos:https    125.85.238.xx:7096      FIN_WAIT2  \ntcp6       0      0 [::]:mysql              [::]:*                  LISTEN     \ntcp6       0      0 [::]:distinct           [::]:*                  LISTEN     \ntcp6       0      0 [::]:ddi-tcp-1          [::]:*                  LISTEN     \ntcp6       1      0 172.21.0.14:ddi-tcp-1   140.82.115.xx:24923    CLOSE_WAIT \ntcp6       1      0 172.21.0.14:ddi-tcp-1   140.82.115.xx:64953    CLOSE_WAIT \ntcp6       1      0 172.21.0.14:ddi-tcp-1   140.82.115.xx:55955    CLOSE_WAIT \n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br")])]),s("h3",{attrs:{id:"列出所有的udp端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#列出所有的udp端口"}},[t._v("#")]),t._v(" 列出所有的UDP端口")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@pdai-centos ~]# netstat -au \nActive Internet connections (servers and established)\nProto Recv-Q Send-Q Local Address           Foreign Address         State      \nudp        0      0 0.0.0.0:bootpc          0.0.0.0:*                          \nudp        0      0 pdai-centos:ntp      0.0.0.0:*                          \nudp        0      0 pdai-centos:ntp      0.0.0.0:*                          \nudp6       0      0 pdai-centos:ntp      [::]:*                             \nudp6       0      0 pdai-centos:ntp      [::]:*  \n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("h3",{attrs:{id:"列出所有监听tcp端口的socket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#列出所有监听tcp端口的socket"}},[t._v("#")]),t._v(" 列出所有监听TCP端口的socket")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@pdai-centos ~]# netstat -lt \nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State      \ntcp        0      0 VM-0-14-cent:cslistener 0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:http            0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:us-srv          0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN     \ntcp        0      0 0.0.0.0:https           0.0.0.0:*               LISTEN     \ntcp6       0      0 [::]:mysql              [::]:*                  LISTEN     \ntcp6       0      0 [::]:distinct           [::]:*                  LISTEN     \ntcp6       0      0 [::]:ddi-tcp-1          [::]:*                  LISTEN \n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("h3",{attrs:{id:"列出所有监听udp端口的socket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#列出所有监听udp端口的socket"}},[t._v("#")]),t._v(" 列出所有监听UDP端口的socket")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@pdai-centos ~]# netstat -lu \nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State      \nudp        0      0 0.0.0.0:bootpc          0.0.0.0:*                          \nudp        0      0 pdai-centos:ntp      0.0.0.0:*                          \nudp        0      0 pdai-centos:ntp      0.0.0.0:*                          \nudp6       0      0 pdai-centos:ntp      [::]:*                             \nudp6       0      0 pdai-centos:ntp      [::]:*  \n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("h3",{attrs:{id:"找出程序运行的端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#找出程序运行的端口"}},[t._v("#")]),t._v(" 找出程序运行的端口")]),t._v(" "),s("p",[t._v("以ssh为例")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@pdai-centos ~]# netstat -ap | grep ssh \ntcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN      1120/sshd           \ntcp        0     64 pdai-centos:ssh      117.82.229.xx:41408    ESTABLISHED 28968/sshd: xx@pt \ntcp        0      0 pdai-centos:ssh      xxx.122.15.xx:32966     TIME_WAIT   -                   \ntcp        0      0 pdai-centos:ssh      203.xxx.85.146:43730    ESTABLISHED 687/sshd: xx [pri \ntcp        0      0 pdai-centos:ssh      134.xx.xx.36:54474     TIME_WAIT   -                   \ntcp        0      0 pdai-centos:ssh      64.xx.111.127:45444    TIME_WAIT   -                   \nunix  3      [ ]         STREAM     CONNECTED     16580    1120/sshd            \nunix  2      [ ]         DGRAM                    113619201 28968/sshd: root@pt  \n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("h3",{attrs:{id:"几个有用查找"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#几个有用查找"}},[t._v("#")]),t._v(" 几个有用查找")]),t._v(" "),s("p",[t._v("1.查找请求数前20个IP（常用于查找攻来源）：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("netstat -anlp|grep 80|grep tcp|awk '{print $5}'|awk -F: '{print $1}'|sort|uniq -c|sort -nr|head -n20\n \nnetstat -ant |awk '/:80/{split($5,ip,”:”);++A[ip[1]]}END{for(i in A) print A[i],i}' |sort -rn|head -n20\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("3.查找较多time_wait连接")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("netstat -n|grep TIME_WAIT|awk '{print $5}'|sort|uniq -c|sort -rn|head -n20\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("4.找查较多的SYN连接")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("netstat -an | grep SYN | awk '{print $5}' | awk -F: '{print $1}' | sort | uniq -c | sort -nr | more\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("5.根据端口列进程")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("netstat -ntlp | grep 80 | awk '{print $7}' | cut -d/ -f1\n```)")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])}),[],!1,null,null,null);s.default=a.exports}}]);