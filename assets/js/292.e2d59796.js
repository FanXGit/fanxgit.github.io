(window.webpackJsonp=window.webpackJsonp||[]).push([[292],{1141:function(e,n,s){e.exports=s.p+"assets/img/springboot-task-2.2ef9f8fc.png"},1142:function(e,n,s){e.exports=s.p+"assets/img/spring-framework-ioc-source-102.34854479.png"},1143:function(e,n){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABEgAAAGICAMAAABldSX3AAAATlBMVEXX1az////8+tHAwMBYWll9wssLChkAAILi4uLLkUKqzbRtq6vQ0I3Ly89GHBGLinCFvmLMuX0fOmxVdXyATBpckZ2hcTKcxXYeYoGVua96HOjkAAAVT0lEQVR4nO3cjXqiuhpAYdyltCJiEbXt/d/oBgISrL98SYYk633OM9tpbcfkkGVE2mQFAELJCgCECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUICQIyQABAjJADECAkAMUISsu2bIytEjpCEbJu4sV0hcoQkZK5Cwo4keoQkZOxI4AghCRk7EjhCSELGjgSOEJKQsSOBI4QkZOxI4AghCRk7EjhCSELGjgSOEJKQaSHJ8/c8z+10hB0JCEnIziHJ33t2UsKOJHqEJGRDSN41j6JQZYNb0VlnG3YkmCIkIdv+7cjDklS73e6Q1c2fz4eEHUn0CEnIttPXNZNXN8XX13fxdCrYkeAuQhKyrbYhOdZ1vdG2JF9F8f39KBXVoczKOh9uZml+/mxV7tmRYEBIQrYdNyR1Wh/rdNySFF9J8jAkVdm8xjlk++Hmqdzn/WeL7iY7EiiEJGRjSI7pxWubJiTNjqRo3QlJd57klP22HzoOH2g/Wxz01zfsSKJHSEI2hqSu/4bk+6vzffcsSFFVp/ZvVfYzfvbYfOzIORKMCEnItudTJHpIhvdtHoekOJXdG8HtS5lDlpXpTn22sU941wYjQhIy/aVNe6J1M7ko7XFITlnavA18Un+rdmmZqXMk7YmTDTsSjAhJyO6cbH0mJMVhn09f6HRN6c6R6Oda2ZGAkITs4u3f42ZyRdqTIVHnVdfp7/CJ/o8fdiQ4IyQhu3dB2jMvbdbZvnnLN+1Otl68/ZvoL27YkUSP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"},3705:function(e,n,s){"use strict";s.r(n);var a=s(7),t=Object(a.a)({},(function(){var e=this,n=e._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"springboot定时任务-spring-schedule实现方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#springboot定时任务-spring-schedule实现方式"}},[e._v("#")]),e._v(" SpringBoot定时任务 - Spring Schedule实现方式")]),e._v(" "),n("blockquote",[n("p",[e._v("前文我们介绍了Timer和ScheduledExecutorService是JDK内置的定时任务方案以及Netty内部基于时间轮实现的HashedWheelTimer；而主流的SpringBoot集成方案有两种，一种是Spring Sechedule, 另一种是Spring集成Quartz； 本文主要介绍Spring Schedule实现方式。@pdai")])]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#springboot%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1---spring-schedule%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"}},[e._v("SpringBoot定时任务 - Spring Schedule实现方式")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%87%86%E5%A4%87%E7%9F%A5%E8%AF%86%E7%82%B9"}},[e._v("准备知识点")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E4%BB%80%E4%B9%88%E6%98%AFcron%E8%A1%A8%E8%BE%BE%E5%BC%8F"}},[e._v("什么是cron表达式")])])])]),e._v(" "),n("li",[n("a",{attrs:{href:"#%E5%AE%9E%E7%8E%B0%E6%A1%88%E4%BE%8B"}},[e._v("实现案例")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#enableschedulingscheduled"}},[e._v("@EnableScheduling+@Scheduled")])])])]),e._v(" "),n("li",[n("a",{attrs:{href:"#%E8%BF%9B%E4%B8%80%E6%AD%A5%E7%90%86%E8%A7%A3"}},[e._v("进一步理解")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E4%BD%BF%E7%94%A8spring-schedule%E8%A6%81%E6%B3%A8%E6%84%8F%E4%BB%80%E4%B9%88"}},[e._v("使用Spring Schedule要注意什么？")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#springtask%E7%9A%84%E5%8E%9F%E7%90%86"}},[e._v("SpringTask的原理？")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#enablescheduling%E6%B3%A8%E8%A7%A3"}},[e._v("@EnableScheduling注解")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#schedulingconfiguration%E4%B8%AD%E5%88%9D%E5%A7%8B%E5%8C%96scheduledannotationbeanpostprocessor"}},[e._v("SchedulingConfiguration中初始化ScheduledAnnotationBeanPostProcessor")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#scheduledtaskregistrar%E6%B3%A8%E5%86%8Ctask"}},[e._v("ScheduledTaskRegistrar注册task")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#scheduledannotationbeanpostprocessor%E5%8A%A0%E8%BD%BDscheduled%E6%B3%A8%E8%A7%A3"}},[e._v("ScheduledAnnotationBeanPostProcessor加载Scheduled注解")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#scheduledtaskregistrar-%E4%B8%AD%E8%A7%A3%E6%9E%90task"}},[e._v("ScheduledTaskRegistrar 中解析task")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#taskscheduler%E5%AF%B9task%E5%A4%84%E7%90%86"}},[e._v("TaskScheduler对Task处理")])])])])])]),e._v(" "),n("li",[n("a",{attrs:{href:"#%E7%A4%BA%E4%BE%8B%E6%BA%90%E7%A0%81"}},[e._v("示例源码")])])])])]),e._v(" "),n("h1",{attrs:{id:"准备知识点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备知识点"}},[e._v("#")]),e._v(" 准备知识点")]),e._v(" "),n("hr"),e._v(" "),n("blockquote",[n("p",[e._v("cron表达式， 以及BeanPostProcessor（方便你理解它的原理，相关介绍在之前的文章中"),n("a",{attrs:{href:"https://pdai.tech/md/spring/spring-x-framework-ioc-source-3.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring核心之控制反转(IOC)源码解析"),n("OutboundLink")],1),e._v("）.")])]),e._v(" "),n("h3",{attrs:{id:"什么是cron表达式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是cron表达式"}},[e._v("#")]),e._v(" 什么是cron表达式")]),e._v(" "),n("p",[e._v("定时任务和CRON表达式在开发中使用也非常广泛；在学习时，总体上理解，对常用的知悉，开发时可以快速查询使用即可。")]),e._v(" "),n("p",[n("em",[e._v("相关文章")])]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/cron/dev-cron-x-usage.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("CRON表达式 - CRON表达式介绍和使用"),n("OutboundLink")],1),e._v(" "),n("ul",[n("li",[e._v("定时任务和CRON表达式在开发中使用也非常广泛，本文整理了CRON表达式和常见使用例子")])])]),e._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/cron/dev-cron-x-tools.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("CRON表达式 - CRON生成和校验工具"),n("OutboundLink")],1),e._v(" "),n("ul",[n("li",[e._v("本文主要总结常用的在线CRON生成和校验工具，从而高效的写出正确的表达式")])])])]),e._v(" "),n("h1",{attrs:{id:"实现案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现案例"}},[e._v("#")]),e._v(" 实现案例")]),e._v(" "),n("hr"),e._v(" "),n("blockquote",[n("p",[e._v("SpringTask封装的比较好，使用非常简单。")])]),e._v(" "),n("h3",{attrs:{id:"enablescheduling-scheduled"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#enablescheduling-scheduled"}},[e._v("#")]),e._v(" @EnableScheduling+@Scheduled")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("通过@EnableScheduling启用定时任务，@Scheduled定义任务")])])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('@EnableScheduling\n@Configuration\npublic class ScheduleDemo {\n\n    /**\n     * 每隔1分钟执行一次。\n     */\n    @Scheduled(fixedRate = 1000 * 60 * 1)\n    public void runScheduleFixedRate() {\n        log.info("runScheduleFixedRate: current DateTime, {}", LocalDateTime.now());\n    }\n\n    /**\n     * 每个整点小时执行一次。\n     */\n    @Scheduled(cron = "0 0 */1 * * ?")\n    public void runScheduleCron() {\n        log.info("runScheduleCron: current DateTime, {}", LocalDateTime.now());\n    }\n\n}\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br")])]),n("ul",[n("li",[n("strong",[e._v("@Scheduled所支持的参数")]),e._v("：")])]),e._v(" "),n("ol",[n("li",[n("code",[e._v("cron")]),e._v("：cron表达式，指定任务在特定时间执行；")]),e._v(" "),n("li",[n("code",[e._v("fixedDelay")]),e._v("：表示上一次任务执行完成后多久再次执行，参数类型为long，单位ms；")]),e._v(" "),n("li",[n("code",[e._v("fixedDelayString")]),e._v("：与fixedDelay含义一样，只是参数类型变为String；")]),e._v(" "),n("li",[n("code",[e._v("fixedRate")]),e._v("：表示按一定的频率执行任务，参数类型为long，单位ms；")]),e._v(" "),n("li",[n("code",[e._v("fixedRateString")]),e._v(": 与fixedRate的含义一样，只是将参数类型变为String；")]),e._v(" "),n("li",[n("code",[e._v("initialDelay")]),e._v("：表示延迟多久再第一次执行任务，参数类型为long，单位ms；")]),e._v(" "),n("li",[n("code",[e._v("initialDelayString")]),e._v("：与initialDelay的含义一样，只是将参数类型变为String；")]),e._v(" "),n("li",[n("code",[e._v("zone")]),e._v("：时区，默认为当前时区，一般没有用到。")])]),e._v(" "),n("h1",{attrs:{id:"进一步理解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#进一步理解"}},[e._v("#")]),e._v(" 进一步理解")]),e._v(" "),n("hr"),e._v(" "),n("blockquote",[n("p",[e._v("我们再通过一些问题来帮助你更深入理解SpringTask实现方式。@pdai")])]),e._v(" "),n("h3",{attrs:{id:"使用spring-schedule要注意什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用spring-schedule要注意什么"}},[e._v("#")]),e._v(" 使用Spring Schedule要注意什么？")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("关于异常处理")])])]),e._v(" "),n("p",[e._v("建议自行处理异常")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("关于超时处理")])])]),e._v(" "),n("p",[e._v("在实际的开发中，这个问题经常会出现，比如执行一段时间后定时任务不再执行了； 这种情况会发生在，比如你调用一个第三方接口，没有设置调用超时，继而引发异常，这时候当前任务便阻塞了。")]),e._v(" "),n("h3",{attrs:{id:"springtask的原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#springtask的原理"}},[e._v("#")]),e._v(" SpringTask的原理？")]),e._v(" "),n("blockquote",[n("p",[e._v("SpringTask的源码在这里：")])]),e._v(" "),n("p",[n("img",{attrs:{src:s(1141),alt:""}})]),e._v(" "),n("h4",{attrs:{id:"enablescheduling注解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#enablescheduling注解"}},[e._v("#")]),e._v(" @EnableScheduling注解")]),e._v(" "),n("p",[e._v("添加@EnableScheduling注解会自动注入SchedulingConfiguration")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v(" * @author Chris Beams\n * @author Juergen Hoeller\n * @since 3.1\n * @see Scheduled\n * @see SchedulingConfiguration\n * @see SchedulingConfigurer\n * @see ScheduledTaskRegistrar\n * @see Trigger\n * @see ScheduledAnnotationBeanPostProcessor\n */\n@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\n@Import(SchedulingConfiguration.class)\n@Documented\npublic @interface EnableScheduling {\n\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br")])]),n("h4",{attrs:{id:"schedulingconfiguration中初始化scheduledannotationbeanpostprocessor"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#schedulingconfiguration中初始化scheduledannotationbeanpostprocessor"}},[e._v("#")]),e._v(" SchedulingConfiguration中初始化ScheduledAnnotationBeanPostProcessor")]),e._v(" "),n("p",[e._v("SchedulingConfiguration配置中自动初始化ScheduledAnnotationBeanPostProcessor")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("@Configuration(proxyBeanMethods = false)\n@Role(BeanDefinition.ROLE_INFRASTRUCTURE)\npublic class SchedulingConfiguration {\n\n\t@Bean(name = TaskManagementConfigUtils.SCHEDULED_ANNOTATION_PROCESSOR_BEAN_NAME)\n\t@Role(BeanDefinition.ROLE_INFRASTRUCTURE)\n\tpublic ScheduledAnnotationBeanPostProcessor scheduledAnnotationProcessor() {\n\t\treturn new ScheduledAnnotationBeanPostProcessor();\n\t}\n\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br")])]),n("p",[e._v("什么是BeanPostProcessor? 我们在前文中有详解的讲解，具体看"),n("a",{attrs:{href:"https://pdai.tech/md/spring/spring-x-framework-ioc-source-3.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring核心之控制反转(IOC)源码解析"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("strong",[e._v("Spring 容器中 Bean 的生命周期流程")])]),e._v(" "),n("p",[n("img",{attrs:{src:s(1142),alt:""}})]),e._v(" "),n("h4",{attrs:{id:"cheduledtaskregistrar注册task"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cheduledtaskregistrar注册task"}},[e._v("#")]),e._v(" cheduledTaskRegistrar注册task")]),e._v(" "),n("p",[e._v("在ScheduledAnnotationBeanPostProcessor构造函数中初始化了ScheduledTaskRegistrar")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("/**\n    * Create a default {@code ScheduledAnnotationBeanPostProcessor}.\n    */\npublic ScheduledAnnotationBeanPostProcessor() {\n    this.registrar = new ScheduledTaskRegistrar();\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("ScheduledTaskRegistrar最主要的是注册各种类型的task （这种方式在新的版本中已经废弃了）")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("protected void scheduleTasks() {\n    if (this.taskScheduler == null) {\n        this.localExecutor = Executors.newSingleThreadScheduledExecutor();\n        this.taskScheduler = new ConcurrentTaskScheduler(this.localExecutor);\n    }\n    if (this.triggerTasks != null) {\n        for (TriggerTask task : this.triggerTasks) {\n            addScheduledTask(scheduleTriggerTask(task));\n        }\n    }\n    if (this.cronTasks != null) {\n        for (CronTask task : this.cronTasks) {\n            addScheduledTask(scheduleCronTask(task));\n        }\n    }\n    if (this.fixedRateTasks != null) {\n        for (IntervalTask task : this.fixedRateTasks) {\n            addScheduledTask(scheduleFixedRateTask(task));\n        }\n    }\n    if (this.fixedDelayTasks != null) {\n        for (IntervalTask task : this.fixedDelayTasks) {\n            addScheduledTask(scheduleFixedDelayTask(task));\n        }\n    }\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br")])]),n("p",[e._v("注册哪些Task，怎么设计类的呢？")]),e._v(" "),n("p",[n("img",{attrs:{src:s(1143),alt:""}})]),e._v(" "),n("h4",{attrs:{id:"scheduledannotationbeanpostprocessor加载scheduled注解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#scheduledannotationbeanpostprocessor加载scheduled注解"}},[e._v("#")]),e._v(" ScheduledAnnotationBeanPostProcessor加载Scheduled注解")]),e._v(" "),n("p",[e._v("在BeanPostProcessor的postProcessAfterInitialization阶段加载Scheduled注解")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('@Override\npublic Object postProcessAfterInitialization(Object bean, String beanName) {\n    if (bean instanceof AopInfrastructureBean || bean instanceof TaskScheduler ||\n            bean instanceof ScheduledExecutorService) {\n        // Ignore AOP infrastructure such as scoped proxies.\n        return bean;\n    }\n\n    Class<?> targetClass = AopProxyUtils.ultimateTargetClass(bean);\n    if (!this.nonAnnotatedClasses.contains(targetClass) &&\n            AnnotationUtils.isCandidateClass(targetClass, Arrays.asList(Scheduled.class, Schedules.class))) {\n        Map<Method, Set<Scheduled>> annotatedMethods = MethodIntrospector.selectMethods(targetClass,\n                (MethodIntrospector.MetadataLookup<Set<Scheduled>>) method -> {\n                    Set<Scheduled> scheduledAnnotations = AnnotatedElementUtils.getMergedRepeatableAnnotations(\n                            method, Scheduled.class, Schedules.class);\n                    return (!scheduledAnnotations.isEmpty() ? scheduledAnnotations : null);\n                });\n        if (annotatedMethods.isEmpty()) {\n            this.nonAnnotatedClasses.add(targetClass);\n            if (logger.isTraceEnabled()) {\n                logger.trace("No @Scheduled annotations found on bean class: " + targetClass);\n            }\n        }\n        else {\n            // Non-empty set of methods\n            annotatedMethods.forEach((method, scheduledAnnotations) ->\n                    scheduledAnnotations.forEach(scheduled -> processScheduled(scheduled, method, bean)));\n            if (logger.isTraceEnabled()) {\n                logger.trace(annotatedMethods.size() + " @Scheduled methods processed on bean \'" + beanName +\n                        "\': " + annotatedMethods);\n            }\n        }\n    }\n    return bean;\n}\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br"),n("span",{staticClass:"line-number"},[e._v("27")]),n("br"),n("span",{staticClass:"line-number"},[e._v("28")]),n("br"),n("span",{staticClass:"line-number"},[e._v("29")]),n("br"),n("span",{staticClass:"line-number"},[e._v("30")]),n("br"),n("span",{staticClass:"line-number"},[e._v("31")]),n("br"),n("span",{staticClass:"line-number"},[e._v("32")]),n("br"),n("span",{staticClass:"line-number"},[e._v("33")]),n("br"),n("span",{staticClass:"line-number"},[e._v("34")]),n("br"),n("span",{staticClass:"line-number"},[e._v("35")]),n("br")])]),n("p",[e._v("Scheduled注解是添加到方法级别，具体如下")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('@Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Repeatable(Schedules.class)\npublic @interface Scheduled {\n\n\t/**\n\t * A special cron expression value that indicates a disabled trigger: {@value}.\n\t * <p>This is primarily meant for use with <code>${...}</code> placeholders,\n\t * allowing for external disabling of corresponding scheduled methods.\n\t * @since 5.1\n\t * @see ScheduledTaskRegistrar#CRON_DISABLED\n\t */\n\tString CRON_DISABLED = ScheduledTaskRegistrar.CRON_DISABLED;\n\n\n\t/**\n\t * A cron-like expression, extending the usual UN*X definition to include triggers\n\t * on the second, minute, hour, day of month, month, and day of week.\n\t * <p>For example, {@code "0 * * * * MON-FRI"} means once per minute on weekdays\n\t * (at the top of the minute - the 0th second).\n\t * <p>The fields read from left to right are interpreted as follows.\n\t * <ul>\n\t * <li>second</li>\n\t * <li>minute</li>\n\t * <li>hour</li>\n\t * <li>day of month</li>\n\t * <li>month</li>\n\t * <li>day of week</li>\n\t * </ul>\n\t * <p>The special value {@link #CRON_DISABLED "-"} indicates a disabled cron\n\t * trigger, primarily meant for externally specified values resolved by a\n\t * <code>${...}</code> placeholder.\n\t * @return an expression that can be parsed to a cron schedule\n\t * @see org.springframework.scheduling.support.CronExpression#parse(String)\n\t */\n\tString cron() default "";\n\n\t/**\n\t * A time zone for which the cron expression will be resolved. By default, this\n\t * attribute is the empty String (i.e. the server\'s local time zone will be used).\n\t * @return a zone id accepted by {@link java.util.TimeZone#getTimeZone(String)},\n\t * or an empty String to indicate the server\'s default time zone\n\t * @since 4.0\n\t * @see org.springframework.scheduling.support.CronTrigger#CronTrigger(String, java.util.TimeZone)\n\t * @see java.util.TimeZone\n\t */\n\tString zone() default "";\n\n\t/**\n\t * Execute the annotated method with a fixed period between the end of the\n\t * last invocation and the start of the next.\n\t * <p>The time unit is milliseconds by default but can be overridden via\n\t * {@link #timeUnit}.\n\t * @return the delay\n\t */\n\tlong fixedDelay() default -1;\n\n\t/**\n\t * Execute the annotated method with a fixed period between the end of the\n\t * last invocation and the start of the next.\n\t * <p>The time unit is milliseconds by default but can be overridden via\n\t * {@link #timeUnit}.\n\t * @return the delay as a String value &mdash; for example, a placeholder\n\t * or a {@link java.time.Duration#parse java.time.Duration} compliant value\n\t * @since 3.2.2\n\t */\n\tString fixedDelayString() default "";\n\n\t/**\n\t * Execute the annotated method with a fixed period between invocations.\n\t * <p>The time unit is milliseconds by default but can be overridden via\n\t * {@link #timeUnit}.\n\t * @return the period\n\t */\n\tlong fixedRate() default -1;\n\n\t/**\n\t * Execute the annotated method with a fixed period between invocations.\n\t * <p>The time unit is milliseconds by default but can be overridden via\n\t * {@link #timeUnit}.\n\t * @return the period as a String value &mdash; for example, a placeholder\n\t * or a {@link java.time.Duration#parse java.time.Duration} compliant value\n\t * @since 3.2.2\n\t */\n\tString fixedRateString() default "";\n\n\t/**\n\t * Number of units of time to delay before the first execution of a\n\t * {@link #fixedRate} or {@link #fixedDelay} task.\n\t * <p>The time unit is milliseconds by default but can be overridden via\n\t * {@link #timeUnit}.\n\t * @return the initial\n\t * @since 3.2\n\t */\n\tlong initialDelay() default -1;\n\n\t/**\n\t * Number of units of time to delay before the first execution of a\n\t * {@link #fixedRate} or {@link #fixedDelay} task.\n\t * <p>The time unit is milliseconds by default but can be overridden via\n\t * {@link #timeUnit}.\n\t * @return the initial delay as a String value &mdash; for example, a placeholder\n\t * or a {@link java.time.Duration#parse java.time.Duration} compliant value\n\t * @since 3.2.2\n\t */\n\tString initialDelayString() default "";\n\n\t/**\n\t * The {@link TimeUnit} to use for {@link #fixedDelay}, {@link #fixedDelayString},\n\t * {@link #fixedRate}, {@link #fixedRateString}, {@link #initialDelay}, and\n\t * {@link #initialDelayString}.\n\t * <p>Defaults to {@link TimeUnit#MICROSECONDS}.\n\t * <p>This attribute is ignored for {@linkplain #cron() cron expressions}\n\t * and for {@link java.time.Duration} values supplied via {@link #fixedDelayString},\n\t * {@link #fixedRateString}, or {@link #initialDelayString}.\n\t * @return the {@code TimeUnit} to use\n\t * @since 5.3.10\n\t */\n\tTimeUnit timeUnit() default TimeUnit.MILLISECONDS;\n\n}\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br"),n("span",{staticClass:"line-number"},[e._v("27")]),n("br"),n("span",{staticClass:"line-number"},[e._v("28")]),n("br"),n("span",{staticClass:"line-number"},[e._v("29")]),n("br"),n("span",{staticClass:"line-number"},[e._v("30")]),n("br"),n("span",{staticClass:"line-number"},[e._v("31")]),n("br"),n("span",{staticClass:"line-number"},[e._v("32")]),n("br"),n("span",{staticClass:"line-number"},[e._v("33")]),n("br"),n("span",{staticClass:"line-number"},[e._v("34")]),n("br"),n("span",{staticClass:"line-number"},[e._v("35")]),n("br"),n("span",{staticClass:"line-number"},[e._v("36")]),n("br"),n("span",{staticClass:"line-number"},[e._v("37")]),n("br"),n("span",{staticClass:"line-number"},[e._v("38")]),n("br"),n("span",{staticClass:"line-number"},[e._v("39")]),n("br"),n("span",{staticClass:"line-number"},[e._v("40")]),n("br"),n("span",{staticClass:"line-number"},[e._v("41")]),n("br"),n("span",{staticClass:"line-number"},[e._v("42")]),n("br"),n("span",{staticClass:"line-number"},[e._v("43")]),n("br"),n("span",{staticClass:"line-number"},[e._v("44")]),n("br"),n("span",{staticClass:"line-number"},[e._v("45")]),n("br"),n("span",{staticClass:"line-number"},[e._v("46")]),n("br"),n("span",{staticClass:"line-number"},[e._v("47")]),n("br"),n("span",{staticClass:"line-number"},[e._v("48")]),n("br"),n("span",{staticClass:"line-number"},[e._v("49")]),n("br"),n("span",{staticClass:"line-number"},[e._v("50")]),n("br"),n("span",{staticClass:"line-number"},[e._v("51")]),n("br"),n("span",{staticClass:"line-number"},[e._v("52")]),n("br"),n("span",{staticClass:"line-number"},[e._v("53")]),n("br"),n("span",{staticClass:"line-number"},[e._v("54")]),n("br"),n("span",{staticClass:"line-number"},[e._v("55")]),n("br"),n("span",{staticClass:"line-number"},[e._v("56")]),n("br"),n("span",{staticClass:"line-number"},[e._v("57")]),n("br"),n("span",{staticClass:"line-number"},[e._v("58")]),n("br"),n("span",{staticClass:"line-number"},[e._v("59")]),n("br"),n("span",{staticClass:"line-number"},[e._v("60")]),n("br"),n("span",{staticClass:"line-number"},[e._v("61")]),n("br"),n("span",{staticClass:"line-number"},[e._v("62")]),n("br"),n("span",{staticClass:"line-number"},[e._v("63")]),n("br"),n("span",{staticClass:"line-number"},[e._v("64")]),n("br"),n("span",{staticClass:"line-number"},[e._v("65")]),n("br"),n("span",{staticClass:"line-number"},[e._v("66")]),n("br"),n("span",{staticClass:"line-number"},[e._v("67")]),n("br"),n("span",{staticClass:"line-number"},[e._v("68")]),n("br"),n("span",{staticClass:"line-number"},[e._v("69")]),n("br"),n("span",{staticClass:"line-number"},[e._v("70")]),n("br"),n("span",{staticClass:"line-number"},[e._v("71")]),n("br"),n("span",{staticClass:"line-number"},[e._v("72")]),n("br"),n("span",{staticClass:"line-number"},[e._v("73")]),n("br"),n("span",{staticClass:"line-number"},[e._v("74")]),n("br"),n("span",{staticClass:"line-number"},[e._v("75")]),n("br"),n("span",{staticClass:"line-number"},[e._v("76")]),n("br"),n("span",{staticClass:"line-number"},[e._v("77")]),n("br"),n("span",{staticClass:"line-number"},[e._v("78")]),n("br"),n("span",{staticClass:"line-number"},[e._v("79")]),n("br"),n("span",{staticClass:"line-number"},[e._v("80")]),n("br"),n("span",{staticClass:"line-number"},[e._v("81")]),n("br"),n("span",{staticClass:"line-number"},[e._v("82")]),n("br"),n("span",{staticClass:"line-number"},[e._v("83")]),n("br"),n("span",{staticClass:"line-number"},[e._v("84")]),n("br"),n("span",{staticClass:"line-number"},[e._v("85")]),n("br"),n("span",{staticClass:"line-number"},[e._v("86")]),n("br"),n("span",{staticClass:"line-number"},[e._v("87")]),n("br"),n("span",{staticClass:"line-number"},[e._v("88")]),n("br"),n("span",{staticClass:"line-number"},[e._v("89")]),n("br"),n("span",{staticClass:"line-number"},[e._v("90")]),n("br"),n("span",{staticClass:"line-number"},[e._v("91")]),n("br"),n("span",{staticClass:"line-number"},[e._v("92")]),n("br"),n("span",{staticClass:"line-number"},[e._v("93")]),n("br"),n("span",{staticClass:"line-number"},[e._v("94")]),n("br"),n("span",{staticClass:"line-number"},[e._v("95")]),n("br"),n("span",{staticClass:"line-number"},[e._v("96")]),n("br"),n("span",{staticClass:"line-number"},[e._v("97")]),n("br"),n("span",{staticClass:"line-number"},[e._v("98")]),n("br"),n("span",{staticClass:"line-number"},[e._v("99")]),n("br"),n("span",{staticClass:"line-number"},[e._v("100")]),n("br"),n("span",{staticClass:"line-number"},[e._v("101")]),n("br"),n("span",{staticClass:"line-number"},[e._v("102")]),n("br"),n("span",{staticClass:"line-number"},[e._v("103")]),n("br"),n("span",{staticClass:"line-number"},[e._v("104")]),n("br"),n("span",{staticClass:"line-number"},[e._v("105")]),n("br"),n("span",{staticClass:"line-number"},[e._v("106")]),n("br"),n("span",{staticClass:"line-number"},[e._v("107")]),n("br"),n("span",{staticClass:"line-number"},[e._v("108")]),n("br"),n("span",{staticClass:"line-number"},[e._v("109")]),n("br"),n("span",{staticClass:"line-number"},[e._v("110")]),n("br"),n("span",{staticClass:"line-number"},[e._v("111")]),n("br"),n("span",{staticClass:"line-number"},[e._v("112")]),n("br"),n("span",{staticClass:"line-number"},[e._v("113")]),n("br"),n("span",{staticClass:"line-number"},[e._v("114")]),n("br"),n("span",{staticClass:"line-number"},[e._v("115")]),n("br"),n("span",{staticClass:"line-number"},[e._v("116")]),n("br"),n("span",{staticClass:"line-number"},[e._v("117")]),n("br"),n("span",{staticClass:"line-number"},[e._v("118")]),n("br"),n("span",{staticClass:"line-number"},[e._v("119")]),n("br"),n("span",{staticClass:"line-number"},[e._v("120")]),n("br"),n("span",{staticClass:"line-number"},[e._v("121")]),n("br"),n("span",{staticClass:"line-number"},[e._v("122")]),n("br")])]),n("p",[e._v("@Scheduled所支持的参数：")]),e._v(" "),n("ol",[n("li",[n("code",[e._v("cron")]),e._v("：cron表达式，指定任务在特定时间执行；")]),e._v(" "),n("li",[n("code",[e._v("fixedDelay")]),e._v("：表示上一次任务执行完成后多久再次执行，参数类型为long，单位ms；")]),e._v(" "),n("li",[n("code",[e._v("fixedDelayString")]),e._v("：与fixedDelay含义一样，只是参数类型变为String；")]),e._v(" "),n("li",[n("code",[e._v("fixedRate")]),e._v("：表示按一定的频率执行任务，参数类型为long，单位ms；")]),e._v(" "),n("li",[n("code",[e._v("fixedRateString")]),e._v(": 与fixedRate的含义一样，只是将参数类型变为String；")]),e._v(" "),n("li",[n("code",[e._v("initialDelay")]),e._v("：表示延迟多久再第一次执行任务，参数类型为long，单位ms；")]),e._v(" "),n("li",[n("code",[e._v("initialDelayString")]),e._v("：与initialDelay的含义一样，只是将参数类型变为String；")]),e._v(" "),n("li",[n("code",[e._v("zone")]),e._v("：时区，默认为当前时区，一般没有用到。")])]),e._v(" "),n("p",[e._v("获取到方法上Scheduled注解（对任务的定义），通过processScheduled处理具体类型的task")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('/**\n    * Process the given {@code @Scheduled} method declaration on the given bean.\n    * @param scheduled the {@code @Scheduled} annotation\n    * @param method the method that the annotation has been declared on\n    * @param bean the target bean instance\n    * @see #createRunnable(Object, Method)\n    */\nprotected void processScheduled(Scheduled scheduled, Method method, Object bean) {\n    try {\n        Runnable runnable = createRunnable(bean, method);\n        boolean processedSchedule = false;\n        String errorMessage =\n                "Exactly one of the \'cron\', \'fixedDelay(String)\', or \'fixedRate(String)\' attributes is required";\n\n        Set<ScheduledTask> tasks = new LinkedHashSet<>(4);\n\n        // Determine initial delay\n        long initialDelay = convertToMillis(scheduled.initialDelay(), scheduled.timeUnit());\n        String initialDelayString = scheduled.initialDelayString();\n        if (StringUtils.hasText(initialDelayString)) {\n            Assert.isTrue(initialDelay < 0, "Specify \'initialDelay\' or \'initialDelayString\', not both");\n            if (this.embeddedValueResolver != null) {\n                initialDelayString = this.embeddedValueResolver.resolveStringValue(initialDelayString);\n            }\n            if (StringUtils.hasLength(initialDelayString)) {\n                try {\n                    initialDelay = convertToMillis(initialDelayString, scheduled.timeUnit());\n                }\n                catch (RuntimeException ex) {\n                    throw new IllegalArgumentException(\n                            "Invalid initialDelayString value \\"" + initialDelayString + "\\" - cannot parse into long");\n                }\n            }\n        }\n\n        // Check cron expression\n        String cron = scheduled.cron();\n        if (StringUtils.hasText(cron)) {\n            String zone = scheduled.zone();\n            if (this.embeddedValueResolver != null) {\n                cron = this.embeddedValueResolver.resolveStringValue(cron);\n                zone = this.embeddedValueResolver.resolveStringValue(zone);\n            }\n            if (StringUtils.hasLength(cron)) {\n                Assert.isTrue(initialDelay == -1, "\'initialDelay\' not supported for cron triggers");\n                processedSchedule = true;\n                if (!Scheduled.CRON_DISABLED.equals(cron)) {\n                    TimeZone timeZone;\n                    if (StringUtils.hasText(zone)) {\n                        timeZone = StringUtils.parseTimeZoneString(zone);\n                    }\n                    else {\n                        timeZone = TimeZone.getDefault();\n                    }\n                    tasks.add(this.registrar.scheduleCronTask(new CronTask(runnable, new CronTrigger(cron, timeZone))));\n                }\n            }\n        }\n\n        // At this point we don\'t need to differentiate between initial delay set or not anymore\n        if (initialDelay < 0) {\n            initialDelay = 0;\n        }\n\n        // Check fixed delay\n        long fixedDelay = convertToMillis(scheduled.fixedDelay(), scheduled.timeUnit());\n        if (fixedDelay >= 0) {\n            Assert.isTrue(!processedSchedule, errorMessage);\n            processedSchedule = true;\n            tasks.add(this.registrar.scheduleFixedDelayTask(new FixedDelayTask(runnable, fixedDelay, initialDelay)));\n        }\n\n        String fixedDelayString = scheduled.fixedDelayString();\n        if (StringUtils.hasText(fixedDelayString)) {\n            if (this.embeddedValueResolver != null) {\n                fixedDelayString = this.embeddedValueResolver.resolveStringValue(fixedDelayString);\n            }\n            if (StringUtils.hasLength(fixedDelayString)) {\n                Assert.isTrue(!processedSchedule, errorMessage);\n                processedSchedule = true;\n                try {\n                    fixedDelay = convertToMillis(fixedDelayString, scheduled.timeUnit());\n                }\n                catch (RuntimeException ex) {\n                    throw new IllegalArgumentException(\n                            "Invalid fixedDelayString value \\"" + fixedDelayString + "\\" - cannot parse into long");\n                }\n                tasks.add(this.registrar.scheduleFixedDelayTask(new FixedDelayTask(runnable, fixedDelay, initialDelay)));\n            }\n        }\n\n        // Check fixed rate\n        long fixedRate = convertToMillis(scheduled.fixedRate(), scheduled.timeUnit());\n        if (fixedRate >= 0) {\n            Assert.isTrue(!processedSchedule, errorMessage);\n            processedSchedule = true;\n            tasks.add(this.registrar.scheduleFixedRateTask(new FixedRateTask(runnable, fixedRate, initialDelay)));\n        }\n        String fixedRateString = scheduled.fixedRateString();\n        if (StringUtils.hasText(fixedRateString)) {\n            if (this.embeddedValueResolver != null) {\n                fixedRateString = this.embeddedValueResolver.resolveStringValue(fixedRateString);\n            }\n            if (StringUtils.hasLength(fixedRateString)) {\n                Assert.isTrue(!processedSchedule, errorMessage);\n                processedSchedule = true;\n                try {\n                    fixedRate = convertToMillis(fixedRateString, scheduled.timeUnit());\n                }\n                catch (RuntimeException ex) {\n                    throw new IllegalArgumentException(\n                            "Invalid fixedRateString value \\"" + fixedRateString + "\\" - cannot parse into long");\n                }\n                tasks.add(this.registrar.scheduleFixedRateTask(new FixedRateTask(runnable, fixedRate, initialDelay)));\n            }\n        }\n\n        // Check whether we had any attribute set\n        Assert.isTrue(processedSchedule, errorMessage);\n\n        // Finally register the scheduled tasks\n        synchronized (this.scheduledTasks) {\n            Set<ScheduledTask> regTasks = this.scheduledTasks.computeIfAbsent(bean, key -> new LinkedHashSet<>(4));\n            regTasks.addAll(tasks);\n        }\n    }\n    catch (IllegalArgumentException ex) {\n        throw new IllegalStateException(\n                "Encountered invalid @Scheduled method \'" + method.getName() + "\': " + ex.getMessage());\n    }\n}\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br"),n("span",{staticClass:"line-number"},[e._v("27")]),n("br"),n("span",{staticClass:"line-number"},[e._v("28")]),n("br"),n("span",{staticClass:"line-number"},[e._v("29")]),n("br"),n("span",{staticClass:"line-number"},[e._v("30")]),n("br"),n("span",{staticClass:"line-number"},[e._v("31")]),n("br"),n("span",{staticClass:"line-number"},[e._v("32")]),n("br"),n("span",{staticClass:"line-number"},[e._v("33")]),n("br"),n("span",{staticClass:"line-number"},[e._v("34")]),n("br"),n("span",{staticClass:"line-number"},[e._v("35")]),n("br"),n("span",{staticClass:"line-number"},[e._v("36")]),n("br"),n("span",{staticClass:"line-number"},[e._v("37")]),n("br"),n("span",{staticClass:"line-number"},[e._v("38")]),n("br"),n("span",{staticClass:"line-number"},[e._v("39")]),n("br"),n("span",{staticClass:"line-number"},[e._v("40")]),n("br"),n("span",{staticClass:"line-number"},[e._v("41")]),n("br"),n("span",{staticClass:"line-number"},[e._v("42")]),n("br"),n("span",{staticClass:"line-number"},[e._v("43")]),n("br"),n("span",{staticClass:"line-number"},[e._v("44")]),n("br"),n("span",{staticClass:"line-number"},[e._v("45")]),n("br"),n("span",{staticClass:"line-number"},[e._v("46")]),n("br"),n("span",{staticClass:"line-number"},[e._v("47")]),n("br"),n("span",{staticClass:"line-number"},[e._v("48")]),n("br"),n("span",{staticClass:"line-number"},[e._v("49")]),n("br"),n("span",{staticClass:"line-number"},[e._v("50")]),n("br"),n("span",{staticClass:"line-number"},[e._v("51")]),n("br"),n("span",{staticClass:"line-number"},[e._v("52")]),n("br"),n("span",{staticClass:"line-number"},[e._v("53")]),n("br"),n("span",{staticClass:"line-number"},[e._v("54")]),n("br"),n("span",{staticClass:"line-number"},[e._v("55")]),n("br"),n("span",{staticClass:"line-number"},[e._v("56")]),n("br"),n("span",{staticClass:"line-number"},[e._v("57")]),n("br"),n("span",{staticClass:"line-number"},[e._v("58")]),n("br"),n("span",{staticClass:"line-number"},[e._v("59")]),n("br"),n("span",{staticClass:"line-number"},[e._v("60")]),n("br"),n("span",{staticClass:"line-number"},[e._v("61")]),n("br"),n("span",{staticClass:"line-number"},[e._v("62")]),n("br"),n("span",{staticClass:"line-number"},[e._v("63")]),n("br"),n("span",{staticClass:"line-number"},[e._v("64")]),n("br"),n("span",{staticClass:"line-number"},[e._v("65")]),n("br"),n("span",{staticClass:"line-number"},[e._v("66")]),n("br"),n("span",{staticClass:"line-number"},[e._v("67")]),n("br"),n("span",{staticClass:"line-number"},[e._v("68")]),n("br"),n("span",{staticClass:"line-number"},[e._v("69")]),n("br"),n("span",{staticClass:"line-number"},[e._v("70")]),n("br"),n("span",{staticClass:"line-number"},[e._v("71")]),n("br"),n("span",{staticClass:"line-number"},[e._v("72")]),n("br"),n("span",{staticClass:"line-number"},[e._v("73")]),n("br"),n("span",{staticClass:"line-number"},[e._v("74")]),n("br"),n("span",{staticClass:"line-number"},[e._v("75")]),n("br"),n("span",{staticClass:"line-number"},[e._v("76")]),n("br"),n("span",{staticClass:"line-number"},[e._v("77")]),n("br"),n("span",{staticClass:"line-number"},[e._v("78")]),n("br"),n("span",{staticClass:"line-number"},[e._v("79")]),n("br"),n("span",{staticClass:"line-number"},[e._v("80")]),n("br"),n("span",{staticClass:"line-number"},[e._v("81")]),n("br"),n("span",{staticClass:"line-number"},[e._v("82")]),n("br"),n("span",{staticClass:"line-number"},[e._v("83")]),n("br"),n("span",{staticClass:"line-number"},[e._v("84")]),n("br"),n("span",{staticClass:"line-number"},[e._v("85")]),n("br"),n("span",{staticClass:"line-number"},[e._v("86")]),n("br"),n("span",{staticClass:"line-number"},[e._v("87")]),n("br"),n("span",{staticClass:"line-number"},[e._v("88")]),n("br"),n("span",{staticClass:"line-number"},[e._v("89")]),n("br"),n("span",{staticClass:"line-number"},[e._v("90")]),n("br"),n("span",{staticClass:"line-number"},[e._v("91")]),n("br"),n("span",{staticClass:"line-number"},[e._v("92")]),n("br"),n("span",{staticClass:"line-number"},[e._v("93")]),n("br"),n("span",{staticClass:"line-number"},[e._v("94")]),n("br"),n("span",{staticClass:"line-number"},[e._v("95")]),n("br"),n("span",{staticClass:"line-number"},[e._v("96")]),n("br"),n("span",{staticClass:"line-number"},[e._v("97")]),n("br"),n("span",{staticClass:"line-number"},[e._v("98")]),n("br"),n("span",{staticClass:"line-number"},[e._v("99")]),n("br"),n("span",{staticClass:"line-number"},[e._v("100")]),n("br"),n("span",{staticClass:"line-number"},[e._v("101")]),n("br"),n("span",{staticClass:"line-number"},[e._v("102")]),n("br"),n("span",{staticClass:"line-number"},[e._v("103")]),n("br"),n("span",{staticClass:"line-number"},[e._v("104")]),n("br"),n("span",{staticClass:"line-number"},[e._v("105")]),n("br"),n("span",{staticClass:"line-number"},[e._v("106")]),n("br"),n("span",{staticClass:"line-number"},[e._v("107")]),n("br"),n("span",{staticClass:"line-number"},[e._v("108")]),n("br"),n("span",{staticClass:"line-number"},[e._v("109")]),n("br"),n("span",{staticClass:"line-number"},[e._v("110")]),n("br"),n("span",{staticClass:"line-number"},[e._v("111")]),n("br"),n("span",{staticClass:"line-number"},[e._v("112")]),n("br"),n("span",{staticClass:"line-number"},[e._v("113")]),n("br"),n("span",{staticClass:"line-number"},[e._v("114")]),n("br"),n("span",{staticClass:"line-number"},[e._v("115")]),n("br"),n("span",{staticClass:"line-number"},[e._v("116")]),n("br"),n("span",{staticClass:"line-number"},[e._v("117")]),n("br"),n("span",{staticClass:"line-number"},[e._v("118")]),n("br"),n("span",{staticClass:"line-number"},[e._v("119")]),n("br"),n("span",{staticClass:"line-number"},[e._v("120")]),n("br"),n("span",{staticClass:"line-number"},[e._v("121")]),n("br"),n("span",{staticClass:"line-number"},[e._v("122")]),n("br"),n("span",{staticClass:"line-number"},[e._v("123")]),n("br"),n("span",{staticClass:"line-number"},[e._v("124")]),n("br"),n("span",{staticClass:"line-number"},[e._v("125")]),n("br"),n("span",{staticClass:"line-number"},[e._v("126")]),n("br"),n("span",{staticClass:"line-number"},[e._v("127")]),n("br"),n("span",{staticClass:"line-number"},[e._v("128")]),n("br"),n("span",{staticClass:"line-number"},[e._v("129")]),n("br"),n("span",{staticClass:"line-number"},[e._v("130")]),n("br"),n("span",{staticClass:"line-number"},[e._v("131")]),n("br")])]),n("h4",{attrs:{id:"scheduledtaskregistrar-中解析task"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#scheduledtaskregistrar-中解析task"}},[e._v("#")]),e._v(" ScheduledTaskRegistrar 中解析task")]),e._v(" "),n("p",[e._v("以CronTask为例，如果定义了taskScheduler则由taskScheduler执行，如果没有放到unresolvedTasks中。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("/**\n    * Schedule the specified cron task, either right away if possible\n    * or on initialization of the scheduler.\n    * @return a handle to the scheduled task, allowing to cancel it\n    * (or {@code null} if processing a previously registered task)\n    * @since 4.3\n    */\n@Nullable\npublic ScheduledTask scheduleCronTask(CronTask task) {\n    ScheduledTask scheduledTask = this.unresolvedTasks.remove(task);\n    boolean newTask = false;\n    if (scheduledTask == null) {\n        scheduledTask = new ScheduledTask(task);\n        newTask = true;\n    }\n    if (this.taskScheduler != null) {\n        scheduledTask.future = this.taskScheduler.schedule(task.getRunnable(), task.getTrigger());\n    }\n    else {\n        addCronTask(task);\n        this.unresolvedTasks.put(task, scheduledTask);\n    }\n    return (newTask ? scheduledTask : null);\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br")])]),n("h4",{attrs:{id:"taskscheduler对task处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#taskscheduler对task处理"}},[e._v("#")]),e._v(" TaskScheduler对Task处理")]),e._v(" "),n("p",[e._v("默认是ConcurrentTaskScheduler， 处理方法如下")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('@Override\n@Nullable\npublic ScheduledFuture<?> schedule(Runnable task, Trigger trigger) {\n    try {\n        if (this.enterpriseConcurrentScheduler) {\n            return new EnterpriseConcurrentTriggerScheduler().schedule(decorateTask(task, true), trigger);\n        }\n        else {\n            ErrorHandler errorHandler =\n                    (this.errorHandler != null ? this.errorHandler : TaskUtils.getDefaultErrorHandler(true));\n            return new ReschedulingRunnable(task, trigger, this.clock, this.scheduledExecutor, errorHandler).schedule();\n        }\n    }\n    catch (RejectedExecutionException ex) {\n        throw new TaskRejectedException("Executor [" + this.scheduledExecutor + "] did not accept task: " + task, ex);\n    }\n}\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br")])]),n("p",[e._v("EnterpriseConcurrentTriggerScheduler 是 JSR-236 Trigger标准，它的处理方法如下")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("/**\n    * Delegate that adapts a Spring Trigger to a JSR-236 Trigger.\n    * Separated into an inner class in order to avoid a hard dependency on the JSR-236 API.\n    */\nprivate class EnterpriseConcurrentTriggerScheduler {\n\n    public ScheduledFuture<?> schedule(Runnable task, final Trigger trigger) {\n        ManagedScheduledExecutorService executor = (ManagedScheduledExecutorService) scheduledExecutor;\n        return executor.schedule(task, new javax.enterprise.concurrent.Trigger() {\n            @Override\n            @Nullable\n            public Date getNextRunTime(@Nullable LastExecution le, Date taskScheduledTime) {\n                return (trigger.nextExecutionTime(le != null ?\n                        new SimpleTriggerContext(le.getScheduledStart(), le.getRunStart(), le.getRunEnd()) :\n                        new SimpleTriggerContext()));\n            }\n            @Override\n            public boolean skipRun(LastExecution lastExecution, Date scheduledRunTime) {\n                return false;\n            }\n        });\n    }\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br")])]),n("p",[e._v("如果没有使用EnterpriseConcurrentTriggerScheduler, 则使用ReschedulingRunnable，本质上由ScheduledExecutorService处理")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("public ReschedulingRunnable(Runnable delegate, Trigger trigger, Clock clock,\n\t\t\tScheduledExecutorService executor, ErrorHandler errorHandler) {\n\n    super(delegate, errorHandler);\n    this.trigger = trigger;\n    this.triggerContext = new SimpleTriggerContext(clock);\n    this.executor = executor;\n}\n\n\n@Nullable\npublic ScheduledFuture<?> schedule() {\n    synchronized (this.triggerContextMonitor) {\n        this.scheduledExecutionTime = this.trigger.nextExecutionTime(this.triggerContext);\n        if (this.scheduledExecutionTime == null) {\n            return null;\n        }\n        long initialDelay = this.scheduledExecutionTime.getTime() - this.triggerContext.getClock().millis();\n        this.currentFuture = this.executor.schedule(this, initialDelay, TimeUnit.MILLISECONDS);\n        return this;\n    }\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br")])]),n("h1",{attrs:{id:"示例源码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例源码"}},[e._v("#")]),e._v(" 示例源码")]),e._v(" "),n("hr"),e._v(" "),n("p",[e._v("https://github.com/realpdai/tech-pdai-spring-demos")])])}),[],!1,null,null,null);n.default=t.exports}}]);