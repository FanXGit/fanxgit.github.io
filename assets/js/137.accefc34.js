(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{1084:function(a,s,n){a.exports=n.p+"assets/img/springboot-liquibase-1.ea4d071f.png"},1085:function(a,s,n){a.exports=n.p+"assets/img/springboot-liquibase-2.3c8d9e0e.png"},1086:function(a,s,n){a.exports=n.p+"assets/img/springboot-liquibase-3.94462ab5.png"},1087:function(a,s,n){a.exports=n.p+"assets/img/springboot-liquibase-7.a0bff811.png"},1088:function(a,s,n){a.exports=n.p+"assets/img/springboot-liquibase-4.f38c6248.png"},1089:function(a,s,n){a.exports=n.p+"assets/img/springboot-liquibase-5.dc1e3e54.png"},1090:function(a,s,n){a.exports=n.p+"assets/img/springboot-liquibase-6.7a48fffc.png"},1091:function(a,s,n){a.exports=n.p+"assets/img/springboot-liquibase-8.0f30d872.png"},3686:function(a,s,n){"use strict";n.r(s);var e=n(7),t=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"▶springboot数据库管理-用liquibase对数据库管理和迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#▶springboot数据库管理-用liquibase对数据库管理和迁移"}},[a._v("#")]),a._v(" ▶SpringBoot数据库管理 - 用Liquibase对数据库管理和迁移")]),a._v(" "),s("p",[a._v("=================================================================================")]),a._v(" "),s("blockquote",[s("p",[a._v("Liquibase是一个用于"),s("strong",[a._v("用于跟踪、管理和应用数据库变化的开源工具")]),a._v("，通过日志文件(changelog)的形式记录数据库的变更(changeset)，然后执行日志文件中的修改，将数据库更新或回滚(rollback)到一致的状态。它的目标是提供一种数据库类型无关的解决方案，通过执行schema类型的文件来达到迁移。本文主要介绍SpringBoot与Liquibase的集成。@pdai")])]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#springboot%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86---%E7%94%A8liquibase%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E5%92%8C%E8%BF%81%E7%A7%BB"}},[a._v("▶SpringBoot数据库管理 - 用Liquibase对数据库管理和迁移")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E7%9F%A5%E8%AF%86%E5%87%86%E5%A4%87"}},[a._v("知识准备")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E4%BB%80%E4%B9%88%E6%98%AFliquibase%E8%BF%99%E7%B1%BB%E5%B7%A5%E5%85%B7%E8%A6%81%E8%A7%A3%E5%86%B3%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98"}},[a._v("什么是Liquibase？这类工具要解决什么问题？")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#liquibase%E6%9C%89%E5%93%AA%E4%BA%9B%E6%A6%82%E5%BF%B5%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84"}},[a._v("Liquibase有哪些概念？是如何工作的？")])])])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"}},[a._v("简单示例")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#pom%E4%BE%9D%E8%B5%96"}},[a._v("POM依赖")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#yml%E9%85%8D%E7%BD%AE"}},[a._v("yml配置")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E6%96%B0%E5%A2%9Echangelog"}},[a._v("新增changelog")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E6%B5%8B%E8%AF%95"}},[a._v("测试")])])])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E8%BF%9B%E4%B8%80%E6%AD%A5%E7%90%86%E8%A7%A3"}},[a._v("进一步理解")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E6%AF%94%E8%BE%83%E5%A5%BD%E7%9A%84changelog%E7%9A%84%E5%AE%9E%E8%B7%B5"}},[a._v("比较好的changelog的实践？")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E9%99%A4%E4%BA%86addcolumnaddtable%E8%BF%98%E6%9C%89%E5%93%AA%E4%BA%9Bchangetype%E5%91%A2"}},[a._v("除了addColumn,addTable还有哪些changeType呢？")])])])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E7%A4%BA%E4%BE%8B%E6%BA%90%E7%A0%81"}},[a._v("示例源码")])])])])]),a._v(" "),s("h1",{attrs:{id:"知识准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#知识准备"}},[a._v("#")]),a._v(" 知识准备")]),a._v(" "),s("hr"),a._v(" "),s("blockquote",[s("p",[a._v("需要理解什么是Liquibase，它的出现是要解决什么问题。")])]),a._v(" "),s("h3",{attrs:{id:"什么是liquibase-这类工具要解决什么问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是liquibase-这类工具要解决什么问题"}},[a._v("#")]),a._v(" 什么是Liquibase？这类工具要解决什么问题？")]),a._v(" "),s("blockquote",[s("p",[a._v("Liquibase是一个用于"),s("strong",[a._v("用于跟踪、管理和应用数据库变化的开源工具")]),a._v("，通过日志文件(changelog)的形式记录数据库的变更(changeset)，然后执行日志文件中的修改，将数据库更新或回滚(rollback)到一致的状态。它的目标是提供一种数据库类型无关的解决方案，通过执行schema类型的文件来达到迁移。")])]),a._v(" "),s("p",[s("strong",[a._v("其优点主要有以下")]),a._v("：")]),a._v(" "),s("ul",[s("li",[a._v("支持几乎所有主流的数据库，目前支持包括 Oracle/Sql Server/DB2/MySql/Sybase/PostgreSQL等 "),s("a",{attrs:{href:"https://docs.liquibase.com/install/tutorials/home.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("各种数据库 在新窗口打开"),s("OutboundLink")],1),a._v("，这样在数据库的部署和升级环节可帮助应用系统支持多数据库；")]),a._v(" "),s("li",[a._v("支持版本控制，这样就能支持多开发者的协作维护；")]),a._v(" "),s("li",[a._v("日志文件支持多种格式，如XML, YAML, JSON, SQL等；")]),a._v(" "),s("li",[a._v("提供变化应用的回滚功能，可按时间、数量或标签（tag）回滚已应用的变化。通过这种方式，开发人员可轻易的还原数据库在任何时间点的状态")]),a._v(" "),s("li",[a._v("支持多种运行方式，如命令行、Spring集成、Maven插件、Gradle插件等。")])]),a._v(" "),s("p",[s("strong",[a._v("为何会出现Liquibase这类工具呢")]),a._v("？")]),a._v(" "),s("p",[a._v("在实际上线的应用中，随着版本的迭代，经常会遇到需要变更数据库表和字段，必然会遇到需要对这些变更进行记录和管理，以及回滚等等；同时只有脚本化且版本可管理，才能在让数据库实现真正的DevOps（自动化执行 + 回滚等）。在这样的场景下Liquibase等工具的出现也就成为了必然。")]),a._v(" "),s("h3",{attrs:{id:"liquibase有哪些概念-是如何工作的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#liquibase有哪些概念-是如何工作的"}},[a._v("#")]),a._v(" Liquibase有哪些概念？是如何工作的？")]),a._v(" "),s("blockquote",[s("p",[s("strong",[a._v("工作流程")]),a._v("：将"),s("strong",[a._v("SQL")]),a._v("变更记录到"),s("strong",[a._v("changeset")]),a._v("，多个changeset变更组成了日志文件("),s("strong",[a._v("changelog")]),a._v(")，liquibase将changelog更新日志文件同步到指定的"),s("strong",[a._v("RDBMS")]),a._v("中。")])]),a._v(" "),s("p",[s("img",{attrs:{src:n(1084),alt:""}})]),a._v(" "),s("p",[a._v("日志文件(databaseChangeLog)支持多种格式，如XML, YAML, JSON, SQL; 我们以xml为例，看下相关配置")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('<?xml version="1.0" encoding="UTF-8"?> \n<databaseChangeLog\n\txmlns="http://www.liquibase.org/xml/ns/dbchangelog"\n\txmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n\txmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"\n\txmlns:pro="http://www.liquibase.org/xml/ns/pro"\n\txsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog\n\t\thttp://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.9.0.xsd\n\t\thttp://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd\n\t\thttp://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.9.0.xsd">\n    <changeSet id="1" author="bob">  \n        <comment>A sample change log</comment>  \n        <createTable/> \n    </changeSet>  \n    <changeSet id="2" author="bob" runAlways="true">  \n        <alterTable/>  \n    </changeSet>  \n    <changeSet id="3" author="alice" failOnError="false" dbms="oracle">\n        <alterTable/>  \n    </changeSet>  \n    <changeSet id="4" author="alice" failOnError="false" dbms="!oracle">\n        <alterTable/>  \n    </changeSet>  \n</databaseChangeLog>\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br")])]),s("h1",{attrs:{id:"简单示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简单示例"}},[a._v("#")]),a._v(" 简单示例")]),a._v(" "),s("hr"),a._v(" "),s("blockquote",[s("p",[a._v("这里主要介绍基于SpringBoot集成liquibase来管理数据库的变更。")])]),a._v(" "),s("h3",{attrs:{id:"pom依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pom依赖"}},[a._v("#")]),a._v(" POM依赖")]),a._v(" "),s("p",[a._v("Maven 包的依赖，主要包含mysql驱动, JDBC(这里spring-boot-starter-data-jpa包含了jdbc包，当然直接引入jdbc包也行)，以及liquibase包。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("<dependency>\n    <groupId>mysql</groupId>\n    <artifactId>mysql-connector-java</artifactId>\n    <version>8.0.28</version>\n</dependency>\n<dependency>\n    <groupId>com.github.wenhao</groupId>\n    <artifactId>jpa-spec</artifactId>\n    <version>3.1.0</version>\n</dependency>\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-jpa</artifactId>\n</dependency>\n\n<dependency>\n    <groupId>org.liquibase</groupId>\n    <artifactId>liquibase-core</artifactId>\n    <version>4.9.1</version>\n</dependency>\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br")])]),s("h3",{attrs:{id:"yml配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yml配置"}},[a._v("#")]),a._v(" yml配置")]),a._v(" "),s("blockquote",[s("p",[a._v("SpringBoot AutoConfig默认已经包含了对liquibase的配置，在spring.liquibase配置下。")])]),a._v(" "),s("p",[a._v("基础的配置，可以直接使用如下（主要是指定change-log的位置，默认的位置是classpath:/db/changelog/db.changelog-master.yaml）：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("spring:\n  datasource:\n    url: jdbc:mysql://localhost:3306/test_db_liquibase?useSSL=false&autoReconnect=true&characterEncoding=utf8\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    username: root\n    password: bfXa4Pt2lUUScy8jakXf\n  liquibase:\n    enabled: true\n    # 如下配置是被spring.datasource赋值的，所以可以不配置\n#    url: jdbc:mysql://localhost:3306/test_db_liquibase?useSSL=false&autoReconnect=true&characterEncoding=utf8\n#    user: root\n#    password: bfXa4Pt2lUUScy8jakXf\n    change-log: classpath:/db/changelog/db.changelog-master.yaml\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("p",[a._v("在开发时，更多的配置可以从如下SpringBoot AutoConfig中找到。")]),a._v(" "),s("p",[s("img",{attrs:{src:n(1085),alt:""}})]),a._v(" "),s("h3",{attrs:{id:"新增changelog"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新增changelog"}},[a._v("#")]),a._v(" 新增changelog")]),a._v(" "),s("p",[a._v("XML方式固然OK，不过依然推荐使用yml格式。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("databaseChangeLog:\n  - changeSet:\n      id: 20220412-01\n      author: pdai\n      changes:\n        - createTable:\n            tableName: person\n            columns:\n              - column:\n                  name: id\n                  type: int\n                  autoIncrement: true\n                  constraints:\n                    primaryKey: true\n                    nullable: false\n              - column:\n                  name: firstname\n                  type: varchar(50)\n              - column:\n                  name: lastname\n                  type: varchar(50)\n                  constraints:\n                    nullable: false\n              - column:\n                  name: state\n                  type: char(2)\n\n  - changeSet:\n      id: 20220412-02\n      author: pdai\n      changes:\n        - addColumn:\n            tableName: person\n            columns:\n              - column:\n                  name: username\n                  type: varchar(8)\n\n  - changeSet:\n      id: 20220412-03\n      author: pdai\n      changes:\n        - addLookupTable:\n            existingTableName: person\n            existingColumnName: state\n            newTableName: state\n            newColumnName: id\n            newColumnDataType: char(2)\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br"),s("span",{staticClass:"line-number"},[a._v("46")]),s("br"),s("span",{staticClass:"line-number"},[a._v("47")]),s("br"),s("span",{staticClass:"line-number"},[a._v("48")]),s("br")])]),s("h3",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),s("p",[a._v("启动springBootApplication, 我们可以看到如下的几个changeSet被依次执行")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("2022-04-12 20:41:20.591  INFO 8476 --- [           main] liquibase.lockservice                    : Successfully acquired change log lock\n2022-04-12 20:41:20.737  INFO 8476 --- [           main] liquibase.changelog                      : Creating database history table with name: test_db_liquibase.DATABASECHANGELOG\n2022-04-12 20:41:20.783  INFO 8476 --- [           main] liquibase.changelog                      : Reading from test_db_liquibase.DATABASECHANGELOG\nRunning Changeset: classpath:/db/changelog/db.changelog-master.yaml::20220412-01::pdai\n2022-04-12 20:41:20.914  INFO 8476 --- [           main] liquibase.changelog                      : Table person created\n2022-04-12 20:41:20.914  INFO 8476 --- [           main] liquibase.changelog                      : ChangeSet classpath:/db/changelog/db.changelog-master.yaml::20220412-01::pdai ran successfully in 53ms\nRunning Changeset: classpath:/db/changelog/db.changelog-master.yaml::20220412-02::pdai\n2022-04-12 20:41:20.952  INFO 8476 --- [           main] liquibase.changelog                      : Columns username(varchar(8)) added to person\n2022-04-12 20:41:20.952  INFO 8476 --- [           main] liquibase.changelog                      : ChangeSet classpath:/db/changelog/db.changelog-master.yaml::20220412-02::pdai ran successfully in 31ms\nRunning Changeset: classpath:/db/changelog/db.changelog-master.yaml::20220412-03::pdai\n2022-04-12 20:41:21.351  INFO 8476 --- [           main] liquibase.changelog                      : Lookup table added for person.state\n2022-04-12 20:41:21.351  INFO 8476 --- [           main] liquibase.changelog                      : ChangeSet classpath:/db/changelog/db.changelog-master.yaml::20220412-03::pdai ran successfully in 389ms\n2022-04-12 20:41:21.382  INFO 8476 --- [           main] liquibase.lockservice                    : Successfully released change log lock\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("p",[a._v("查看数据库，你会发现数据已经变更")]),a._v(" "),s("p",[s("img",{attrs:{src:n(1086),alt:""}})]),a._v(" "),s("p",[a._v("那我们如果重新启动这个SpringBootApplication，会怎么呢？")]),a._v(" "),s("p",[a._v("很显然，因为databasechangelog表中已经有相关执行记录了，所以将不再执行变更")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("2022-04-12 20:49:01.566  INFO 9144 --- [           main] liquibase.lockservice                    : Successfully acquired change log lock\n2022-04-12 20:49:01.761  INFO 9144 --- [           main] liquibase.changelog                      : Reading from test_db_liquibase.DATABASECHANGELOG\n2022-04-12 20:49:01.812  INFO 9144 --- [           main] liquibase.lockservice                    : Successfully released change log lock\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h1",{attrs:{id:"进一步理解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#进一步理解"}},[a._v("#")]),a._v(" 进一步理解")]),a._v(" "),s("hr"),a._v(" "),s("blockquote",[s("p",[a._v("通过几个问题，进一步理解。")])]),a._v(" "),s("h3",{attrs:{id:"比较好的changelog的实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#比较好的changelog的实践"}},[a._v("#")]),a._v(" 比较好的changelog的实践？")]),a._v(" "),s("blockquote",[s("p",[a._v("简单而言：yml格式 + "),s("a",{attrs:{href:"https://docs.liquibase.com/change-types/sql-file.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("sql-file方式 在新窗口打开"),s("OutboundLink")],1)])]),a._v(" "),s("p",[a._v("执行sqlFile格式的changeSet，如下")]),a._v(" "),s("p",[s("img",{attrs:{src:n(1087),alt:""}})]),a._v(" "),s("p",[a._v("执行的日志如下")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("2022-04-12 21:00:28.198  INFO 17540 --- [           main] liquibase.lockservice                    : Successfully acquired change log lock\n2022-04-12 21:00:28.398  INFO 17540 --- [           main] liquibase.changelog                      : Reading from test_db_liquibase.DATABASECHANGELOG\nRunning Changeset: classpath:/db/changelog/db.changelog-master.yaml::20220412-04::pdai\n2022-04-12 21:00:28.516  INFO 17540 --- [           main] liquibase.changelog                      : SQL in file classpath:/db/changelog/db.changelog-20220412-04.sql executed\n2022-04-12 21:00:28.516  INFO 17540 --- [           main] liquibase.changelog                      : ChangeSet classpath:/db/changelog/db.changelog-master.yaml::20220412-04::pdai ran successfully in 83ms\n2022-04-12 21:00:28.532  INFO 17540 --- [           main] liquibase.lockservice                    : Successfully released change log lock\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("执行后，查看变更记录")]),a._v(" "),s("p",[s("img",{attrs:{src:n(1088),alt:""}})]),a._v(" "),s("p",[a._v("数据表user表已经创建并插入一条数据")]),a._v(" "),s("p",[s("img",{attrs:{src:n(1089),alt:""}})]),a._v(" "),s("h3",{attrs:{id:"除了addcolumn-addtable还有哪些changetype呢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#除了addcolumn-addtable还有哪些changetype呢"}},[a._v("#")]),a._v(" 除了addColumn,addTable还有哪些changeType呢？")]),a._v(" "),s("blockquote",[s("p",[a._v("除了addColumn,addTable还有哪些changeType呢?")])]),a._v(" "),s("p",[a._v("与此同时，还支持"),s("a",{attrs:{href:"https://docs.liquibase.com/change-types/home.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("如下changeType 在新窗口打开"),s("OutboundLink")],1),a._v("：")]),a._v(" "),s("p",[s("img",{attrs:{src:n(1090),alt:""}})]),a._v(" "),s("p",[a._v("此外，还支持执行"),s("a",{attrs:{href:"https://docs.liquibase.com/commands/home.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("command 在新窗口打开"),s("OutboundLink")],1)]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("changeSet:  \n  id:  executeCommand-example  \n  author:  liquibase-docs  \n  changes:  \n  -  executeCommand:  \n      args:  \n      -  arg:  \n          value:  -out  \n      -  arg:  \n          value:  -param2  \n      executable:  mysqldump  \n      os:  Windows 7  \n      timeout:  10s\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("p",[a._v("比如，回滚的操作可以通过如下command进行")]),a._v(" "),s("p",[s("img",{attrs:{src:n(1091),alt:""}})]),a._v(" "),s("p",[a._v("再比如，我们可以通过Liquibase来生成相关差异，再制作成changeSet，最后部署。")]),a._v(" "),s("h1",{attrs:{id:"示例源码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例源码"}},[a._v("#")]),a._v(" 示例源码")]),a._v(" "),s("hr"),a._v(" "),s("p",[a._v("https://github.com/realpdai/tech-pdai-spring-demos")]),a._v(" "),s("p",[a._v("参考文章")]),a._v(" "),s("p",[a._v("https://docs.liquibase.com")])])}),[],!1,null,null,null);s.default=t.exports}}]);