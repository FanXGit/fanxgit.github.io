(window.webpackJsonp=window.webpackJsonp||[]).push([[235],{2749:function(s,n,a){s.exports=a.p+"assets/img/ut-dev-mock-4.c37dce53.png"},2750:function(s,n,a){s.exports=a.p+"assets/img/ut-dev-mock-5.6a0696ef.png"},2751:function(s,n,a){s.exports=a.p+"assets/img/dev-ut-mock-1.c5db49be.png"},2752:function(s,n,a){s.exports=a.p+"assets/img/dev-ut-mock-11.a16da2f5.png"},2753:function(s,n,a){s.exports=a.p+"assets/img/dev-ut-mock-12.03a5c888.png"},3973:function(s,n,a){"use strict";a.r(n);var t=a(7),e=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"单元测试-mockito-详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单元测试-mockito-详解"}},[s._v("#")]),s._v(" 单元测试 - Mockito 详解")]),s._v(" "),n("p",[s._v("=======================================")]),s._v(" "),n("blockquote",[n("p",[s._v("Mock通常是指，在测试一个对象A时，我们构造一些假的对象来模拟与A之间的交互，而这些Mock对象的行为是我们事先设定且符合预期。通过这些Mock对象来测试A在正常逻辑，异常逻辑或压力情况下工作是否正常。而Mockito是最流行的Java mock框架之一。@pdai")])]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#%E4%BB%80%E4%B9%88%E6%98%AF-mock-%E6%B5%8B%E8%AF%95",target:"_blank",rel:"noopener noreferrer"}},[s._v("什么是 Mock 测试"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#mock-%E9%80%82%E7%94%A8%E5%9C%A8%E4%BB%80%E4%B9%88%E5%9C%BA%E6%99%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mock 适用在什么场景"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#mockito",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mockito"),n("OutboundLink")],1),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#%E5%AE%98%E6%96%B9%E8%B5%84%E6%96%99",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方资料"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#maven%E5%8C%85%E5%BC%95%E5%85%A5",target:"_blank",rel:"noopener noreferrer"}},[s._v("Maven包引入"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#%E6%B5%8B%E8%AF%95-hello-world",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试:Hello World"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#%E6%B5%8B%E8%AF%95-%E4%BD%BF%E7%94%A8mock%E6%96%B9%E6%B3%95",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试:使用mock方法"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#%E6%B5%8B%E8%AF%95-%E9%80%82%E7%94%A8-mock%E6%B3%A8%E8%A7%A3",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试:适用@Mock注解"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#%E6%B5%8B%E8%AF%95-%E5%8F%82%E6%95%B0%E5%8C%B9%E9%85%8D",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试:参数匹配"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#%E6%B5%8B%E8%AF%95-mock%E5%BC%82%E5%B8%B8",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试:Mock异常"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#%E6%B5%8B%E8%AF%95-spy-%E5%92%8C-spy-%E6%B3%A8%E8%A7%A3",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试:spy 和 @Spy 注解"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#%E6%B5%8B%E8%AF%95-%E6%B5%8B%E8%AF%95%E9%9A%94%E7%A6%BB",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试:测试隔离"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#%E6%B5%8B%E8%AF%95-%E7%BB%93%E5%90%88powermock%E6%94%AF%E6%8C%81%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试:结合PowerMock支持静态方法"),n("OutboundLink")],1)])])]),s._v(" "),n("li",[n("a",{attrs:{href:"https://pdai.tech/md/develop/ut/dev-ut-x-mockito.html#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考文章"),n("OutboundLink")],1)])]),s._v(" "),n("h1",{attrs:{id:"什么是-mock-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-mock-测试"}},[s._v("#")]),s._v(" 什么是 Mock 测试")]),s._v(" "),n("hr"),s._v(" "),n("blockquote",[n("p",[s._v("Mock通常是指，在测试一个对象A时，我们构造一些假的对象来模拟与A之间的交互，而这些Mock对象的行为是我们事先设定且符合预期。通过这些Mock对象来测试A在正常逻辑，异常逻辑或压力情况下工作是否正常。@pdai")])]),s._v(" "),n("p",[s._v("Mock 测试就是在测试过程中，对于某些不容易构造（如 HttpServletRequest 必须在Servlet 容器中才能构造出来）或者不容易获取比较复杂的对象（如 JDBC 中的ResultSet 对象），用一个虚拟的对象（Mock 对象）来创建以便测试的测试方法。Mock 最大的功能是帮你把单元测试的耦合分解开，如果你的代码对另一个类或者接口有依赖，它能够帮你模拟这些依赖，并帮你验证所调用的依赖的行为。")]),s._v(" "),n("p",[s._v("先来看看下面这个示例：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(2749),alt:""}})]),s._v(" "),n("p",[s._v("从上图可以看出如果我们要对A进行测试，那么就要先把整个依赖树构建出来，也就是BCDE的实例。")]),s._v(" "),n("p",[s._v("一种替代方案就是使用mocks")]),s._v(" "),n("p",[n("img",{attrs:{src:a(2750),alt:""}})]),s._v(" "),n("p",[s._v("从图中可以清晰的看出, mock对象就是在调试期间用来作为真实对象的替代品。")]),s._v(" "),n("p",[s._v("mock测试就是在测试过程中，对那些不容易构建的对象用一个虚拟对象来代替测试的方法就叫mock测试。")]),s._v(" "),n("h1",{attrs:{id:"mock-适用在什么场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mock-适用在什么场景"}},[s._v("#")]),s._v(" Mock 适用在什么场景")]),s._v(" "),n("hr"),s._v(" "),n("blockquote",[n("p",[s._v("在使用Mock的过程中，发现Mock是有一些通用性的，对于一些应用场景，是非常适合使用Mock的：")])]),s._v(" "),n("ul",[n("li",[s._v("真实对象具有不可确定的行为(产生不可预测的结果，如股票的行情)")]),s._v(" "),n("li",[s._v("真实对象很难被创建(比如具体的web容器)")]),s._v(" "),n("li",[s._v("真实对象的某些行为很难触发(比如网络错误)")]),s._v(" "),n("li",[s._v("真实情况令程序的运行速度很慢")]),s._v(" "),n("li",[s._v("真实对象有用户界面")]),s._v(" "),n("li",[s._v("测试需要询问真实对象它是如何被调用的(比如测试可能需要验证某个回调函数是否被调用了)")]),s._v(" "),n("li",[s._v("真实对象实际上并不存在(当需要和其他开发小组，或者新的硬件系统打交道的时候，这是一个普遍的问题)")])]),s._v(" "),n("p",[s._v("当然，也有一些不得不Mock的场景：")]),s._v(" "),n("ul",[n("li",[s._v("一些比较难构造的Object：这类Object通常有很多依赖，在单元测试中构造出这样类通常花费的成本太大。")]),s._v(" "),n("li",[s._v("执行操作的时间较长Object：有一些Object的操作费时，而被测对象依赖于这一个操作的执行结果，例如大文件写操作，数据的更新等等，出于测试的需求，通常将这类操作进行Mock。")]),s._v(" "),n("li",[s._v("异常逻辑：一些异常的逻辑往往在正常测试中是很难触发的，通过Mock可以人为的控制触发异常逻辑。")])]),s._v(" "),n("p",[s._v("在一些压力测试的场景下，也不得不使用Mock，例如在分布式系统测试中，通常需要测试一些单点（如namenode，jobtracker）在压力场景下的工作是否正常。而通常测试集群在正常逻辑下无法提供足够的压力（主要原因是受限于机器数量），这时候就需要应用Mock去满足。")]),s._v(" "),n("h1",{attrs:{id:"mockito"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mockito"}},[s._v("#")]),s._v(" Mockito")]),s._v(" "),n("hr"),s._v(" "),n("blockquote",[n("p",[s._v("Mockito是最流行的Java mock框架之一.")])]),s._v(" "),n("h3",{attrs:{id:"官方资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#官方资料"}},[s._v("#")]),s._v(" 官方资料")]),s._v(" "),n("ul",[n("li",[s._v("Mockito 官方网站")])]),s._v(" "),n("p",[s._v("https://site.mockito.org/")]),s._v(" "),n("ul",[n("li",[s._v("PowerMockito Github")])]),s._v(" "),n("p",[s._v("https://github.com/powermock/powermock/")]),s._v(" "),n("h3",{attrs:{id:"maven包引入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#maven包引入"}},[s._v("#")]),s._v(" Maven包引入")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>pdai.tech</groupId>\n    <artifactId>java-mockito</artifactId>\n    <version>1.0-SNAPSHOT</version>\n    <dependencies>\n        <dependency>\n            <groupId>junit</groupId>\n            <artifactId>junit</artifactId>\n            <version>4.12</version>\n            <scope>test</scope>\n        </dependency>\n        \x3c!-- https://mvnrepository.com/artifact/org.mockito/mockito-core --\x3e\n        <dependency>\n            <groupId>org.mockito</groupId>\n            <artifactId>mockito-core</artifactId>\n            <version>3.7.7</version>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n</project>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h3",{attrs:{id:"测试-hello-world"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试-hello-world"}},[s._v("#")]),s._v(" 测试:Hello World")]),s._v(" "),n("blockquote",[n("p",[s._v("本例子主要用来测试DemoService类，但是DemoService又依赖于DemoDao，这时候我们便可以mock出DemoDao的返回预期值，从而测试DemoService类。")])]),s._v(" "),n("p",[s._v("待测试类DemoService")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("package tech.pdai.mockito.service;\n\nimport tech.pdai.mockito.dao.DemoDao;\n\npublic class DemoService {\n\n    private DemoDao demoDao;\n\n    public DemoService(DemoDao demoDao) {\n        this.demoDao = demoDao;\n    }\n\n    public int getDemoStatus(){\n        return demoDao.getDemoStatus();\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("依赖DemoDao")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("package tech.pdai.mockito.dao;\n\nimport java.util.Random;\n\npublic class DemoDao {\n\n    public int getDemoStatus(){\n        return new Random().nextInt();\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("测试类")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("package tech.pdai.mockito;\n\nimport org.junit.Assert;\nimport org.junit.Test;\nimport org.mockito.Mockito;\nimport tech.pdai.mockito.dao.DemoDao;\nimport tech.pdai.mockito.service.DemoService;\n\n/**\n * Hello World Test.\n */\npublic class HelloWorldTest {\n\n    @Test\n    public void helloWorldTest() {\n        // mock DemoDao instance\n        DemoDao mockDemoDao = Mockito.mock(DemoDao.class);\n\n        // 使用 mockito 对 getDemoStatus 方法打桩\n        Mockito.when(mockDemoDao.getDemoStatus()).thenReturn(1);\n\n        // 调用 mock 对象的 getDemoStatus 方法，结果永远是 1\n        Assert.assertEquals(1, mockDemoDao.getDemoStatus());\n\n        // mock DemoService\n        DemoService mockDemoService = new DemoService(mockDemoDao);\n        Assert.assertEquals(1, mockDemoService.getDemoStatus() );\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("执行结果")]),s._v(" "),n("p",[n("img",{attrs:{src:a(2751),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"测试-使用mock方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试-使用mock方法"}},[s._v("#")]),s._v(" 测试:使用mock方法")]),s._v(" "),n("p",[s._v("包含两块测试：一个是类测试，一个接口测试，具体如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package tech.pdai.mockito;\n\nimport org.junit.Assert;\nimport org.junit.Test;\n\nimport java.util.List;\nimport java.util.Random;\n\nimport static org.mockito.Mockito.mock;\nimport static org.mockito.Mockito.when;\n\n/**\n * Mock Class Test.\n */\npublic class MockClassTest {\n\n    @Test\n    public void mockClassTest() {\n        Random mockRandom = mock(Random.class);\n\n        // 默认值: mock 对象的方法的返回值默认都是返回类型的默认值\n        System.out.println(mockRandom.nextBoolean()); // false\n        System.out.println(mockRandom.nextInt()); // 0\n        System.out.println(mockRandom.nextDouble()); // 0.0\n\n        // mock: 指定调用 nextInt 方法时，永远返回 100\n        when(mockRandom.nextInt()).thenReturn(100);\n        Assert.assertEquals(100, mockRandom.nextInt());\n        Assert.assertEquals(100, mockRandom.nextInt());\n    }\n\n    @Test\n    public void mockInterfaceTest() {\n        List mockList = mock(List.class);\n\n        // 接口的默认值：和类方法一致，都是默认返回值\n        Assert.assertEquals(0, mockList.size());\n        Assert.assertEquals(null, mockList.get(0));\n\n        // 注意：调用 mock 对象的写方法，是没有效果的\n        mockList.add("a");\n        Assert.assertEquals(0, mockList.size());      // 没有指定 size() 方法返回值，这里结果是默认值\n        Assert.assertEquals(null, mockList.get(0));   // 没有指定 get(0) 返回值，这里结果是默认值\n\n        // mock值测试\n        when(mockList.get(0)).thenReturn("a");          // 指定 get(0)时返回 a\n        Assert.assertEquals(0, mockList.size());        // 没有指定 size() 方法返回值，这里结果是默认值\n        Assert.assertEquals("a", mockList.get(0));      // 因为上面指定了 get(0) 返回 a，所以这里会返回 a\n        Assert.assertEquals(null, mockList.get(1));     // 没有指定 get(1) 返回值，这里结果是默认值\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br")])]),n("p",[s._v("执行结果")]),s._v(" "),n("p",[n("img",{attrs:{src:a(2752),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"测试-适用-mock注解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试-适用-mock注解"}},[s._v("#")]),s._v(" 测试:适用@Mock注解")]),s._v(" "),n("blockquote",[n("p",[s._v("@Mock 注解可以理解为对 mock 方法的一个替代。")])]),s._v(" "),n("p",[s._v("使用该注解时，要使用MockitoAnnotations.initMocks 方法，让注解生效, 比如放在@Before方法中初始化。")]),s._v(" "),n("p",[s._v("比较优雅优雅的写法是用MockitoJUnitRunner，它可以自动执行MockitoAnnotations.initMocks 方法。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("package tech.pdai.mockito;\n\nimport org.junit.Assert;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.mockito.Mock;\nimport org.mockito.junit.MockitoJUnitRunner;\n\nimport java.util.Random;\n\nimport static org.mockito.Mockito.when;\n\n/**\n * Mock Annotation\n */\n@RunWith(MockitoJUnitRunner.class)\npublic class MockAnnotationTest {\n\n    @Mock\n    private Random random;\n\n    @Test\n    public void test() {\n        when(random.nextInt()).thenReturn(100);\n        Assert.assertEquals(100, random.nextInt());\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("h3",{attrs:{id:"测试-参数匹配"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试-参数匹配"}},[s._v("#")]),s._v(" 测试:参数匹配")]),s._v(" "),n("p",[s._v("如果参数匹配既申明了精确匹配，也声明了模糊匹配；又或者同一个值的精确匹配出现了两次，使用时会匹配符合匹配条件的最新声明的匹配。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package tech.pdai.mockito;\n\n\nimport org.junit.Assert;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.mockito.Mock;\nimport org.mockito.junit.MockitoJUnitRunner;\n\nimport java.util.List;\n\nimport static org.mockito.ArgumentMatchers.anyInt;\nimport static org.mockito.Mockito.when;\n\n\n/**\n * Mock Parameter Test.\n */\n@RunWith(MockitoJUnitRunner.class)\npublic class ParameterTest {\n\n    @Mock\n    private List<String> testList;\n\n    @Test\n    public void test01() {\n\n        // 精确匹配 0\n        when(testList.get(0)).thenReturn("a");\n        Assert.assertEquals("a", testList.get(0));\n\n        // 精确匹配 0\n        when(testList.get(0)).thenReturn("b");\n        Assert.assertEquals("b", testList.get(0));\n\n        // 模糊匹配\n        when(testList.get(anyInt())).thenReturn("c");\n        Assert.assertEquals("c", testList.get(0));\n        Assert.assertEquals("c", testList.get(1));\n\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br")])]),n("p",[s._v("anyInt 只是用来匹配参数的工具之一，目前 mockito 有多种匹配函数，部分如下：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("函数名")]),s._v(" "),n("th",[s._v("匹配类型")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("any()")]),s._v(" "),n("td",[s._v("所有对象类型")])]),s._v(" "),n("tr",[n("td",[s._v("anyInt()")]),s._v(" "),n("td",[s._v("基本类型 int、非 null 的 Integer 类型")])]),s._v(" "),n("tr",[n("td",[s._v("anyChar()")]),s._v(" "),n("td",[s._v("基本类型 char、非 null 的 Character 类型")])]),s._v(" "),n("tr",[n("td",[s._v("anyShort()")]),s._v(" "),n("td",[s._v("基本类型 short、非 null 的 Short 类型")])]),s._v(" "),n("tr",[n("td",[s._v("anyBoolean()")]),s._v(" "),n("td",[s._v("基本类型 boolean、非 null 的 Boolean 类型")])]),s._v(" "),n("tr",[n("td",[s._v("anyDouble()")]),s._v(" "),n("td",[s._v("基本类型 double、非 null 的 Double 类型")])]),s._v(" "),n("tr",[n("td",[s._v("anyFloat()")]),s._v(" "),n("td",[s._v("基本类型 float、非 null 的 Float 类型")])]),s._v(" "),n("tr",[n("td",[s._v("anyLong()")]),s._v(" "),n("td",[s._v("基本类型 long、非 null 的 Long 类型")])]),s._v(" "),n("tr",[n("td",[s._v("anyByte()")]),s._v(" "),n("td",[s._v("基本类型 byte、非 null 的 Byte 类型")])]),s._v(" "),n("tr",[n("td",[s._v("anyString()")]),s._v(" "),n("td",[s._v("String 类型(不能是 null)")])]),s._v(" "),n("tr",[n("td",[s._v("anyList()")]),s._v(" "),n("td",[n("code",[s._v("List<T>")]),s._v(" 类型(不能是 null)")])]),s._v(" "),n("tr",[n("td",[s._v("anyMap()")]),s._v(" "),n("td",[n("code",[s._v("Map<K, V>")]),s._v("类型(不能是 null)")])]),s._v(" "),n("tr",[n("td",[s._v("anyCollection()")]),s._v(" "),n("td",[n("code",[s._v("Collection<T>")]),s._v("类型(不能是 null)")])]),s._v(" "),n("tr",[n("td",[s._v("anySet()")]),s._v(" "),n("td",[n("code",[s._v("Set<T>")]),s._v("类型(不能是 null)")])]),s._v(" "),n("tr",[n("td",[s._v("any("),n("code",[s._v("Class<T>")]),s._v(" type)")]),s._v(" "),n("td",[s._v("type类型的对象(不能是 null)")])]),s._v(" "),n("tr",[n("td",[s._v("isNull()")]),s._v(" "),n("td",[s._v("null")])]),s._v(" "),n("tr",[n("td",[s._v("notNull()")]),s._v(" "),n("td",[s._v("非 null")])]),s._v(" "),n("tr",[n("td",[s._v("isNotNull()")]),s._v(" "),n("td",[s._v("非 null")])])])]),s._v(" "),n("h3",{attrs:{id:"测试-mock异常"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试-mock异常"}},[s._v("#")]),s._v(" 测试:Mock异常")]),s._v(" "),n("blockquote",[n("p",[s._v("Mockito 使用 thenThrow 让方法抛出异常")])]),s._v(" "),n("p",[s._v("如下代码中，包含两个例子：一个是单个异常，一个是多个异常。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package tech.pdai.mockito;\n\nimport org.junit.Assert;\nimport org.junit.Test;\n\nimport java.util.Random;\n\nimport static org.mockito.Mockito.mock;\nimport static org.mockito.Mockito.when;\n\n/**\n * Exception Test.\n */\npublic class ThrowTest {\n\n    /**\n     * 例子1： thenThrow 用来让函数调用抛出异常.\n     */\n    @Test\n    public void throwTest1() {\n\n        Random mockRandom = mock(Random.class);\n        when(mockRandom.nextInt()).thenThrow(new RuntimeException("异常"));\n\n        try {\n            mockRandom.nextInt();\n            Assert.fail();  // 上面会抛出异常，所以不会走到这里\n        } catch (Exception ex) {\n            Assert.assertTrue(ex instanceof RuntimeException);\n            Assert.assertEquals("异常", ex.getMessage());\n        }\n    }\n\n    /**\n     * thenThrow 中可以指定多个异常。在调用时异常依次出现。若调用次数超过异常的数量，再次调用时抛出最后一个异常。\n     */\n    @Test\n    public void throwTest2() {\n\n        Random mockRandom = mock(Random.class);\n        when(mockRandom.nextInt()).thenThrow(new RuntimeException("异常1"), new RuntimeException("异常2"));\n\n        try {\n            mockRandom.nextInt();\n            Assert.fail();\n        } catch (Exception ex) {\n            Assert.assertTrue(ex instanceof RuntimeException);\n            Assert.assertEquals("异常1", ex.getMessage());\n        }\n\n        try {\n            mockRandom.nextInt();\n            Assert.fail();\n        } catch (Exception ex) {\n            Assert.assertTrue(ex instanceof RuntimeException);\n            Assert.assertEquals("异常2", ex.getMessage());\n        }\n    }\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br")])]),n("p",[s._v("执行结果")]),s._v(" "),n("p",[n("img",{attrs:{src:a(2753),alt:""}})]),s._v(" "),n("blockquote",[n("p",[s._v("对应返回类型是 void 的函数，thenThrow 是无效的，要使用 doThrow。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package tech.pdai.mockito;\n\nimport org.junit.Assert;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.mockito.Mock;\nimport org.mockito.MockitoAnnotations;\nimport org.mockito.junit.MockitoJUnitRunner;\n\nimport static org.mockito.Mockito.doThrow;\n\n/**\n * Do Throw for void return.\n */\n@RunWith(MockitoJUnitRunner.class)\npublic class DoThrowTest {\n\n    static class ExampleService {\n\n        public void hello() {\n            System.out.println("Hello");\n        }\n\n    }\n\n    @Mock\n    private ExampleService exampleService;\n\n    @Test\n    public void test() {\n\n        // 这种写法可以达到效果\n        doThrow(new RuntimeException("异常")).when(exampleService).hello();\n\n        try {\n            exampleService.hello();\n            Assert.fail();\n        } catch (RuntimeException ex) {\n            Assert.assertEquals("异常", ex.getMessage());\n        }\n\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br")])]),n("p",[s._v("此外还有，可以查看官方文档")]),s._v(" "),n("ul",[n("li",[s._v("doAnswer(Answer)")]),s._v(" "),n("li",[s._v("doNothing()")]),s._v(" "),n("li",[s._v("doCallRealMethod()")])]),s._v(" "),n("h3",{attrs:{id:"测试-spy-和-spy-注解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试-spy-和-spy-注解"}},[s._v("#")]),s._v(" 测试:spy 和 @Spy 注解")]),s._v(" "),n("p",[s._v("spy 和 mock不同，不同点是：")]),s._v(" "),n("ul",[n("li",[s._v("spy 的参数是对象示例，mock 的参数是 class。")]),s._v(" "),n("li",[s._v("被 spy 的对象，调用其方法时默认会走真实方法。mock 对象不会。")])]),s._v(" "),n("p",[s._v("下面是一个对比：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import org.junit.Assert;\nimport org.junit.Test;\nimport static org.mockito.Mockito.*;\n\n\nclass ExampleService {\n\n    int add(int a, int b) {\n        return a+b;\n    }\n\n}\n\npublic class MockitoDemo {\n\n    // 测试 spy\n    @Test\n    public void test_spy() {\n\n        ExampleService spyExampleService = spy(new ExampleService());\n\n        // 默认会走真实方法\n        Assert.assertEquals(3, spyExampleService.add(1, 2));\n\n        // 打桩后，不会走了\n        when(spyExampleService.add(1, 2)).thenReturn(10);\n        Assert.assertEquals(10, spyExampleService.add(1, 2));\n\n        // 但是参数比匹配的调用，依然走真实方法\n        Assert.assertEquals(3, spyExampleService.add(2, 1));\n\n    }\n\n    // 测试 mock\n    @Test\n    public void test_mock() {\n\n        ExampleService mockExampleService = mock(ExampleService.class);\n\n        // 默认返回结果是返回类型int的默认值\n        Assert.assertEquals(0, mockExampleService.add(1, 2));\n\n    }\n\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br")])]),n("p",[s._v("spy 对应注解 @Spy，和 @Mock 是一样用的。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import org.junit.Assert;\nimport org.junit.Test;\nimport org.mockito.MockitoAnnotations;\nimport org.mockito.Spy;\n\nimport static org.mockito.Mockito.*;\n\n\nclass ExampleService {\n\n    int add(int a, int b) {\n        return a+b;\n    }\n\n}\n\npublic class MockitoDemo {\n\n    @Spy\n    private ExampleService spyExampleService;\n\n    @Test\n    public void test_spy() {\n\n        MockitoAnnotations.initMocks(this);\n\n        Assert.assertEquals(3, spyExampleService.add(1, 2));\n\n        when(spyExampleService.add(1, 2)).thenReturn(10);\n        Assert.assertEquals(10, spyExampleService.add(1, 2));\n\n    }\n\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("p",[s._v("对于@Spy，如果发现修饰的变量是 null，会自动调用类的无参构造函数来初始化。")]),s._v(" "),n("p",[s._v("所以下面两种写法是等价的：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 写法1\n@Spy\nprivate ExampleService spyExampleService;\n\n// 写法2\n@Spy\nprivate ExampleService spyExampleService = new ExampleService();\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("如果没有无参构造函数，必须使用写法2。例子：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import org.junit.Assert;\nimport org.junit.Test;\nimport org.mockito.MockitoAnnotations;\nimport org.mockito.Spy;\n\nclass ExampleService {\n\n    private int a;\n\n    public ExampleService(int a) {\n        this.a = a;\n    }\n\n    int add(int b) {\n        return a+b;\n    }\n\n}\n\npublic class MockitoDemo {\n\n    @Spy\n    private ExampleService spyExampleService = new ExampleService(1);\n\n    @Test\n    public void test_spy() {\n\n        MockitoAnnotations.initMocks(this);\n\n        Assert.assertEquals(3, spyExampleService.add(2));\n\n    }\n\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("h3",{attrs:{id:"测试-测试隔离"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试-测试隔离"}},[s._v("#")]),s._v(" 测试:测试隔离")]),s._v(" "),n("blockquote",[n("p",[s._v("根据 JUnit 单测隔离 ，当 Mockito 和 JUnit 配合使用时，也会将非static变量或者非单例隔离开。")])]),s._v(" "),n("p",[s._v("比如使用 @Mock 修饰的 mock 对象在不同的单测中会被隔离开。")]),s._v(" "),n("p",[s._v("示例：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('import org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.mockito.Mock;\nimport org.mockito.junit.MockitoJUnitRunner;\n\nimport static org.mockito.Mockito.*;\n\n@RunWith(MockitoJUnitRunner.class)\npublic class MockitoDemo {\n\n    static class ExampleService {\n\n        public int add(int a, int b) {\n            return a+b;\n        }\n\n    }\n\n    @Mock\n    private ExampleService exampleService;\n\n    @Test\n    public void test01() {\n        System.out.println("---call test01---");\n\n        System.out.println("打桩前: " + exampleService.add(1, 2));\n\n        when(exampleService.add(1, 2)).thenReturn(100);\n\n        System.out.println("打桩后: " + exampleService.add(1, 2));\n    }\n\n    @Test\n    public void test02() {\n        System.out.println("---call test02---");\n\n        System.out.println("打桩前: " + exampleService.add(1, 2));\n\n        when(exampleService.add(1, 2)).thenReturn(100);\n\n        System.out.println("打桩后: " + exampleService.add(1, 2));\n    }\n\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])]),n("p",[s._v("将两个单测一起运行，运行结果是：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("---call test01---\n打桩前: 0\n打桩后: 100\n---call test02---\n打桩前: 0\n打桩后: 100\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("test01 先被执行，打桩前调用add(1, 2)的结果是0，打桩后是 100。")]),s._v(" "),n("p",[s._v("然后 test02 被执行，打桩前调用add(1, 2)的结果是0，而非 100，这证明了我们上面的说法。")]),s._v(" "),n("h3",{attrs:{id:"测试-结合powermock支持静态方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试-结合powermock支持静态方法"}},[s._v("#")]),s._v(" 测试:结合PowerMock支持静态方法")]),s._v(" "),n("blockquote",[n("p",[s._v("PowerMock 是一个增强库，用来增加 Mockito 、EasyMock 等测试库的功能。")])]),s._v(" "),n("p",[s._v("Mockito为什么不能mock静态方法?")]),s._v(" "),n("p",[s._v("因为Mockito使用继承的方式实现mock的，用CGLIB生成mock对象代替真实的对象进行执行，为了mock实例的方法，你可以在subclass中覆盖它，而static方法是不能被子类覆盖的，所以Mockito不能mock静态方法。")]),s._v(" "),n("p",[s._v("但PowerMock可以mock静态方法，因为它直接在bytecode上工作。")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("Mockito 默认是不支持静态方法")])])]),s._v(" "),n("p",[s._v("比如我们在 ExampleService 类中定义静态方法 add：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("public class ExampleService {\n\n    public static int add(int a, int b) {\n        return a+b;\n    }\n\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("尝试给静态方法打桩，会报错：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.mockito.Mock;\nimport org.mockito.junit.MockitoJUnitRunner;\n\nimport static org.mockito.Mockito.*;\n\n@RunWith(MockitoJUnitRunner.class)\npublic class MockitoDemo {\n\n    @Test\n    public void test() {\n\n        // 会报错\n        when(ExampleService.add(1, 2)).thenReturn(100);\n\n    }\n\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("可以用 Powermock 弥补 Mockito 缺失的静态方法 mock 功能")])])]),s._v(" "),n("p",[s._v("在 pom.xml 中配置以下依赖：(版本的匹配问题可以参考：https://github.com/powermock/powermock/wiki/Mockito)")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("<properties>\n    <powermock.version>2.0.2</powermock.version>\n</properties>\n<dependencies>\n   <dependency>\n      <groupId>org.powermock</groupId>\n      <artifactId>powermock-module-junit4</artifactId>\n      <version>${powermock.version}</version>\n      <scope>test</scope>\n   </dependency>\n   <dependency>\n      <groupId>org.powermock</groupId>\n      <artifactId>powermock-api-mockito2</artifactId>\n      <version>${powermock.version}</version>\n      <scope>test</scope>\n   </dependency>\n</dependencies>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("示例：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import org.junit.Assert;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.powermock.api.mockito.PowerMockito;\nimport org.powermock.core.classloader.annotations.PrepareForTest;\nimport org.powermock.modules.junit4.PowerMockRunner;\n\nimport static org.mockito.Mockito.*;\n\n@RunWith(PowerMockRunner.class)     // 这是必须的\n@PrepareForTest(ExampleService.class)  // 声明要处理 ExampleService\npublic class MockitoDemo {\n    @Test\n    public void test() {\n\n        PowerMockito.mockStatic(ExampleService.class);  // 这也是必须的\n\n        when(ExampleService.add(1, 2)).thenReturn(100);\n\n        Assert.assertEquals(100, ExampleService.add(1, 2));\n        Assert.assertEquals(0, ExampleService.add(2, 2));\n\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("PowerMockRunner 支持 Mockito 的 @Mock 等注解")])])]),s._v(" "),n("p",[s._v("上面我们用了 PowerMockRunner ，MockitoJUnitRunner 就不能用了。但不要担心， @Mock 等注解还能用。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import org.junit.Assert;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.mockito.Mock;\nimport org.powermock.modules.junit4.PowerMockRunner;\n\nimport java.util.Random;\n\nimport static org.mockito.Mockito.*;\n\n@RunWith(PowerMockRunner.class)\npublic class MockitoDemo {\n\n    @Mock\n    private Random random;\n\n    @Test\n    public void test() {\n\n        when(random.nextInt()).thenReturn(1);\n        Assert.assertEquals(1,  random.nextInt());\n\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h1",{attrs:{id:"参考文章"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),n("hr"),s._v(" "),n("ul",[n("li",[s._v("https://www.cnblogs.com/oldboyooxx/p/11147474.html")]),s._v(" "),n("li",[s._v("https://www.cnblogs.com/bodhitree/p/9456515.html)")])])])}),[],!1,null,null,null);n.default=e.exports}}]);