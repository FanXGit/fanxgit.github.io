(window.webpackJsonp=window.webpackJsonp||[]).push([[446],{2389:function(e,a){e.exports="data:image/png;base64,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"},3921:function(e,a,v){"use strict";v.r(a);var g=v(7),t=Object(g.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"mongo进阶-wt引擎-page生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongo进阶-wt引擎-page生命周期"}},[e._v("#")]),e._v(" Mongo进阶 - WT引擎：Page生命周期")]),e._v(" "),a("p",[e._v("===================================================")]),e._v(" "),a("blockquote",[a("p",[e._v("通过前文我们了解到数据以page为单位加载到cache; 有必要系统的分析一页page的生命周期、状态以及相关参数的配置，这对后续MongoDB的性能调优和故障问题的定位和解决有帮助。@pdai")])]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#mongo%E8%BF%9B%E9%98%B6---wt%E5%BC%95%E6%93%8Epage%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"}},[e._v("Mongo进阶 - WT引擎：Page生命周期")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BA%86%E8%A7%A3page%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"}},[e._v("为什么要了解Page生命周期")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#page%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"}},[e._v("Page的生命周期")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#page%E7%9A%84%E5%90%84%E7%A7%8D%E7%8A%B6%E6%80%81"}},[e._v("Page的各种状态")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#page%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%8F%82%E6%95%B0"}},[e._v("Page的大小参数")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#page%E6%97%A0%E9%94%81%E5%8F%8A%E5%8E%8B%E7%BC%A9"}},[e._v("Page无锁及压缩")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"}},[e._v("参考文章")])])])])]),e._v(" "),a("h1",{attrs:{id:"为什么要了解page生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么要了解page生命周期"}},[e._v("#")]),e._v(" 为什么要了解Page生命周期")]),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("通过前文我们了解到数据以page为单位加载到cache、cache里面又会生成各种不同类型的page及为不同类型的page分配不同大小的内存、eviction触发机制和reconcile动作都发生在page上、page大小持续增加时会被分割成多个小page，所有这些操作都是围绕一个page来完成的。")]),e._v(" "),a("p",[e._v("因此，有必要系统的分析一页page的生命周期、状态以及相关参数的配置，这对后续MongoDB的性能调优和故障问题的定位和解决有帮助。")]),e._v(" "),a("h1",{attrs:{id:"page的生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#page的生命周期"}},[e._v("#")]),e._v(" Page的生命周期")]),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("Page的典型生命周期如下图所示：")]),e._v(" "),a("p",[a("img",{attrs:{src:v(2389),alt:""}})]),e._v(" "),a("ul",[a("li",[a("p",[e._v("第一步：pages从磁盘读到内存；")])]),e._v(" "),a("li",[a("p",[e._v("第二步：pages在内存中被修改；")])]),e._v(" "),a("li",[a("p",[e._v("第三步：被修改的脏pages在内存被reconcile，完成后将discard这些pages。")])]),e._v(" "),a("li",[a("p",[e._v("第四步：pages被选中，加入淘汰队列，等待被evict线程淘汰出内存；")])]),e._v(" "),a("li",[a("p",[e._v("第五步：evict线程会将“干净“的pages直接从内存丢弃（因为相对于磁盘page来说没做任何修改），将经过reconcile处理后的磁盘映像写到磁盘再丢弃“脏的”pages。")])])]),e._v(" "),a("p",[e._v("pages的状态是在不断变化的，因此，对于读操作来说，它首先会检查pages的状态是否为"),a("code",[e._v("WT_REF_MEM")]),e._v("，然后设置一个hazard指针指向要读的pages，如果刷新后，pages的状态仍为WT_REF_MEM，读操作才能继续处理。")]),e._v(" "),a("p",[e._v("与此同时，evict线程想要淘汰pages时，它会先锁住pages，即将pages的状态设为"),a("code",[e._v("WT_REF_LOCKED")]),e._v("，然后检查pages上是否有读操作设置的hazard指针，如有，说明还有线程正在读这个page则停止evict，重新将page的状态设置为"),a("code",[e._v("WT_REF_MEM")]),e._v("；如果没有，则pages被淘汰出去。")]),e._v(" "),a("h1",{attrs:{id:"page的各种状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#page的各种状态"}},[e._v("#")]),e._v(" Page的各种状态")]),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("针对一页page的每一种状态，详细描述如下：")]),e._v(" "),a("ul",[a("li",[a("p",[a("strong",[e._v("WT_REF_DISK")]),e._v("： 初始状态，page在磁盘上的状态，必须被读到内存后才能使用，当page被evict后，状态也会被设置为这个。")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("WT_REF_DELETED")]),e._v("： page在磁盘上，但是已经从内存B-Tree上删除，当我们不在需要读某个leaf page时，可以将其删除。")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("WT_REF_LIMBO")]),e._v("： page的映像已经被加载到内存，但page上还有额外的修改数据在lookasidetable上没有被加载到内存。")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("WT_REF_LOOKASIDE")]),e._v("： page在磁盘上，但是在lookasidetable也有与此page相关的修改内容，在page可读之前，也需要加载这部分内容。")])])]),e._v(" "),a("p",[e._v("当对一个page进行reconcile时，如果系统中还有之前的读操作正在访问此page上修改的数据，则会将这些数据保存到lookasidetable；当page再被读时，可以利用lookasidetable中的数据重新构建内存page。")]),e._v(" "),a("ul",[a("li",[a("p",[a("strong",[e._v("WT_REF_LOCKED")]),e._v("： 当page被evict时，会将page锁住，其它线程不可访问。")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("WT_REF_MEM")]),e._v("： page已经从磁盘读到内存，并且能正常访问。")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("WT_REF_READING")]),e._v("： page正在被某个线程从磁盘读到内存，其它的读线程等待它被读完，不需要重复去读。")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("WT_REF_SPLIT")]),e._v("： 当page变得过大时，会被split，状态设为WT_REF_SPLIT，原来指向的page不再被使用。")])])]),e._v(" "),a("h1",{attrs:{id:"page的大小参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#page的大小参数"}},[e._v("#")]),e._v(" Page的大小参数")]),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("无论将数据从磁盘读到内存，还是从内存写到磁盘，都是以page为单位调度的，但是在磁盘上一个page到底多大？是否是最小分割单元？以及内存里面的各种page的大小对存储引擎的性能是否有影响？本节将围绕这些问题，分析与page大小相关的参数是如何影响存储引擎性能的。 总的来说，涉及到的关键参数和默认值如下表所示：")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("参数名称")]),e._v(" "),a("th",[e._v("默认配置值")]),e._v(" "),a("th",[e._v("含义")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("allocation_size")]),e._v(" "),a("td",[e._v("4KB")]),e._v(" "),a("td",[e._v("磁盘上最小分配单元")])]),e._v(" "),a("tr",[a("td",[e._v("memory_page_max")]),e._v(" "),a("td",[e._v("5MB")]),e._v(" "),a("td",[e._v("内存中允许的最大page值")])]),e._v(" "),a("tr",[a("td",[e._v("internal_page_max")]),e._v(" "),a("td",[e._v("4KB")]),e._v(" "),a("td",[e._v("磁盘上允许的最大internal page值")])]),e._v(" "),a("tr",[a("td",[e._v("leaf_page_max")]),e._v(" "),a("td",[e._v("32KB")]),e._v(" "),a("td",[e._v("磁盘上允许的最大leaf page值")])]),e._v(" "),a("tr",[a("td",[e._v("internal_key_max")]),e._v(" "),a("td",[e._v("1/10*internal_page")]),e._v(" "),a("td",[e._v("internal page上允许的最大key值")])]),e._v(" "),a("tr",[a("td",[e._v("leaf_key_max")]),e._v(" "),a("td",[e._v("1/10*leaf_page")]),e._v(" "),a("td",[e._v("leaf page上允许的最大key值")])]),e._v(" "),a("tr",[a("td",[e._v("leaf_key_value")]),e._v(" "),a("td",[e._v("1/2*leaf_page")]),e._v(" "),a("td",[e._v("leaf page上允许的最大value值")])]),e._v(" "),a("tr",[a("td",[e._v("split_pct")]),e._v(" "),a("td",[e._v("75%")]),e._v(" "),a("td",[e._v("reconciled的page的分割百分比")])])])]),e._v(" "),a("p",[e._v("详细说明如下：")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("allocation_size")]),e._v("：")])]),e._v(" "),a("p",[e._v("MongoDB磁盘文件的最小分配单元（由WiredTiger自带的块管理模块来分配），一个page的可以由一个或多个这样的单元组成；默认值是4KB，与主机操作系统虚拟内存页的大小相当，大多数场景下不需要修改这个值。")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("memory_page_max")]),e._v("：")])]),e._v(" "),a("p",[e._v("WiredTigerCache里面一个内存page随着不断插入修改等操作，允许增长达到的最大值，默认值为5MB。当一个内存page达到这个最大值时，将会被split成较小的内存pages且通过reconcile将这些pages写到磁盘pages，一旦完成写到磁盘，这些内存pages将从内存移除。")]),e._v(" "),a("p",[e._v("需要注意的是：split和reconcile这两个动作都需要获得page的排它锁，导致应用程序在此page上的其它写操作会等待，因此设置一个合理的最大值，对系统的性能也很关键。")]),e._v(" "),a("p",[e._v("如果值太大，虽然spilt和reconcile发生的机率减少，但一旦发生这样的动作，持有排它锁的时间会较长，导致应用程序的插入或修改操作延迟增大；")]),e._v(" "),a("p",[e._v("如果值太小，虽然单次持有排它锁的时间会较短，但是会导致spilt和reconcile发生的机率增加。")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("internal_page_max")]),e._v("：")])]),e._v(" "),a("p",[e._v("磁盘上internalpage的最大值，默认为4KB。随着reconcile进行，internalpage超过这个值时，会被split成多个pages。")]),e._v(" "),a("p",[e._v("这个值的大小会影响磁盘上B-Tree的深度和internalpage上key的数量，如果太大，则internalpage上的key的数量会很多，通过遍历定位到正确leaf page的时间会增加；如果太小，则B-Tree的深度会增加，也会影响定位到正确leaf page的时间。")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("leaf_page_max")]),e._v("：")])]),e._v(" "),a("p",[e._v("磁盘上leaf page的最大值，默认为32KB。随着reconcile进行，leaf page超过这个值时，会被split成多个pages。")]),e._v(" "),a("p",[e._v("这个值的大小会影响磁盘的I/O性能，因为我们在从磁盘读取数据时，总是期望一次I/O能多读取一点数据，所以希望把这个参数调大；但是太大，又会造成读写放大，因为读出来的很多数据可能后续都用不上。")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("internal_key_max")]),e._v("：")])]),e._v(" "),a("p",[e._v("internalpage上允许的最大key值，默认大小为internalpage初始值的1/10，如果超过这个值，将会额外存储。导致读取key时需要额外的磁盘I/O。")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("leaf_key_max")]),e._v("：")])]),e._v(" "),a("p",[e._v("leaf page上允许的最大key值，默认大小为leaf page初始值的1/10，如果超过这个值，将会额外存储。导致读取key时需要额外的磁盘I/O。")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("leaf_value_max")]),e._v("：")])]),e._v(" "),a("p",[e._v("leaf page上允许的最大value值（保存真正的集合数据），默认大小为leaf page初始值的1/2，如果超过这个值，将会额外存储。导致读取value时需要额外的磁盘I/O。")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("split_pct")]),e._v("：")])]),e._v(" "),a("p",[e._v("内存里面将要被reconciled的 page大小与internal_page_max或leaf_page_max值的百分比，默认值为75%，如果内存里面被reconciled的page能够装进一个单独的磁盘page上，则不会发生spilt，否则按照该百分比值*最大允许的page值分割新page的大小。")]),e._v(" "),a("h1",{attrs:{id:"page无锁及压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#page无锁及压缩"}},[e._v("#")]),e._v(" Page无锁及压缩")]),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("https://blog.csdn.net/weixin_45583158/article/details/100143033")]),e._v(" "),a("h1",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[e._v("#")]),e._v(" 参考文章")]),e._v(" "),a("hr"),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://mongoing.com/archives/57177",target:"_blank",rel:"noopener noreferrer"}},[e._v("文章来源 在新窗口打开"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("作者：郭远威")])]),e._v(" "),a("li",[a("p",[e._v("MongoDB中文社区委员，长沙分会主席;《大数据存储MongoDB实战指南》作者资深大数据架构师，通信行业业务架构与数据迁移专家")])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_45583158/article/details/100143033",target:"_blank",rel:"noopener noreferrer"}},[e._v("文章来源 在新窗口打开"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("袁荣喜，学霸君工程师，2015年加入学霸君，负责学霸君的网络实时传输和分布式系统的架构设计和实现，专注于基础技术领域，在网络传输、数据库内核、分布式系统和并发编程方面有一定了解)")])])])])}),[],!1,null,null,null);a.default=t.exports}}]);