(window.webpackJsonp=window.webpackJsonp||[]).push([[227],{2227:function(s,n,a){s.exports=a.p+"assets/img/db-redis-stream-1.c1eb1b90.png"},2228:function(s,n){s.exports="data:image/png;base64,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"},2229:function(s,n,a){s.exports=a.p+"assets/img/db-redis-stream-3.a79f3cbe.png"},2230:function(s,n,a){s.exports=a.p+"assets/img/db-redis-stream-4.948af097.png"},2231:function(s,n,a){s.exports=a.p+"assets/img/db-redis-stream-5.136043a4.png"},3896:function(s,n,a){"use strict";a.r(n);var e=a(7),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"redis入门-数据类型-stream详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis入门-数据类型-stream详解"}},[s._v("#")]),s._v(" Redis入门 - 数据类型：Stream详解")]),s._v(" "),n("p",[s._v("===================================================")]),s._v(" "),n("blockquote",[n("p",[s._v("Redis5.0 中还增加了一个数据类型Stream，它借鉴了Kafka的设计，是一个新的强大的支持多播的可持久化的消息队列。@pdai")])]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#redis%E5%85%A5%E9%97%A8---%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8Bstream%E8%AF%A6%E8%A7%A3"}},[s._v("Redis入门 - 数据类型：Stream详解")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E8%AE%BE%E8%AE%A1stream"}},[s._v("为什么会设计Stream")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#stream%E8%AF%A6%E8%A7%A3"}},[s._v("Stream详解")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#stream%E7%9A%84%E7%BB%93%E6%9E%84"}},[s._v("Stream的结构")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"}},[s._v("增删改查")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E7%8B%AC%E7%AB%8B%E6%B6%88%E8%B4%B9"}},[s._v("独立消费")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E6%B6%88%E8%B4%B9%E7%BB%84%E6%B6%88%E8%B4%B9"}},[s._v("消费组消费")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E4%BF%A1%E6%81%AF%E7%9B%91%E6%8E%A7"}},[s._v("信息监控")])])])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E6%9B%B4%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3"}},[s._v("更深入理解")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#stream%E7%94%A8%E5%9C%A8%E4%BB%80%E4%B9%88%E6%A0%B7%E5%9C%BA%E6%99%AF"}},[s._v("Stream用在什么样场景")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E6%B6%88%E6%81%AFid%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%98%AF%E5%90%A6%E8%80%83%E8%99%91%E4%BA%86%E6%97%B6%E9%97%B4%E5%9B%9E%E6%8B%A8%E7%9A%84%E9%97%AE%E9%A2%98"}},[s._v("消息ID的设计是否考虑了时间回拨的问题？")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E6%B6%88%E8%B4%B9%E8%80%85%E5%B4%A9%E6%BA%83%E5%B8%A6%E6%9D%A5%E7%9A%84%E4%BC%9A%E4%B8%8D%E4%BC%9A%E6%B6%88%E6%81%AF%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98"}},[s._v("消费者崩溃带来的会不会消息丢失问题?")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E6%B6%88%E8%B4%B9%E8%80%85%E5%BD%BB%E5%BA%95%E5%AE%95%E6%9C%BA%E5%90%8E%E5%A6%82%E4%BD%95%E8%BD%AC%E7%A7%BB%E7%BB%99%E5%85%B6%E5%AE%83%E6%B6%88%E8%B4%B9%E8%80%85%E5%A4%84%E7%90%86"}},[s._v("消费者彻底宕机后如何转移给其它消费者处理？")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E5%9D%8F%E6%B6%88%E6%81%AF%E9%97%AE%E9%A2%98dead-letter%E6%AD%BB%E4%BF%A1%E9%97%AE%E9%A2%98"}},[s._v("坏消息问题，Dead Letter，死信问题")])])])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"}},[s._v("参考文章")])])])])]),s._v(" "),n("h1",{attrs:{id:"为什么会设计stream"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么会设计stream"}},[s._v("#")]),s._v(" 为什么会设计Stream")]),s._v(" "),n("hr"),s._v(" "),n("blockquote",[n("p",[s._v("Redis5.0 中还增加了一个数据结构Stream，从字面上看是流类型，但其实从功能上看，应该是Redis对消息队列（MQ，Message Queue）的完善实现。")])]),s._v(" "),n("p",[s._v("用过Redis做消息队列的都了解，基于Reids的消息队列实现有很多种，例如：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("PUB/SUB，订阅/发布模式")]),s._v(" "),n("ul",[n("li",[s._v("但是发布订阅模式是无法持久化的，如果出现网络断开、Redis 宕机等，消息就会被丢弃；")])])]),s._v(" "),n("li",[s._v("基于"),n("strong",[s._v("List LPUSH+BRPOP")]),s._v(" 或者 "),n("strong",[s._v("基于Sorted-Set")]),s._v("的实现\n"),n("ul",[n("li",[s._v("支持了持久化，但是不支持多播，分组消费等")])])])]),s._v(" "),n("p",[s._v("为什么上面的结构无法满足广泛的MQ场景？ 这里便引出一个核心的问题：如果我们期望设计一种数据结构来实现消息队列，最重要的就是要理解"),n("strong",[s._v("设计一个消息队列需要考虑什么")]),s._v("？初步的我们很容易想到")]),s._v(" "),n("ul",[n("li",[s._v("消息的生产")]),s._v(" "),n("li",[s._v("消息的消费\n"),n("ul",[n("li",[s._v("单播和多播（多对多）")]),s._v(" "),n("li",[s._v("阻塞和非阻塞读取")])])]),s._v(" "),n("li",[s._v("消息有序性")]),s._v(" "),n("li",[s._v("消息的持久化")])]),s._v(" "),n("p",[s._v("其它还要考虑啥嗯？借助美团技术团队的一篇文章，"),n("a",{attrs:{href:"https://tech.meituan.com/2016/07/01/mq-design.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("消息队列设计精要 在新窗口打开"),n("OutboundLink")],1),s._v(" 中的图")]),s._v(" "),n("p",[n("img",{attrs:{src:a(2227),alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("我们不妨看看Redis考虑了哪些设计")]),s._v("？")]),s._v(" "),n("ul",[n("li",[s._v("消息ID的序列化生成")]),s._v(" "),n("li",[s._v("消息遍历")]),s._v(" "),n("li",[s._v("消息的阻塞和非阻塞读取")]),s._v(" "),n("li",[s._v("消息的分组消费")]),s._v(" "),n("li",[s._v("未完成消息的处理")]),s._v(" "),n("li",[s._v("消息队列监控")]),s._v(" "),n("li",[s._v("...")])]),s._v(" "),n("blockquote",[n("p",[s._v("这也是我们需要理解Stream的点，但是结合上面的图，我们也应该理解Redis Stream也是一种超轻量MQ并没有完全实现消息队列所有设计要点，这决定着它适用的场景。")])]),s._v(" "),n("h1",{attrs:{id:"stream详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#stream详解"}},[s._v("#")]),s._v(" Stream详解")]),s._v(" "),n("hr"),s._v(" "),n("blockquote",[n("p",[s._v("经过梳理总结，我认为从以下几个大的方面去理解Stream是比较合适的，总结如下：@pdai")])]),s._v(" "),n("ul",[n("li",[s._v("Stream的结构设计")]),s._v(" "),n("li",[s._v("生产和消费\n"),n("ul",[n("li",[s._v("基本的增删查改")]),s._v(" "),n("li",[s._v("单一消费者的消费")]),s._v(" "),n("li",[s._v("消费组的消费")])])]),s._v(" "),n("li",[s._v("监控状态")])]),s._v(" "),n("h3",{attrs:{id:"stream的结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#stream的结构"}},[s._v("#")]),s._v(" Stream的结构")]),s._v(" "),n("p",[s._v("每个 Stream 都有唯一的名称，它就是 Redis 的 key，在我们首次使用 xadd 指令追加消息时自动创建。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(2228),alt:""}})]),s._v(" "),n("p",[s._v("上图解析：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("Consumer Group")]),s._v(" ：消费组，使用 XGROUP CREATE 命令创建，一个消费组有多个消费者(Consumer), 这些消费者之间是竞争关系。")]),s._v(" "),n("li",[n("code",[s._v("last_delivered_id")]),s._v(" ：游标，每个消费组会有个游标 last_delivered_id，任意一个消费者读取了消息都会使游标 last_delivered_id 往前移动。")]),s._v(" "),n("li",[n("code",[s._v("pending_ids")]),s._v(" ：消费者(Consumer)的状态变量，作用是维护消费者的未确认的 id。 pending_ids 记录了当前已经被客户端读取的消息，但是还没有 "),n("code",[s._v("ack")]),s._v(" (Acknowledge character：确认字符）。如果客户端没有ack，这个变量里面的消息ID会越来越多，一旦某个消息被ack，它就开始减少。这个pending_ids变量在Redis官方被称之为PEL，也就是Pending Entries List，这是一个很核心的数据结构，它用来确保客户端至少消费了消息一次，而不会在网络传输的中途丢失了没处理。")])]),s._v(" "),n("p",[s._v("此外我们还需要理解两点：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("消息ID")]),s._v(": 消息ID的形式是timestampInMillis-sequence，例如1527846880572-5，它表示当前的消息在毫米时间戳1527846880572时产生，并且是该毫秒内产生的第5条消息。消息ID可以由服务器自动生成，也可以由客户端自己指定，但是形式必须是整数-整数，而且必须是后面加入的消息的ID要大于前面的消息ID。")]),s._v(" "),n("li",[n("code",[s._v("消息内容")]),s._v(": 消息内容就是键值对，形如hash结构的键值对，这没什么特别之处。")])]),s._v(" "),n("h3",{attrs:{id:"增删改查"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#增删改查"}},[s._v("#")]),s._v(" 增删改查")]),s._v(" "),n("p",[s._v("消息队列相关命令：")]),s._v(" "),n("ul",[n("li",[s._v("XADD - 添加消息到末尾")]),s._v(" "),n("li",[s._v("XTRIM - 对流进行修剪，限制长度")]),s._v(" "),n("li",[s._v("XDEL - 删除消息")]),s._v(" "),n("li",[s._v("XLEN - 获取流包含的元素数量，即消息长度")]),s._v(" "),n("li",[s._v("XRANGE - 获取消息列表，会自动过滤已经删除的消息")]),s._v(" "),n("li",[s._v("XREVRANGE - 反向获取消息列表，ID 从大到小")]),s._v(" "),n("li",[s._v("XREAD - 以阻塞或非阻塞方式获取消息列表")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# *号表示服务器自动生成ID，后面顺序跟着一堆key/value\n127.0.0.1:6379> xadd codehole * name laoqian age 30  #  名字叫laoqian，年龄30岁\n1527849609889-0  # 生成的消息ID\n127.0.0.1:6379> xadd codehole * name xiaoyu age 29\n1527849629172-0\n127.0.0.1:6379> xadd codehole * name xiaoqian age 1\n1527849637634-0\n127.0.0.1:6379> xlen codehole\n(integer) 3\n127.0.0.1:6379> xrange codehole - +  # -表示最小值, +表示最大值\n127.0.0.1:6379> xrange codehole - +\n1) 1) 1527849609889-0\n   1) 1) "name"\n      1) "laoqian"\n      2) "age"\n      3) "30"\n2) 1) 1527849629172-0\n   1) 1) "name"\n      1) "xiaoyu"\n      2) "age"\n      3) "29"\n3) 1) 1527849637634-0\n   1) 1) "name"\n      1) "xiaoqian"\n      2) "age"\n      3) "1"\n127.0.0.1:6379> xrange codehole 1527849629172-0 +  # 指定最小消息ID的列表\n1) 1) 1527849629172-0\n   2) 1) "name"\n      2) "xiaoyu"\n      3) "age"\n      4) "29"\n2) 1) 1527849637634-0\n   2) 1) "name"\n      2) "xiaoqian"\n      3) "age"\n      4) "1"\n127.0.0.1:6379> xrange codehole - 1527849629172-0  # 指定最大消息ID的列表\n1) 1) 1527849609889-0\n   2) 1) "name"\n      2) "laoqian"\n      3) "age"\n      4) "30"\n2) 1) 1527849629172-0\n   2) 1) "name"\n      2) "xiaoyu"\n      3) "age"\n      4) "29"\n127.0.0.1:6379> xdel codehole 1527849609889-0\n(integer) 1\n127.0.0.1:6379> xlen codehole  # 长度不受影响\n(integer) 3\n127.0.0.1:6379> xrange codehole - +  # 被删除的消息没了\n1) 1) 1527849629172-0\n   2) 1) "name"\n      2) "xiaoyu"\n      3) "age"\n      4) "29"\n2) 1) 1527849637634-0\n   2) 1) "name"\n      2) "xiaoqian"\n      3) "age"\n      4) "1"\n127.0.0.1:6379> del codehole  # 删除整个Stream\n(integer) 1\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br")])]),n("h3",{attrs:{id:"独立消费"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#独立消费"}},[s._v("#")]),s._v(" 独立消费")]),s._v(" "),n("p",[s._v("我们可以在不定义消费组的情况下进行Stream消息的独立消费，当Stream没有新消息时，甚至可以阻塞等待。Redis设计了一个单独的消费指令xread，可以将Stream当成普通的消息队列(list)来使用。使用xread时，我们可以完全忽略消费组(Consumer Group)的存在，就好比Stream就是一个普通的列表(list)。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 从Stream头部读取两条消息\n127.0.0.1:6379> xread count 2 streams codehole 0-0\n1) 1) "codehole"\n   2) 1) 1) 1527851486781-0\n         2) 1) "name"\n            2) "laoqian"\n            3) "age"\n            4) "30"\n      2) 1) 1527851493405-0\n         2) 1) "name"\n            2) "yurui"\n            3) "age"\n            4) "29"\n# 从Stream尾部读取一条消息，毫无疑问，这里不会返回任何消息\n127.0.0.1:6379> xread count 1 streams codehole $\n(nil)\n# 从尾部阻塞等待新消息到来，下面的指令会堵住，直到新消息到来\n127.0.0.1:6379> xread block 0 count 1 streams codehole $\n# 我们从新打开一个窗口，在这个窗口往Stream里塞消息\n127.0.0.1:6379> xadd codehole * name youming age 60\n1527852774092-0\n# 再切换到前面的窗口，我们可以看到阻塞解除了，返回了新的消息内容\n# 而且还显示了一个等待时间，这里我们等待了93s\n127.0.0.1:6379> xread block 0 count 1 streams codehole $\n1) 1) "codehole"\n   2) 1) 1) 1527852774092-0\n         2) 1) "name"\n            2) "youming"\n            3) "age"\n            4) "60"\n(93.11s)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("p",[s._v("客户端如果想要使用xread进行顺序消费，一定要记住当前消费到哪里了，也就是返回的消息ID。下次继续调用xread时，将上次返回的最后一个消息ID作为参数传递进去，就可以继续消费后续的消息。")]),s._v(" "),n("p",[s._v("block 0表示永远阻塞，直到消息到来，block 1000表示阻塞1s，如果1s内没有任何消息到来，就返回nil")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("127.0.0.1:6379> xread block 1000 count 1 streams codehole $\n(nil)\n(1.07s)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"消费组消费"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#消费组消费"}},[s._v("#")]),s._v(" 消费组消费")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("消费组消费图")])])]),s._v(" "),n("p",[n("img",{attrs:{src:a(2229),alt:""}})]),s._v(" "),n("ul",[n("li",[n("p",[s._v("相关命令：")]),s._v(" "),n("ul",[n("li",[s._v("XGROUP CREATE - 创建消费者组")]),s._v(" "),n("li",[s._v("XREADGROUP GROUP - 读取消费者组中的消息")]),s._v(" "),n("li",[s._v('XACK - 将消息标记为"已处理"')]),s._v(" "),n("li",[s._v("XGROUP SETID - 为消费者组设置新的最后递送消息ID")]),s._v(" "),n("li",[s._v("XGROUP DELCONSUMER - 删除消费者")]),s._v(" "),n("li",[s._v("XGROUP DESTROY - 删除消费者组")]),s._v(" "),n("li",[s._v("XPENDING - 显示待处理消息的相关信息")]),s._v(" "),n("li",[s._v("XCLAIM - 转移消息的归属权")]),s._v(" "),n("li",[s._v("XINFO - 查看流和消费者组的相关信息；")]),s._v(" "),n("li",[s._v("XINFO GROUPS - 打印消费者组的信息；")]),s._v(" "),n("li",[s._v("XINFO STREAM - 打印流信息")])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("创建消费组")])])])]),s._v(" "),n("p",[s._v("Stream通过xgroup create指令创建消费组(Consumer Group)，需要传递起始消息ID参数用来初始化last_delivered_id变量。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> xgroup create codehole cg1 0-0  #  表示从头开始消费\nOK\n# $表示从尾部开始消费，只接受新消息，当前Stream消息会全部忽略\n127.0.0.1:6379> xgroup create codehole cg2 $\nOK\n127.0.0.1:6379> xinfo stream codehole  # 获取Stream信息\n 1) length\n 2) (integer) 3  # 共3个消息\n 3) radix-tree-keys\n 4) (integer) 1\n 5) radix-tree-nodes\n 6) (integer) 2\n 7) groups\n 8) (integer) 2  # 两个消费组\n 9) first-entry  # 第一个消息\n10) 1) 1527851486781-0\n    2) 1) "name"\n       2) "laoqian"\n       3) "age"\n       4) "30"\n11) last-entry  # 最后一个消息\n12) 1) 1527851498956-0\n    2) 1) "name"\n       2) "xiaoqian"\n       3) "age"\n       4) "1"\n127.0.0.1:6379> xinfo groups codehole  # 获取Stream的消费组信息\n1) 1) name\n   2) "cg1"\n   3) consumers\n   4) (integer) 0  # 该消费组还没有消费者\n   5) pending\n   6) (integer) 0  # 该消费组没有正在处理的消息\n2) 1) name\n   2) "cg2"\n   3) consumers  # 该消费组还没有消费者\n   4) (integer) 0\n   5) pending\n   6) (integer) 0  # 该消费组没有正在处理的消息\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("消费组消费")])])]),s._v(" "),n("p",[s._v("Stream提供了xreadgroup指令可以进行消费组的组内消费，需要提供消费组名称、消费者名称和起始消息ID。它同xread一样，也可以阻塞等待新消息。读到新消息后，对应的消息ID就会进入消费者的PEL(正在处理的消息)结构里，客户端处理完毕后使用xack指令通知服务器，本条消息已经处理完毕，该消息ID就会从PEL中移除。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# >号表示从当前消费组的last_delivered_id后面开始读\n# 每当消费者读取一条消息，last_delivered_id变量就会前进\n127.0.0.1:6379> xreadgroup GROUP cg1 c1 count 1 streams codehole >\n1) 1) "codehole"\n   2) 1) 1) 1527851486781-0\n         2) 1) "name"\n            2) "laoqian"\n            3) "age"\n            4) "30"\n127.0.0.1:6379> xreadgroup GROUP cg1 c1 count 1 streams codehole >\n1) 1) "codehole"\n   2) 1) 1) 1527851493405-0\n         2) 1) "name"\n            2) "yurui"\n            3) "age"\n            4) "29"\n127.0.0.1:6379> xreadgroup GROUP cg1 c1 count 2 streams codehole >\n1) 1) "codehole"\n   2) 1) 1) 1527851498956-0\n         2) 1) "name"\n            2) "xiaoqian"\n            3) "age"\n            4) "1"\n      2) 1) 1527852774092-0\n         2) 1) "name"\n            2) "youming"\n            3) "age"\n            4) "60"\n# 再继续读取，就没有新消息了\n127.0.0.1:6379> xreadgroup GROUP cg1 c1 count 1 streams codehole >\n(nil)\n# 那就阻塞等待吧\n127.0.0.1:6379> xreadgroup GROUP cg1 c1 block 0 count 1 streams codehole >\n# 开启另一个窗口，往里塞消息\n127.0.0.1:6379> xadd codehole * name lanying age 61\n1527854062442-0\n# 回到前一个窗口，发现阻塞解除，收到新消息了\n127.0.0.1:6379> xreadgroup GROUP cg1 c1 block 0 count 1 streams codehole >\n1) 1) "codehole"\n   2) 1) 1) 1527854062442-0\n         2) 1) "name"\n            2) "lanying"\n            3) "age"\n            4) "61"\n(36.54s)\n127.0.0.1:6379> xinfo groups codehole  # 观察消费组信息\n1) 1) name\n   2) "cg1"\n   3) consumers\n   4) (integer) 1  # 一个消费者\n   5) pending\n   6) (integer) 5  # 共5条正在处理的信息还有没有ack\n2) 1) name\n   2) "cg2"\n   3) consumers\n   4) (integer) 0  # 消费组cg2没有任何变化，因为前面我们一直在操纵cg1\n   5) pending\n   6) (integer) 0\n# 如果同一个消费组有多个消费者，我们可以通过xinfo consumers指令观察每个消费者的状态\n127.0.0.1:6379> xinfo consumers codehole cg1  # 目前还有1个消费者\n1) 1) name\n   2) "c1"\n   3) pending\n   4) (integer) 5  # 共5条待处理消息\n   5) idle\n   6) (integer) 418715  # 空闲了多长时间ms没有读取消息了\n# 接下来我们ack一条消息\n127.0.0.1:6379> xack codehole cg1 1527851486781-0\n(integer) 1\n127.0.0.1:6379> xinfo consumers codehole cg1\n1) 1) name\n   2) "c1"\n   3) pending\n   4) (integer) 4  # 变成了5条\n   5) idle\n   6) (integer) 668504\n# 下面ack所有消息\n127.0.0.1:6379> xack codehole cg1 1527851493405-0 1527851498956-0 1527852774092-0 1527854062442-0\n(integer) 4\n127.0.0.1:6379> xinfo consumers codehole cg1\n1) 1) name\n   2) "c1"\n   3) pending\n   4) (integer) 0  # pel空了\n   5) idle\n   6) (integer) 745505\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br")])]),n("h3",{attrs:{id:"信息监控"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#信息监控"}},[s._v("#")]),s._v(" 信息监控")]),s._v(" "),n("p",[s._v("Stream提供了XINFO来实现对服务器信息的监控，可以查询：")]),s._v(" "),n("ul",[n("li",[s._v("查看队列信息")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> Xinfo stream mq\n 1) "length"\n 2) (integer) 7\n 3) "radix-tree-keys"\n 4) (integer) 1\n 5) "radix-tree-nodes"\n 6) (integer) 2\n 7) "groups"\n 8) (integer) 1\n 9) "last-generated-id"\n10) "1553585533795-9"\n11) "first-entry"\n12) 1) "1553585533795-3"\n    2) 1) "msg"\n       2) "4"\n13) "last-entry"\n14) 1) "1553585533795-9"\n    2) 1) "msg"\n       2) "10"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("ul",[n("li",[s._v("消费组信息")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> Xinfo groups mq\n1) 1) "name"\n   2) "mqGroup"\n   3) "consumers"\n   4) (integer) 3\n   5) "pending"\n   6) (integer) 3\n   7) "last-delivered-id"\n   8) "1553585533795-4"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("ul",[n("li",[s._v("消费者组成员信息")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> XINFO CONSUMERS mq mqGroup\n1) 1) "name"\n   2) "consumerA"\n   3) "pending"\n   4) (integer) 1\n   5) "idle"\n   6) (integer) 18949894\n2) 1) "name"\n   2) "consumerB"\n   3) "pending"\n   4) (integer) 1\n   5) "idle"\n   6) (integer) 3092719\n3) 1) "name"\n   2) "consumerC"\n   3) "pending"\n   4) (integer) 1\n   5) "idle"\n   6) (integer) 23683256\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("至此，消息队列的操作说明大体结束！")]),s._v(" "),n("h1",{attrs:{id:"更深入理解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更深入理解"}},[s._v("#")]),s._v(" 更深入理解")]),s._v(" "),n("hr"),s._v(" "),n("blockquote",[n("p",[s._v("我们结合MQ中常见问题，看Redis是如何解决的，来进一步理解Redis。")])]),s._v(" "),n("h3",{attrs:{id:"stream用在什么样场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#stream用在什么样场景"}},[s._v("#")]),s._v(" Stream用在什么样场景")]),s._v(" "),n("p",[s._v("可用作时通信等，大数据分析，异地数据备份等")]),s._v(" "),n("p",[n("img",{attrs:{src:a(2230),alt:""}})]),s._v(" "),n("p",[s._v("客户端可以平滑扩展，提高处理能力")]),s._v(" "),n("p",[n("img",{attrs:{src:a(2231),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"消息id的设计是否考虑了时间回拨的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#消息id的设计是否考虑了时间回拨的问题"}},[s._v("#")]),s._v(" 消息ID的设计是否考虑了时间回拨的问题？")]),s._v(" "),n("blockquote",[n("p",[s._v("在 "),n("a",{attrs:{href:"https://pdai.tech/md/algorithm/alg-domain-id-snowflake.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("分布式算法 - ID算法"),n("OutboundLink")],1),s._v("设计中, 一个常见的问题就是时间回拨问题，那么Redis的消息ID设计中是否考虑到这个问题呢？")])]),s._v(" "),n("p",[s._v("XADD生成的1553439850328-0，就是Redis生成的消息ID，由两部分组成:"),n("strong",[s._v("时间戳-序号")]),s._v("。时间戳是毫秒级单位，是生成消息的Redis服务器时间，它是个64位整型（int64）。序号是在这个毫秒时间点内的消息序号，它也是个64位整型。")]),s._v(" "),n("p",[s._v("可以通过multi批处理，来验证序号的递增：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> MULTI\nOK\n127.0.0.1:6379> XADD memberMessage * msg one\nQUEUED\n127.0.0.1:6379> XADD memberMessage * msg two\nQUEUED\n127.0.0.1:6379> XADD memberMessage * msg three\nQUEUED\n127.0.0.1:6379> XADD memberMessage * msg four\nQUEUED\n127.0.0.1:6379> XADD memberMessage * msg five\nQUEUED\n127.0.0.1:6379> EXEC\n1) "1553441006884-0"\n2) "1553441006884-1"\n3) "1553441006884-2"\n4) "1553441006884-3"\n5) "1553441006884-4"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("由于一个redis命令的执行很快，所以可以看到在同一时间戳内，是通过序号递增来表示消息的。")]),s._v(" "),n("p",[s._v("为了保证消息是有序的，因此Redis生成的ID是单调递增有序的。由于ID中包含时间戳部分，为了避免服务器时间错误而带来的问题（例如服务器时间延后了），Redis的每个Stream类型数据都维护一个latest_generated_id属性，用于记录最后一个消息的ID。"),n("strong",[s._v("若发现当前时间戳退后（小于latest_generated_id所记录的），则采用时间戳不变而序号递增的方案来作为新消息ID")]),s._v("（这也是序号为什么使用int64的原因，保证有足够多的的序号），从而保证ID的单调递增性质。")]),s._v(" "),n("p",[s._v("强烈建议使用Redis的方案生成消息ID，因为这种时间戳+序号的单调递增的ID方案，几乎可以满足你全部的需求。但同时，记住ID是支持自定义的，别忘了！")]),s._v(" "),n("h3",{attrs:{id:"消费者崩溃带来的会不会消息丢失问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#消费者崩溃带来的会不会消息丢失问题"}},[s._v("#")]),s._v(" 消费者崩溃带来的会不会消息丢失问题?")]),s._v(" "),n("p",[s._v("为了解决组内消息读取但处理期间消费者崩溃带来的消息丢失问题，STREAM 设计了 Pending 列表，用于记录读取但并未处理完毕的消息。命令XPENDIING 用来获消费组或消费内消费者的未处理完毕的消息。演示如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> XPENDING mq mqGroup # mpGroup的Pending情况\n1) (integer) 5 # 5个已读取但未处理的消息\n2) "1553585533795-0" # 起始ID\n3) "1553585533795-4" # 结束ID\n4) 1) 1) "consumerA" # 消费者A有3个\n      2) "3"\n   2) 1) "consumerB" # 消费者B有1个\n      2) "1"\n   3) 1) "consumerC" # 消费者C有1个\n      2) "1"\n\n127.0.0.1:6379> XPENDING mq mqGroup - + 10 # 使用 start end count 选项可以获取详细信息\n1) 1) "1553585533795-0" # 消息ID\n   2) "consumerA" # 消费者\n   3) (integer) 1654355 # 从读取到现在经历了1654355ms，IDLE\n   4) (integer) 5 # 消息被读取了5次，delivery counter\n2) 1) "1553585533795-1"\n   2) "consumerA"\n   3) (integer) 1654355\n   4) (integer) 4\n# 共5个，余下3个省略 ...\n\n127.0.0.1:6379> XPENDING mq mqGroup - + 10 consumerA # 在加上消费者参数，获取具体某个消费者的Pending列表\n1) 1) "1553585533795-0"\n   2) "consumerA"\n   3) (integer) 1641083\n   4) (integer) 5\n# 共3个，余下2个省略 ...\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("p",[s._v("每个Pending的消息有4个属性：")]),s._v(" "),n("ul",[n("li",[s._v("消息ID")]),s._v(" "),n("li",[s._v("所属消费者")]),s._v(" "),n("li",[s._v("IDLE，已读取时长")]),s._v(" "),n("li",[s._v("delivery counter，消息被读取次数")])]),s._v(" "),n("p",[s._v("上面的结果我们可以看到，我们之前读取的消息，都被记录在Pending列表中，说明全部读到的消息都没有处理，仅仅是读取了。那如何表示消费者处理完毕了消息呢？使用命令 XACK 完成告知消息处理完成，演示如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> XACK mq mqGroup 1553585533795-0 # 通知消息处理结束，用消息ID标识\n(integer) 1\n\n127.0.0.1:6379> XPENDING mq mqGroup # 再次查看Pending列表\n1) (integer) 4 # 已读取但未处理的消息已经变为4个\n2) "1553585533795-1"\n3) "1553585533795-4"\n4) 1) 1) "consumerA" # 消费者A，还有2个消息处理\n      2) "2"\n   2) 1) "consumerB"\n      2) "1"\n   3) 1) "consumerC"\n      2) "1"\n127.0.0.1:6379>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("有了这样一个Pending机制，就意味着在某个消费者读取消息但未处理后，消息是不会丢失的。等待消费者再次上线后，可以读取该Pending列表，就可以继续处理该消息了，保证消息的有序和不丢失。")]),s._v(" "),n("h3",{attrs:{id:"消费者彻底宕机后如何转移给其它消费者处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#消费者彻底宕机后如何转移给其它消费者处理"}},[s._v("#")]),s._v(" 消费者彻底宕机后如何转移给其它消费者处理？")]),s._v(" "),n("blockquote",[n("p",[s._v("还有一个问题，就是若某个消费者宕机之后，没有办法再上线了，那么就需要将该消费者Pending的消息，转义给其他的消费者处理，就是消息转移。")])]),s._v(" "),n("p",[s._v("消息转移的操作时将某个消息转移到自己的Pending列表中。使用语法XCLAIM来实现，需要设置组、转移的目标消费者和消息ID，同时需要提供IDLE（已被读取时长），只有超过这个时长，才能被转移。演示如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 当前属于消费者A的消息1553585533795-1，已经15907,787ms未处理了\n127.0.0.1:6379> XPENDING mq mqGroup - + 10\n1) 1) "1553585533795-1"\n   2) "consumerA"\n   3) (integer) 15907787\n   4) (integer) 4\n\n# 转移超过3600s的消息1553585533795-1到消费者B的Pending列表\n127.0.0.1:6379> XCLAIM mq mqGroup consumerB 3600000 1553585533795-1\n1) 1) "1553585533795-1"\n   2) 1) "msg"\n      2) "2"\n\n# 消息1553585533795-1已经转移到消费者B的Pending中。\n127.0.0.1:6379> XPENDING mq mqGroup - + 10\n1) 1) "1553585533795-1"\n   2) "consumerB"\n   3) (integer) 84404 # 注意IDLE，被重置了\n   4) (integer) 5 # 注意，读取次数也累加了1次\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("以上代码，完成了一次消息转移。转移除了要指定ID外，还需要指定IDLE，保证是长时间未处理的才被转移。被转移的消息的IDLE会被重置，用以保证不会被重复转移，以为可能会出现将过期的消息同时转移给多个消费者的并发操作，设置了IDLE，则可以避免后面的转移不会成功，因为IDLE不满足条件。例如下面的连续两条转移，第二条不会成功。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("127.0.0.1:6379> XCLAIM mq mqGroup consumerB 3600000 1553585533795-1\n127.0.0.1:6379> XCLAIM mq mqGroup consumerC 3600000 1553585533795-1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("这就是消息转移。至此我们使用了一个Pending消息的ID，所属消费者和IDLE的属性，还有一个属性就是消息被读取次数，delivery counter，该属性的作用由于统计消息被读取的次数，包括被转移也算。这个属性主要用在判定是否为错误数据上。")]),s._v(" "),n("h3",{attrs:{id:"坏消息问题-dead-letter-死信问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#坏消息问题-dead-letter-死信问题"}},[s._v("#")]),s._v(" 坏消息问题，Dead Letter，死信问题")]),s._v(" "),n("p",[s._v("正如上面所说，如果某个消息，不能被消费者处理，也就是不能被XACK，这是要长时间处于Pending列表中，即使被反复的转移给各个消费者也是如此。此时该消息的delivery counter就会累加（上一节的例子可以看到），当累加到某个我们预设的临界值时，我们就认为是坏消息（也叫死信，DeadLetter，无法投递的消息），由于有了判定条件，我们将坏消息处理掉即可，删除即可。删除一个消息，使用XDEL语法，演示如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 删除队列中的消息\n127.0.0.1:6379> XDEL mq 1553585533795-1\n(integer) 1\n# 查看队列中再无此消息\n127.0.0.1:6379> XRANGE mq - +\n1) 1) "1553585533795-0"\n   2) 1) "msg"\n      2) "1"\n2) 1) "1553585533795-2"\n   2) 1) "msg"\n      2) "3"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("注意本例中，并没有删除Pending中的消息因此你查看Pending，消息还会在。可以执行XACK标识其处理完毕！")]),s._v(" "),n("h1",{attrs:{id:"参考文章"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("本文主要梳理总结自：")]),s._v(" "),n("ul",[n("li",[s._v("https://www.runoob.com/redis/redis-stream.html")]),s._v(" "),n("li",[s._v("https://www.zhihu.com/question/279540635")]),s._v(" "),n("li",[s._v("https://zhuanlan.zhihu.com/p/60501638)")])])])}),[],!1,null,null,null);n.default=t.exports}}]);