(window.webpackJsonp=window.webpackJsonp||[]).push([[204],{3398:function(n,s,e){n.exports=e.p+"assets/img/tomcat-x-pipline-3.e5306707.jpg"},3399:function(n,s,e){n.exports=e.p+"assets/img/tomcat-x-pipline-1.01aa4d63.jpg"},3400:function(n,s,e){n.exports=e.p+"assets/img/tomcat-x-pipline-6.4e78eb47.jpg"},3401:function(n,s,e){n.exports=e.p+"assets/img/tomcat-x-pipline-5.299e42ff.jpg"},3402:function(n,s,e){n.exports=e.p+"assets/img/tomcat-x-pipline-7.0011e9be.jpg"},3403:function(n,s,e){n.exports=e.p+"assets/img/tomcat-x-pipline-2.c668bdd9.jpg"},4209:function(n,s,e){"use strict";e.r(s);var a=e(7),t=Object(a.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h1",{attrs:{id:"tomcat-container的管道机制-责任链模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tomcat-container的管道机制-责任链模式"}},[n._v("#")]),n._v(" Tomcat - Container的管道机制：责任链模式")]),n._v(" "),s("p",[n._v("===============================================================")]),n._v(" "),s("blockquote",[s("p",[n._v("上文中介绍了Engine的设计，其中有Pipline相关内容没有介绍，本文将向你阐述Tomcat的管道机制以及它要解决的问题。@pdai")])]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#tomcat---container%E7%9A%84%E7%AE%A1%E9%81%93%E6%9C%BA%E5%88%B6%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"}},[n._v("Tomcat - Container的管道机制：责任链模式")]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E5%86%85%E5%AE%B9%E5%BC%95%E5%85%A5"}},[n._v("内容引入")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#%E7%9F%A5%E8%AF%86%E5%87%86%E5%A4%87"}},[n._v("知识准备")]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"}},[n._v("责任链模式")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#filterchain"}},[n._v("FilterChain")])])])]),n._v(" "),s("li",[s("a",{attrs:{href:"#pipline%E6%9C%BA%E5%88%B6"}},[n._v("Pipline机制")]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#vavle%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"}},[n._v("Vavle接口设计")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#pipline%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"}},[n._v("Pipline接口设计")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#basevavle%E8%AE%BE%E8%AE%A1"}},[n._v("BaseVavle设计")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#standardpipline%E5%AE%9E%E7%8E%B0"}},[n._v("StandardPipline实现")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#containerbase%E4%B8%AD%E8%BF%90%E7%94%A8pipline"}},[n._v("ContainerBase中运用Pipline")])])])]),n._v(" "),s("li",[s("a",{attrs:{href:"#%E5%AF%B9%E6%AF%94%E4%B8%8B%E4%B8%A4%E7%A7%8D%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"}},[n._v("对比下两种责任链模式")])])])])]),n._v(" "),s("h1",{attrs:{id:"内容引入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内容引入"}},[n._v("#")]),n._v(" 内容引入")]),n._v(" "),s("hr"),n._v(" "),s("blockquote",[s("p",[n._v("承接上文Engine的设计，从以下几个方面，我将向你解释为什么要理解Tomcat中管道机制，它要解决什么问题？@pdai")])]),n._v(" "),s("ul",[s("li",[n._v("Tomcat总计架构图中Pipeline和Vavle")])]),n._v(" "),s("p",[s("img",{attrs:{src:e(3398),alt:""}})]),n._v(" "),s("ul",[s("li",[n._v("我们在上文Engine中有一块Pipline没有解释：")])]),n._v(" "),s("p",[s("img",{attrs:{src:e(3399),alt:""}})]),n._v(" "),s("ul",[s("li",[n._v("为什么Tomcat要引入Pipline呢？它要解决什么问题呢？")])]),n._v(" "),s("p",[n._v("下文将向你详细阐述。")]),n._v(" "),s("h1",{attrs:{id:"知识准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#知识准备"}},[n._v("#")]),n._v(" 知识准备")]),n._v(" "),s("hr"),n._v(" "),s("blockquote",[s("p",[n._v("在弄清楚管道机制前，你需要一些基础知识和其它软件设计中的应用场景。")])]),n._v(" "),s("h3",{attrs:{id:"责任链模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#责任链模式"}},[n._v("#")]),n._v(" 责任链模式")]),n._v(" "),s("p",[n._v("管道机制在设计模式上属于责任链模式，如果你不理解，请参看如下文章：")]),n._v(" "),s("p",[s("a",{attrs:{href:"https://pdai.tech/md/dev-spec/pattern/15_chain.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("责任链模式(Chain of responsibility pattern)"),s("OutboundLink")],1),n._v(": 通过责任链模式, 你可以为某个请求创建一个对象链. 每个对象依序检查此请求并对其进行处理或者将它传给链中的下一个对象。")]),n._v(" "),s("h3",{attrs:{id:"filterchain"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#filterchain"}},[n._v("#")]),n._v(" FilterChain")]),n._v(" "),s("p",[n._v("在软件开发的常接触的责任链模式是FilterChain，它体现在很多软件设计中：")]),n._v(" "),s("ul",[s("li",[s("strong",[n._v("比如Spring Security框架中")])])]),n._v(" "),s("p",[s("img",{attrs:{src:e(3400),alt:""}})]),n._v(" "),s("ul",[s("li",[s("strong",[n._v("比如HttpServletRequest处理的过滤器中")])])]),n._v(" "),s("p",[n._v("当一个request过来的时候，需要对这个request做一系列的加工，使用责任链模式可以使每个加工组件化，减少耦合。也可以使用在当一个request过来的时候，需要找到合适的加工方式。当一个加工方式不适合这个request的时候，传递到下一个加工方法，该加工方式再尝试对request加工。")]),n._v(" "),s("p",[n._v("网上找了图，这里我们后文将通过Tomcat请求处理向你阐述。")]),n._v(" "),s("p",[s("img",{attrs:{src:e(3401),alt:""}})]),n._v(" "),s("h1",{attrs:{id:"pipline机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pipline机制"}},[n._v("#")]),n._v(" Pipline机制")]),n._v(" "),s("hr"),n._v(" "),s("blockquote",[s("p",[n._v("为什么要有管道机制？")])]),n._v(" "),s("p",[n._v("在一个比较复杂的大型系统中，如果一个对象或数据流需要进行繁杂的逻辑处理，我们可以选择在一个大的组件中直接处理这些繁杂的业务逻辑， 这个方式虽然达到目的，但扩展性和可重用性较差， 因为可能牵一发而动全身。更好的解决方案是采用管道机制，"),s("strong",[n._v("用一条管道把多个对象(阀门部件)连接起来，整体看起来就像若干个阀门嵌套在管道中一样，而处理逻辑放在阀门上")]),n._v("。")]),n._v(" "),s("h3",{attrs:{id:"vavle接口设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vavle接口设计"}},[n._v("#")]),n._v(" Vavle接口设计")]),n._v(" "),s("p",[n._v("理解它的设计，第一步就是阀门设计")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("public interface Valve {\n\n\n    // 因为需要传递给下个Valve处理，所以有next\n    public Valve getNext();\n    public void setNext(Valve valve);\n\n\n    // 设计这个方法，便于执行周期任务，比如重新加载组件。此方法将在该容器的类加载上下文中调用。\n    public void backgroundProcess();\n\n\n    // 这个方法很容易理解，阀门中处理的执行方法，传入Request和Response进行处理\n    public void invoke(Request request, Response response)\n        throws IOException, ServletException;\n\n    // 此阀门是否支持Servlet 3+ 异步的请求\n    public boolean isAsyncSupported();\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br")])]),s("h3",{attrs:{id:"pipline接口设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pipline接口设计"}},[n._v("#")]),n._v(" Pipline接口设计")]),n._v(" "),s("p",[n._v("由于Pipline是为容器设计的，所以它在设计时加入了一个Containerd接口, 就是为了制定当前Pipline所属的容器：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("public interface Contained {\n\n    Container getContainer();\n\n    void setContainer(Container container);\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br")])]),s("p",[n._v("我们接着看下Pipline接口设计")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("public interface Pipeline extends Contained {\n\n    // 基础的处理阀\n    public Valve getBasic();\n    public void setBasic(Valve valve);\n\n\n    // 对节点（阀门）增删查\n    public void addValve(Valve valve);\n    public Valve[] getValves();\n    public void removeValve(Valve valve);\n\n\n    // 获取第一个节点，遍历的起点，所以需要有这方法\n    public Valve getFirst();\n\n\n    // 是否所有节点（阀门）都支持处理Servlet3异步处理\n    public boolean isAsyncSupported();\n\n\n    // 找到所有不支持Servlet3异步处理的阀门\n    public void findNonAsyncValves(Set<String> result);\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br")])]),s("h3",{attrs:{id:"basevavle设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#basevavle设计"}},[n._v("#")]),n._v(" BaseVavle设计")]),n._v(" "),s("p",[n._v("由于Valve也是组件，需要生命周期管理，所以实现LifecycleMBeanBase，同时集成Contained和Valve")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('public abstract class ValveBase extends LifecycleMBeanBase implements Contained, Valve {\n\n    protected static final StringManager sm = StringManager.getManager(ValveBase.class);\n\n\n    //------------------------------------------------------ Constructor\n\n    public ValveBase() {\n        this(false);\n    }\n\n\n    public ValveBase(boolean asyncSupported) {\n        this.asyncSupported = asyncSupported;\n    }\n\n\n    //------------------------------------------------------ Instance Variables\n\n    /**\n     * Does this valve support Servlet 3+ async requests?\n     */\n    protected boolean asyncSupported;\n\n\n    /**\n     * The Container whose pipeline this Valve is a component of.\n     */\n    protected Container container = null;\n\n\n    /**\n     * Container log\n     */\n    protected Log containerLog = null;\n\n\n    /**\n     * The next Valve in the pipeline this Valve is a component of.\n     */\n    protected Valve next = null;\n\n\n    //-------------------------------------------------------------- Properties\n\n    /**\n     * Return the Container with which this Valve is associated, if any.\n     */\n    @Override\n    public Container getContainer() {\n        return container;\n    }\n\n\n    /**\n     * Set the Container with which this Valve is associated, if any.\n     *\n     * @param container The new associated container\n     */\n    @Override\n    public void setContainer(Container container) {\n        this.container = container;\n    }\n\n\n    @Override\n    public boolean isAsyncSupported() {\n        return asyncSupported;\n    }\n\n\n    public void setAsyncSupported(boolean asyncSupported) {\n        this.asyncSupported = asyncSupported;\n    }\n\n\n    /**\n     * Return the next Valve in this pipeline, or <code>null</code> if this\n     * is the last Valve in the pipeline.\n     */\n    @Override\n    public Valve getNext() {\n        return next;\n    }\n\n\n    /**\n     * Set the Valve that follows this one in the pipeline it is part of.\n     *\n     * @param valve The new next valve\n     */\n    @Override\n    public void setNext(Valve valve) {\n        this.next = valve;\n    }\n\n\n    //---------------------------------------------------------- Public Methods\n\n    /**\n     * Execute a periodic task, such as reloading, etc. This method will be\n     * invoked inside the classloading context of this container. Unexpected\n     * throwables will be caught and logged.\n     */\n    @Override\n    public void backgroundProcess() {\n        // NOOP by default\n    }\n\n\n    @Override\n    protected void initInternal() throws LifecycleException {\n        super.initInternal();\n        containerLog = getContainer().getLogger();\n    }\n\n\n    /**\n     * Start this component and implement the requirements\n     * of {@link org.apache.catalina.util.LifecycleBase#startInternal()}.\n     *\n     * @exception LifecycleException if this component detects a fatal error\n     *  that prevents this component from being used\n     */\n    @Override\n    protected synchronized void startInternal() throws LifecycleException {\n        setState(LifecycleState.STARTING);\n    }\n\n\n    /**\n     * Stop this component and implement the requirements\n     * of {@link org.apache.catalina.util.LifecycleBase#stopInternal()}.\n     *\n     * @exception LifecycleException if this component detects a fatal error\n     *  that prevents this component from being used\n     */\n    @Override\n    protected synchronized void stopInternal() throws LifecycleException {\n        setState(LifecycleState.STOPPING);\n    }\n\n\n    /**\n     * Return a String rendering of this object.\n     */\n    @Override\n    public String toString() {\n        return ToStringUtil.toString(this);\n    }\n\n\n    // -------------------- JMX and Registration  --------------------\n\n    @Override\n    public String getObjectNameKeyProperties() {\n        StringBuilder name = new StringBuilder("type=Valve");\n\n        Container container = getContainer();\n\n        name.append(container.getMBeanKeyProperties());\n\n        int seq = 0;\n\n        // Pipeline may not be present in unit testing\n        Pipeline p = container.getPipeline();\n        if (p != null) {\n            for (Valve valve : p.getValves()) {\n                // Skip null valves\n                if (valve == null) {\n                    continue;\n                }\n                // Only compare valves in pipeline until we find this valve\n                if (valve == this) {\n                    break;\n                }\n                if (valve.getClass() == this.getClass()) {\n                    // Duplicate valve earlier in pipeline\n                    // increment sequence number\n                    seq ++;\n                }\n            }\n        }\n\n        if (seq > 0) {\n            name.append(",seq=");\n            name.append(seq);\n        }\n\n        String className = this.getClass().getName();\n        int period = className.lastIndexOf(\'.\');\n        if (period >= 0) {\n            className = className.substring(period + 1);\n        }\n        name.append(",name=");\n        name.append(className);\n\n        return name.toString();\n    }\n\n\n    @Override\n    public String getDomainInternal() {\n        Container c = getContainer();\n        if (c == null) {\n            return null;\n        } else {\n            return c.getDomain();\n        }\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br"),s("span",{staticClass:"line-number"},[n._v("87")]),s("br"),s("span",{staticClass:"line-number"},[n._v("88")]),s("br"),s("span",{staticClass:"line-number"},[n._v("89")]),s("br"),s("span",{staticClass:"line-number"},[n._v("90")]),s("br"),s("span",{staticClass:"line-number"},[n._v("91")]),s("br"),s("span",{staticClass:"line-number"},[n._v("92")]),s("br"),s("span",{staticClass:"line-number"},[n._v("93")]),s("br"),s("span",{staticClass:"line-number"},[n._v("94")]),s("br"),s("span",{staticClass:"line-number"},[n._v("95")]),s("br"),s("span",{staticClass:"line-number"},[n._v("96")]),s("br"),s("span",{staticClass:"line-number"},[n._v("97")]),s("br"),s("span",{staticClass:"line-number"},[n._v("98")]),s("br"),s("span",{staticClass:"line-number"},[n._v("99")]),s("br"),s("span",{staticClass:"line-number"},[n._v("100")]),s("br"),s("span",{staticClass:"line-number"},[n._v("101")]),s("br"),s("span",{staticClass:"line-number"},[n._v("102")]),s("br"),s("span",{staticClass:"line-number"},[n._v("103")]),s("br"),s("span",{staticClass:"line-number"},[n._v("104")]),s("br"),s("span",{staticClass:"line-number"},[n._v("105")]),s("br"),s("span",{staticClass:"line-number"},[n._v("106")]),s("br"),s("span",{staticClass:"line-number"},[n._v("107")]),s("br"),s("span",{staticClass:"line-number"},[n._v("108")]),s("br"),s("span",{staticClass:"line-number"},[n._v("109")]),s("br"),s("span",{staticClass:"line-number"},[n._v("110")]),s("br"),s("span",{staticClass:"line-number"},[n._v("111")]),s("br"),s("span",{staticClass:"line-number"},[n._v("112")]),s("br"),s("span",{staticClass:"line-number"},[n._v("113")]),s("br"),s("span",{staticClass:"line-number"},[n._v("114")]),s("br"),s("span",{staticClass:"line-number"},[n._v("115")]),s("br"),s("span",{staticClass:"line-number"},[n._v("116")]),s("br"),s("span",{staticClass:"line-number"},[n._v("117")]),s("br"),s("span",{staticClass:"line-number"},[n._v("118")]),s("br"),s("span",{staticClass:"line-number"},[n._v("119")]),s("br"),s("span",{staticClass:"line-number"},[n._v("120")]),s("br"),s("span",{staticClass:"line-number"},[n._v("121")]),s("br"),s("span",{staticClass:"line-number"},[n._v("122")]),s("br"),s("span",{staticClass:"line-number"},[n._v("123")]),s("br"),s("span",{staticClass:"line-number"},[n._v("124")]),s("br"),s("span",{staticClass:"line-number"},[n._v("125")]),s("br"),s("span",{staticClass:"line-number"},[n._v("126")]),s("br"),s("span",{staticClass:"line-number"},[n._v("127")]),s("br"),s("span",{staticClass:"line-number"},[n._v("128")]),s("br"),s("span",{staticClass:"line-number"},[n._v("129")]),s("br"),s("span",{staticClass:"line-number"},[n._v("130")]),s("br"),s("span",{staticClass:"line-number"},[n._v("131")]),s("br"),s("span",{staticClass:"line-number"},[n._v("132")]),s("br"),s("span",{staticClass:"line-number"},[n._v("133")]),s("br"),s("span",{staticClass:"line-number"},[n._v("134")]),s("br"),s("span",{staticClass:"line-number"},[n._v("135")]),s("br"),s("span",{staticClass:"line-number"},[n._v("136")]),s("br"),s("span",{staticClass:"line-number"},[n._v("137")]),s("br"),s("span",{staticClass:"line-number"},[n._v("138")]),s("br"),s("span",{staticClass:"line-number"},[n._v("139")]),s("br"),s("span",{staticClass:"line-number"},[n._v("140")]),s("br"),s("span",{staticClass:"line-number"},[n._v("141")]),s("br"),s("span",{staticClass:"line-number"},[n._v("142")]),s("br"),s("span",{staticClass:"line-number"},[n._v("143")]),s("br"),s("span",{staticClass:"line-number"},[n._v("144")]),s("br"),s("span",{staticClass:"line-number"},[n._v("145")]),s("br"),s("span",{staticClass:"line-number"},[n._v("146")]),s("br"),s("span",{staticClass:"line-number"},[n._v("147")]),s("br"),s("span",{staticClass:"line-number"},[n._v("148")]),s("br"),s("span",{staticClass:"line-number"},[n._v("149")]),s("br"),s("span",{staticClass:"line-number"},[n._v("150")]),s("br"),s("span",{staticClass:"line-number"},[n._v("151")]),s("br"),s("span",{staticClass:"line-number"},[n._v("152")]),s("br"),s("span",{staticClass:"line-number"},[n._v("153")]),s("br"),s("span",{staticClass:"line-number"},[n._v("154")]),s("br"),s("span",{staticClass:"line-number"},[n._v("155")]),s("br"),s("span",{staticClass:"line-number"},[n._v("156")]),s("br"),s("span",{staticClass:"line-number"},[n._v("157")]),s("br"),s("span",{staticClass:"line-number"},[n._v("158")]),s("br"),s("span",{staticClass:"line-number"},[n._v("159")]),s("br"),s("span",{staticClass:"line-number"},[n._v("160")]),s("br"),s("span",{staticClass:"line-number"},[n._v("161")]),s("br"),s("span",{staticClass:"line-number"},[n._v("162")]),s("br"),s("span",{staticClass:"line-number"},[n._v("163")]),s("br"),s("span",{staticClass:"line-number"},[n._v("164")]),s("br"),s("span",{staticClass:"line-number"},[n._v("165")]),s("br"),s("span",{staticClass:"line-number"},[n._v("166")]),s("br"),s("span",{staticClass:"line-number"},[n._v("167")]),s("br"),s("span",{staticClass:"line-number"},[n._v("168")]),s("br"),s("span",{staticClass:"line-number"},[n._v("169")]),s("br"),s("span",{staticClass:"line-number"},[n._v("170")]),s("br"),s("span",{staticClass:"line-number"},[n._v("171")]),s("br"),s("span",{staticClass:"line-number"},[n._v("172")]),s("br"),s("span",{staticClass:"line-number"},[n._v("173")]),s("br"),s("span",{staticClass:"line-number"},[n._v("174")]),s("br"),s("span",{staticClass:"line-number"},[n._v("175")]),s("br"),s("span",{staticClass:"line-number"},[n._v("176")]),s("br"),s("span",{staticClass:"line-number"},[n._v("177")]),s("br"),s("span",{staticClass:"line-number"},[n._v("178")]),s("br"),s("span",{staticClass:"line-number"},[n._v("179")]),s("br"),s("span",{staticClass:"line-number"},[n._v("180")]),s("br"),s("span",{staticClass:"line-number"},[n._v("181")]),s("br"),s("span",{staticClass:"line-number"},[n._v("182")]),s("br"),s("span",{staticClass:"line-number"},[n._v("183")]),s("br"),s("span",{staticClass:"line-number"},[n._v("184")]),s("br"),s("span",{staticClass:"line-number"},[n._v("185")]),s("br"),s("span",{staticClass:"line-number"},[n._v("186")]),s("br"),s("span",{staticClass:"line-number"},[n._v("187")]),s("br"),s("span",{staticClass:"line-number"},[n._v("188")]),s("br"),s("span",{staticClass:"line-number"},[n._v("189")]),s("br"),s("span",{staticClass:"line-number"},[n._v("190")]),s("br"),s("span",{staticClass:"line-number"},[n._v("191")]),s("br"),s("span",{staticClass:"line-number"},[n._v("192")]),s("br"),s("span",{staticClass:"line-number"},[n._v("193")]),s("br"),s("span",{staticClass:"line-number"},[n._v("194")]),s("br"),s("span",{staticClass:"line-number"},[n._v("195")]),s("br"),s("span",{staticClass:"line-number"},[n._v("196")]),s("br"),s("span",{staticClass:"line-number"},[n._v("197")]),s("br"),s("span",{staticClass:"line-number"},[n._v("198")]),s("br"),s("span",{staticClass:"line-number"},[n._v("199")]),s("br"),s("span",{staticClass:"line-number"},[n._v("200")]),s("br"),s("span",{staticClass:"line-number"},[n._v("201")]),s("br"),s("span",{staticClass:"line-number"},[n._v("202")]),s("br"),s("span",{staticClass:"line-number"},[n._v("203")]),s("br"),s("span",{staticClass:"line-number"},[n._v("204")]),s("br"),s("span",{staticClass:"line-number"},[n._v("205")]),s("br"),s("span",{staticClass:"line-number"},[n._v("206")]),s("br"),s("span",{staticClass:"line-number"},[n._v("207")]),s("br"),s("span",{staticClass:"line-number"},[n._v("208")]),s("br"),s("span",{staticClass:"line-number"},[n._v("209")]),s("br"),s("span",{staticClass:"line-number"},[n._v("210")]),s("br"),s("span",{staticClass:"line-number"},[n._v("211")]),s("br")])]),s("h3",{attrs:{id:"standardpipline实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#standardpipline实现"}},[n._v("#")]),n._v(" StandardPipline实现")]),n._v(" "),s("p",[n._v("里面方法很简单，就直接贴代码了。它必然是继承LifecycleBase同时实现Pipline.")]),n._v(" "),s("p",[n._v("贴个图方面你理解")]),n._v(" "),s("p",[s("img",{attrs:{src:e(3402),alt:""}})]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('public class StandardPipeline extends LifecycleBase implements Pipeline {\n\n    private static final Log log = LogFactory.getLog(StandardPipeline.class);\n    private static final StringManager sm = StringManager.getManager(Constants.Package);\n\n    // ----------------------------------------------------------- Constructors\n\n\n    /**\n     * Construct a new StandardPipeline instance with no associated Container.\n     */\n    public StandardPipeline() {\n\n        this(null);\n\n    }\n\n\n    /**\n     * Construct a new StandardPipeline instance that is associated with the\n     * specified Container.\n     *\n     * @param container The container we should be associated with\n     */\n    public StandardPipeline(Container container) {\n\n        super();\n        setContainer(container);\n\n    }\n\n\n    // ----------------------------------------------------- Instance Variables\n\n\n    /**\n     * The basic Valve (if any) associated with this Pipeline.\n     */\n    protected Valve basic = null;\n\n\n    /**\n     * The Container with which this Pipeline is associated.\n     */\n    protected Container container = null;\n\n\n    /**\n     * The first valve associated with this Pipeline.\n     */\n    protected Valve first = null;\n\n\n    // --------------------------------------------------------- Public Methods\n\n    @Override\n    public boolean isAsyncSupported() {\n        Valve valve = (first!=null)?first:basic;\n        boolean supported = true;\n        while (supported && valve!=null) {\n            supported = supported & valve.isAsyncSupported();\n            valve = valve.getNext();\n        }\n        return supported;\n    }\n\n\n    @Override\n    public void findNonAsyncValves(Set<String> result) {\n        Valve valve = (first!=null) ? first : basic;\n        while (valve != null) {\n            if (!valve.isAsyncSupported()) {\n                result.add(valve.getClass().getName());\n            }\n            valve = valve.getNext();\n        }\n    }\n\n\n    // ------------------------------------------------------ Contained Methods\n\n    /**\n     * Return the Container with which this Pipeline is associated.\n     */\n    @Override\n    public Container getContainer() {\n        return this.container;\n    }\n\n\n    /**\n     * Set the Container with which this Pipeline is associated.\n     *\n     * @param container The new associated container\n     */\n    @Override\n    public void setContainer(Container container) {\n        this.container = container;\n    }\n\n\n    @Override\n    protected void initInternal() {\n        // NOOP\n    }\n\n\n    /**\n     * Start {@link Valve}s) in this pipeline and implement the requirements\n     * of {@link LifecycleBase#startInternal()}.\n     *\n     * @exception LifecycleException if this component detects a fatal error\n     *  that prevents this component from being used\n     */\n    @Override\n    protected synchronized void startInternal() throws LifecycleException {\n\n        // Start the Valves in our pipeline (including the basic), if any\n        Valve current = first;\n        if (current == null) {\n            current = basic;\n        }\n        while (current != null) {\n            if (current instanceof Lifecycle)\n                ((Lifecycle) current).start();\n            current = current.getNext();\n        }\n\n        setState(LifecycleState.STARTING);\n    }\n\n\n    /**\n     * Stop {@link Valve}s) in this pipeline and implement the requirements\n     * of {@link LifecycleBase#stopInternal()}.\n     *\n     * @exception LifecycleException if this component detects a fatal error\n     *  that prevents this component from being used\n     */\n    @Override\n    protected synchronized void stopInternal() throws LifecycleException {\n\n        setState(LifecycleState.STOPPING);\n\n        // Stop the Valves in our pipeline (including the basic), if any\n        Valve current = first;\n        if (current == null) {\n            current = basic;\n        }\n        while (current != null) {\n            if (current instanceof Lifecycle)\n                ((Lifecycle) current).stop();\n            current = current.getNext();\n        }\n    }\n\n\n    @Override\n    protected void destroyInternal() {\n        Valve[] valves = getValves();\n        for (Valve valve : valves) {\n            removeValve(valve);\n        }\n    }\n\n\n    /**\n     * Return a String representation of this component.\n     */\n    @Override\n    public String toString() {\n        return ToStringUtil.toString(this);\n    }\n\n\n    // ------------------------------------------------------- Pipeline Methods\n\n\n    /**\n     * <p>Return the Valve instance that has been distinguished as the basic\n     * Valve for this Pipeline (if any).\n     */\n    @Override\n    public Valve getBasic() {\n        return this.basic;\n    }\n\n\n    /**\n     * <p>Set the Valve instance that has been distinguished as the basic\n     * Valve for this Pipeline (if any).  Prior to setting the basic Valve,\n     * the Valve\'s <code>setContainer()</code> will be called, if it\n     * implements <code>Contained</code>, with the owning Container as an\n     * argument.  The method may throw an <code>IllegalArgumentException</code>\n     * if this Valve chooses not to be associated with this Container, or\n     * <code>IllegalStateException</code> if it is already associated with\n     * a different Container.</p>\n     *\n     * @param valve Valve to be distinguished as the basic Valve\n     */\n    @Override\n    public void setBasic(Valve valve) {\n\n        // Change components if necessary\n        Valve oldBasic = this.basic;\n        if (oldBasic == valve)\n            return;\n\n        // Stop the old component if necessary\n        if (oldBasic != null) {\n            if (getState().isAvailable() && (oldBasic instanceof Lifecycle)) {\n                try {\n                    ((Lifecycle) oldBasic).stop();\n                } catch (LifecycleException e) {\n                    log.error(sm.getString("standardPipeline.basic.stop"), e);\n                }\n            }\n            if (oldBasic instanceof Contained) {\n                try {\n                    ((Contained) oldBasic).setContainer(null);\n                } catch (Throwable t) {\n                    ExceptionUtils.handleThrowable(t);\n                }\n            }\n        }\n\n        // Start the new component if necessary\n        if (valve == null)\n            return;\n        if (valve instanceof Contained) {\n            ((Contained) valve).setContainer(this.container);\n        }\n        if (getState().isAvailable() && valve instanceof Lifecycle) {\n            try {\n                ((Lifecycle) valve).start();\n            } catch (LifecycleException e) {\n                log.error(sm.getString("standardPipeline.basic.start"), e);\n                return;\n            }\n        }\n\n        // Update the pipeline\n        Valve current = first;\n        while (current != null) {\n            if (current.getNext() == oldBasic) {\n                current.setNext(valve);\n                break;\n            }\n            current = current.getNext();\n        }\n\n        this.basic = valve;\n\n    }\n\n\n    /**\n     * <p>Add a new Valve to the end of the pipeline associated with this\n     * Container.  Prior to adding the Valve, the Valve\'s\n     * <code>setContainer()</code> method will be called, if it implements\n     * <code>Contained</code>, with the owning Container as an argument.\n     * The method may throw an\n     * <code>IllegalArgumentException</code> if this Valve chooses not to\n     * be associated with this Container, or <code>IllegalStateException</code>\n     * if it is already associated with a different Container.</p>\n     *\n     * @param valve Valve to be added\n     *\n     * @exception IllegalArgumentException if this Container refused to\n     *  accept the specified Valve\n     * @exception IllegalArgumentException if the specified Valve refuses to be\n     *  associated with this Container\n     * @exception IllegalStateException if the specified Valve is already\n     *  associated with a different Container\n     */\n    @Override\n    public void addValve(Valve valve) {\n\n        // Validate that we can add this Valve\n        if (valve instanceof Contained)\n            ((Contained) valve).setContainer(this.container);\n\n        // Start the new component if necessary\n        if (getState().isAvailable()) {\n            if (valve instanceof Lifecycle) {\n                try {\n                    ((Lifecycle) valve).start();\n                } catch (LifecycleException e) {\n                    log.error(sm.getString("standardPipeline.valve.start"), e);\n                }\n            }\n        }\n\n        // Add this Valve to the set associated with this Pipeline\n        if (first == null) {\n            first = valve;\n            valve.setNext(basic);\n        } else {\n            Valve current = first;\n            while (current != null) {\n                if (current.getNext() == basic) {\n                    current.setNext(valve);\n                    valve.setNext(basic);\n                    break;\n                }\n                current = current.getNext();\n            }\n        }\n\n        container.fireContainerEvent(Container.ADD_VALVE_EVENT, valve);\n    }\n\n\n    /**\n     * Return the set of Valves in the pipeline associated with this\n     * Container, including the basic Valve (if any).  If there are no\n     * such Valves, a zero-length array is returned.\n     */\n    @Override\n    public Valve[] getValves() {\n\n        List<Valve> valveList = new ArrayList<>();\n        Valve current = first;\n        if (current == null) {\n            current = basic;\n        }\n        while (current != null) {\n            valveList.add(current);\n            current = current.getNext();\n        }\n\n        return valveList.toArray(new Valve[0]);\n\n    }\n\n    public ObjectName[] getValveObjectNames() {\n\n        List<ObjectName> valveList = new ArrayList<>();\n        Valve current = first;\n        if (current == null) {\n            current = basic;\n        }\n        while (current != null) {\n            if (current instanceof JmxEnabled) {\n                valveList.add(((JmxEnabled) current).getObjectName());\n            }\n            current = current.getNext();\n        }\n\n        return valveList.toArray(new ObjectName[0]);\n\n    }\n\n    /**\n     * Remove the specified Valve from the pipeline associated with this\n     * Container, if it is found; otherwise, do nothing.  If the Valve is\n     * found and removed, the Valve\'s <code>setContainer(null)</code> method\n     * will be called if it implements <code>Contained</code>.\n     *\n     * @param valve Valve to be removed\n     */\n    @Override\n    public void removeValve(Valve valve) {\n\n        Valve current;\n        if(first == valve) {\n            first = first.getNext();\n            current = null;\n        } else {\n            current = first;\n        }\n        while (current != null) {\n            if (current.getNext() == valve) {\n                current.setNext(valve.getNext());\n                break;\n            }\n            current = current.getNext();\n        }\n\n        if (first == basic) first = null;\n\n        if (valve instanceof Contained)\n            ((Contained) valve).setContainer(null);\n\n        if (valve instanceof Lifecycle) {\n            // Stop this valve if necessary\n            if (getState().isAvailable()) {\n                try {\n                    ((Lifecycle) valve).stop();\n                } catch (LifecycleException e) {\n                    log.error(sm.getString("standardPipeline.valve.stop"), e);\n                }\n            }\n            try {\n                ((Lifecycle) valve).destroy();\n            } catch (LifecycleException e) {\n                log.error(sm.getString("standardPipeline.valve.destroy"), e);\n            }\n        }\n\n        container.fireContainerEvent(Container.REMOVE_VALVE_EVENT, valve);\n    }\n\n\n    @Override\n    public Valve getFirst() {\n        if (first != null) {\n            return first;\n        }\n\n        return basic;\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br"),s("span",{staticClass:"line-number"},[n._v("87")]),s("br"),s("span",{staticClass:"line-number"},[n._v("88")]),s("br"),s("span",{staticClass:"line-number"},[n._v("89")]),s("br"),s("span",{staticClass:"line-number"},[n._v("90")]),s("br"),s("span",{staticClass:"line-number"},[n._v("91")]),s("br"),s("span",{staticClass:"line-number"},[n._v("92")]),s("br"),s("span",{staticClass:"line-number"},[n._v("93")]),s("br"),s("span",{staticClass:"line-number"},[n._v("94")]),s("br"),s("span",{staticClass:"line-number"},[n._v("95")]),s("br"),s("span",{staticClass:"line-number"},[n._v("96")]),s("br"),s("span",{staticClass:"line-number"},[n._v("97")]),s("br"),s("span",{staticClass:"line-number"},[n._v("98")]),s("br"),s("span",{staticClass:"line-number"},[n._v("99")]),s("br"),s("span",{staticClass:"line-number"},[n._v("100")]),s("br"),s("span",{staticClass:"line-number"},[n._v("101")]),s("br"),s("span",{staticClass:"line-number"},[n._v("102")]),s("br"),s("span",{staticClass:"line-number"},[n._v("103")]),s("br"),s("span",{staticClass:"line-number"},[n._v("104")]),s("br"),s("span",{staticClass:"line-number"},[n._v("105")]),s("br"),s("span",{staticClass:"line-number"},[n._v("106")]),s("br"),s("span",{staticClass:"line-number"},[n._v("107")]),s("br"),s("span",{staticClass:"line-number"},[n._v("108")]),s("br"),s("span",{staticClass:"line-number"},[n._v("109")]),s("br"),s("span",{staticClass:"line-number"},[n._v("110")]),s("br"),s("span",{staticClass:"line-number"},[n._v("111")]),s("br"),s("span",{staticClass:"line-number"},[n._v("112")]),s("br"),s("span",{staticClass:"line-number"},[n._v("113")]),s("br"),s("span",{staticClass:"line-number"},[n._v("114")]),s("br"),s("span",{staticClass:"line-number"},[n._v("115")]),s("br"),s("span",{staticClass:"line-number"},[n._v("116")]),s("br"),s("span",{staticClass:"line-number"},[n._v("117")]),s("br"),s("span",{staticClass:"line-number"},[n._v("118")]),s("br"),s("span",{staticClass:"line-number"},[n._v("119")]),s("br"),s("span",{staticClass:"line-number"},[n._v("120")]),s("br"),s("span",{staticClass:"line-number"},[n._v("121")]),s("br"),s("span",{staticClass:"line-number"},[n._v("122")]),s("br"),s("span",{staticClass:"line-number"},[n._v("123")]),s("br"),s("span",{staticClass:"line-number"},[n._v("124")]),s("br"),s("span",{staticClass:"line-number"},[n._v("125")]),s("br"),s("span",{staticClass:"line-number"},[n._v("126")]),s("br"),s("span",{staticClass:"line-number"},[n._v("127")]),s("br"),s("span",{staticClass:"line-number"},[n._v("128")]),s("br"),s("span",{staticClass:"line-number"},[n._v("129")]),s("br"),s("span",{staticClass:"line-number"},[n._v("130")]),s("br"),s("span",{staticClass:"line-number"},[n._v("131")]),s("br"),s("span",{staticClass:"line-number"},[n._v("132")]),s("br"),s("span",{staticClass:"line-number"},[n._v("133")]),s("br"),s("span",{staticClass:"line-number"},[n._v("134")]),s("br"),s("span",{staticClass:"line-number"},[n._v("135")]),s("br"),s("span",{staticClass:"line-number"},[n._v("136")]),s("br"),s("span",{staticClass:"line-number"},[n._v("137")]),s("br"),s("span",{staticClass:"line-number"},[n._v("138")]),s("br"),s("span",{staticClass:"line-number"},[n._v("139")]),s("br"),s("span",{staticClass:"line-number"},[n._v("140")]),s("br"),s("span",{staticClass:"line-number"},[n._v("141")]),s("br"),s("span",{staticClass:"line-number"},[n._v("142")]),s("br"),s("span",{staticClass:"line-number"},[n._v("143")]),s("br"),s("span",{staticClass:"line-number"},[n._v("144")]),s("br"),s("span",{staticClass:"line-number"},[n._v("145")]),s("br"),s("span",{staticClass:"line-number"},[n._v("146")]),s("br"),s("span",{staticClass:"line-number"},[n._v("147")]),s("br"),s("span",{staticClass:"line-number"},[n._v("148")]),s("br"),s("span",{staticClass:"line-number"},[n._v("149")]),s("br"),s("span",{staticClass:"line-number"},[n._v("150")]),s("br"),s("span",{staticClass:"line-number"},[n._v("151")]),s("br"),s("span",{staticClass:"line-number"},[n._v("152")]),s("br"),s("span",{staticClass:"line-number"},[n._v("153")]),s("br"),s("span",{staticClass:"line-number"},[n._v("154")]),s("br"),s("span",{staticClass:"line-number"},[n._v("155")]),s("br"),s("span",{staticClass:"line-number"},[n._v("156")]),s("br"),s("span",{staticClass:"line-number"},[n._v("157")]),s("br"),s("span",{staticClass:"line-number"},[n._v("158")]),s("br"),s("span",{staticClass:"line-number"},[n._v("159")]),s("br"),s("span",{staticClass:"line-number"},[n._v("160")]),s("br"),s("span",{staticClass:"line-number"},[n._v("161")]),s("br"),s("span",{staticClass:"line-number"},[n._v("162")]),s("br"),s("span",{staticClass:"line-number"},[n._v("163")]),s("br"),s("span",{staticClass:"line-number"},[n._v("164")]),s("br"),s("span",{staticClass:"line-number"},[n._v("165")]),s("br"),s("span",{staticClass:"line-number"},[n._v("166")]),s("br"),s("span",{staticClass:"line-number"},[n._v("167")]),s("br"),s("span",{staticClass:"line-number"},[n._v("168")]),s("br"),s("span",{staticClass:"line-number"},[n._v("169")]),s("br"),s("span",{staticClass:"line-number"},[n._v("170")]),s("br"),s("span",{staticClass:"line-number"},[n._v("171")]),s("br"),s("span",{staticClass:"line-number"},[n._v("172")]),s("br"),s("span",{staticClass:"line-number"},[n._v("173")]),s("br"),s("span",{staticClass:"line-number"},[n._v("174")]),s("br"),s("span",{staticClass:"line-number"},[n._v("175")]),s("br"),s("span",{staticClass:"line-number"},[n._v("176")]),s("br"),s("span",{staticClass:"line-number"},[n._v("177")]),s("br"),s("span",{staticClass:"line-number"},[n._v("178")]),s("br"),s("span",{staticClass:"line-number"},[n._v("179")]),s("br"),s("span",{staticClass:"line-number"},[n._v("180")]),s("br"),s("span",{staticClass:"line-number"},[n._v("181")]),s("br"),s("span",{staticClass:"line-number"},[n._v("182")]),s("br"),s("span",{staticClass:"line-number"},[n._v("183")]),s("br"),s("span",{staticClass:"line-number"},[n._v("184")]),s("br"),s("span",{staticClass:"line-number"},[n._v("185")]),s("br"),s("span",{staticClass:"line-number"},[n._v("186")]),s("br"),s("span",{staticClass:"line-number"},[n._v("187")]),s("br"),s("span",{staticClass:"line-number"},[n._v("188")]),s("br"),s("span",{staticClass:"line-number"},[n._v("189")]),s("br"),s("span",{staticClass:"line-number"},[n._v("190")]),s("br"),s("span",{staticClass:"line-number"},[n._v("191")]),s("br"),s("span",{staticClass:"line-number"},[n._v("192")]),s("br"),s("span",{staticClass:"line-number"},[n._v("193")]),s("br"),s("span",{staticClass:"line-number"},[n._v("194")]),s("br"),s("span",{staticClass:"line-number"},[n._v("195")]),s("br"),s("span",{staticClass:"line-number"},[n._v("196")]),s("br"),s("span",{staticClass:"line-number"},[n._v("197")]),s("br"),s("span",{staticClass:"line-number"},[n._v("198")]),s("br"),s("span",{staticClass:"line-number"},[n._v("199")]),s("br"),s("span",{staticClass:"line-number"},[n._v("200")]),s("br"),s("span",{staticClass:"line-number"},[n._v("201")]),s("br"),s("span",{staticClass:"line-number"},[n._v("202")]),s("br"),s("span",{staticClass:"line-number"},[n._v("203")]),s("br"),s("span",{staticClass:"line-number"},[n._v("204")]),s("br"),s("span",{staticClass:"line-number"},[n._v("205")]),s("br"),s("span",{staticClass:"line-number"},[n._v("206")]),s("br"),s("span",{staticClass:"line-number"},[n._v("207")]),s("br"),s("span",{staticClass:"line-number"},[n._v("208")]),s("br"),s("span",{staticClass:"line-number"},[n._v("209")]),s("br"),s("span",{staticClass:"line-number"},[n._v("210")]),s("br"),s("span",{staticClass:"line-number"},[n._v("211")]),s("br"),s("span",{staticClass:"line-number"},[n._v("212")]),s("br"),s("span",{staticClass:"line-number"},[n._v("213")]),s("br"),s("span",{staticClass:"line-number"},[n._v("214")]),s("br"),s("span",{staticClass:"line-number"},[n._v("215")]),s("br"),s("span",{staticClass:"line-number"},[n._v("216")]),s("br"),s("span",{staticClass:"line-number"},[n._v("217")]),s("br"),s("span",{staticClass:"line-number"},[n._v("218")]),s("br"),s("span",{staticClass:"line-number"},[n._v("219")]),s("br"),s("span",{staticClass:"line-number"},[n._v("220")]),s("br"),s("span",{staticClass:"line-number"},[n._v("221")]),s("br"),s("span",{staticClass:"line-number"},[n._v("222")]),s("br"),s("span",{staticClass:"line-number"},[n._v("223")]),s("br"),s("span",{staticClass:"line-number"},[n._v("224")]),s("br"),s("span",{staticClass:"line-number"},[n._v("225")]),s("br"),s("span",{staticClass:"line-number"},[n._v("226")]),s("br"),s("span",{staticClass:"line-number"},[n._v("227")]),s("br"),s("span",{staticClass:"line-number"},[n._v("228")]),s("br"),s("span",{staticClass:"line-number"},[n._v("229")]),s("br"),s("span",{staticClass:"line-number"},[n._v("230")]),s("br"),s("span",{staticClass:"line-number"},[n._v("231")]),s("br"),s("span",{staticClass:"line-number"},[n._v("232")]),s("br"),s("span",{staticClass:"line-number"},[n._v("233")]),s("br"),s("span",{staticClass:"line-number"},[n._v("234")]),s("br"),s("span",{staticClass:"line-number"},[n._v("235")]),s("br"),s("span",{staticClass:"line-number"},[n._v("236")]),s("br"),s("span",{staticClass:"line-number"},[n._v("237")]),s("br"),s("span",{staticClass:"line-number"},[n._v("238")]),s("br"),s("span",{staticClass:"line-number"},[n._v("239")]),s("br"),s("span",{staticClass:"line-number"},[n._v("240")]),s("br"),s("span",{staticClass:"line-number"},[n._v("241")]),s("br"),s("span",{staticClass:"line-number"},[n._v("242")]),s("br"),s("span",{staticClass:"line-number"},[n._v("243")]),s("br"),s("span",{staticClass:"line-number"},[n._v("244")]),s("br"),s("span",{staticClass:"line-number"},[n._v("245")]),s("br"),s("span",{staticClass:"line-number"},[n._v("246")]),s("br"),s("span",{staticClass:"line-number"},[n._v("247")]),s("br"),s("span",{staticClass:"line-number"},[n._v("248")]),s("br"),s("span",{staticClass:"line-number"},[n._v("249")]),s("br"),s("span",{staticClass:"line-number"},[n._v("250")]),s("br"),s("span",{staticClass:"line-number"},[n._v("251")]),s("br"),s("span",{staticClass:"line-number"},[n._v("252")]),s("br"),s("span",{staticClass:"line-number"},[n._v("253")]),s("br"),s("span",{staticClass:"line-number"},[n._v("254")]),s("br"),s("span",{staticClass:"line-number"},[n._v("255")]),s("br"),s("span",{staticClass:"line-number"},[n._v("256")]),s("br"),s("span",{staticClass:"line-number"},[n._v("257")]),s("br"),s("span",{staticClass:"line-number"},[n._v("258")]),s("br"),s("span",{staticClass:"line-number"},[n._v("259")]),s("br"),s("span",{staticClass:"line-number"},[n._v("260")]),s("br"),s("span",{staticClass:"line-number"},[n._v("261")]),s("br"),s("span",{staticClass:"line-number"},[n._v("262")]),s("br"),s("span",{staticClass:"line-number"},[n._v("263")]),s("br"),s("span",{staticClass:"line-number"},[n._v("264")]),s("br"),s("span",{staticClass:"line-number"},[n._v("265")]),s("br"),s("span",{staticClass:"line-number"},[n._v("266")]),s("br"),s("span",{staticClass:"line-number"},[n._v("267")]),s("br"),s("span",{staticClass:"line-number"},[n._v("268")]),s("br"),s("span",{staticClass:"line-number"},[n._v("269")]),s("br"),s("span",{staticClass:"line-number"},[n._v("270")]),s("br"),s("span",{staticClass:"line-number"},[n._v("271")]),s("br"),s("span",{staticClass:"line-number"},[n._v("272")]),s("br"),s("span",{staticClass:"line-number"},[n._v("273")]),s("br"),s("span",{staticClass:"line-number"},[n._v("274")]),s("br"),s("span",{staticClass:"line-number"},[n._v("275")]),s("br"),s("span",{staticClass:"line-number"},[n._v("276")]),s("br"),s("span",{staticClass:"line-number"},[n._v("277")]),s("br"),s("span",{staticClass:"line-number"},[n._v("278")]),s("br"),s("span",{staticClass:"line-number"},[n._v("279")]),s("br"),s("span",{staticClass:"line-number"},[n._v("280")]),s("br"),s("span",{staticClass:"line-number"},[n._v("281")]),s("br"),s("span",{staticClass:"line-number"},[n._v("282")]),s("br"),s("span",{staticClass:"line-number"},[n._v("283")]),s("br"),s("span",{staticClass:"line-number"},[n._v("284")]),s("br"),s("span",{staticClass:"line-number"},[n._v("285")]),s("br"),s("span",{staticClass:"line-number"},[n._v("286")]),s("br"),s("span",{staticClass:"line-number"},[n._v("287")]),s("br"),s("span",{staticClass:"line-number"},[n._v("288")]),s("br"),s("span",{staticClass:"line-number"},[n._v("289")]),s("br"),s("span",{staticClass:"line-number"},[n._v("290")]),s("br"),s("span",{staticClass:"line-number"},[n._v("291")]),s("br"),s("span",{staticClass:"line-number"},[n._v("292")]),s("br"),s("span",{staticClass:"line-number"},[n._v("293")]),s("br"),s("span",{staticClass:"line-number"},[n._v("294")]),s("br"),s("span",{staticClass:"line-number"},[n._v("295")]),s("br"),s("span",{staticClass:"line-number"},[n._v("296")]),s("br"),s("span",{staticClass:"line-number"},[n._v("297")]),s("br"),s("span",{staticClass:"line-number"},[n._v("298")]),s("br"),s("span",{staticClass:"line-number"},[n._v("299")]),s("br"),s("span",{staticClass:"line-number"},[n._v("300")]),s("br"),s("span",{staticClass:"line-number"},[n._v("301")]),s("br"),s("span",{staticClass:"line-number"},[n._v("302")]),s("br"),s("span",{staticClass:"line-number"},[n._v("303")]),s("br"),s("span",{staticClass:"line-number"},[n._v("304")]),s("br"),s("span",{staticClass:"line-number"},[n._v("305")]),s("br"),s("span",{staticClass:"line-number"},[n._v("306")]),s("br"),s("span",{staticClass:"line-number"},[n._v("307")]),s("br"),s("span",{staticClass:"line-number"},[n._v("308")]),s("br"),s("span",{staticClass:"line-number"},[n._v("309")]),s("br"),s("span",{staticClass:"line-number"},[n._v("310")]),s("br"),s("span",{staticClass:"line-number"},[n._v("311")]),s("br"),s("span",{staticClass:"line-number"},[n._v("312")]),s("br"),s("span",{staticClass:"line-number"},[n._v("313")]),s("br"),s("span",{staticClass:"line-number"},[n._v("314")]),s("br"),s("span",{staticClass:"line-number"},[n._v("315")]),s("br"),s("span",{staticClass:"line-number"},[n._v("316")]),s("br"),s("span",{staticClass:"line-number"},[n._v("317")]),s("br"),s("span",{staticClass:"line-number"},[n._v("318")]),s("br"),s("span",{staticClass:"line-number"},[n._v("319")]),s("br"),s("span",{staticClass:"line-number"},[n._v("320")]),s("br"),s("span",{staticClass:"line-number"},[n._v("321")]),s("br"),s("span",{staticClass:"line-number"},[n._v("322")]),s("br"),s("span",{staticClass:"line-number"},[n._v("323")]),s("br"),s("span",{staticClass:"line-number"},[n._v("324")]),s("br"),s("span",{staticClass:"line-number"},[n._v("325")]),s("br"),s("span",{staticClass:"line-number"},[n._v("326")]),s("br"),s("span",{staticClass:"line-number"},[n._v("327")]),s("br"),s("span",{staticClass:"line-number"},[n._v("328")]),s("br"),s("span",{staticClass:"line-number"},[n._v("329")]),s("br"),s("span",{staticClass:"line-number"},[n._v("330")]),s("br"),s("span",{staticClass:"line-number"},[n._v("331")]),s("br"),s("span",{staticClass:"line-number"},[n._v("332")]),s("br"),s("span",{staticClass:"line-number"},[n._v("333")]),s("br"),s("span",{staticClass:"line-number"},[n._v("334")]),s("br"),s("span",{staticClass:"line-number"},[n._v("335")]),s("br"),s("span",{staticClass:"line-number"},[n._v("336")]),s("br"),s("span",{staticClass:"line-number"},[n._v("337")]),s("br"),s("span",{staticClass:"line-number"},[n._v("338")]),s("br"),s("span",{staticClass:"line-number"},[n._v("339")]),s("br"),s("span",{staticClass:"line-number"},[n._v("340")]),s("br"),s("span",{staticClass:"line-number"},[n._v("341")]),s("br"),s("span",{staticClass:"line-number"},[n._v("342")]),s("br"),s("span",{staticClass:"line-number"},[n._v("343")]),s("br"),s("span",{staticClass:"line-number"},[n._v("344")]),s("br"),s("span",{staticClass:"line-number"},[n._v("345")]),s("br"),s("span",{staticClass:"line-number"},[n._v("346")]),s("br"),s("span",{staticClass:"line-number"},[n._v("347")]),s("br"),s("span",{staticClass:"line-number"},[n._v("348")]),s("br"),s("span",{staticClass:"line-number"},[n._v("349")]),s("br"),s("span",{staticClass:"line-number"},[n._v("350")]),s("br"),s("span",{staticClass:"line-number"},[n._v("351")]),s("br"),s("span",{staticClass:"line-number"},[n._v("352")]),s("br"),s("span",{staticClass:"line-number"},[n._v("353")]),s("br"),s("span",{staticClass:"line-number"},[n._v("354")]),s("br"),s("span",{staticClass:"line-number"},[n._v("355")]),s("br"),s("span",{staticClass:"line-number"},[n._v("356")]),s("br"),s("span",{staticClass:"line-number"},[n._v("357")]),s("br"),s("span",{staticClass:"line-number"},[n._v("358")]),s("br"),s("span",{staticClass:"line-number"},[n._v("359")]),s("br"),s("span",{staticClass:"line-number"},[n._v("360")]),s("br"),s("span",{staticClass:"line-number"},[n._v("361")]),s("br"),s("span",{staticClass:"line-number"},[n._v("362")]),s("br"),s("span",{staticClass:"line-number"},[n._v("363")]),s("br"),s("span",{staticClass:"line-number"},[n._v("364")]),s("br"),s("span",{staticClass:"line-number"},[n._v("365")]),s("br"),s("span",{staticClass:"line-number"},[n._v("366")]),s("br"),s("span",{staticClass:"line-number"},[n._v("367")]),s("br"),s("span",{staticClass:"line-number"},[n._v("368")]),s("br"),s("span",{staticClass:"line-number"},[n._v("369")]),s("br"),s("span",{staticClass:"line-number"},[n._v("370")]),s("br"),s("span",{staticClass:"line-number"},[n._v("371")]),s("br"),s("span",{staticClass:"line-number"},[n._v("372")]),s("br"),s("span",{staticClass:"line-number"},[n._v("373")]),s("br"),s("span",{staticClass:"line-number"},[n._v("374")]),s("br"),s("span",{staticClass:"line-number"},[n._v("375")]),s("br"),s("span",{staticClass:"line-number"},[n._v("376")]),s("br"),s("span",{staticClass:"line-number"},[n._v("377")]),s("br"),s("span",{staticClass:"line-number"},[n._v("378")]),s("br"),s("span",{staticClass:"line-number"},[n._v("379")]),s("br"),s("span",{staticClass:"line-number"},[n._v("380")]),s("br"),s("span",{staticClass:"line-number"},[n._v("381")]),s("br"),s("span",{staticClass:"line-number"},[n._v("382")]),s("br"),s("span",{staticClass:"line-number"},[n._v("383")]),s("br"),s("span",{staticClass:"line-number"},[n._v("384")]),s("br"),s("span",{staticClass:"line-number"},[n._v("385")]),s("br"),s("span",{staticClass:"line-number"},[n._v("386")]),s("br"),s("span",{staticClass:"line-number"},[n._v("387")]),s("br"),s("span",{staticClass:"line-number"},[n._v("388")]),s("br"),s("span",{staticClass:"line-number"},[n._v("389")]),s("br"),s("span",{staticClass:"line-number"},[n._v("390")]),s("br"),s("span",{staticClass:"line-number"},[n._v("391")]),s("br"),s("span",{staticClass:"line-number"},[n._v("392")]),s("br"),s("span",{staticClass:"line-number"},[n._v("393")]),s("br"),s("span",{staticClass:"line-number"},[n._v("394")]),s("br"),s("span",{staticClass:"line-number"},[n._v("395")]),s("br"),s("span",{staticClass:"line-number"},[n._v("396")]),s("br"),s("span",{staticClass:"line-number"},[n._v("397")]),s("br"),s("span",{staticClass:"line-number"},[n._v("398")]),s("br"),s("span",{staticClass:"line-number"},[n._v("399")]),s("br"),s("span",{staticClass:"line-number"},[n._v("400")]),s("br"),s("span",{staticClass:"line-number"},[n._v("401")]),s("br"),s("span",{staticClass:"line-number"},[n._v("402")]),s("br"),s("span",{staticClass:"line-number"},[n._v("403")]),s("br"),s("span",{staticClass:"line-number"},[n._v("404")]),s("br"),s("span",{staticClass:"line-number"},[n._v("405")]),s("br"),s("span",{staticClass:"line-number"},[n._v("406")]),s("br"),s("span",{staticClass:"line-number"},[n._v("407")]),s("br"),s("span",{staticClass:"line-number"},[n._v("408")]),s("br"),s("span",{staticClass:"line-number"},[n._v("409")]),s("br"),s("span",{staticClass:"line-number"},[n._v("410")]),s("br"),s("span",{staticClass:"line-number"},[n._v("411")]),s("br"),s("span",{staticClass:"line-number"},[n._v("412")]),s("br"),s("span",{staticClass:"line-number"},[n._v("413")]),s("br")])]),s("h3",{attrs:{id:"containerbase中运用pipline"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#containerbase中运用pipline"}},[n._v("#")]),n._v(" ContainerBase中运用Pipline")]),n._v(" "),s("blockquote",[s("p",[n._v("那么容器中是如何运用Pipline的呢？")])]),n._v(" "),s("ul",[s("li",[n._v("容器中是如何运用Pipline的？")])]),n._v(" "),s("p",[n._v("由于Container中都有涉及，实现方法肯定是在抽象的实现类中，所以肯定是在ContainerBase中实现。")]),n._v(" "),s("ul",[s("li",[n._v("初始化")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * The Pipeline object with which this Container is associated.\n  */\nprotected final Pipeline pipeline = new StandardPipeline(this);\n/**\n  * Return the Pipeline object that manages the Valves associated with\n  * this Container.\n  */\n@Override\npublic Pipeline getPipeline() {\n    return this.pipeline;\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br")])]),s("ul",[s("li",[n._v("Lifecycle模板方法")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("@Override\nprotected synchronized void startInternal() throws LifecycleException {\n...\n    // Start the Valves in our pipeline (including the basic), if any\n    if (pipeline instanceof Lifecycle) {\n        ((Lifecycle) pipeline).start();\n    }\n...\n}\n\n@Override\nprotected synchronized void stopInternal() throws LifecycleException {\n  ...\n\n    // Stop the Valves in our pipeline (including the basic), if any\n    if (pipeline instanceof Lifecycle &&\n            ((Lifecycle) pipeline).getState().isAvailable()) {\n        ((Lifecycle) pipeline).stop();\n    }\n  ...\n}\n\n@Override\nprotected void destroyInternal() throws LifecycleException {\n...\n\n    // Stop the Valves in our pipeline (including the basic), if any\n    if (pipeline instanceof Lifecycle) {\n        ((Lifecycle) pipeline).destroy();\n    }\n...\n    super.destroyInternal();\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br")])]),s("ul",[s("li",[n._v("重点是"),s("strong",[n._v("backgroundProcess方法")])])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('@Override\npublic void backgroundProcess() {\n\n    if (!getState().isAvailable())\n        return;\n\n    Cluster cluster = getClusterInternal();\n    if (cluster != null) {\n        try {\n            cluster.backgroundProcess();\n        } catch (Exception e) {\n            log.warn(sm.getString("containerBase.backgroundProcess.cluster",\n                    cluster), e);\n        }\n    }\n    Realm realm = getRealmInternal();\n    if (realm != null) {\n        try {\n            realm.backgroundProcess();\n        } catch (Exception e) {\n            log.warn(sm.getString("containerBase.backgroundProcess.realm", realm), e);\n        }\n    }\n    // 看这里\n    Valve current = pipeline.getFirst();\n    while (current != null) {\n        try {\n            current.backgroundProcess();\n        } catch (Exception e) {\n            log.warn(sm.getString("containerBase.backgroundProcess.valve", current), e);\n        }\n        current = current.getNext();\n    }\n    fireLifecycleEvent(Lifecycle.PERIODIC_EVENT, null);\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br")])]),s("p",[n._v("看下相关链路")]),n._v(" "),s("p",[s("img",{attrs:{src:e(3403),alt:""}})]),n._v(" "),s("h1",{attrs:{id:"对比下两种责任链模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对比下两种责任链模式"}},[n._v("#")]),n._v(" 对比下两种责任链模式")]),n._v(" "),s("hr"),n._v(" "),s("table",[s("thead",[s("tr",[s("th",[n._v("管道/阀门")]),n._v(" "),s("th",[n._v("过滤器链/过滤器")])])]),n._v(" "),s("tbody",[s("tr",[s("td",[n._v("管道（Pipeline）")]),n._v(" "),s("td",[n._v("过滤器链（FilterChain）")])]),n._v(" "),s("tr",[s("td",[n._v("阀门（Valve）")]),n._v(" "),s("td",[n._v("过滤器（Filter）")])]),n._v(" "),s("tr",[s("td",[n._v("底层实现为具有头（first）、尾（basic）指针的单向链表")]),n._v(" "),s("td",[n._v("底层实现为数组")])]),n._v(" "),s("tr",[s("td",[n._v("Valve的核心方法invoke(request,response)")]),n._v(" "),s("td",[n._v("Filter核心方法doFilter(request,response,chain)")])]),n._v(" "),s("tr",[s("td",[n._v("pipeline.getFirst().invoke(request,response)")]),n._v(" "),s("td",[n._v("filterchain.doFilter(request,response)")])])])])])}),[],!1,null,null,null);s.default=t.exports}}]);