(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{1020:function(s,e,n){s.exports=n.p+"assets/img/springboot-interface-param-4.3ead23bf.png"},1021:function(s,e,n){s.exports=n.p+"assets/img/springboot-interface-param-3.db8cb917.png"},1022:function(s,e,n){s.exports=n.p+"assets/img/springboot-interface-param-5.53ff00b3.png"},1023:function(s,e,n){s.exports=n.p+"assets/img/springboot-interface-param-7.4d45fe11.png"},1024:function(s,e,n){s.exports=n.p+"assets/img/springboot-interface-param-6.ca192e4a.png"},1025:function(s,e,n){s.exports=n.p+"assets/img/springboot-interface-param-8.63b7c906.png"},1026:function(s,e,n){s.exports=n.p+"assets/img/springboot-interface-param-9.19792d24.png"},3662:function(s,e,n){"use strict";n.r(e);var a=n(7),r=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"springboot接口-如何参数校验国际化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#springboot接口-如何参数校验国际化"}},[s._v("#")]),s._v(" SpringBoot接口 - 如何参数校验国际化")]),s._v(" "),e("blockquote",[e("p",[s._v("上文我们学习了如何对SpringBoot接口进行参数校验，但是如果需要有国际化的信息（比如返回校验结果有中英文），应该如何优雅处理呢？@pdai")])]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#springboot%E6%8E%A5%E5%8F%A3---%E5%A6%82%E4%BD%95%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E5%9B%BD%E9%99%85%E5%8C%96"}},[s._v("SpringBoot接口 - 如何参数校验国际化")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E4%BB%80%E4%B9%88%E6%98%AF%E5%9B%BD%E9%99%85%E5%8C%96"}},[s._v("什么是国际化")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E5%AE%9E%E7%8E%B0%E6%A1%88%E4%BE%8B"}},[s._v("实现案例")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E5%AE%9A%E4%B9%89%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6"}},[s._v("定义资源文件")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E4%BD%BF%E7%94%A8message"}},[s._v("使用message")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E4%B8%AD%E8%8B%B1%E6%96%87%E5%88%87%E6%8D%A2%E6%8B%A6%E6%88%AA"}},[s._v("中英文切换拦截")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E6%A0%A1%E9%AA%8C"}},[s._v("校验")])])])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E7%A4%BA%E4%BE%8B%E6%BA%90%E7%A0%81"}},[s._v("示例源码")])])])])]),s._v(" "),e("h1",{attrs:{id:"什么是国际化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#什么是国际化"}},[s._v("#")]),s._v(" 什么是国际化")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("软件的国际化：软件开发时，要使它能同时应对世界不同地区和国家的访问，并针对不同地区和国家的访问，提供相应的、符合来访者阅读习惯的页面或数据。国际化又称为 i18n：internationalization")]),s._v(" "),e("h1",{attrs:{id:"实现案例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实现案例"}},[s._v("#")]),s._v(" 实现案例")]),s._v(" "),e("hr"),s._v(" "),e("blockquote",[e("p",[s._v("这里实现一个案例: 语言切换和国际化（中英文）验证信息。")])]),s._v(" "),e("h3",{attrs:{id:"定义资源文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#定义资源文件"}},[s._v("#")]),s._v(" 定义资源文件")]),s._v(" "),e("p",[s._v("在Resources下添加如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:n(1020),alt:""}})]),s._v(" "),e("p",[s._v("填写名称和资源语言类型")]),s._v(" "),e("p",[e("img",{attrs:{src:n(1021),alt:""}})]),s._v(" "),e("p",[s._v("添加中英文对应的message")]),s._v(" "),e("p",[e("img",{attrs:{src:n(1022),alt:""}})]),s._v(" "),e("h3",{attrs:{id:"使用message"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用message"}},[s._v("#")]),s._v(" 使用message")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('@Data\n@Builder\n@ApiModel(value = "User", subTypes = {AddressParam.class})\npublic class UserParam implements Serializable {\n\n    private static final long serialVersionUID = 1L;\n\n    @NotEmpty(message = "{user.msg.userId.notEmpty}") // 这里\n    private String userId;\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h3",{attrs:{id:"中英文切换拦截"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#中英文切换拦截"}},[s._v("#")]),s._v(" 中英文切换拦截")]),s._v(" "),e("p",[s._v("由于默认是拦截request参数获取locale参数来实现的切换语言，这里我们可以改下，优先从header中获取，如果没有获取到再从request参数中获取。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('package tech.pdai.springboot.validation.i18n.config;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.lang.NonNull;\nimport org.springframework.util.ObjectUtils;\nimport org.springframework.web.servlet.LocaleResolver;\nimport org.springframework.web.servlet.i18n.LocaleChangeInterceptor;\nimport org.springframework.web.servlet.support.RequestContextUtils;\n\n/**\n * custom locale change interceptor.\n *\n * @author pdai\n */\n@Slf4j\npublic class CustomLocaleChangeInterceptor extends LocaleChangeInterceptor {\n\n    /**\n     * try to get locale from header, if not exist then get it from request parameter.\n     *\n     * @param request  request\n     * @param response response\n     * @param handler  handler\n     * @return bool\n     * @throws ServletException ServletException\n     */\n    @Override\n    public boolean preHandle(HttpServletRequest request, @NonNull HttpServletResponse response, @NonNull Object handler) throws ServletException {\n        String newLocale = request.getHeader(getParamName());\n        if (newLocale!=null) {\n            if (checkHttpMethods(request.getMethod())) {\n                LocaleResolver localeResolver = RequestContextUtils.getLocaleResolver(request);\n                if (localeResolver==null) {\n                    throw new IllegalStateException("No LocaleResolver found: not in a DispatcherServlet request?");\n                }\n                try {\n                    localeResolver.setLocale(request, response, parseLocaleValue(newLocale));\n                } catch (IllegalArgumentException ex) {\n                    if (isIgnoreInvalidLocale()) {\n                        log.debug("Ignoring invalid locale value [" + newLocale + "]: " + ex.getMessage());\n                    } else {\n                        throw ex;\n                    }\n                }\n            }\n            return true;\n        } else {\n            return super.preHandle(request, response, handler);\n        }\n    }\n\n    private boolean checkHttpMethods(String currentMethod) {\n        String[] configuredMethods = getHttpMethods();\n        if (ObjectUtils.isEmpty(configuredMethods)) {\n            return true;\n        }\n        for (String configuredMethod : configuredMethods) {\n            if (configuredMethod.equalsIgnoreCase(currentMethod)) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br")])]),e("p",[s._v("初始化相关配置")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("package tech.pdai.springboot.validation.i18n.config;\n\nimport java.util.Locale;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.boot.validation.MessageInterpolatorFactory;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.support.ResourceBundleMessageSource;\nimport org.springframework.validation.beanvalidation.LocalValidatorFactoryBean;\nimport org.springframework.web.servlet.LocaleResolver;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\nimport org.springframework.web.servlet.i18n.LocaleChangeInterceptor;\nimport org.springframework.web.servlet.i18n.SessionLocaleResolver;\n\n/**\n * This class is for web config.\n *\n * @author pdai\n */\n@Configuration\n@RequiredArgsConstructor\npublic class WebConfig implements WebMvcConfigurer {\n\n    /**\n     * lang param name in header, default to 'locale'.\n     */\n    private static final String LANGUAGE_PARAM_NAME = LocaleChangeInterceptor.DEFAULT_PARAM_NAME;\n\n    /**\n     * message source.\n     */\n    private final ResourceBundleMessageSource resourceBundleMessageSource;\n\n    /**\n     * default locale.\n     *\n     * @return locale resolver\n     */\n    @Bean\n    public LocaleResolver localeResolver() {\n        SessionLocaleResolver localeResolver = new SessionLocaleResolver();\n        localeResolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);\n        return localeResolver;\n    }\n\n    /**\n     * local validator factory bean.\n     *\n     * @return LocalValidatorFactoryBean\n     */\n    @Bean\n    public LocalValidatorFactoryBean localValidatorFactoryBean() {\n        LocalValidatorFactoryBean factoryBean = new LocalValidatorFactoryBean();\n        MessageInterpolatorFactory interpolatorFactory = new MessageInterpolatorFactory();\n        factoryBean.setMessageInterpolator(interpolatorFactory.getObject());\n        factoryBean.setValidationMessageSource(resourceBundleMessageSource);\n        return factoryBean;\n    }\n\n    /**\n     * locale change interceptor.\n     *\n     * @return LocaleChangeInterceptor\n     */\n    @Bean\n    public LocaleChangeInterceptor localeChangeInterceptor() {\n        LocaleChangeInterceptor interceptor = new CustomLocaleChangeInterceptor();\n        interceptor.setParamName(LANGUAGE_PARAM_NAME);\n        return interceptor;\n    }\n\n    /**\n     * register locale change interceptor.\n     *\n     * @param registry registry\n     */\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        registry.addInterceptor(localeChangeInterceptor());\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br")])]),e("h3",{attrs:{id:"校验"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#校验"}},[s._v("#")]),s._v(" 校验")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("设置语言是中文")])])]),s._v(" "),e("p",[e("img",{attrs:{src:n(1023),alt:""}})]),s._v(" "),e("p",[s._v("查看校验结果")]),s._v(" "),e("p",[e("img",{attrs:{src:n(1024),alt:""}})]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("设置语言是英文")])])]),s._v(" "),e("p",[e("img",{attrs:{src:n(1025),alt:""}})]),s._v(" "),e("p",[s._v("查看校验结果")]),s._v(" "),e("p",[e("img",{attrs:{src:n(1026),alt:""}})]),s._v(" "),e("h1",{attrs:{id:"示例源码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#示例源码"}},[s._v("#")]),s._v(" 示例源码")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("https://github.com/realpdai/tech-pdai-spring-demos")])])}),[],!1,null,null,null);e.default=r.exports}}]);