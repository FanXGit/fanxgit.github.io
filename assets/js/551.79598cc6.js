(window.webpackJsonp=window.webpackJsonp||[]).push([[551],{3707:function(s,t,a){"use strict";a.r(t);var r=a(7),n=Object(r.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"springboot集成文件-大文件的上传-异步-分片-断点续传和秒传"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#springboot集成文件-大文件的上传-异步-分片-断点续传和秒传"}},[s._v("#")]),s._v(" SpringBoot集成文件 - 大文件的上传(异步，分片，断点续传和秒传)")]),s._v(" "),t("blockquote",[t("p",[s._v("上文中介绍的是常规文件的上传和下载，而超大文件的上传技术手段和普通文件上传是有差异的，主要通过基于分片的断点续传和秒传和异步上传等技术手段解决。本文主要介绍SpringBoot集成大文件上传的案例。@pdai")])]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#springboot%E9%9B%86%E6%88%90%E6%96%87%E4%BB%B6---%E5%A4%A7%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%8A%E4%BC%A0%E5%BC%82%E6%AD%A5%E5%88%86%E7%89%87%E6%96%AD%E7%82%B9%E7%BB%AD%E4%BC%A0%E5%92%8C%E7%A7%92%E4%BC%A0"}},[s._v("SpringBoot集成文件 - 大文件的上传(异步，分片，断点续传和秒传)")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#%E7%9F%A5%E8%AF%86%E5%87%86%E5%A4%87"}},[s._v("知识准备")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#%E5%9F%BA%E4%BA%8E%E5%88%86%E7%89%87%E7%9A%84%E6%96%AD%E7%82%B9%E7%BB%AD%E4%BC%A0%E5%92%8C%E7%A7%92%E4%BC%A0"}},[s._v("基于分片的断点续传和秒传")])]),s._v(" "),t("li",[t("a",{attrs:{href:"#%E5%BC%82%E6%AD%A5%E4%B8%8A%E4%BC%A0"}},[s._v("异步上传")])])])]),s._v(" "),t("li",[t("a",{attrs:{href:"#%E5%AE%9E%E7%8E%B0%E6%A1%88%E4%BE%8B"}},[s._v("实现案例")])]),s._v(" "),t("li",[t("a",{attrs:{href:"#%E7%A4%BA%E4%BE%8B%E6%BA%90%E7%A0%81"}},[s._v("示例源码")])]),s._v(" "),t("li",[t("a",{attrs:{href:"#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"}},[s._v("参考文章")])])])])]),s._v(" "),t("h1",{attrs:{id:"知识准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#知识准备"}},[s._v("#")]),s._v(" 知识准备")]),s._v(" "),t("hr"),s._v(" "),t("blockquote",[t("p",[s._v("大文件的上传技术手段和普通文件上传是有差异的，主要通过基于分片的断点续传和秒传和异步上传解决。@pdai")])]),s._v(" "),t("h3",{attrs:{id:"基于分片的断点续传和秒传"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于分片的断点续传和秒传"}},[s._v("#")]),s._v(" 基于分片的断点续传和秒传")]),s._v(" "),t("blockquote",[t("p",[s._v("当我们上传的文件很大时，对大文件的处理通常通过"),t("strong",[s._v("分片上传")]),s._v("、"),t("strong",[s._v("断点续传")]),s._v("和"),t("strong",[s._v("秒传")]),s._v("技术手段实现。")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("分片上传")])])]),s._v(" "),t("p",[s._v("分片上传就是将一个大文件分成若干份大小相等的小块文件，等所有小块文件上传成功后，再将文件进行合并成完整的原始文件。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("断点续传")])])]),s._v(" "),t("p",[s._v("断点续传就是重新上传文件时先判断哪些文件块已经上传过了（比如将分片的chuck md5等信息保存在DB中)，如果上传过了则跳过这些块，否则上传没有上传的块。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("秒传")])])]),s._v(" "),t("p",[s._v("当用户选择上传一个文件时，服务端检测该文件之前是否已经被上传过，如果服务器已经存有该文件（完全一样），就立马返回前端 “文件已上传成功”。前端随即将进度条更新至100%。 这样给用户的感觉就是 “秒传” 的感觉。")]),s._v(" "),t("p",[s._v("对于分片上传，"),t("strong",[s._v("前后端分别需要怎么做呢")]),s._v("？")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("前端")]),s._v("：需要将文件file.slice()成多个文件块，并计算每一块的md5值，每次请求上传都是传一个小文件块。")]),s._v(" "),t("li",[t("strong",[s._v("后端")]),s._v("：需要接收每次上传的文件块并保存文件块的信息（比如md5), 如果已经上传则跳过；最后等所有文件上传完成之后，将所有的文件块合并成一个大文件。")])]),s._v(" "),t("h3",{attrs:{id:"异步上传"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#异步上传"}},[s._v("#")]),s._v(" 异步上传")]),s._v(" "),t("blockquote",[t("p",[s._v("当我们上传的文件很大，后台需要处理的时间很长，用户期望切换到其它页面继续工作，而不需要等待完成。这时候我们可以采用异步上传的方式。")])]),s._v(" "),t("p",[s._v("在SpringBoot中将一个方法声明为异步方法非常简单，只需两个注解即可"),t("code",[s._v("@EnableAsync")]),s._v("和"),t("code",[s._v("@Async")]),s._v("。")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("@EnableAsync")]),s._v("用于开启SpringBoot支持异步的功能，用在SpringBoot的启动类上。")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("@SpringBootApplication\n@EnableAsync // 这里\npublic class App {\n \n    public static void main(String[] args) {\n        SpringApplication.run(App.class, args);\n    }\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[t("code",[s._v("@Async")]),s._v("用于方法上，标记该方法为异步处理方法。")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("@Service\npublic class UserServiceImpl {\n \n    @Async // 这里带@Async的方法，会被当成一个子线程\n    public void processFile(InputStream inputStream) {\n        \n    }\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h1",{attrs:{id:"实现案例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现案例"}},[s._v("#")]),s._v(" 实现案例")]),s._v(" "),t("hr"),s._v(" "),t("blockquote",[t("p",[s._v("TBD")])]),s._v(" "),t("h1",{attrs:{id:"示例源码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#示例源码"}},[s._v("#")]),s._v(" 示例源码")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("https://github.com/realpdai/tech-pdai-spring-demos")]),s._v(" "),t("h1",{attrs:{id:"参考文章"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("https://www.jb51.net/article/212399.htm")])])}),[],!1,null,null,null);t.default=n.exports}}]);