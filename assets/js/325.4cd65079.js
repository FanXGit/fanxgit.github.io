(window.webpackJsonp=window.webpackJsonp||[]).push([[325],{3395:function(n,s,e){n.exports=e.p+"assets/img/tomcat-x-container-2.d4c4c9af.png"},3396:function(n,s,e){n.exports=e.p+"assets/img/tomcat-x-container-1.62d69b2c.jpg"},3397:function(n,s,e){n.exports=e.p+"assets/img/tomcat-x-container-3.9cdc78f8.png"},4208:function(n,s,e){"use strict";e.r(s);var a=e(7),t=Object(a.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h1",{attrs:{id:"tomcat-request请求处理-container设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tomcat-request请求处理-container设计"}},[n._v("#")]),n._v(" Tomcat - Request请求处理: Container设计")]),n._v(" "),s("p",[n._v("======================================================================")]),n._v(" "),s("blockquote",[s("p",[n._v("在理解了Server，Service和Executor后，我们可以进入Request处理环节了。我们知道客户端是可以发起多个请求的，Tomcat也是可以支持多个webapp的，有多个上下文，且一个webapp中可以有多个Servlet...等等，那么Tomcat是如何设计组件来支撑请求处理的呢？本节文将介绍Tomcat的Container设计。@pdai")])]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#tomcat---request%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86-container%E8%AE%BE%E8%AE%A1"}},[n._v("Tomcat - Request请求处理: Container设计")]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E5%86%85%E5%AE%B9%E5%BC%95%E5%85%A5"}},[n._v("内容引入")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#%E7%90%86%E8%A7%A3%E6%80%9D%E8%B7%AF"}},[n._v("理解思路")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#container%E7%9A%84%E8%AE%BE%E8%AE%A1"}},[n._v("Container的设计")]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#container%E7%9A%84%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84%E6%96%B9%E6%B3%95"}},[n._v("Container的层次结构方法")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#container%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95"}},[n._v("Container事件监听相关方法")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#container%E5%8A%9F%E8%83%BD%E6%94%AF%E6%92%91%E6%96%B9%E6%B3%95"}},[n._v("Container功能支撑方法")])])])]),n._v(" "),s("li",[s("a",{attrs:{href:"#container%E5%9F%BA%E6%9C%AC%E5%AE%9E%E7%8E%B0containerbase"}},[n._v("Container基本实现：ContainerBase")]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#logger"}},[n._v("Logger")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#cluster"}},[n._v("Cluster")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#realm"}},[n._v("Realm")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#name%E7%AD%89%E5%B1%9E%E6%80%A7"}},[n._v("name等属性")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#child%E7%9B%B8%E5%85%B3"}},[n._v("child相关")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#lifecycle%E7%9A%84%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95"}},[n._v("Lifecycle的模板方法")])])])])])])]),n._v(" "),s("h1",{attrs:{id:"内容引入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内容引入"}},[n._v("#")]),n._v(" 内容引入")]),n._v(" "),s("hr"),n._v(" "),s("blockquote",[s("p",[n._v("这里一定把握住我们上下文之间的衔接，这是我们整个系列理解Tomcat的主线。@pdai")])]),n._v(" "),s("ul",[s("li",[n._v("到目前我们研究到了哪里？")])]),n._v(" "),s("p",[s("img",{attrs:{src:e(3395),alt:""}})]),n._v(" "),s("h1",{attrs:{id:"理解思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#理解思路"}},[n._v("#")]),n._v(" 理解思路")]),n._v(" "),s("hr"),n._v(" "),s("ul",[s("li",[s("strong",[n._v("为什么我们说上面的是Container呢？我们看下几个Container之间的关系")]),n._v("：")])]),n._v(" "),s("p",[s("img",{attrs:{src:e(3396),alt:""}})]),n._v(" "),s("p",[n._v("从上图上，我们也可以看出Container顶层也是基于Lifecycle的组件设计的。")]),n._v(" "),s("ul",[s("li",[s("strong",[n._v("在设计Container组件层次组件时，上述4个组件分别做什么的呢？为什么要四种组件呢？")])])]),n._v(" "),s("p",[n._v("如下是Container接口类的相关注释")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v(" * <li><b>Engine</b> - Representation of the entire Catalina servlet engine,\n *     most likely containing one or more subcontainers that are either Host\n *     or Context implementations, or other custom groups.\n * <li><b>Host</b> - Representation of a virtual host containing a number\n *     of Contexts.\n * <li><b>Context</b> - Representation of a single ServletContext, which will\n *     typically contain one or more Wrappers for the supported servlets.\n * <li><b>Wrapper</b> - Representation of an individual servlet definition\n *     (which may support multiple servlet instances if the servlet itself\n *     implements SingleThreadModel).\n * </ul>\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br")])]),s("p",[s("strong",[n._v("Engine")]),n._v(" - 表示整个catalina的servlet引擎，多数情况下包含"),s("strong",[n._v("一个或多个")]),n._v("子容器，这些子容器要么是Host，要么是Context实现，或者是其他自定义组。")]),n._v(" "),s("p",[s("strong",[n._v("Host")]),n._v(" - 表示包含多个Context的虚拟主机的。")]),n._v(" "),s("p",[s("strong",[n._v("Context")]),n._v(" — 表示一个ServletContext，表示一个webapp，它通常包含一个或多个wrapper。")]),n._v(" "),s("p",[s("strong",[n._v("Wrapper")]),n._v(" - 表示一个servlet定义的（如果servlet本身实现了SingleThreadModel，则可能支持多个servlet实例）。")]),n._v(" "),s("ul",[s("li",[s("strong",[n._v("结合整体的框架图中上述组件部分，我们看下包含了什么")]),n._v("？")])]),n._v(" "),s("p",[s("img",{attrs:{src:e(3397),alt:""}})]),n._v(" "),s("p",[n._v("很明显，除了四个组件的嵌套关系，Container中还包含了Realm，Cluster，Listeners, Pipleline等支持组件。")]),n._v(" "),s("p",[n._v("这一点，还可以通过相关注释可以看出：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("**Loader** - Class loader to use for integrating new Java classes for this Container into the JVM in which Catalina is running.\n\n**Logger** - Implementation of the log() method signatures of the ServletContext interface.\n\n**Manager** - Manager for the pool of Sessions associated with this Container.\n\n**Realm** - Read-only interface to a security domain, for authenticating user identities and their corresponding roles.\n\n**Resources** - JNDI directory context enabling access to static resources, enabling custom linkages to existing server components when Catalina is embedded in a larger server.\n\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br")])]),s("h1",{attrs:{id:"container的设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#container的设计"}},[n._v("#")]),n._v(" Container的设计")]),n._v(" "),s("hr"),n._v(" "),s("blockquote",[s("p",[n._v("这container应该包含哪些接口呢？如果你看源代码它包含二十多个接口，这里理解的时候一定要分组去理解。")])]),n._v(" "),s("h3",{attrs:{id:"container的层次结构方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#container的层次结构方法"}},[n._v("#")]),n._v(" Container的层次结构方法")]),n._v(" "),s("p",[n._v("查找父容器的方法：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Get the parent container.\n  *\n  * @return Return the Container for which this Container is a child, if\n  *         there is one. If there is no defined parent, return\n  *         <code>null</code>.\n  */\npublic Container getParent();\n\n\n/**\n  * Set the parent Container to which this Container is being added as a\n  * child.  This Container may refuse to become attached to the specified\n  * Container by throwing an exception.\n  *\n  * @param container Container to which this Container is being added\n  *  as a child\n  *\n  * @exception IllegalArgumentException if this Container refuses to become\n  *  attached to the specified Container\n  */\npublic void setParent(Container container);\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br")])]),s("p",[n._v("由于Engine显然上层是Service，所以里面加了一个getService的方法")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Return the Service to which this container belongs.\n  * @param container The container to start from\n  * @return the Service, or null if not found\n  */\npublic static Service getService(Container container) {\n    while (container != null && !(container instanceof Engine)) {\n        container = container.getParent();\n    }\n    if (container == null) {\n        return null;\n    }\n    return ((Engine) container).getService();\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br")])]),s("p",[n._v("类比树接口，有Parent方法，那肯定也child方法：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Add a new child Container to those associated with this Container,\n  * if supported.  Prior to adding this Container to the set of children,\n  * the child's <code>setParent()</code> method must be called, with this\n  * Container as an argument.  This method may thrown an\n  * <code>IllegalArgumentException</code> if this Container chooses not\n  * to be attached to the specified Container, in which case it is not added\n  *\n  * @param child New child Container to be added\n  *\n  * @exception IllegalArgumentException if this exception is thrown by\n  *  the <code>setParent()</code> method of the child Container\n  * @exception IllegalArgumentException if the new child does not have\n  *  a name unique from that of existing children of this Container\n  * @exception IllegalStateException if this Container does not support\n  *  child Containers\n  */\npublic void addChild(Container child);\n\n/**\n  * Obtain the child Containers associated with this Container.\n  *\n  * @return An array containing all children of this container. If this\n  *         Container has no children, a zero-length array is returned.\n  */\npublic Container[] findChildren();\n\n/**\n  * Remove an existing child Container from association with this parent\n  * Container.\n  *\n  * @param child Existing child Container to be removed\n  */\npublic void removeChild(Container child);\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br")])]),s("h3",{attrs:{id:"container事件监听相关方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#container事件监听相关方法"}},[n._v("#")]),n._v(" Container事件监听相关方法")]),n._v(" "),s("p",[n._v("前文我们也分析过Tomcat的事件监听机制，Container也是一样， 比如如下的ContainerListener")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Add a container event listener to this component.\n  *\n  * @param listener The listener to add\n  */\npublic void addContainerListener(ContainerListener listener);\n\n/**\n  * Obtain the container listeners associated with this Container.\n  *\n  * @return An array containing the container listeners associated with this\n  *         Container. If this Container has no registered container\n  *         listeners, a zero-length array is returned.\n  */\npublic ContainerListener[] findContainerListeners();\n\n/**\n  * Remove a container event listener from this component.\n  *\n  * @param listener The listener to remove\n  */\npublic void removeContainerListener(ContainerListener listener);\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br")])]),s("p",[n._v("除了Container级别的，和前文我们理解的一样，还有属性相关的Listener, 显然就增删属性的监听方法")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Remove a property change listener from this component.\n  *\n  * @param listener The listener to remove\n  */\npublic void removePropertyChangeListener(PropertyChangeListener listener);\n\n/**\n  * Add a property change listener to this component.\n  *\n  * @param listener The listener to add\n  */\npublic void addPropertyChangeListener(PropertyChangeListener listener);\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br")])]),s("p",[n._v("最后显然还有事件的触发方法")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Notify all container event listeners that a particular event has\n  * occurred for this Container.  The default implementation performs\n  * this notification synchronously using the calling thread.\n  *\n  * @param type Event type\n  * @param data Event data\n  */\npublic void fireContainerEvent(String type, Object data);\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br")])]),s("h3",{attrs:{id:"container功能支撑方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#container功能支撑方法"}},[n._v("#")]),n._v(" Container功能支撑方法")]),n._v(" "),s("p",[n._v("前面我们知道，Loader, Logger, Manager, Realm, Resources等支撑功能。这里简单看下接口定义，相关基本实现看下节ContainerBase的实现。")]),n._v(" "),s("ul",[s("li",[n._v("Loader")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Get the parent class loader.\n  *\n  * @return the parent class loader for this component. If not set, return\n  *         {@link #getParent()}.{@link #getParentClassLoader()}. If no\n  *         parent has been set, return the system class loader.\n  */\npublic ClassLoader getParentClassLoader();\n\n\n/**\n  * Set the parent class loader for this component. For {@link Context}s\n  * this call is meaningful only <strong>before</strong> a Loader has\n  * been configured, and the specified value (if non-null) should be\n  * passed as an argument to the class loader constructor.\n  *\n  * @param parent The new parent class loader\n  */\npublic void setParentClassLoader(ClassLoader parent);\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br")])]),s("ul",[s("li",[n._v("Logger")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Obtain the log to which events for this container should be logged.\n  *\n  * @return The Logger with which this Container is associated.  If there is\n  *         no associated Logger, return the Logger associated with the\n  *         parent Container (if any); otherwise return <code>null</code>.\n  */\npublic Log getLogger();\n\n\n/**\n  * Return the logger name that the container will use.\n  * @return the abbreviated name of this container for logging messages\n  */\npublic String getLogName();\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br")])]),s("ul",[s("li",[n._v("Manager")])]),n._v(" "),s("p",[n._v("体现在我们之前分析的JMX管理")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Obtain the JMX name for this container.\n  *\n  * @return the JMX name associated with this container.\n  */\npublic ObjectName getObjectName();\n\n\n/**\n  * Obtain the JMX domain under which this container will be / has been\n  * registered.\n  *\n  * @return The JMX domain name\n  */\npublic String getDomain();\n\n\n/**\n  * Calculate the key properties string to be added to an object's\n  * {@link ObjectName} to indicate that it is associated with this container.\n  *\n  * @return          A string suitable for appending to the ObjectName\n  *\n  */\npublic String getMBeanKeyProperties();\n\n/**\n  * Obtain the number of threads available for starting and stopping any\n  * children associated with this container. This allows start/stop calls to\n  * children to be processed in parallel.\n  *\n  * @return The currently configured number of threads used to start/stop\n  *         children associated with this container\n  */\npublic int getStartStopThreads();\n\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br")])]),s("ul",[s("li",[n._v("Realm")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Obtain the Realm with which this Container is associated.\n  *\n  * @return The associated Realm; if there is no associated Realm, the\n  *         Realm associated with the parent Container (if any); otherwise\n  *         return <code>null</code>.\n  */\npublic Realm getRealm();\n\n\n/**\n  * Set the Realm with which this Container is associated.\n  *\n  * @param realm The newly associated Realm\n  */\npublic void setRealm(Realm realm);\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br")])]),s("ul",[s("li",[n._v("Cluster")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Get the Cluster for this container.\n  *\n  * @return The Cluster with which this Container is associated. If there is\n  *         no associated Cluster, return the Cluster associated with our\n  *         parent Container (if any); otherwise return <code>null</code>.\n  */\npublic Cluster getCluster();\n\n\n/**\n  * Set the Cluster with which this Container is associated.\n  *\n  * @param cluster the Cluster with which this Container is associated.\n  */\npublic void setCluster(Cluster cluster);\n\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br")])]),s("ul",[s("li",[n._v("其它")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Return a name string (suitable for use by humans) that describes this\n  * Container.  Within the set of child containers belonging to a particular\n  * parent, Container names must be unique.\n  *\n  * @return The human readable name of this container.\n  */\npublic String getName();\n\n\n/**\n  * Set a name string (suitable for use by humans) that describes this\n  * Container.  Within the set of child containers belonging to a particular\n  * parent, Container names must be unique.\n  *\n  * @param name New name of this container\n  *\n  * @exception IllegalStateException if this Container has already been\n  *  added to the children of a parent Container (after which the name\n  *  may not be changed)\n  */\npublic void setName(String name);\n\n/**\n  * Sets the number of threads available for starting and stopping any\n  * children associated with this container. This allows start/stop calls to\n  * children to be processed in parallel.\n  * @param   startStopThreads    The new number of threads to be used\n  */\npublic void setStartStopThreads(int startStopThreads);\n\n\n/**\n  * Obtain the location of CATALINA_BASE.\n  *\n  * @return  The location of CATALINA_BASE.\n  */\npublic File getCatalinaBase();\n\n\n/**\n  * Obtain the location of CATALINA_HOME.\n  *\n  * @return The location of CATALINA_HOME.\n  */\npublic File getCatalinaHome();\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br")])]),s("h1",{attrs:{id:"container基本实现-containerbase"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#container基本实现-containerbase"}},[n._v("#")]),n._v(" Container基本实现：ContainerBase")]),n._v(" "),s("hr"),n._v(" "),s("blockquote",[s("p",[n._v("就讲讲几个比较核心的")])]),n._v(" "),s("h3",{attrs:{id:"logger"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#logger"}},[n._v("#")]),n._v(" Logger")]),n._v(" "),s("p",[n._v("日志记录器，比较简单，直接看代码")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('/**\n  * Return the Logger for this Container.\n  */\n@Override\npublic Log getLogger() {\n    if (logger != null)\n        return logger;\n    logger = LogFactory.getLog(getLogName());\n    return logger;\n}\n\n\n/**\n  * @return the abbreviated name of this container for logging messages\n  */\n@Override\npublic String getLogName() {\n\n    if (logName != null) {\n        return logName;\n    }\n    String loggerName = null;\n    Container current = this;\n    while (current != null) {\n        String name = current.getName();\n        if ((name == null) || (name.equals(""))) {\n            name = "/";\n        } else if (name.startsWith("##")) {\n            name = "/" + name;\n        }\n        loggerName = "[" + name + "]"\n            + ((loggerName != null) ? ("." + loggerName) : "");\n        current = current.getParent();\n    }\n    logName = ContainerBase.class.getName() + "." + loggerName;\n    return logName;\n\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br")])]),s("h3",{attrs:{id:"cluster"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cluster"}},[n._v("#")]),n._v(" Cluster")]),n._v(" "),s("ul",[s("li",[s("code",[n._v("getCluster")]),n._v("：读锁，获取子类的cluster，如果没有则返回父类的cluster；")]),n._v(" "),s("li",[s("code",[n._v("getClusterInternal")]),n._v(": 读锁，获取子类的cluster")]),n._v(" "),s("li",[s("code",[n._v("setCluster")]),n._v(": 写锁，设置container的cluster；由于cluster具备生命周期，所以需要对停止旧的cluster，启动新的cluster；设置成功后，再触发cluster变更事件。")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('\n/**\n  * The cluster with which this Container is associated.\n  */\nprotected Cluster cluster = null;\nprivate final ReadWriteLock clusterLock = new ReentrantReadWriteLock();\n\n/**\n  * The parent Container to which this Container is a child.\n  */\nprotected Container parent = null;\n\n/**\n  * Return the Cluster with which this Container is associated.  If there is\n  * no associated Cluster, return the Cluster associated with our parent\n  * Container (if any); otherwise return <code>null</code>.\n  */\n@Override\npublic Cluster getCluster() {\n    Lock readLock = clusterLock.readLock();\n    readLock.lock();\n    try {\n        if (cluster != null)\n            return cluster;\n\n        if (parent != null)\n            return parent.getCluster();\n\n        return null;\n    } finally {\n        readLock.unlock();\n    }\n}\n\n\n/*\n  * Provide access to just the cluster component attached to this container.\n  */\nprotected Cluster getClusterInternal() {\n    Lock readLock = clusterLock.readLock();\n    readLock.lock();\n    try {\n        return cluster;\n    } finally {\n        readLock.unlock();\n    }\n}\n\n\n/**\n  * Set the Cluster with which this Container is associated.\n  *\n  * @param cluster The newly associated Cluster\n  */\n@Override\npublic void setCluster(Cluster cluster) {\n\n    Cluster oldCluster = null;\n    Lock writeLock = clusterLock.writeLock();\n    writeLock.lock();\n    try {\n        // Change components if necessary\n        oldCluster = this.cluster;\n        if (oldCluster == cluster)\n            return;\n        this.cluster = cluster;\n\n        // Stop the old component if necessary\n        if (getState().isAvailable() && (oldCluster != null) &&\n            (oldCluster instanceof Lifecycle)) {\n            try {\n                ((Lifecycle) oldCluster).stop();\n            } catch (LifecycleException e) {\n                log.error(sm.getString("containerBase.cluster.stop"), e);\n            }\n        }\n\n        // Start the new component if necessary\n        if (cluster != null)\n            cluster.setContainer(this);\n\n        if (getState().isAvailable() && (cluster != null) &&\n            (cluster instanceof Lifecycle)) {\n            try {\n                ((Lifecycle) cluster).start();\n            } catch (LifecycleException e) {\n                log.error(sm.getString("containerBase.cluster.start"), e);\n            }\n        }\n    } finally {\n        writeLock.unlock();\n    }\n\n    // Report this property change to interested listeners\n    support.firePropertyChange("cluster", oldCluster, cluster);\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br"),s("span",{staticClass:"line-number"},[n._v("87")]),s("br"),s("span",{staticClass:"line-number"},[n._v("88")]),s("br"),s("span",{staticClass:"line-number"},[n._v("89")]),s("br"),s("span",{staticClass:"line-number"},[n._v("90")]),s("br"),s("span",{staticClass:"line-number"},[n._v("91")]),s("br"),s("span",{staticClass:"line-number"},[n._v("92")]),s("br"),s("span",{staticClass:"line-number"},[n._v("93")]),s("br"),s("span",{staticClass:"line-number"},[n._v("94")]),s("br"),s("span",{staticClass:"line-number"},[n._v("95")]),s("br"),s("span",{staticClass:"line-number"},[n._v("96")]),s("br")])]),s("h3",{attrs:{id:"realm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#realm"}},[n._v("#")]),n._v(" Realm")]),n._v(" "),s("p",[n._v("Realm和上面的Cluster方法基本一致。")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('/**\n * Return the Realm with which this Container is associated.  If there is\n * no associated Realm, return the Realm associated with our parent\n * Container (if any); otherwise return <code>null</code>.\n */\n@Override\npublic Realm getRealm() {\n\n    Lock l = realmLock.readLock();\n    l.lock();\n    try {\n        if (realm != null)\n            return realm;\n        if (parent != null)\n            return parent.getRealm();\n        return null;\n    } finally {\n        l.unlock();\n    }\n}\n\n\nprotected Realm getRealmInternal() {\n    Lock l = realmLock.readLock();\n    l.lock();\n    try {\n        return realm;\n    } finally {\n        l.unlock();\n    }\n}\n\n/**\n * Set the Realm with which this Container is associated.\n *\n * @param realm The newly associated Realm\n */\n@Override\npublic void setRealm(Realm realm) {\n\n    Lock l = realmLock.writeLock();\n    l.lock();\n    try {\n        // Change components if necessary\n        Realm oldRealm = this.realm;\n        if (oldRealm == realm)\n            return;\n        this.realm = realm;\n\n        // Stop the old component if necessary\n        if (getState().isAvailable() && (oldRealm != null) &&\n            (oldRealm instanceof Lifecycle)) {\n            try {\n                ((Lifecycle) oldRealm).stop();\n            } catch (LifecycleException e) {\n                log.error(sm.getString("containerBase.realm.stop"), e);\n            }\n        }\n\n        // Start the new component if necessary\n        if (realm != null)\n            realm.setContainer(this);\n        if (getState().isAvailable() && (realm != null) &&\n            (realm instanceof Lifecycle)) {\n            try {\n                ((Lifecycle) realm).start();\n            } catch (LifecycleException e) {\n                log.error(sm.getString("containerBase.realm.start"), e);\n            }\n        }\n\n        // Report this property change to interested listeners\n        support.firePropertyChange("realm", oldRealm, this.realm);\n    } finally {\n        l.unlock();\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br")])]),s("h3",{attrs:{id:"name等属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#name等属性"}},[n._v("#")]),n._v(" name等属性")]),n._v(" "),s("p",[n._v("此类属性改变时触发属性变更事件，比如name是容器的名字，name变更会触发name变更事件。")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('\n/**\n  * The human-readable name of this Container.\n  */\nprotected String name = null;\n\n\n/**\n  * Return a name string (suitable for use by humans) that describes this\n  * Container.  Within the set of child containers belonging to a particular\n  * parent, Container names must be unique.\n  */\n@Override\npublic String getName() {\n    return name;\n}\n\n\n/**\n  * Set a name string (suitable for use by humans) that describes this\n  * Container.  Within the set of child containers belonging to a particular\n  * parent, Container names must be unique.\n  *\n  * @param name New name of this container\n  *\n  * @exception IllegalStateException if this Container has already been\n  *  added to the children of a parent Container (after which the name\n  *  may not be changed)\n  */\n@Override\npublic void setName(String name) {\n    if (name == null) {\n        throw new IllegalArgumentException(sm.getString("containerBase.nullName"));\n    }\n    String oldName = this.name;\n    this.name = name;\n    support.firePropertyChange("name", oldName, this.name);\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br")])]),s("h3",{attrs:{id:"child相关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#child相关"}},[n._v("#")]),n._v(" child相关")]),n._v(" "),s("p",[n._v("添加子容器")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('/**\n  * Add a new child Container to those associated with this Container,\n  * if supported.  Prior to adding this Container to the set of children,\n  * the child\'s <code>setParent()</code> method must be called, with this\n  * Container as an argument.  This method may thrown an\n  * <code>IllegalArgumentException</code> if this Container chooses not\n  * to be attached to the specified Container, in which case it is not added\n  *\n  * @param child New child Container to be added\n  *\n  * @exception IllegalArgumentException if this exception is thrown by\n  *  the <code>setParent()</code> method of the child Container\n  * @exception IllegalArgumentException if the new child does not have\n  *  a name unique from that of existing children of this Container\n  * @exception IllegalStateException if this Container does not support\n  *  child Containers\n  */\n@Override\npublic void addChild(Container child) {\n    if (Globals.IS_SECURITY_ENABLED) {\n        PrivilegedAction<Void> dp =\n            new PrivilegedAddChild(child);\n        AccessController.doPrivileged(dp);\n    } else {\n        addChildInternal(child);\n    }\n}\n\nprivate void addChildInternal(Container child) {\n\n    if (log.isDebugEnabled()) {\n        log.debug("Add child " + child + " " + this);\n    }\n\n    synchronized(children) {\n        if (children.get(child.getName()) != null)\n            throw new IllegalArgumentException(\n                    sm.getString("containerBase.child.notUnique", child.getName()));\n        child.setParent(this);  // May throw IAE 设置父容器\n        children.put(child.getName(), child); // 使用map,方便通过name查找子容器\n    }\n\n    fireContainerEvent(ADD_CHILD_EVENT, child); // 触发添加子容器的事件\n\n    // Start child // 注意下这里，没有将start方法放到synchronized的原因\n    // Don\'t do this inside sync block - start can be a slow process and\n    // locking the children object can cause problems elsewhere\n    try {\n        if ((getState().isAvailable() ||\n                LifecycleState.STARTING_PREP.equals(getState())) &&\n                startChildren) {\n            child.start();\n        }\n    } catch (LifecycleException e) {\n        throw new IllegalStateException(sm.getString("containerBase.child.start"), e);\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br")])]),s("p",[n._v("查找子容器")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * Return the child Container, associated with this Container, with\n  * the specified name (if any); otherwise, return <code>null</code>\n  *\n  * @param name Name of the child Container to be retrieved\n  */\n@Override\npublic Container findChild(String name) {\n    if (name == null) {\n        return null;\n    }\n    synchronized (children) {\n        return children.get(name);\n    }\n}\n/**\n  * Return the set of children Containers associated with this Container.\n  * If this Container has no children, a zero-length array is returned.\n  */\n@Override\npublic Container[] findChildren() {\n    synchronized (children) {\n        Container results[] = new Container[children.size()];\n        return children.values().toArray(results);\n    }\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br")])]),s("ul",[s("li",[n._v("删除子容器")])]),n._v(" "),s("p",[n._v("子容器有生命周期，所以应该是先停止，然后销毁（distroy), 再触发删除事件，最后将children中子容器删除。")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('/**\n  * Remove an existing child Container from association with this parent\n  * Container.\n  *\n  * @param child Existing child Container to be removed\n  */\n@Override\npublic void removeChild(Container child) {\n\n    if (child == null) {\n        return;\n    }\n\n    try {\n        if (child.getState().isAvailable()) {\n            child.stop();\n        }\n    } catch (LifecycleException e) {\n        log.error(sm.getString("containerBase.child.stop"), e);\n    }\n\n    boolean destroy = false;\n    try {\n        // child.destroy() may have already been called which would have\n        // triggered this call. If that is the case, no need to destroy the\n        // child again.\n        if (!LifecycleState.DESTROYING.equals(child.getState())) {\n            child.destroy();\n            destroy = true;\n        }\n    } catch (LifecycleException e) {\n        log.error(sm.getString("containerBase.child.destroy"), e);\n    }\n\n    if (!destroy) {\n        fireContainerEvent(REMOVE_CHILD_EVENT, child);\n    }\n\n    synchronized(children) {\n        if (children.get(child.getName()) == null)\n            return;\n        children.remove(child.getName());\n    }\n\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br")])]),s("h3",{attrs:{id:"lifecycle的模板方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lifecycle的模板方法"}},[n._v("#")]),n._v(" Lifecycle的模板方法")]),n._v(" "),s("ul",[s("li",[s("strong",[n._v("initInternal")])])]),n._v(" "),s("p",[n._v("startStopThreads 默认为 1 ，所以 reconfigureStartStopExecutor 方法会走 if 语句，而 startStopExecutor 最开始是没有赋值的，startStopExecutor instanceof InlineExecutorService 会返回 false，因此最终会执行 startStopExecutor = new InlineExecutorService()，InlineExecutorService 只是简单地实现了 java.util.concurrent.AbstractExecutorService 类。 最终 reconfigureStartStopExecutor 给 startStopExecutor 这个成员变量设置了，startStopExecutor。")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("/**\n  * The number of threads available to process start and stop events for any\n  * children associated with this container.\n  */\nprivate int startStopThreads = 1;\nprotected ExecutorService startStopExecutor;\n\n\n@Override\nprotected void initInternal() throws LifecycleException {\n    reconfigureStartStopExecutor(getStartStopThreads()); // 设置一个线程池来处理子容器启动和关闭事件\n    super.initInternal(); // 调用LifecycleMBeanBase的方法\n}\n\n\nprivate void reconfigureStartStopExecutor(int threads) {\n    if (threads == 1) {\n        // Use a fake executor\n        if (!(startStopExecutor instanceof InlineExecutorService)) {\n            startStopExecutor = new InlineExecutorService(); // 执行这里\n        }\n    } else {\n        // Delegate utility execution to the Service\n        Server server = Container.getService(this).getServer();\n        server.setUtilityThreads(threads);\n        startStopExecutor = server.getUtilityExecutor();\n    }\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br")])]),s("ul",[s("li",[s("strong",[n._v("startInternal")])])]),n._v(" "),s("p",[n._v("试想，container中有很多组件，而且属于Lifecycle生命周期管理；那么启动容器的时候，必然是逐个将这些子组件（包括子容器）启动起来。")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('/**\n  * Start this component and implement the requirements\n  * of {@link org.apache.catalina.util.LifecycleBase#startInternal()}.\n  *\n  * @exception LifecycleException if this component detects a fatal error\n  *  that prevents this component from being used\n  */\n@Override\nprotected synchronized void startInternal() throws LifecycleException {\n\n    // Start our subordinate components, if any\n    logger = null;\n    getLogger();\n    Cluster cluster = getClusterInternal();\n    if (cluster instanceof Lifecycle) {\n        ((Lifecycle) cluster).start();\n    }\n    Realm realm = getRealmInternal();\n    if (realm instanceof Lifecycle) {\n        ((Lifecycle) realm).start();\n    }\n\n    // Start our child containers, if any\n    Container children[] = findChildren();\n    List<Future<Void>> results = new ArrayList<>();\n    for (Container child : children) {\n        results.add(startStopExecutor.submit(new StartChild(child)));\n    }\n\n    MultiThrowable multiThrowable = null; // 引入一个MultiThrowable，来收集多个异常\n\n    for (Future<Void> result : results) {\n        try {\n            result.get();\n        } catch (Throwable e) {\n            log.error(sm.getString("containerBase.threadedStartFailed"), e);\n            if (multiThrowable == null) {\n                multiThrowable = new MultiThrowable();\n            }\n            multiThrowable.add(e);\n        }\n\n    }\n    if (multiThrowable != null) {\n        throw new LifecycleException(sm.getString("containerBase.threadedStartFailed"),\n                multiThrowable.getThrowable());\n    }\n\n    // Start the Valves in our pipeline (including the basic), if any\n    if (pipeline instanceof Lifecycle) {\n        ((Lifecycle) pipeline).start();\n    }\n\n    setState(LifecycleState.STARTING);\n\n    // 看这个，本质是调用最上层server的utilityExecutorWrapper 线程池去执行 ContainerBackgroundProcessorMonitor 任务\n    if (backgroundProcessorDelay > 0) {\n        monitorFuture = Container.getService(ContainerBase.this).getServer()\n                .getUtilityExecutor().scheduleWithFixedDelay(\n                        new ContainerBackgroundProcessorMonitor(), 0, 60, TimeUnit.SECONDS);\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br")])]),s("ul",[s("li",[s("strong",[n._v("stopInternal")])])]),n._v(" "),s("p",[n._v("和initInternal初始化子组件方式倒过来，逐一停止子组件，并触发相关事件。")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('/**\n  * Stop this component and implement the requirements\n  * of {@link org.apache.catalina.util.LifecycleBase#stopInternal()}.\n  *\n  * @exception LifecycleException if this component detects a fatal error\n  *  that prevents this component from being used\n  */\n@Override\nprotected synchronized void stopInternal() throws LifecycleException {\n\n    // Stop our thread\n    if (monitorFuture != null) {\n        monitorFuture.cancel(true);\n        monitorFuture = null;\n    }\n    threadStop();\n\n    setState(LifecycleState.STOPPING);\n\n    // Stop the Valves in our pipeline (including the basic), if any\n    if (pipeline instanceof Lifecycle &&\n            ((Lifecycle) pipeline).getState().isAvailable()) {\n        ((Lifecycle) pipeline).stop();\n    }\n\n    // Stop our child containers, if any\n    Container children[] = findChildren();\n    List<Future<Void>> results = new ArrayList<>();\n    for (Container child : children) {\n        results.add(startStopExecutor.submit(new StopChild(child)));\n    }\n\n    boolean fail = false;\n    for (Future<Void> result : results) {\n        try {\n            result.get();\n        } catch (Exception e) {\n            log.error(sm.getString("containerBase.threadedStopFailed"), e);\n            fail = true;\n        }\n    }\n    if (fail) {\n        throw new LifecycleException(\n                sm.getString("containerBase.threadedStopFailed"));\n    }\n\n    // Stop our subordinate components, if any\n    Realm realm = getRealmInternal();\n    if (realm instanceof Lifecycle) {\n        ((Lifecycle) realm).stop();\n    }\n    Cluster cluster = getClusterInternal();\n    if (cluster instanceof Lifecycle) {\n        ((Lifecycle) cluster).stop();\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br")])]),s("ul",[s("li",[s("strong",[n._v("destroyInternal")])])]),n._v(" "),s("p",[n._v("对比下initInternal，它初始化了什么就destory什么")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("@Override\nprotected void destroyInternal() throws LifecycleException {\n\n    Realm realm = getRealmInternal();\n    if (realm instanceof Lifecycle) {\n        ((Lifecycle) realm).destroy();\n    }\n    Cluster cluster = getClusterInternal();\n    if (cluster instanceof Lifecycle) {\n        ((Lifecycle) cluster).destroy();\n    }\n\n    // Stop the Valves in our pipeline (including the basic), if any\n    if (pipeline instanceof Lifecycle) {\n        ((Lifecycle) pipeline).destroy();\n    }\n\n    // Remove children now this container is being destroyed\n    for (Container child : findChildren()) {\n        removeChild(child);\n    }\n\n    // Required if the child is destroyed directly.\n    if (parent != null) {\n        parent.removeChild(this);\n    }\n\n    // If init fails, this may be null\n    if (startStopExecutor != null) {\n        startStopExecutor.shutdownNow();\n    }\n\n    super.destroyInternal(); // 调用LifecycleMBeanBase的方法\n}\n```)")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);