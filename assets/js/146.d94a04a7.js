(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{2090:function(s,e){s.exports="data:image/png;base64,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"},2091:function(s,e,a){s.exports=a.p+"assets/img/db-mysql-sql-parser-2.a301cfef.png"},2092:function(s,e,a){s.exports=a.p+"assets/img/db-mysql-sql-parser-3.e5f45d34.png"},2093:function(s,e,a){s.exports=a.p+"assets/img/db-mysql-sql-parser-4.063fc72a.png"},2094:function(s,e,a){s.exports=a.p+"assets/img/db-mysql-sql-parser-5.2916bb96.png"},2095:function(s,e,a){s.exports=a.p+"assets/img/db-mysql-sql-parser-6.1888a970.png"},2096:function(s,e,a){s.exports=a.p+"assets/img/db-mysql-sql-parser-7.2cff1984.png"},2097:function(s,e,a){s.exports=a.p+"assets/img/db-mysql-sql-parser-8.29077666.png"},3880:function(s,e,a){"use strict";a.r(e);var n=a(7),t=Object(n.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"mysql-mysql中sql是如何解析的"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql-mysql中sql是如何解析的"}},[s._v("#")]),s._v(" MySQL - MySQL中SQL是如何解析的")]),s._v(" "),e("p",[s._v("===================================================")]),s._v(" "),e("blockquote",[e("p",[s._v("前文我们分享了一篇文章学习一条SQL是如何在数据库中执行的，其中有一个阶段是SQL的解析。这个阶段对于更全面的SQL优化功能；多维度的慢查询分析；辅助故障分析等有很大帮助。本文主要介绍一篇美团技术团队关于SQL解析和应用的文章，希望能给一些启示。@pdai")])]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#mysql---mysql%E4%B8%ADsql%E6%98%AF%E5%A6%82%E4%BD%95%E8%A7%A3%E6%9E%90%E7%9A%84"}},[s._v("MySQL - MySQL中SQL是如何解析的")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E8%83%8C%E6%99%AF"}},[s._v("背景")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E7%8E%B0%E7%8A%B6%E4%B8%8E%E5%9C%BA%E6%99%AF"}},[s._v("现状与场景")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#sql%E8%A7%A3%E6%9E%90%E7%9A%84%E5%8E%9F%E7%90%86"}},[s._v("SQL解析的原理")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90"}},[s._v("词法分析")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90"}},[s._v("语法分析")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E6%A0%91"}},[s._v("语法分析树")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#mysql%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E6%A0%91%E7%94%9F%E6%88%90%E8%BF%87%E7%A8%8B"}},[s._v("MySQL语法分析树生成过程")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E6%A0%B8%E5%BF%83%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E5%85%B6%E5%85%B3%E7%B3%BB"}},[s._v("核心数据结构及其关系")])])])])])]),s._v(" "),e("li",[e("a",{attrs:{href:"#sql%E8%A7%A3%E6%9E%90%E7%9A%84%E5%BA%94%E7%94%A8"}},[s._v("SQL解析的应用")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E6%97%A0%E7%94%A8%E6%9D%A1%E4%BB%B6%E5%8E%BB%E9%99%A4"}},[s._v("无用条件去除")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#sql%E7%89%B9%E5%BE%81%E7%94%9F%E6%88%90"}},[s._v("SQL特征生成")])])])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E5%AD%A6%E4%B9%A0%E5%BB%BA%E8%AE%AE"}},[s._v("学习建议")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E4%BD%9C%E8%80%85%E7%AE%80%E4%BB%8B"}},[s._v("作者简介")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E6%96%87%E7%AB%A0%E6%9D%A5%E6%BA%90"}},[s._v("文章来源")])])])])]),s._v(" "),e("h1",{attrs:{id:"背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("数据库作为核心的基础组件，是需要重点保护的对象。任何一个线上的不慎操作，都有可能给数据库带来严重的故障，从而给业务造成巨大的损失。为了避免这种损失，一般会在管理上下功夫。比如为研发人员制定数据库开发规范；新上线的SQL，需要DBA进行审核；维护操作需要经过领导审批等等。而且如果希望能够有效地管理这些措施，需要有效的数据库培训，还需要DBA细心的进行SQL审核。很多中小型创业公司，可以通过设定规范、进行培训、完善审核流程来管理数据库。")]),s._v(" "),e("p",[s._v("随着美团的业务不断发展和壮大，上述措施的实施成本越来越高。如何更多的依赖技术手段，来提高效率，越来越受到重视。业界已有不少基于MySQL源码开发的SQL审核、优化建议等工具，极大的减轻了DBA的SQL审核负担。那么我们能否继续扩展MySQL的源码，来辅助DBA和研发人员来进一步提高效率呢？比如，更全面的SQL优化功能；多维度的慢查询分析；辅助故障分析等。要实现上述功能，其中最核心的技术之一就是SQL解析。")]),s._v(" "),e("h1",{attrs:{id:"现状与场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#现状与场景"}},[s._v("#")]),s._v(" 现状与场景")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("SQL解析是一项复杂的技术，一般都是由数据库厂商来掌握，当然也有公司专门提供"),e("a",{attrs:{href:"https://www.sqlparser.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("SQL解析的API 在新窗口打开"),e("OutboundLink")],1),s._v("。由于这几年MySQL数据库中间件的兴起，需要支持读写分离、分库分表等功能，就必须从SQL中抽出表名、库名以及相关字段的值。因此像Java语言编写的Druid，C语言编写的MaxScale，Go语言编写的Kingshard等，都会对SQL进行部分解析。而真正把SQL解析技术用于数据库维护的产品较少，主要有如下几个:")]),s._v(" "),e("ul",[e("li",[s._v("美团开源的"),e("a",{attrs:{href:"https://github.com/Meituan-Dianping/SQLAdvisor",target:"_blank",rel:"noopener noreferrer"}},[s._v("SQLAdvisor 在新窗口打开"),e("OutboundLink")],1),s._v("。它基于MySQL原生态词法解析，结合分析SQL中的where条件、聚合条件、多表Join关系给出索引优化建议。")]),s._v(" "),e("li",[s._v("去哪儿开源的Inception（原仓库已经删除，闭源了）。侧重于根据内置的规则，对SQL进行审核。")]),s._v(" "),e("li",[s._v("阿里的"),e("a",{attrs:{href:"https://developer.aliyun.com/article/218442",target:"_blank",rel:"noopener noreferrer"}},[s._v("Cloud DBA 在新窗口打开"),e("OutboundLink")],1),s._v("。根据官方文档介绍，其也是提供SQL优化建议和改写。")])]),s._v(" "),e("p",[s._v("上述产品都有非常合适的应用场景，在业界也被广泛使用。但是SQL解析的应用场景远远没有被充分发掘，比如：")]),s._v(" "),e("ul",[e("li",[s._v("基于表粒度的慢查询报表。比如，一个Schema中包含了属于不同业务线的数据表，那么从业务线的角度来说，其希望提供表粒度的慢查询报表。")]),s._v(" "),e("li",[s._v("生成SQL特征。将SQL语句中的值替换成问号，方便SQL归类。虽然可以使用正则表达式实现相同的功能，但是其Bug较多，可以参考pt-query-digest。比如pt-query-digest中，会把遇到的数字都替换成“?”，导致无法区别不同数字后缀的表。")]),s._v(" "),e("li",[s._v("高危操作确认与规避。比如，DBA不小心Drop数据表，而此类操作，目前还无有效的工具进行回滚，尤其是大表，其后果将是灾难性的。")]),s._v(" "),e("li",[s._v("SQL合法性判断。为了安全、审计、控制等方面的原因，美团不会让研发人员直接操作数据库，而是提供RDS服务。尤其是对于数据变更，需要研发人员的上级主管进行业务上的审批。如果研发人员，写了一条语法错误的SQL，而RDS无法判断该SQL是否合法，就会造成不必要的沟通成本。")])]),s._v(" "),e("p",[s._v("因此为了让所有有需要的业务都能方便的使用SQL解析功能，我们认为应该具有如下特性。")]),s._v(" "),e("ul",[e("li",[s._v("直接暴露SQL解析接口，使用尽量简单。比如，输入SQL，则输出表名、特征和优化建议。")]),s._v(" "),e("li",[s._v("接口的使用不依赖于特定的语言，否则维护和使用的代价太高。比如，以HTTP等方式提供服务。")])]),s._v(" "),e("p",[s._v("千里之行，始于足下。下面我先介绍下SQL的解析原理。")]),s._v(" "),e("h1",{attrs:{id:"sql解析的原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sql解析的原理"}},[s._v("#")]),s._v(" SQL解析的原理")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("SQL解析与优化是属于编译器范畴，和C等其他语言的解析没有本质的区别。其中分为，词法分析、语法和语义分析、优化、执行代码生成。对应到MySQL的部分，如下图")]),s._v(" "),e("p",[e("img",{attrs:{src:a(2090),alt:""}})]),s._v(" "),e("h3",{attrs:{id:"词法分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#词法分析"}},[s._v("#")]),s._v(" 词法分析")]),s._v(" "),e("p",[s._v("SQL解析由词法分析和语法/语义分析两个部分组成。词法分析主要是把输入转化成一个个Token。其中Token中包含Keyword（也称symbol）和非Keyword。例如，SQL语句 select username from userinfo，在分析之后，会得到4个Token，其中有2个Keyword，分别为select和from：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("关键字")]),s._v(" "),e("th",[s._v("非关键字")]),s._v(" "),e("th",[s._v("关键字")]),s._v(" "),e("th",[s._v("非关键字")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("select")]),s._v(" "),e("td",[s._v("username")]),s._v(" "),e("td",[s._v("from")]),s._v(" "),e("td",[s._v("userinfo")])])])]),s._v(" "),e("p",[s._v("通常情况下，词法分析可以使用Flex来生成，但是MySQL并未使用该工具，而是手写了词法分析部分（据说是为了效率和灵活性，参考此文）。具体代码在sql/lex.h和sql/sql_lex.cc文件中。")]),s._v(" "),e("p",[s._v("MySQL中的Keyword定义在sql/lex.h中，如下为部分Keyword：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{ "&&",               SYM(AND_AND_SYM)},\n{ "<",                SYM(LT)},\n{ "<=",               SYM(LE)},\n{ "<>",               SYM(NE)},\n{ "!=",               SYM(NE)},\n{ "=",                SYM(EQ)},\n{ ">",                SYM(GT_SYM)},\n{ ">=",               SYM(GE)},\n{ "<<",               SYM(SHIFT_LEFT)},\n{ ">>",               SYM(SHIFT_RIGHT)},\n{ "<=>",              SYM(EQUAL_SYM)},\n{ "ACCESSIBLE",       SYM(ACCESSIBLE_SYM)},\n{ "ACTION",           SYM(ACTION)},\n{ "ADD",              SYM(ADD)},\n{ "AFTER",            SYM(AFTER_SYM)},\n{ "AGAINST",          SYM(AGAINST)},\n{ "AGGREGATE",        SYM(AGGREGATE_SYM)},\n{ "ALL",              SYM(ALL)},\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("p",[s._v("词法分析的核心代码在sql/sql_lex.c文件中的，MySQLLex→lex_one_Token，有兴趣的同学可以下载源码研究。")]),s._v(" "),e("h3",{attrs:{id:"语法分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#语法分析"}},[s._v("#")]),s._v(" 语法分析")]),s._v(" "),e("p",[s._v("语法分析就是生成语法树的过程。这是整个解析过程中最精华，最复杂的部分，不过这部分MySQL使用了Bison来完成。即使如此，如何设计合适的数据结构以及相关算法，去存储和遍历所有的信息，也是值得在这里研究的。")]),s._v(" "),e("h4",{attrs:{id:"语法分析树"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#语法分析树"}},[s._v("#")]),s._v(" 语法分析树")]),s._v(" "),e("p",[s._v("SQL语句：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("select username, ismale from userinfo where age > 20 and level > 5 and 1 = 1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("会生成如下语法树。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(2091),alt:""}})]),s._v(" "),e("p",[s._v("对于未接触过编译器实现的同学，肯定会好奇如何才能生成这样的语法树。其背后的原理都是编译器的范畴，可以参考维基百科的一篇文章，以及该链接中的参考书籍。本人也是在学习MySQL源码过程中，阅读了部分内容。由于编译器涉及的内容过多，本人精力和时间有限，不做过多探究。从工程的角度来说，学会如何使用Bison去构建语法树，来解决实际问题，对我们的工作也许有更大帮助。下面我就以Bison为基础，探讨该过程。")]),s._v(" "),e("h4",{attrs:{id:"mysql语法分析树生成过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql语法分析树生成过程"}},[s._v("#")]),s._v(" MySQL语法分析树生成过程")]),s._v(" "),e("p",[s._v("全部的源码在sql/sql_yacc.yy中，在MySQL5.6中有17K行左右代码。这里列出涉及到SQL：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("select username, ismale from userinfo where age > 20 and level > 5 and 1 = 1 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("解析过程的部分代码摘录出来。其实有了Bison之后，SQL解析的难度也没有想象的那么大。特别是这里给出了解析的脉络之后。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("select /*select语句入口*/:\n \n          select_init\n \n          {\n \n            LEX *lex= Lex;\n \n            lex->sql_command= SQLCOM_SELECT;\n \n          }\n \n        ;\n \nselect_init:\n          SELECT_SYM /*select 关键字*/ select_init2\n \n        | '(' select_paren ')' union_opt\n \n        ;\n \nselect_init2:\n          select_part2\n          {\n            LEX *lex= Lex;\n            SELECT_LEX * sel= lex->current_select;\n            if (lex->current_select->set_braces(0))\n            {\n              my_parse_error(ER(ER_SYNTAX_ERROR));\n              MYSQL_YYABORT;\n            }\n            if (sel->linkage == UNION_TYPE &&\n                sel->master_unit()->first_select()->braces)\n            {\n              my_parse_error(ER(ER_SYNTAX_ERROR));\n              MYSQL_YYABORT;\n            }\n          }\n          union_clause\n        ;\nselect_part2:\n          {\n            LEX *lex= Lex;\n            SELECT_LEX *sel= lex->current_select;\n            if (sel->linkage != UNION_TYPE)\n              mysql_init_select(lex);\n            lex->current_select->parsing_place= SELECT_LIST;\n          }\n  \n          select_options select_item_list /*解析列名*/\n          {\n            Select->parsing_place= NO_MATTER;\n          }\n          select_into select_lock_type\n        ;\n \nselect_into:\n          opt_order_clause opt_limit_clause {}\n        | into\n        | select_from /*from 字句*/\n        | into select_from\n        | select_from into\n        ;\nselect_from:\n          FROM join_table_list /*解析表名*/ where_clause /*where字句*/ group_clause having_clause\n          opt_order_clause opt_limit_clause procedure_analyse_clause\n          {\n            Select->context.table_list=\n              Select->context.first_name_resolution_table=\n                Select->table_list.first;\n          }\n        | FROM DUAL_SYM where_clause opt_limit_clause\n          /* oracle compatibility: oracle always requires FROM clause,\n             and DUAL is system table without fields.\n             Is \"SELECT 1 FROM DUAL\" any better than \"SELECT 1\" ?\n          Hmmm :) */\n        ;\n \nwhere_clause:\n          /* empty */  { Select->where= 0; }\n        | WHERE\n          {\n            Select->parsing_place= IN_WHERE;\n          }\n          expr /*各种表达式*/\n          {\n            SELECT_LEX *select= Select;\n            select->where= $3;\n            select->parsing_place= NO_MATTER;\n            if ($3)\n              $3->top_level_item();\n          }\n        ;\n  \n/* all possible expressions */\nexpr:\n           | expr and expr %prec AND_SYM\n          {\n            /* See comments in rule expr: expr or expr */\n            Item_cond_and *item1;\n            Item_cond_and *item3;\n            if (is_cond_and($1))\n            {\n              item1= (Item_cond_and*) $1;\n              if (is_cond_and($3))\n              {\n                item3= (Item_cond_and*) $3;\n                /*\n                  (X1 AND X2) AND (Y1 AND Y2) ==> AND (X1, X2, Y1, Y2)\n                */\n                item3->add_at_head(item1->argument_list());\n                $$ = $3;\n              }\n              else\n              {\n                /*\n                  (X1 AND X2) AND Y ==> AND (X1, X2, Y)\n                */\n                item1->add($3);\n                $$ = $1;\n              }\n            }\n            else if (is_cond_and($3))\n            {\n              item3= (Item_cond_and*) $3;\n              /*\n                X AND (Y1 AND Y2) ==> AND (X, Y1, Y2)\n              */\n              item3->add_at_head($1);\n              $$ = $3;\n            }\n            else\n            {\n              /* X AND Y */\n              $$ = new (YYTHD->mem_root) Item_cond_and($1, $3);\n              if ($$ == NULL)\n                MYSQL_YYABORT;\n            }\n          }\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br"),e("span",{staticClass:"line-number"},[s._v("108")]),e("br"),e("span",{staticClass:"line-number"},[s._v("109")]),e("br"),e("span",{staticClass:"line-number"},[s._v("110")]),e("br"),e("span",{staticClass:"line-number"},[s._v("111")]),e("br"),e("span",{staticClass:"line-number"},[s._v("112")]),e("br"),e("span",{staticClass:"line-number"},[s._v("113")]),e("br"),e("span",{staticClass:"line-number"},[s._v("114")]),e("br"),e("span",{staticClass:"line-number"},[s._v("115")]),e("br"),e("span",{staticClass:"line-number"},[s._v("116")]),e("br"),e("span",{staticClass:"line-number"},[s._v("117")]),e("br"),e("span",{staticClass:"line-number"},[s._v("118")]),e("br"),e("span",{staticClass:"line-number"},[s._v("119")]),e("br"),e("span",{staticClass:"line-number"},[s._v("120")]),e("br"),e("span",{staticClass:"line-number"},[s._v("121")]),e("br"),e("span",{staticClass:"line-number"},[s._v("122")]),e("br"),e("span",{staticClass:"line-number"},[s._v("123")]),e("br"),e("span",{staticClass:"line-number"},[s._v("124")]),e("br"),e("span",{staticClass:"line-number"},[s._v("125")]),e("br"),e("span",{staticClass:"line-number"},[s._v("126")]),e("br"),e("span",{staticClass:"line-number"},[s._v("127")]),e("br"),e("span",{staticClass:"line-number"},[s._v("128")]),e("br"),e("span",{staticClass:"line-number"},[s._v("129")]),e("br"),e("span",{staticClass:"line-number"},[s._v("130")]),e("br"),e("span",{staticClass:"line-number"},[s._v("131")]),e("br"),e("span",{staticClass:"line-number"},[s._v("132")]),e("br"),e("span",{staticClass:"line-number"},[s._v("133")]),e("br"),e("span",{staticClass:"line-number"},[s._v("134")]),e("br"),e("span",{staticClass:"line-number"},[s._v("135")]),e("br"),e("span",{staticClass:"line-number"},[s._v("136")]),e("br"),e("span",{staticClass:"line-number"},[s._v("137")]),e("br"),e("span",{staticClass:"line-number"},[s._v("138")]),e("br"),e("span",{staticClass:"line-number"},[s._v("139")]),e("br")])]),e("p",[s._v("在大家浏览上述代码的过程，会发现Bison中嵌入了C++的代码。通过C++代码，把解析到的信息存储到相关对象中。例如表信息会存储到TABLE_LIST中，order_list存储order by子句里的信息，where字句存储在Item中。有了这些信息，再辅助以相应的算法就可以对SQL进行更进一步的处理了。")]),s._v(" "),e("h4",{attrs:{id:"核心数据结构及其关系"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#核心数据结构及其关系"}},[s._v("#")]),s._v(" 核心数据结构及其关系")]),s._v(" "),e("p",[s._v("在SQL解析中，最核心的结构是SELECT_LEX，其定义在sql/sql_lex.h中。下面仅列出与上述例子相关的部分。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(2092),alt:""}})]),s._v(" "),e("p",[s._v("上面图示中，列名username、ismale存储在item_list中，表名存储在table_list中，条件存储在where中。其中以where条件中的Item层次结构最深，表达也较为复杂，如下图所示。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(2093),alt:""}})]),s._v(" "),e("h1",{attrs:{id:"sql解析的应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sql解析的应用"}},[s._v("#")]),s._v(" SQL解析的应用")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("为了更深入的了解SQL解析器，这里给出2个应用SQL解析的例子。")]),s._v(" "),e("h3",{attrs:{id:"无用条件去除"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#无用条件去除"}},[s._v("#")]),s._v(" 无用条件去除")]),s._v(" "),e("p",[s._v("无用条件去除属于优化器的逻辑优化范畴，可以仅仅根据SQL本身以及表结构即可完成，其优化的情况也是较多的，代码在sql/sql_optimizer.cc文件中的remove_eq_conds函数。为了避免过于繁琐的描述，以及大段代码的粘贴，这里通过图来分析以下四种情况。")]),s._v(" "),e("p",[s._v("a）1=1 and (m > 3 and n > 4)")]),s._v(" "),e("p",[e("img",{attrs:{src:a(2094),alt:""}})]),s._v(" "),e("p",[s._v("b）1=2 and (m > 3 and n > 4)")]),s._v(" "),e("p",[e("img",{attrs:{src:a(2095),alt:""}})]),s._v(" "),e("p",[s._v("c）1=1 or (m > 3 and n > 4)")]),s._v(" "),e("p",[e("img",{attrs:{src:a(2096),alt:""}})]),s._v(" "),e("p",[s._v("d）1=2 or (m > 3 and n > 4)")]),s._v(" "),e("p",[e("img",{attrs:{src:a(2097),alt:""}})]),s._v(" "),e("p",[s._v("如果对其代码实现有兴趣的同学，需要对MySQL中的一个重要数据结构Item类有所了解。因为其比较复杂，所以MySQL"),e("a",{attrs:{href:"https://dev.mysql.com/doc/internals/en/item-class.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档 在新窗口打开"),e("OutboundLink")],1),s._v("，专门介绍了Item类。阿里的MySQL小组，也有类似的"),e("a",{attrs:{href:"https://www.orczhou.com/index.php/2012/11/mysql-innodb-source-code-optimization-1/",target:"_blank",rel:"noopener noreferrer"}},[s._v("文章 在新窗口打开"),e("OutboundLink")],1),s._v("。如需更详细的了解，就需要去查看源码中sql/item_*等文件。")]),s._v(" "),e("h3",{attrs:{id:"sql特征生成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sql特征生成"}},[s._v("#")]),s._v(" SQL特征生成")]),s._v(" "),e("p",[s._v("为了确保数据库，这一系统基础组件稳定、高效运行，业界有很多辅助系统。比如慢查询系统、中间件系统。这些系统采集、收到SQL之后，需要对SQL进行归类，以便统计信息或者应用相关策略。归类时，通常需要获取SQL特征。比如SQL:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("select username, ismale from userinfo where age > 20 and level > 5；\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("SQL特征为：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("select username, ismale from userinfo where age > ? and level > ? \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("业界著名的慢查询分析工具pt-query-digest，通过正则表达式实现这个功能但是这类处理办法Bug较多。接下来就介绍如何使用SQL解析，完成SQL特征的生成。")]),s._v(" "),e("p",[s._v("SQL特征生成分两部分组成。")]),s._v(" "),e("ul",[e("li",[s._v("a) 生成Token数组")]),s._v(" "),e("li",[s._v("b) 根据Token数组，生成SQL特征")])]),s._v(" "),e("p",[s._v("首先回顾在词法解析章节，我们介绍了SQL中的关键字，并且每个关键字都有一个16位的整数对应，而非关键字统一用ident表示，其也对应了一个16位整数。如下表：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("标识")]),s._v(" "),e("th",[s._v("select")]),s._v(" "),e("th",[s._v("from")]),s._v(" "),e("th",[s._v("where")]),s._v(" "),e("th",[s._v(">")]),s._v(" "),e("th",[s._v("?")]),s._v(" "),e("th",[s._v("and")]),s._v(" "),e("th",[s._v("ident")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("整数")]),s._v(" "),e("td",[s._v("728")]),s._v(" "),e("td",[s._v("448")]),s._v(" "),e("td",[s._v("878")]),s._v(" "),e("td",[s._v("463")]),s._v(" "),e("td",[s._v("893")]),s._v(" "),e("td",[s._v("272")]),s._v(" "),e("td",[s._v("476")])])])]),s._v(" "),e("p",[s._v("将一个SQL转换成特征的过程：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("原SQL")]),s._v(" "),e("th",[s._v("select")]),s._v(" "),e("th",[s._v("username")]),s._v(" "),e("th",[s._v("from")]),s._v(" "),e("th",[s._v("userinfo")]),s._v(" "),e("th",[s._v("where")]),s._v(" "),e("th",[s._v("age")]),s._v(" "),e("th",[s._v(">")]),s._v(" "),e("th",[s._v("20")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("SQL特征")]),s._v(" "),e("td",[s._v("select")]),s._v(" "),e("td",[s._v("ident:length:value")]),s._v(" "),e("td",[s._v("from")]),s._v(" "),e("td",[s._v("ident:length:value")]),s._v(" "),e("td",[s._v("where")]),s._v(" "),e("td",[s._v("ident:length:value")]),s._v(" "),e("td",[s._v(">")]),s._v(" "),e("td",[s._v("?")])])])]),s._v(" "),e("p",[s._v("在SQL解析过程中，可以很方便的完成Token数组的生成。而一旦完成Token数组的生成，就可以很简单的完成SQL特征的生成。SQL特征被广泛用于各个系统中，比如pt-query-digest需要根据特征对SQL归类，然而其基于正则表达式的实现有诸多bug。下面列举几个已知Bug：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("原始SQL")]),s._v(" "),e("th",[s._v("pt-query-digest生成的特征")]),s._v(" "),e("th",[s._v("SQL解析器生成的特征")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("select * from email_template2 where id = 1")]),s._v(" "),e("td",[s._v("select * from mail_template？ where id = ？")]),s._v(" "),e("td",[s._v("select * from email_template2 where id = ？")])]),s._v(" "),e("tr",[e("td",[s._v("REPLACE INTO a VALUES(‘INSERT INTO foo VALUES (1),(2)’)")]),s._v(" "),e("td",[s._v("replace into a values(\\‘insert into foo values(?+)")]),s._v(" "),e("td",[s._v("replace into a values （?）")])])])]),s._v(" "),e("p",[s._v("因此可以看出SQL解析的优势是很明显的。")]),s._v(" "),e("h1",{attrs:{id:"学习建议"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#学习建议"}},[s._v("#")]),s._v(" 学习建议")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("最近，在对SQL解析器和优化器探索的过程中，从一开始的茫然无措到有章可循，也总结了一些心得体会，在这里跟大家分享一下。")]),s._v(" "),e("ul",[e("li",[s._v("首先，阅读相关图书书籍。图书能给我们系统认识解析器和优化器的角度。但是针对MySQL的此类图书市面上很少，目前中文作品可以看一看《数据库查询优化器的艺术：原理解析与SQL性能优化》。")]),s._v(" "),e("li",[s._v("其次，要阅读源码，但是最好以某个版本为基础，比如MySQL5.6.23，因为SQL解析、优化部分的代码在不断变化。尤其是在跨越大的版本时，改动力度大。")]),s._v(" "),e("li",[s._v("再次，多使用GDB调试，验证自己的猜测，检验阅读质量。")]),s._v(" "),e("li",[s._v("最后，需要写相关代码验证，只有写出来了才能算真正的掌握。")])]),s._v(" "),e("h1",{attrs:{id:"作者简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#作者简介"}},[s._v("#")]),s._v(" 作者简介")]),s._v(" "),e("hr"),s._v(" "),e("ul",[e("li",[s._v("广友，美团到店综合事业群MySQL DBA专家，2012年毕业于中国科学技术大学，2017年加入美团，长期致力于MySQL及周边工具的研究。")]),s._v(" "),e("li",[s._v("金龙，2014年加入美团，主要从事相关的数据库运维、高可用和相关的运维平台建设。对运维高可用与架构相关感兴趣的同学可以关注个人微信公众号“自己的设计师”，定期推送运维相关原创内容。")]),s._v(" "),e("li",[s._v("邢帆，美团到店综合事业群MySQL DBA，2017年研究生毕业后加入美团，目前已经对MySQL运维有一定经验，并编写了一些自动化脚本。")])]),s._v(" "),e("h1",{attrs:{id:"文章来源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#文章来源"}},[s._v("#")]),s._v(" 文章来源")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("转载说明")]),s._v(" "),e("ul",[e("li",[s._v("作者：广友")]),s._v(" "),e("li",[s._v("版权声明：本文为美团技术团队的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。")]),s._v(" "),e("li",[s._v("原文链接：https://tech.meituan.com/2018/05/20/sql-parser-used-in-mtdp.html)")])])])}),[],!1,null,null,null);e.default=t.exports}}]);