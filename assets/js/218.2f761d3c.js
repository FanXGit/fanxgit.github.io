(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{1219:function(t,a,n){t.exports=n.p+"assets/img/springboot-actuator-1.ffb1bfd4.png"},1220:function(t,a,n){t.exports=n.p+"assets/img/springboot-actuator-5.d6661315.png"},1221:function(t,a){t.exports="data:image/png;base64,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"},1222:function(t,a,n){t.exports=n.p+"assets/img/springboot-actuator-3.89d2d674.png"},1223:function(t,a,n){t.exports=n.p+"assets/img/springboot-actuator-4.d56c21cc.png"},3726:function(t,a,n){"use strict";n.r(a);var s=n(7),e=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"▶springboot监控-集成actuator监控工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#▶springboot监控-集成actuator监控工具"}},[t._v("#")]),t._v(" ▶SpringBoot监控 - 集成actuator监控工具")]),t._v(" "),a("p",[t._v("=================================================================")]),t._v(" "),a("blockquote",[a("p",[t._v("当SpringBoot的应用部署到生产环境中后，如何监控和管理呢？比如审计日志，监控状态，指标收集等。为了解决这个问题，SpringBoot提供了Actuator。本文主要介绍Spring Boot Actuator及实现案例。@pdai")])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#springboot%E7%9B%91%E6%8E%A7---%E9%9B%86%E6%88%90actuator%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7"}},[t._v("▶SpringBoot监控 - 集成actuator监控工具")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E7%9F%A5%E8%AF%86%E5%87%86%E5%A4%87"}},[t._v("知识准备")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E4%BB%80%E4%B9%88%E6%98%AFactuator"}},[t._v("什么是Actuator?")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BB%80%E4%B9%88%E6%98%AFspring-boot-actuator"}},[t._v("什么是Spring Boot Actuator？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BB%80%E4%B9%88%E6%98%AFactuator-endpoints"}},[t._v("什么是Actuator Endpoints？")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"}},[t._v("简单示例")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#pom%E5%BC%95%E5%85%A5actuator%E5%8C%85"}},[t._v("POM引入actuator包")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#yml%E9%85%8D%E7%BD%AE"}},[t._v("yml配置")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#endpoints%E7%9A%84%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%8B%93%E5%B1%95%E9%85%8D%E7%BD%AE"}},[t._v("Endpoints的进一步拓展配置")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E4%B8%8Espringsecurity%E9%9B%86%E6%88%90%E4%BF%9D%E9%9A%9C%E5%AE%89%E5%85%A8"}},[t._v("与SpringSecurity集成保障安全")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#endpoint%E8%B7%A8%E5%9F%9F%E8%AE%BF%E9%97%AE"}},[t._v("Endpoint跨域访问")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%B7%B1%E7%9A%84endpoint"}},[t._v("实现自己的Endpoint")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E7%BB%84%E4%BB%B6%E7%9A%84health%E7%8A%B6%E5%86%B5"}},[t._v("组件的health状况")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#metrics%E6%8E%A5%E5%85%A5%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F"}},[t._v("Metrics接入监控系统")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#info%E4%BF%A1%E6%81%AF%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96"}},[t._v("Info信息如何获取")])])])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E7%A4%BA%E4%BE%8B%E6%BA%90%E7%A0%81"}},[t._v("示例源码")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"}},[t._v("参考资料")])])])])]),t._v(" "),a("h1",{attrs:{id:"知识准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#知识准备"}},[t._v("#")]),t._v(" 知识准备")]),t._v(" "),a("hr"),t._v(" "),a("blockquote",[a("p",[t._v("需要了解什么是Spring Boot Actuator， 以及其提供的功能(Endpoints)。")])]),t._v(" "),a("h3",{attrs:{id:"什么是actuator"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是actuator"}},[t._v("#")]),t._v(" 什么是Actuator?")]),t._v(" "),a("blockquote",[a("p",[t._v("致动器（actuator）是2018年公布的计算机科学技术名词。")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://baike.baidu.com/item/%E8%87%B4%E5%8A%A8%E5%99%A8/56538368?fr=aladdin",target:"_blank",rel:"noopener noreferrer"}},[t._v("百度百科 在新窗口打开"),a("OutboundLink")],1),t._v("的解释如下： 致动器能将某种形式的能量转换为机械能的驱动装置。如热致动器、磁致动器等，在磁盘中是指将电能转换为机械能并带动磁头运动的装置。")]),t._v(" "),a("p",[t._v("官网给的解释是：An actuator is a manufacturing term that refers to a mechanical device for moving or controlling something. Actuators can generate a large amount of motion from a small change.")]),t._v(" "),a("p",[t._v("从上述的解释不难知道Spring 命名这个组件为Actuator，就是为了提供监测程序的能力。")]),t._v(" "),a("h3",{attrs:{id:"什么是spring-boot-actuator"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是spring-boot-actuator"}},[t._v("#")]),t._v(" 什么是Spring Boot Actuator？")]),t._v(" "),a("blockquote",[a("p",[t._v("什么是Spring Boot Actuator? 用在什么样的场景呢？")])]),t._v(" "),a("p",[t._v("Spring Boot Actuator提供了对SpringBoot应用程序（可以是生产环境）监视和管理的能力， 可以选择通过使用"),a("strong",[t._v("HTTP Endpoint")]),t._v("或使用"),a("strong",[t._v("JMX")]),t._v("来管理和监控SpringBoot应用程序。")]),t._v(" "),a("h3",{attrs:{id:"什么是actuator-endpoints"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是actuator-endpoints"}},[t._v("#")]),t._v(" 什么是Actuator Endpoints？")]),t._v(" "),a("p",[t._v("Spring Boot Actuator 允许你通过Endpoints对Spring Boot进行监控和交互。")]),t._v(" "),a("p",[t._v("Spring Boot 内置的Endpoint包括（两种Endpoint： WEB和JMX， web方式考虑到安全性默认只开启了/health）：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("ID")]),t._v(" "),a("th",[t._v("JMX")]),t._v(" "),a("th",[t._v("Web")]),t._v(" "),a("th",[t._v("Endpoint功能描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("auditevents")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("暴露当前应用的audit events （依赖AuditEventRepository）")])]),t._v(" "),a("tr",[a("td",[t._v("beans")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("Spring中所有Beans")])]),t._v(" "),a("tr",[a("td",[t._v("caches")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("暴露可用的缓存")])]),t._v(" "),a("tr",[a("td",[t._v("conditions")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("展示configuration 和auto-configuration类中解析的condition，并展示是否匹配的信息.")])]),t._v(" "),a("tr",[a("td",[t._v("configprops")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("展示所有的@ConfigurationProperties")])]),t._v(" "),a("tr",[a("td",[t._v("env")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("展示环境变量，来源于ConfigurableEnvironment")])]),t._v(" "),a("tr",[a("td",[t._v("flyway")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("flyway数据迁移信息（依赖Flyway）")])]),t._v(" "),a("tr",[a("td",[t._v("health")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[a("strong",[t._v("Yes")])]),t._v(" "),a("td",[t._v("展示应用的健康信息")])]),t._v(" "),a("tr",[a("td",[t._v("heapdump")]),t._v(" "),a("td",[t._v("N/A")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("（"),a("strong",[t._v("web应用时")]),t._v("）hprof 堆的dump文件（依赖HotSpot JVM）")])]),t._v(" "),a("tr",[a("td",[t._v("httptrace")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("展示HTTP trace信息, 默认展示前100个（依赖HttpTraceRepository）")])]),t._v(" "),a("tr",[a("td",[t._v("info")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("应用信息")])]),t._v(" "),a("tr",[a("td",[t._v("integrationgraph")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("展示spring集成信息（依赖spring-integration-core）")])]),t._v(" "),a("tr",[a("td",[t._v("jolokia")]),t._v(" "),a("td",[t._v("N/A")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("（"),a("strong",[t._v("web应用时")]),t._v("）通过HTTP暴露JMX beans（依赖jolokia-core）")])]),t._v(" "),a("tr",[a("td",[t._v("logfile")]),t._v(" "),a("td",[t._v("N/A")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("（"),a("strong",[t._v("web应用时")]),t._v("）如果配置了logging.file.name 或者 logging.file.path，展示logfile内容")])]),t._v(" "),a("tr",[a("td",[t._v("loggers")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("展示或者配置loggers，比如修改日志的等级")])]),t._v(" "),a("tr",[a("td",[t._v("liquibase")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("Liquibase 数据迁移信息（依赖Liquibase）")])]),t._v(" "),a("tr",[a("td",[t._v("metrics")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("指标信息")])]),t._v(" "),a("tr",[a("td",[t._v("mappings")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("@RequestMapping映射路径")])]),t._v(" "),a("tr",[a("td",[t._v("prometheus")]),t._v(" "),a("td",[t._v("N/A")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("（"),a("strong",[t._v("web应用时")]),t._v("）向prometheus暴露监控信息（依赖micrometer-registry-prometheus）")])]),t._v(" "),a("tr",[a("td",[t._v("quartz")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("展示 quartz任务信息")])]),t._v(" "),a("tr",[a("td",[t._v("scheduledtasks")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("展示Spring Scheduled 任务信息")])]),t._v(" "),a("tr",[a("td",[t._v("sessions")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("session信息")])]),t._v(" "),a("tr",[a("td",[t._v("shutdown")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("关闭应用")])]),t._v(" "),a("tr",[a("td",[t._v("startup")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("展示ApplicationStartup的startup步骤的数据（依赖通在SpringApplication配置BufferingApplicationStartup）")])]),t._v(" "),a("tr",[a("td",[t._v("threaddump")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("线程dump")])])])]),t._v(" "),a("p",[t._v("当然你也可以自己定义暴露哪些endpoint,")]),t._v(" "),a("p",[t._v("不如JMX时：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('management:\n  endpoints:\n    jmx:\n      exposure:\n        include: "health,info"\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("web时(*代表所有）：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('management:\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n        exclude: "env,beans"\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h1",{attrs:{id:"简单示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单示例"}},[t._v("#")]),t._v(" 简单示例")]),t._v(" "),a("hr"),t._v(" "),a("blockquote",[a("p",[t._v("我们通过一个简单的例子，来展示自定义配置指定的endpoint，然后围绕这个简单的例子，谈谈后续拓展。")])]),t._v(" "),a("h3",{attrs:{id:"pom引入actuator包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pom引入actuator包"}},[t._v("#")]),t._v(" POM引入actuator包")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-actuator</artifactId>\n</dependency>\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h3",{attrs:{id:"yml配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#yml配置"}},[t._v("#")]),t._v(" yml配置")]),t._v(" "),a("p",[t._v("自定义暴露哪些endpoint, 比如如下yml配置")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server:\n  port: 8080\n\nmanagement:\n  endpoints:\n    enabled-by-default: false\n    web:\n      base-path: /manage\n      exposure:\n        include: 'info,health,env,beans'\n  endpoint:\n    info:\n      enabled: true\n    health:\n      enabled: true\n    env:\n      enabled: true\n    beans:\n      enabled: true\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br")])]),a("p",[t._v("上述配置只暴露info,health,env,beans四个endpoints, web通过可以"),a("code",[t._v("/manage")]),t._v("访问，")]),t._v(" "),a("p",[a("img",{attrs:{src:n(1219),alt:""}})]),t._v(" "),a("h3",{attrs:{id:"endpoints的进一步拓展配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#endpoints的进一步拓展配置"}},[t._v("#")]),t._v(" Endpoints的进一步拓展配置")]),t._v(" "),a("h4",{attrs:{id:"与springsecurity集成保障安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#与springsecurity集成保障安全"}},[t._v("#")]),t._v(" 与SpringSecurity集成保障安全")]),t._v(" "),a("p",[t._v("正是由于endpoint可能潜在暴露应用的安全性，web方式的endpoint才在默认情况下只暴露了一个/health。")]),t._v(" "),a("p",[t._v("如果你需要暴露更多，并保证endpoint接口安全，可以与Spring Security集成，比如")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('@Configuration(proxyBeanMethods = false)\npublic class MySecurityConfiguration {\n\n    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        http.requestMatcher(EndpointRequest.toAnyEndpoint())\n                .authorizeRequests((requests) -> requests.anyRequest().hasRole("ENDPOINT_ADMIN"));\n        http.httpBasic();\n        return http.build();\n    }\n\n}\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("h4",{attrs:{id:"endpoint跨域访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#endpoint跨域访问"}},[t._v("#")]),t._v(" Endpoint跨域访问")]),t._v(" "),a("p",[t._v("跨域访问，可以通过如下配置：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('management:\n  endpoints:\n    web:\n      cors:\n        allowed-origins: "https://example.com"\n        allowed-methods: "GET,POST"\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h4",{attrs:{id:"实现自己的endpoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现自己的endpoint"}},[t._v("#")]),t._v(" 实现自己的Endpoint")]),t._v(" "),a("p",[t._v("我们可以通过@JmxEndpoint or @WebEndpoint注解来定义自己的endpoint, 然后通过@ReadOperation, @WriteOperation或者@DeleteOperation来暴露操作，")]),t._v(" "),a("p",[t._v("比如添加系统时间date的endpoint")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('package tech.pdai.springboot.actuator;\n\nimport java.time.LocalDateTime;\n\nimport org.springframework.boot.actuate.endpoint.annotation.ReadOperation;\nimport org.springframework.boot.actuate.endpoint.web.annotation.WebEndpoint;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n * @author pdai\n */\n@RestController("custom")\n@WebEndpoint(id = "date")\npublic class CustomEndpointController {\n\n    @ReadOperation\n    public ResponseEntity<String> currentDate() {\n        return ResponseEntity.ok(LocalDateTime.now().toString());\n    }\n}\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br")])]),a("p",[t._v("enable 自定义的date")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("management:\n  endpoints:\n    enabled-by-default: false\n    web:\n      base-path: /manage\n      exposure:\n        include: 'info,health,env,beans,date'\n  endpoint:\n    info:\n      enabled: true\n    health:\n      enabled: true\n    env:\n      enabled: true\n    beans:\n      enabled: true\n    date:\n      enabled: true\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])]),a("p",[t._v("你可以看到所有开放的接口中增加了date")]),t._v(" "),a("p",[a("img",{attrs:{src:n(1220),alt:""}})]),t._v(" "),a("p",[t._v("访问效果")]),t._v(" "),a("p",[a("img",{attrs:{src:n(1221),alt:""}})]),t._v(" "),a("h4",{attrs:{id:"组件的health状况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组件的health状况"}},[t._v("#")]),t._v(" 组件的health状况")]),t._v(" "),a("p",[t._v("SpringBoot默认集成了如下常见中间件的health监控")]),t._v(" "),a("p",[a("img",{attrs:{src:n(1222),alt:""}})]),t._v(" "),a("p",[t._v("当然你也可以自定义HealthIndicator")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('package tech.pdai.springboot.actuator;\n\nimport org.springframework.boot.actuate.health.Health;\nimport org.springframework.boot.actuate.health.HealthIndicator;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author pdai\n */\n@Component\npublic class CustomHealthIndicator implements HealthIndicator {\n\n    @Override\n    public Health health() {\n        int errorCode = check();\n        if (errorCode!=0) {\n            return Health.down().withDetail("Error Code", errorCode).build();\n        }\n        return Health.up().build();\n    }\n\n    private int check() {\n        // perform some specific health check\n        return 0;\n    }\n\n}\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br")])]),a("p",[t._v("更详细的信息可以参考"),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.endpoints.health",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网 在新窗口打开"),a("OutboundLink")],1)]),t._v(" "),a("h4",{attrs:{id:"metrics接入监控系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#metrics接入监控系统"}},[t._v("#")]),t._v(" Metrics接入监控系统")]),t._v(" "),a("p",[t._v("这个也是比较常用的，具体参考")]),t._v(" "),a("p",[a("img",{attrs:{src:n(1223),alt:""}})]),t._v(" "),a("h4",{attrs:{id:"info信息如何获取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#info信息如何获取"}},[t._v("#")]),t._v(" Info信息如何获取")]),t._v(" "),a("p",[t._v("有细心的小伙伴会发现/info是空的，最简单的配置方式是在spring-boot-maven-plugin中加入build-info， 编译成jar后运行，即可获取info：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<plugins>\n    <plugin>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-maven-plugin</artifactId>\n        <executions>\n            <execution>\n                <goals>\n                    <goal>build-info</goal>\n                </goals>\n            </execution>\n        </executions>\n    </plugin>\n</plugins>\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("h1",{attrs:{id:"示例源码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例源码"}},[t._v("#")]),t._v(" 示例源码")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("https://github.com/realpdai/tech-pdai-spring-demos")]),t._v(" "),a("h1",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.enabling)")])])}),[],!1,null,null,null);a.default=e.exports}}]);