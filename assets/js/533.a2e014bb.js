(window.webpackJsonp=window.webpackJsonp||[]).push([[533],{3664:function(n,s,a){"use strict";a.r(s);var e=a(7),i=Object(e.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h1",{attrs:{id:"springboot接口-如何提供多个版本接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#springboot接口-如何提供多个版本接口"}},[n._v("#")]),n._v(" SpringBoot接口 - 如何提供多个版本接口")]),n._v(" "),s("p",[n._v("=======================================================")]),n._v(" "),s("blockquote",[s("p",[n._v("在以SpringBoot开发Restful接口时，由于模块，系统等业务的变化，需要对同一接口提供不同版本的参数实现（老的接口还有模块或者系统在用，不能直接改，所以需要不同版本）。如何更加优雅的实现多版本接口呢？@pdai")])]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#springboot%E6%8E%A5%E5%8F%A3---%E5%A6%82%E4%BD%95%E6%8F%90%E4%BE%9B%E5%A4%9A%E4%B8%AA%E7%89%88%E6%9C%AC%E6%8E%A5%E5%8F%A3"}},[n._v("SpringBoot接口 - 如何提供多个版本接口")]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%8E%A5%E5%8F%A3%E4%BC%9A%E5%87%BA%E7%8E%B0%E5%A4%9A%E4%B8%AA%E7%89%88%E6%9C%AC"}},[n._v("为什么接口会出现多个版本？")]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E6%9C%89%E5%93%AA%E4%BA%9B%E6%8E%A7%E5%88%B6%E6%8E%A5%E5%8F%A3%E5%A4%9A%E7%89%88%E6%9C%AC%E7%9A%84%E6%96%B9%E5%BC%8F"}},[n._v("有哪些控制接口多版本的方式？")])])])]),n._v(" "),s("li",[s("a",{attrs:{href:"#%E5%AE%9E%E7%8E%B0%E6%A1%88%E4%BE%8B"}},[n._v("实现案例")]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E8%87%AA%E5%AE%9A%E4%B9%89apiversion%E6%B3%A8%E8%A7%A3"}},[n._v("自定义@ApiVersion注解")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#%E5%AE%9A%E4%B9%89%E7%89%88%E6%9C%AC%E5%8C%B9%E9%85%8Drequestcondition"}},[n._v("定义版本匹配RequestCondition")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#%E5%AE%9A%E4%B9%89handlermapping"}},[n._v("定义HandlerMapping")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#%E9%85%8D%E7%BD%AE%E6%B3%A8%E5%86%8Chandlermapping"}},[n._v("配置注册HandlerMapping")])]),n._v(" "),s("li",[s("a",{attrs:{href:"#%E6%B5%8B%E8%AF%95%E8%BF%90%E8%A1%8C"}},[n._v("测试运行")])])])]),n._v(" "),s("li",[s("a",{attrs:{href:"#%E7%A4%BA%E4%BE%8B%E6%BA%90%E7%A0%81"}},[n._v("示例源码")])])])])]),n._v(" "),s("h1",{attrs:{id:"为什么接口会出现多个版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么接口会出现多个版本"}},[n._v("#")]),n._v(" 为什么接口会出现多个版本？")]),n._v(" "),s("hr"),n._v(" "),s("blockquote",[s("p",[n._v("为什么接口会出现多个版本？")])]),n._v(" "),s("p",[n._v("一般来说，Restful API接口是提供给其它模块，系统或是其他公司使用，不能随意频繁的变更。然而，需求和业务不断变化，接口和参数也会发生相应的变化。如果直接对原来的接口进行修改，势必会影响线其他系统的正常运行。这就必须对api 接口进行有效的版本控制。")]),n._v(" "),s("h3",{attrs:{id:"有哪些控制接口多版本的方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#有哪些控制接口多版本的方式"}},[n._v("#")]),n._v(" 有哪些控制接口多版本的方式？")]),n._v(" "),s("ul",[s("li",[s("p",[n._v("相同URL，用"),s("strong",[n._v("不同的版本参数")]),n._v("区分")]),n._v(" "),s("ul",[s("li",[s("code",[n._v("api.pdai.tech/user?version=v1")]),n._v(" 表示 v1版本的接口, 保持原有接口不动")]),n._v(" "),s("li",[s("code",[n._v("api.pdai.tech/user?version=v2")]),n._v(" 表示 v2版本的接口，更新新的接口")])])]),n._v(" "),s("li",[s("p",[n._v("区分"),s("strong",[n._v("不同的接口域名")]),n._v("，不同的版本有不同的子域名, 路由到不同的实例:")]),n._v(" "),s("ul",[s("li",[s("code",[n._v("v1.api.pdai.tech/user")]),n._v(" 表示 v1版本的接口, 保持原有接口不动, 路由到instance1")]),n._v(" "),s("li",[s("code",[n._v("v2.api.pdai.tech/user")]),n._v(" 表示 v2版本的接口，更新新的接口, 路由到instance2")])])]),n._v(" "),s("li",[s("p",[n._v("网关路由不同子目录到"),s("strong",[n._v("不同的实例")]),n._v("（不同package也可以）")]),n._v(" "),s("ul",[s("li",[s("code",[n._v("api.pdai.tech/v1/user")]),n._v(" 表示 v1版本的接口, 保持原有接口不动, 路由到instance1")]),n._v(" "),s("li",[s("code",[n._v("api.pdai.tech/v2/user")]),n._v(" 表示 v2版本的接口，更新新的接口, 路由到instance2")])])]),n._v(" "),s("li",[s("p",[s("strong",[n._v("同一实例")]),n._v("，用注解隔离不同版本控制")]),n._v(" "),s("ul",[s("li",[s("code",[n._v("api.pdai.tech/v1/user")]),n._v(' 表示 v1版本的接口, 保持原有接口不动，匹配@ApiVersion("1")的handlerMapping')]),n._v(" "),s("li",[s("code",[n._v("api.pdai.tech/v2/user")]),n._v(' 表示 v2版本的接口，更新新的接口，匹配@ApiVersion("2")的handlerMapping')])])])]),n._v(" "),s("p",[n._v("这里主要展示第四种单一实例中如何优雅的控制接口的版本。")]),n._v(" "),s("h1",{attrs:{id:"实现案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现案例"}},[n._v("#")]),n._v(" 实现案例")]),n._v(" "),s("hr"),n._v(" "),s("blockquote",[s("p",[n._v("这个例子基于SpringBoot封装了@ApiVersion注解方式控制接口版本。")])]),n._v(" "),s("h3",{attrs:{id:"自定义-apiversion注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义-apiversion注解"}},[n._v("#")]),n._v(" 自定义@ApiVersion注解")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("package tech.pdai.springboot.api.version.config.version;\n\nimport org.springframework.web.bind.annotation.Mapping;\n\nimport java.lang.annotation.*;\n\n@Target({ElementType.METHOD, ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Mapping\npublic @interface ApiVersion {\n    String value();\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br")])]),s("h3",{attrs:{id:"定义版本匹配requestcondition"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定义版本匹配requestcondition"}},[n._v("#")]),n._v(" 定义版本匹配RequestCondition")]),n._v(" "),s("p",[n._v("版本匹配支持三层版本")]),n._v(" "),s("ul",[s("li",[n._v("v1.1.1 （大版本.小版本.补丁版本）")]),n._v(" "),s("li",[n._v("v1.1 (等同于v1.1.0)")]),n._v(" "),s("li",[n._v("v1 （等同于v1.0.0)")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('package tech.pdai.springboot.api.version.config.version;\n\nimport lombok.Getter;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.web.servlet.mvc.condition.RequestCondition;\n\nimport javax.servlet.http.HttpServletRequest;\nimport java.util.Arrays;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.regex.Matcher;\nimport java.util.regex.Pattern;\n\n@Slf4j\npublic class ApiVersionCondition implements RequestCondition<ApiVersionCondition> {\n\n    /**\n     * support v1.1.1, v1.1, v1; three levels .\n     */\n    private static final Pattern VERSION_PREFIX_PATTERN_1 = Pattern.compile("/v\\\\d\\\\.\\\\d\\\\.\\\\d/");\n    private static final Pattern VERSION_PREFIX_PATTERN_2 = Pattern.compile("/v\\\\d\\\\.\\\\d/");\n    private static final Pattern VERSION_PREFIX_PATTERN_3 = Pattern.compile("/v\\\\d/");\n    private static final List<Pattern> VERSION_LIST = Collections.unmodifiableList(\n            Arrays.asList(VERSION_PREFIX_PATTERN_1, VERSION_PREFIX_PATTERN_2, VERSION_PREFIX_PATTERN_3)\n    );\n\n    @Getter\n    private final String apiVersion;\n\n    public ApiVersionCondition(String apiVersion) {\n        this.apiVersion = apiVersion;\n    }\n\n    /**\n     * method priority is higher then class.\n     *\n     * @param other other\n     * @return ApiVersionCondition\n     */\n    @Override\n    public ApiVersionCondition combine(ApiVersionCondition other) {\n        return new ApiVersionCondition(other.apiVersion);\n    }\n\n    @Override\n    public ApiVersionCondition getMatchingCondition(HttpServletRequest request) {\n        for (int vIndex = 0; vIndex < VERSION_LIST.size(); vIndex++) {\n            Matcher m = VERSION_LIST.get(vIndex).matcher(request.getRequestURI());\n            if (m.find()) {\n                String version = m.group(0).replace("/v", "").replace("/", "");\n                if (vIndex == 1) {\n                    version = version + ".0";\n                } else if (vIndex == 2) {\n                    version = version + ".0.0";\n                }\n                if (compareVersion(version, this.apiVersion) >= 0) {\n                    log.info("version={}, apiVersion={}", version, this.apiVersion);\n                    return this;\n                }\n            }\n        }\n        return null;\n    }\n\n    @Override\n    public int compareTo(ApiVersionCondition other, HttpServletRequest request) {\n        return compareVersion(other.getApiVersion(), this.apiVersion);\n    }\n\n    private int compareVersion(String version1, String version2) {\n        if (version1 == null || version2 == null) {\n            throw new RuntimeException("compareVersion error:illegal params.");\n        }\n        String[] versionArray1 = version1.split("\\\\.");\n        String[] versionArray2 = version2.split("\\\\.");\n        int idx = 0;\n        int minLength = Math.min(versionArray1.length, versionArray2.length);\n        int diff = 0;\n        while (idx < minLength\n                && (diff = versionArray1[idx].length() - versionArray2[idx].length()) == 0\n                && (diff = versionArray1[idx].compareTo(versionArray2[idx])) == 0) {\n            ++idx;\n        }\n        diff = (diff != 0) ? diff : versionArray1.length - versionArray2.length;\n        return diff;\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br"),s("span",{staticClass:"line-number"},[n._v("87")]),s("br")])]),s("h3",{attrs:{id:"定义handlermapping"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定义handlermapping"}},[n._v("#")]),n._v(" 定义HandlerMapping")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("package tech.pdai.springboot.api.version.config.version;\n\nimport org.springframework.core.annotation.AnnotationUtils;\nimport org.springframework.lang.NonNull;\nimport org.springframework.web.servlet.mvc.condition.RequestCondition;\nimport org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;\n\nimport java.lang.reflect.Method;\n\npublic class ApiVersionRequestMappingHandlerMapping extends RequestMappingHandlerMapping {\n\n    /**\n     * add @ApiVersion to controller class.\n     *\n     * @param handlerType handlerType\n     * @return RequestCondition\n     */\n    @Override\n    protected RequestCondition<?> getCustomTypeCondition(@NonNull Class<?> handlerType) {\n        ApiVersion apiVersion = AnnotationUtils.findAnnotation(handlerType, ApiVersion.class);\n        return null == apiVersion ? super.getCustomTypeCondition(handlerType) : new ApiVersionCondition(apiVersion.value());\n    }\n\n    /**\n     * add @ApiVersion to controller method.\n     *\n     * @param method method\n     * @return RequestCondition\n     */\n    @Override\n    protected RequestCondition<?> getCustomMethodCondition(@NonNull Method method) {\n        ApiVersion apiVersion = AnnotationUtils.findAnnotation(method, ApiVersion.class);\n        return null == apiVersion ? super.getCustomMethodCondition(method) : new ApiVersionCondition(apiVersion.value());\n    }\n\n}\n\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br")])]),s("h3",{attrs:{id:"配置注册handlermapping"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置注册handlermapping"}},[n._v("#")]),n._v(" 配置注册HandlerMapping")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("package tech.pdai.springboot.api.version.config.version;\n\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;\nimport org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;\n\n@Configuration\npublic class CustomWebMvcConfiguration extends WebMvcConfigurationSupport {\n\n    @Override\n    public RequestMappingHandlerMapping createRequestMappingHandlerMapping() {\n        return new ApiVersionRequestMappingHandlerMapping();\n    }\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br")])]),s("p",[n._v("或者实现WebMvcRegistrations的接口")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("@Configuration\n@RequiredArgsConstructor\npublic class WebConfig implements WebMvcConfigurer, WebMvcRegistrations {\n    //...\n\n    @Override\n    @NonNull\n    public RequestMappingHandlerMapping getRequestMappingHandlerMapping() {\n        return new ApiVersionRequestMappingHandlerMapping();\n    }\n\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br")])]),s("h3",{attrs:{id:"测试运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试运行"}},[n._v("#")]),n._v(" 测试运行")]),n._v(" "),s("p",[n._v("controller")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('package tech.pdai.springboot.api.version.controller;\n\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport tech.pdai.springboot.api.version.config.version.ApiVersion;\nimport tech.pdai.springboot.api.version.entity.User;\n\n/**\n * @author pdai\n */\n@RestController\n@RequestMapping("api/{v}/user")\npublic class UserController {\n\n    @RequestMapping("get")\n    public User getUser() {\n        return User.builder().age(18).name("pdai, default").build();\n    }\n\n    @ApiVersion("1.0.0")\n    @RequestMapping("get")\n    public User getUserV1() {\n        return User.builder().age(18).name("pdai, v1.0.0").build();\n    }\n\n    @ApiVersion("1.1.0")\n    @RequestMapping("get")\n    public User getUserV11() {\n        return User.builder().age(19).name("pdai, v1.1.0").build();\n    }\n\n    @ApiVersion("1.1.2")\n    @RequestMapping("get")\n    public User getUserV112() {\n        return User.builder().age(19).name("pdai2, v1.1.2").build();\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br")])]),s("p",[n._v("输出")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('http://localhost:8080/api/v1/user/get\n// {"name":"pdai, v1.0.0","age":18}\n\nhttp://localhost:8080/api/v1.1/user/get\n// {"name":"pdai, v1.1.0","age":19}\n\nhttp://localhost:8080/api/v1.1.1/user/get\n// {"name":"pdai, v1.1.0","age":19} 匹配比1.1.1小的中最大的一个版本号\n\nhttp://localhost:8080/api/v1.1.2/user/get\n// {"name":"pdai2, v1.1.2","age":19}\n\nhttp://localhost:8080/api/v1.2/user/get\n// {"name":"pdai2, v1.1.2","age":19} 匹配最大的版本号，v1.1.2\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br")])]),s("p",[n._v("这样，如果我们向另外一个模块提供v1版本的接口，新的需求中只变动了一个接口方法，这时候我们只需要增加一个接口添加版本号v1.1即可用v1.1版本访问所有接口。")]),n._v(" "),s("blockquote",[s("p",[n._v("此外，这种方式可能会导致v3版本接口没有发布，但是是可以通过v3访问接口的；这种情况下可以添加一些限制版本的逻辑，比如最大版本，版本集合等。")])]),n._v(" "),s("h1",{attrs:{id:"示例源码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例源码"}},[n._v("#")]),n._v(" 示例源码")]),n._v(" "),s("hr"),n._v(" "),s("p",[n._v("https://github.com/realpdai/tech-pdai-spring-demos")])])}),[],!1,null,null,null);s.default=i.exports}}]);