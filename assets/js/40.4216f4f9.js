(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{2536:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-1.20d339bd.png"},2537:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-2.8d56c25c.png"},2538:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-4.6eb7a9f2.png"},2539:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-5.20c1f046.png"},2540:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-6.8cd704c0.png"},2541:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-7.2850bed5.png"},2542:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-8.5c170c24.png"},2543:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-9.3c7048b1.png"},2544:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-11.c2599777.png"},2545:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-12.0eea325d.png"},2546:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-13.cbe8ba03.png"},2547:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-14.b90e2caf.png"},2548:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-15.626fa67d.png"},2549:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-16.454affad.png"},2550:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-17.0aa130fd.png"},281:function(s,a,n){s.exports=n.p+"assets/img/es-dsl-full-text-3.171aa7d2.png"},3943:function(s,a,n){"use strict";n.r(a);var t=n(7),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"es详解-查询-dsl查询之全文搜索详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#es详解-查询-dsl查询之全文搜索详解"}},[s._v("#")]),s._v(" ES详解 - 查询：DSL查询之全文搜索详解")]),s._v(" "),a("p",[s._v("=================================================")]),s._v(" "),a("blockquote",[a("p",[s._v("DSL查询极为常用的是对文本进行搜索，我们叫全文搜索，本文主要对全文搜索进行详解。@pdai")])]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#es%E8%AF%A6%E8%A7%A3---%E6%9F%A5%E8%AF%A2dsl%E6%9F%A5%E8%AF%A2%E4%B9%8B%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E8%AF%A6%E8%A7%A3"}},[s._v("ES详解 - 查询：DSL查询之全文搜索详解")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%E8%B0%88%E8%B0%88%E5%A6%82%E4%BD%95%E4%BB%8E%E5%AE%98%E7%BD%91%E5%AD%A6%E4%B9%A0"}},[s._v("写在前面:谈谈如何从官网学习")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#match%E7%B1%BB%E5%9E%8B"}},[s._v("Match类型")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#match-%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%AD%A5%E9%AA%A4"}},[s._v("match 查询的步骤")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#match%E5%A4%9A%E4%B8%AA%E8%AF%8D%E6%B7%B1%E5%85%A5"}},[s._v("match多个词深入")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E6%8E%A7%E5%88%B6match%E7%9A%84%E5%8C%B9%E9%85%8D%E7%B2%BE%E5%BA%A6"}},[s._v("控制match的匹配精度")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E5%85%B6%E5%AE%83match%E7%B1%BB%E5%9E%8B"}},[s._v("其它match类型")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#query-string%E7%B1%BB%E5%9E%8B"}},[s._v("query string类型")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#query_string"}},[s._v("query_string")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#query_string_simple"}},[s._v("query_string_simple")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#interval%E7%B1%BB%E5%9E%8B"}},[s._v("Interval类型")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"}},[s._v("参考文章")])])])])]),s._v(" "),a("h1",{attrs:{id:"写在前面-谈谈如何从官网学习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#写在前面-谈谈如何从官网学习"}},[s._v("#")]),s._v(" 写在前面:谈谈如何从官网学习")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("提示")]),s._v(" "),a("p",[s._v("很多读者在看官方文档学习时存在一个误区，以DSL中full text查询为例，其实内容是非常多的， 没有取舍/没重点去阅读， 要么需要花很多时间，要么头脑一片浆糊。所以这里重点谈谈我的理解。@pdai")]),s._v(" "),a("p",[s._v("一些理解：")]),s._v(" "),a("ul",[a("li",[s._v("第一点："),a("strong",[s._v("全局观")]),s._v("，即我们现在学习内容在整个体系的哪个位置？")])]),s._v(" "),a("p",[s._v("如下图，可以很方便的帮助你构筑这种体系")]),s._v(" "),a("p",[a("img",{attrs:{src:n(281),alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("第二点： "),a("strong",[s._v("分类别")]),s._v("，从上层理解，而不是本身")])]),s._v(" "),a("p",[s._v("比如Full text Query中，我们只需要把如下的那么多点分为3大类，你的体系能力会大大提升")]),s._v(" "),a("p",[a("img",{attrs:{src:n(2536),alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("第三点： "),a("strong",[s._v("知识点还是API")]),s._v("？ API类型的是可以查询的，只需要知道大致有哪些功能就可以了。")])]),s._v(" "),a("p",[a("img",{attrs:{src:n(2537),alt:""}})]),s._v(" "),a("h1",{attrs:{id:"match类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#match类型"}},[s._v("#")]),s._v(" Match类型")]),s._v(" "),a("hr"),s._v(" "),a("blockquote",[a("p",[s._v("第一类：match 类型")])]),s._v(" "),a("h3",{attrs:{id:"match-查询的步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#match-查询的步骤"}},[s._v("#")]),s._v(" match 查询的步骤")]),s._v(" "),a("p",[s._v("在"),a("a",{attrs:{href:"https://pdai.tech/md/db/nosql-es/elasticsearch-x-usage.html#%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2%EF%BC%9Amatch",target:"_blank",rel:"noopener noreferrer"}},[s._v("前文"),a("OutboundLink")],1),s._v("中我们已经介绍了match查询。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("准备一些数据")])])]),s._v(" "),a("p",[s._v("这里我们准备一些数据，通过实例看match 查询的步骤")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('PUT /test-dsl-match\n{ "settings": { "number_of_shards": 1 }} \n\nPOST /test-dsl-match/_bulk\n{ "index": { "_id": 1 }}\n{ "title": "The quick brown fox" }\n{ "index": { "_id": 2 }}\n{ "title": "The quick brown fox jumps over the lazy dog" }\n{ "index": { "_id": 3 }}\n{ "title": "The quick brown fox jumps over the quick dog" }\n{ "index": { "_id": 4 }}\n{ "title": "Brown fox brown dog" }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[a("strong",[s._v("查询数据")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n    "query": {\n        "match": {\n            "title": "QUICK!"\n        }\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("Elasticsearch 执行上面这个 match 查询的步骤是：")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("检查字段类型")]),s._v(" 。")])]),s._v(" "),a("p",[s._v("标题 title 字段是一个 string 类型（ analyzed ）已分析的全文字段，这意味着查询字符串本身也应该被分析。")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("strong",[s._v("分析查询字符串")]),s._v(" 。")])]),s._v(" "),a("p",[s._v("将查询的字符串 QUICK! 传入标准分析器中，输出的结果是单个项 quick 。因为只有一个单词项，所以 match 查询执行的是单个底层 term 查询。")]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[a("strong",[s._v("查找匹配文档")]),s._v(" 。")])]),s._v(" "),a("p",[s._v("用 term 查询在倒排索引中查找 quick 然后获取一组包含该项的文档，本例的结果是文档：1、2 和 3 。")]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[a("strong",[s._v("为每个文档评分")]),s._v(" 。")])]),s._v(" "),a("p",[s._v("用 term 查询计算每个文档相关度评分 _score ，这是种将词频（term frequency，即词 quick 在相关文档的 title 字段中出现的频率）和反向文档频率（inverse document frequency，即词 quick 在所有文档的 title 字段中出现的频率），以及字段的长度（即字段越短相关度越高）相结合的计算方式。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("验证结果")])])]),s._v(" "),a("p",[a("img",{attrs:{src:n(2538),alt:""}})]),s._v(" "),a("h3",{attrs:{id:"match多个词深入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#match多个词深入"}},[s._v("#")]),s._v(" match多个词深入")]),s._v(" "),a("p",[s._v("我们在上文中复合查询中已经使用了match多个词，比如“Quick pets”； 这里我们通过例子带你更深入理解match多个词")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("match多个词的本质")])])]),s._v(" "),a("p",[s._v('查询多个词"BROWN DOG!"')]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n    "query": {\n        "match": {\n            "title": "BROWN DOG"\n        }\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("img",{attrs:{src:n(2539),alt:""}})]),s._v(" "),a("p",[s._v('因为 match 查询必须查找两个词（ ["brown","dog"] ），它在内部实际上先执行两次 term 查询，然后将两次查询的结果合并作为最终结果输出。为了做到这点，它将两个 term 查询包入一个 bool 查询中，')]),s._v(" "),a("p",[s._v("所以上述查询的结果，和如下语句查询结果是等同的")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "bool": {\n      "should": [\n        {\n          "term": {\n            "title": "brown"\n          }\n        },\n        {\n          "term": {\n            "title": "dog"\n          }\n        }\n      ]\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[a("img",{attrs:{src:n(2540),alt:""}})]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("match多个词的逻辑")])])]),s._v(" "),a("p",[s._v("上面等同于should（任意一个满足），是因为 match还有一个operator参数，默认是or, 所以对应的是should。")]),s._v(" "),a("p",[s._v("所以上述查询也等同于")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "match": {\n      "title": {\n        "query": "BROWN DOG",\n        "operator": "or"\n      }\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("那么我们如果是需要and操作呢，即同时满足呢？")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "match": {\n      "title": {\n        "query": "BROWN DOG",\n        "operator": "and"\n      }\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("等同于")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "bool": {\n      "must": [\n        {\n          "term": {\n            "title": "brown"\n          }\n        },\n        {\n          "term": {\n            "title": "dog"\n          }\n        }\n      ]\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[a("img",{attrs:{src:n(2541),alt:""}})]),s._v(" "),a("h3",{attrs:{id:"控制match的匹配精度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#控制match的匹配精度"}},[s._v("#")]),s._v(" 控制match的匹配精度")]),s._v(" "),a("p",[s._v("如果用户给定 3 个查询词，想查找至少包含其中 2 个的文档，该如何处理？将 operator 操作符参数设置成 and 或者 or 都是不合适的。")]),s._v(" "),a("p",[s._v("match 查询支持 minimum_should_match 最小匹配参数，这让我们可以指定必须匹配的词项数用来表示一个文档是否相关。我们可以将其设置为某个具体数字，更常用的做法是将其设置为一个百分数，因为我们无法控制用户搜索时输入的单词数量：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "match": {\n      "title": {\n        "query":                "quick brown dog",\n        "minimum_should_match": "75%"\n      }\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("当给定百分比的时候， minimum_should_match 会做合适的事情：在之前三词项的示例中， 75% 会自动被截断成 66.6% ，即三个里面两个词。无论这个值设置成什么，至少包含一个词项的文档才会被认为是匹配的。")]),s._v(" "),a("p",[a("img",{attrs:{src:n(2542),alt:""}})]),s._v(" "),a("p",[s._v("当然也等同于")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "bool": {\n      "should": [\n        { "match": { "title": "quick" }},\n        { "match": { "title": "brown"   }},\n        { "match": { "title": "dog"   }}\n      ],\n      "minimum_should_match": 2 \n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[a("img",{attrs:{src:n(2543),alt:""}})]),s._v(" "),a("h3",{attrs:{id:"其它match类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其它match类型"}},[s._v("#")]),s._v(" 其它match类型")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("match_pharse")])])]),s._v(" "),a("p",[s._v("match_phrase在前文中我们已经有了解，我们再看下另外一个例子。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "match_phrase": {\n      "title": {\n        "query": "quick brown"\n      }\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("img",{attrs:{src:n(2544),alt:""}})]),s._v(" "),a("p",[s._v("很多人对它仍然有误解的，比如如下例子：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "match_phrase": {\n      "title": {\n        "query": "quick brown f"\n      }\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("这样的查询是查不出任何数据的，因为前文中我们知道了match本质上是对term组合，match_phrase本质是连续的term的查询，所以f并不是一个分词，不满足term查询，所以最终查不出任何内容了。")]),s._v(" "),a("p",[a("img",{attrs:{src:n(2545),alt:""}})]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("match_pharse_prefix")])])]),s._v(" "),a("p",[s._v("那有没有可以查询出"),a("code",[s._v("quick brown f")]),s._v("的方式呢？ELasticSearch在match_phrase基础上提供了一种可以查最后一个词项是前缀的方法，这样就可以查询"),a("code",[s._v("quick brown f")]),s._v("了")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "match_phrase_prefix": {\n      "title": {\n        "query": "quick brown f"\n      }\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("img",{attrs:{src:n(2546),alt:""}})]),s._v(" "),a("p",[s._v("(ps: prefix的意思不是整个text的开始匹配，而是最后一个词项满足term的prefix查询而已)")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("match_bool_prefix")])])]),s._v(" "),a("p",[s._v("除了match_phrase_prefix，ElasticSearch还提供了match_bool_prefix查询")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "match_bool_prefix": {\n      "title": {\n        "query": "quick brown f"\n      }\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("img",{attrs:{src:n(2547),alt:""}})]),s._v(" "),a("p",[s._v("它们两种方式有啥区别呢？match_bool_prefix本质上可以转换为：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "bool" : {\n      "should": [\n        { "term": { "title": "quick" }},\n        { "term": { "title": "brown" }},\n        { "prefix": { "title": "f"}}\n      ]\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("所以这样你就能理解，match_bool_prefix查询中的quick,brown,f是无序的。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("multi_match")])])]),s._v(" "),a("p",[s._v("如果我们期望一次对多个字段查询，怎么办呢？ElasticSearch提供了multi_match查询的方式")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('{\n  "query": {\n    "multi_match" : {\n      "query":    "Will Smith",\n      "fields": [ "title", "*_name" ] \n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("code",[s._v("*")]),s._v("表示前缀匹配字段。")]),s._v(" "),a("h1",{attrs:{id:"query-string类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#query-string类型"}},[s._v("#")]),s._v(" query string类型")]),s._v(" "),a("hr"),s._v(" "),a("blockquote",[a("p",[s._v("第二类：query string 类型")])]),s._v(" "),a("h3",{attrs:{id:"query-string"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#query-string"}},[s._v("#")]),s._v(" query_string")]),s._v(" "),a("p",[s._v("此查询使用语法根据运算符（例如AND或）来解析和拆分提供的查询字符串NOT。然后查询在返回匹配的文档之前独立分析每个拆分的文本。")]),s._v(" "),a("p",[s._v("可以使用该query_string查询创建一个复杂的搜索，其中包括通配符，跨多个字段的搜索等等。尽管用途广泛，但查询是严格的，如果查询字符串包含任何无效语法，则返回错误。")]),s._v(" "),a("p",[s._v("例如：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "query_string": {\n      "query": "(lazy dog) OR (brown dog)",\n      "default_field": "title"\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("这里查询结果，你需要理解本质上查询这四个分词（term）or的结果而已，所以doc 3和4也在其中")]),s._v(" "),a("p",[a("img",{attrs:{src:n(2548),alt:""}})]),s._v(" "),a("p",[s._v("对构筑知识体系已经够了，但是它其实还有很多参数和用法，更多请参考"),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网 在新窗口打开"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"query-string-simple"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#query-string-simple"}},[s._v("#")]),s._v(" query_string_simple")]),s._v(" "),a("p",[s._v("该查询使用一种简单的语法来解析提供的查询字符串并将其拆分为基于特殊运算符的术语。然后查询在返回匹配的文档之前独立分析每个术语。")]),s._v(" "),a("p",[s._v("尽管其语法比query_string查询更受限制 ，但"),a("strong",[s._v("simple_query_string 查询不会针对无效语法返回错误。而是，它将忽略查询字符串的任何无效部分")]),s._v("。")]),s._v(" "),a("p",[s._v("举例：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "simple_query_string" : {\n        "query": "\\"over the\\" + (lazy | quick) + dog",\n        "fields": ["title"],\n        "default_operator": "and"\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("img",{attrs:{src:n(2549),alt:""}})]),s._v(" "),a("p",[s._v("更多请参考"),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网 在新窗口打开"),a("OutboundLink")],1)]),s._v(" "),a("h1",{attrs:{id:"interval类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#interval类型"}},[s._v("#")]),s._v(" Interval类型")]),s._v(" "),a("hr"),s._v(" "),a("blockquote",[a("p",[s._v("第三类：interval类型")])]),s._v(" "),a("p",[s._v("Intervals是时间间隔的意思，本质上将多个规则按照顺序匹配。")]),s._v(" "),a("p",[s._v("比如：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GET /test-dsl-match/_search\n{\n  "query": {\n    "intervals" : {\n      "title" : {\n        "all_of" : {\n          "ordered" : true,\n          "intervals" : [\n            {\n              "match" : {\n                "query" : "quick",\n                "max_gaps" : 0,\n                "ordered" : true\n              }\n            },\n            {\n              "any_of" : {\n                "intervals" : [\n                  { "match" : { "query" : "jump over" } },\n                  { "match" : { "query" : "quick dog" } }\n                ]\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("p",[a("img",{attrs:{src:n(2550),alt:""}})]),s._v(" "),a("p",[s._v("因为interval之间是可以组合的，所以它可以表现的很复杂。更多请参考"),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-intervals-query.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网 在新窗口打开"),a("OutboundLink")],1)]),s._v(" "),a("h1",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("https://www.elastic.co/guide/en/elasticsearch/reference/current/full-text-queries.html#full-text-queries")]),s._v(" "),a("p",[s._v("https://www.elastic.co/guide/cn/elasticsearch/guide/current/match-multi-word.html)")])])}),[],!1,null,null,null);a.default=e.exports}}]);