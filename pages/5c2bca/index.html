<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis进阶 - 性能调优-Redis性能调优详解 | Fanx 知识库</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/logo.svg">[object Object]
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.6ece31e0.css" as="style"><link rel="preload" href="/assets/js/app.38fd400a.js" as="script"><link rel="preload" href="/assets/js/3.e11db813.js" as="script"><link rel="preload" href="/assets/js/149.cb6f2cb0.js" as="script"><link rel="prefetch" href="/assets/js/10.939e2dd4.js"><link rel="prefetch" href="/assets/js/100.4a08f581.js"><link rel="prefetch" href="/assets/js/101.45cd45c9.js"><link rel="prefetch" href="/assets/js/102.ac1359d1.js"><link rel="prefetch" href="/assets/js/103.22344102.js"><link rel="prefetch" href="/assets/js/104.5071cdfd.js"><link rel="prefetch" href="/assets/js/105.7767c121.js"><link rel="prefetch" href="/assets/js/106.809b79f1.js"><link rel="prefetch" href="/assets/js/107.62fd626a.js"><link rel="prefetch" href="/assets/js/108.0583fdc1.js"><link rel="prefetch" href="/assets/js/109.fa127771.js"><link rel="prefetch" href="/assets/js/11.6463adc8.js"><link rel="prefetch" href="/assets/js/110.5cf9f09c.js"><link rel="prefetch" href="/assets/js/111.9d963667.js"><link rel="prefetch" href="/assets/js/112.bc2b8a6e.js"><link rel="prefetch" href="/assets/js/113.2ae29573.js"><link rel="prefetch" href="/assets/js/114.0b2cedfa.js"><link rel="prefetch" href="/assets/js/115.652e433e.js"><link rel="prefetch" href="/assets/js/116.bcc5d64a.js"><link rel="prefetch" href="/assets/js/117.30b02d0d.js"><link rel="prefetch" href="/assets/js/118.87f4f927.js"><link rel="prefetch" href="/assets/js/119.05839492.js"><link rel="prefetch" href="/assets/js/12.a17960e5.js"><link rel="prefetch" href="/assets/js/120.3d772c9c.js"><link rel="prefetch" href="/assets/js/121.bd8fcebf.js"><link rel="prefetch" href="/assets/js/122.e58d2205.js"><link rel="prefetch" href="/assets/js/123.f2c2826d.js"><link rel="prefetch" href="/assets/js/124.12d9ff87.js"><link rel="prefetch" href="/assets/js/125.c7e4bf1c.js"><link rel="prefetch" href="/assets/js/126.71c358fb.js"><link rel="prefetch" href="/assets/js/127.fb1922e5.js"><link rel="prefetch" href="/assets/js/128.25cbf771.js"><link rel="prefetch" href="/assets/js/129.50047ea3.js"><link rel="prefetch" href="/assets/js/13.727ebfda.js"><link rel="prefetch" href="/assets/js/130.a77cfa28.js"><link rel="prefetch" href="/assets/js/131.1618c1f5.js"><link rel="prefetch" href="/assets/js/132.4073573b.js"><link rel="prefetch" href="/assets/js/133.f6e4882f.js"><link rel="prefetch" href="/assets/js/134.1de81973.js"><link rel="prefetch" href="/assets/js/135.43148a0c.js"><link rel="prefetch" href="/assets/js/136.12b3ef34.js"><link rel="prefetch" href="/assets/js/137.accefc34.js"><link rel="prefetch" href="/assets/js/138.8d3115ff.js"><link rel="prefetch" href="/assets/js/139.6e492e2b.js"><link rel="prefetch" href="/assets/js/14.bc6d3062.js"><link rel="prefetch" href="/assets/js/140.3d98f006.js"><link rel="prefetch" href="/assets/js/141.542d08af.js"><link rel="prefetch" href="/assets/js/142.c91a19a2.js"><link rel="prefetch" href="/assets/js/143.0c681ed2.js"><link rel="prefetch" href="/assets/js/144.62e9c646.js"><link rel="prefetch" href="/assets/js/145.ebc34777.js"><link rel="prefetch" href="/assets/js/146.d94a04a7.js"><link rel="prefetch" href="/assets/js/147.b45158de.js"><link rel="prefetch" href="/assets/js/148.5dfa6740.js"><link rel="prefetch" href="/assets/js/15.a9468bf1.js"><link rel="prefetch" href="/assets/js/150.9f58dbc6.js"><link rel="prefetch" href="/assets/js/151.0a1c07e3.js"><link rel="prefetch" href="/assets/js/152.eafe4843.js"><link rel="prefetch" href="/assets/js/153.fb94cab5.js"><link rel="prefetch" href="/assets/js/154.07f7a11d.js"><link rel="prefetch" href="/assets/js/155.7f6da40b.js"><link rel="prefetch" href="/assets/js/156.2f007ca1.js"><link rel="prefetch" href="/assets/js/157.a35b5249.js"><link rel="prefetch" href="/assets/js/158.540f7a5a.js"><link rel="prefetch" href="/assets/js/159.f62e0315.js"><link rel="prefetch" href="/assets/js/16.ace3b806.js"><link rel="prefetch" href="/assets/js/160.e043c758.js"><link rel="prefetch" href="/assets/js/161.d90141bf.js"><link rel="prefetch" href="/assets/js/162.ddcdbfb9.js"><link rel="prefetch" href="/assets/js/163.f1ba395e.js"><link rel="prefetch" href="/assets/js/164.9f398973.js"><link rel="prefetch" href="/assets/js/165.0db3da51.js"><link rel="prefetch" href="/assets/js/166.b5305797.js"><link rel="prefetch" href="/assets/js/167.e7b2f76b.js"><link rel="prefetch" href="/assets/js/168.a2ecf883.js"><link rel="prefetch" href="/assets/js/169.88bd4d26.js"><link rel="prefetch" href="/assets/js/17.60481837.js"><link rel="prefetch" href="/assets/js/170.fb1699e2.js"><link rel="prefetch" href="/assets/js/171.47268bef.js"><link rel="prefetch" href="/assets/js/172.79002327.js"><link rel="prefetch" href="/assets/js/173.3b1813fb.js"><link rel="prefetch" href="/assets/js/174.362811a9.js"><link rel="prefetch" href="/assets/js/175.bb48bcd7.js"><link rel="prefetch" href="/assets/js/176.97bbf32c.js"><link rel="prefetch" href="/assets/js/177.0717ff7a.js"><link rel="prefetch" href="/assets/js/178.75bff3b7.js"><link rel="prefetch" href="/assets/js/179.3e7db0a2.js"><link rel="prefetch" href="/assets/js/18.dd3c5709.js"><link rel="prefetch" href="/assets/js/180.c81da8dd.js"><link rel="prefetch" href="/assets/js/181.142d6d1c.js"><link rel="prefetch" href="/assets/js/182.fb312040.js"><link rel="prefetch" href="/assets/js/183.3684267e.js"><link rel="prefetch" href="/assets/js/184.ec2a13bc.js"><link rel="prefetch" href="/assets/js/185.a7acace4.js"><link rel="prefetch" href="/assets/js/186.7df28551.js"><link rel="prefetch" href="/assets/js/187.347e9348.js"><link rel="prefetch" href="/assets/js/188.07356026.js"><link rel="prefetch" href="/assets/js/189.0816176d.js"><link rel="prefetch" href="/assets/js/19.cc2d4ad1.js"><link rel="prefetch" href="/assets/js/190.fd5dd8cc.js"><link rel="prefetch" href="/assets/js/191.a938967e.js"><link rel="prefetch" href="/assets/js/192.859b71a1.js"><link rel="prefetch" href="/assets/js/193.adcf2ec3.js"><link rel="prefetch" href="/assets/js/194.69d1169c.js"><link rel="prefetch" href="/assets/js/195.ad7cbcc4.js"><link rel="prefetch" href="/assets/js/196.b65138da.js"><link rel="prefetch" href="/assets/js/197.b4fca73b.js"><link rel="prefetch" href="/assets/js/198.2494a23f.js"><link rel="prefetch" href="/assets/js/199.404b9ce1.js"><link rel="prefetch" href="/assets/js/2.938bab56.js"><link rel="prefetch" href="/assets/js/20.361e2bf6.js"><link rel="prefetch" href="/assets/js/200.42b54eae.js"><link rel="prefetch" href="/assets/js/201.ab495eb8.js"><link rel="prefetch" href="/assets/js/202.2cbc5c9a.js"><link rel="prefetch" href="/assets/js/203.abf3fde5.js"><link rel="prefetch" href="/assets/js/204.4fdd4cfb.js"><link rel="prefetch" href="/assets/js/205.411987d7.js"><link rel="prefetch" href="/assets/js/206.dbcab3ae.js"><link rel="prefetch" href="/assets/js/207.f1429354.js"><link rel="prefetch" href="/assets/js/208.f763286c.js"><link rel="prefetch" href="/assets/js/209.c1edbca5.js"><link rel="prefetch" href="/assets/js/21.ae1e88a3.js"><link rel="prefetch" href="/assets/js/210.b2a1501d.js"><link rel="prefetch" href="/assets/js/211.fe1fd5f7.js"><link rel="prefetch" href="/assets/js/212.0fd39a8f.js"><link rel="prefetch" href="/assets/js/213.bb3fc163.js"><link rel="prefetch" href="/assets/js/214.c42e1ef3.js"><link rel="prefetch" href="/assets/js/215.4f0fa915.js"><link rel="prefetch" href="/assets/js/216.07c485c9.js"><link rel="prefetch" href="/assets/js/217.ada25e7a.js"><link rel="prefetch" href="/assets/js/218.2f761d3c.js"><link rel="prefetch" href="/assets/js/219.32d1a663.js"><link rel="prefetch" href="/assets/js/22.0b09d67f.js"><link rel="prefetch" href="/assets/js/220.36c56cf4.js"><link rel="prefetch" href="/assets/js/221.3e0431e2.js"><link rel="prefetch" href="/assets/js/222.90aa0ff7.js"><link rel="prefetch" href="/assets/js/223.5966d7df.js"><link rel="prefetch" href="/assets/js/224.7e2329e1.js"><link rel="prefetch" href="/assets/js/225.2ed3675d.js"><link rel="prefetch" href="/assets/js/226.fa3cef02.js"><link rel="prefetch" href="/assets/js/227.07bf7bca.js"><link rel="prefetch" href="/assets/js/228.9ac2589a.js"><link rel="prefetch" href="/assets/js/229.b980e141.js"><link rel="prefetch" href="/assets/js/23.31ed5c2f.js"><link rel="prefetch" href="/assets/js/230.2c32e874.js"><link rel="prefetch" href="/assets/js/231.723e20cb.js"><link rel="prefetch" href="/assets/js/232.1f94511c.js"><link rel="prefetch" href="/assets/js/233.2d477f71.js"><link rel="prefetch" href="/assets/js/234.10141c75.js"><link rel="prefetch" href="/assets/js/235.a328b127.js"><link rel="prefetch" href="/assets/js/236.42419c3b.js"><link rel="prefetch" href="/assets/js/237.648ca44e.js"><link rel="prefetch" href="/assets/js/238.4b363b75.js"><link rel="prefetch" href="/assets/js/239.fe711a73.js"><link rel="prefetch" href="/assets/js/24.fe75e3fa.js"><link rel="prefetch" href="/assets/js/240.6baa12bf.js"><link rel="prefetch" href="/assets/js/241.6f375dc4.js"><link rel="prefetch" href="/assets/js/242.aee8e39d.js"><link rel="prefetch" href="/assets/js/243.bfc7f6e1.js"><link rel="prefetch" href="/assets/js/244.c73a14a7.js"><link rel="prefetch" href="/assets/js/245.a2352aa1.js"><link rel="prefetch" href="/assets/js/246.b12c3ae6.js"><link rel="prefetch" href="/assets/js/247.2f768275.js"><link rel="prefetch" href="/assets/js/248.3f79dfb1.js"><link rel="prefetch" href="/assets/js/249.7fd0cb75.js"><link rel="prefetch" href="/assets/js/25.f2e379df.js"><link rel="prefetch" href="/assets/js/250.df3f1d0a.js"><link rel="prefetch" href="/assets/js/251.a3865750.js"><link rel="prefetch" href="/assets/js/252.d62542df.js"><link rel="prefetch" href="/assets/js/253.59b2f200.js"><link rel="prefetch" href="/assets/js/254.522d17b5.js"><link rel="prefetch" href="/assets/js/255.0f95a196.js"><link rel="prefetch" href="/assets/js/256.31b37cbe.js"><link rel="prefetch" href="/assets/js/257.ff22ad12.js"><link rel="prefetch" href="/assets/js/258.15205e0b.js"><link rel="prefetch" href="/assets/js/259.f3b7c5aa.js"><link rel="prefetch" href="/assets/js/26.45264b04.js"><link rel="prefetch" href="/assets/js/260.fec3c7aa.js"><link rel="prefetch" href="/assets/js/261.d965ee56.js"><link rel="prefetch" href="/assets/js/262.76a7105b.js"><link rel="prefetch" href="/assets/js/263.e684cc46.js"><link rel="prefetch" href="/assets/js/264.59297da0.js"><link rel="prefetch" href="/assets/js/265.66182ed2.js"><link rel="prefetch" href="/assets/js/266.eec50d90.js"><link rel="prefetch" href="/assets/js/267.c85bce12.js"><link rel="prefetch" href="/assets/js/268.ef544f0c.js"><link rel="prefetch" href="/assets/js/269.8cfb5c6a.js"><link rel="prefetch" href="/assets/js/27.4e065810.js"><link rel="prefetch" href="/assets/js/270.b66cab3c.js"><link rel="prefetch" href="/assets/js/271.c1b7d136.js"><link rel="prefetch" href="/assets/js/272.0d7950c3.js"><link rel="prefetch" href="/assets/js/273.06349cca.js"><link rel="prefetch" href="/assets/js/274.9b442c09.js"><link rel="prefetch" href="/assets/js/275.11082d81.js"><link rel="prefetch" href="/assets/js/276.ce0abe31.js"><link rel="prefetch" href="/assets/js/277.4b7fcc53.js"><link rel="prefetch" href="/assets/js/278.129d0397.js"><link rel="prefetch" href="/assets/js/279.5c021f7c.js"><link rel="prefetch" href="/assets/js/28.126ecd33.js"><link rel="prefetch" href="/assets/js/280.d183c9e3.js"><link rel="prefetch" href="/assets/js/281.0df67750.js"><link rel="prefetch" href="/assets/js/282.8fdd2372.js"><link rel="prefetch" href="/assets/js/283.dae956df.js"><link rel="prefetch" href="/assets/js/284.c5dc7189.js"><link rel="prefetch" href="/assets/js/285.7f5a7367.js"><link rel="prefetch" href="/assets/js/286.d9bfcef5.js"><link rel="prefetch" href="/assets/js/287.4fa6a5c5.js"><link rel="prefetch" href="/assets/js/288.57904d2d.js"><link rel="prefetch" href="/assets/js/289.b96d7c2f.js"><link rel="prefetch" href="/assets/js/29.8f5db82a.js"><link rel="prefetch" href="/assets/js/290.8dda9646.js"><link rel="prefetch" href="/assets/js/291.ab433493.js"><link rel="prefetch" href="/assets/js/292.e2d59796.js"><link rel="prefetch" href="/assets/js/293.30f9fcc4.js"><link rel="prefetch" href="/assets/js/294.158492dc.js"><link rel="prefetch" href="/assets/js/295.33e3a53d.js"><link rel="prefetch" href="/assets/js/296.49d7a2de.js"><link rel="prefetch" href="/assets/js/297.1b7572ac.js"><link rel="prefetch" href="/assets/js/298.00e4586a.js"><link rel="prefetch" href="/assets/js/299.d8fb6ff9.js"><link rel="prefetch" href="/assets/js/30.ef97cb8e.js"><link rel="prefetch" href="/assets/js/300.90e9dadf.js"><link rel="prefetch" href="/assets/js/301.d5592ea1.js"><link rel="prefetch" href="/assets/js/302.b08dc1ea.js"><link rel="prefetch" href="/assets/js/303.bef541c8.js"><link rel="prefetch" href="/assets/js/304.be3f7081.js"><link rel="prefetch" href="/assets/js/305.13718421.js"><link rel="prefetch" href="/assets/js/306.41685aa2.js"><link rel="prefetch" href="/assets/js/307.6d569102.js"><link rel="prefetch" href="/assets/js/308.aaabab89.js"><link rel="prefetch" href="/assets/js/309.910ecc42.js"><link rel="prefetch" href="/assets/js/31.795b3334.js"><link rel="prefetch" href="/assets/js/310.104b7753.js"><link rel="prefetch" href="/assets/js/311.45f4a7da.js"><link rel="prefetch" href="/assets/js/312.180c7e45.js"><link rel="prefetch" href="/assets/js/313.87d3a801.js"><link rel="prefetch" href="/assets/js/314.7739b1ef.js"><link rel="prefetch" href="/assets/js/315.54a1fac0.js"><link rel="prefetch" href="/assets/js/316.a978a787.js"><link rel="prefetch" href="/assets/js/317.84f65f2c.js"><link rel="prefetch" href="/assets/js/318.7f8caff8.js"><link rel="prefetch" href="/assets/js/319.0b5276f3.js"><link rel="prefetch" href="/assets/js/32.e65c7229.js"><link rel="prefetch" href="/assets/js/320.ba90589a.js"><link rel="prefetch" href="/assets/js/321.b6810c5a.js"><link rel="prefetch" href="/assets/js/322.2eaa727d.js"><link rel="prefetch" href="/assets/js/323.17573ee3.js"><link rel="prefetch" href="/assets/js/324.806fd6ca.js"><link rel="prefetch" href="/assets/js/325.4cd65079.js"><link rel="prefetch" href="/assets/js/326.fe0e2e22.js"><link rel="prefetch" href="/assets/js/327.a64d0209.js"><link rel="prefetch" href="/assets/js/328.aca1c89a.js"><link rel="prefetch" href="/assets/js/329.53ccf1dd.js"><link rel="prefetch" href="/assets/js/33.9a57aab8.js"><link rel="prefetch" href="/assets/js/330.92822a09.js"><link rel="prefetch" href="/assets/js/331.6b82baff.js"><link rel="prefetch" href="/assets/js/332.fc20f585.js"><link rel="prefetch" href="/assets/js/333.005ba8e3.js"><link rel="prefetch" href="/assets/js/334.9d3309b8.js"><link rel="prefetch" href="/assets/js/335.0e938f19.js"><link rel="prefetch" href="/assets/js/336.01fe9903.js"><link rel="prefetch" href="/assets/js/337.e207d67c.js"><link rel="prefetch" href="/assets/js/338.bfcf6bc8.js"><link rel="prefetch" href="/assets/js/339.a502aa64.js"><link rel="prefetch" href="/assets/js/34.3835d35c.js"><link rel="prefetch" href="/assets/js/340.3888b147.js"><link rel="prefetch" href="/assets/js/341.20297f95.js"><link rel="prefetch" href="/assets/js/342.9cd149e9.js"><link rel="prefetch" href="/assets/js/343.faac8369.js"><link rel="prefetch" href="/assets/js/344.da8cd079.js"><link rel="prefetch" href="/assets/js/345.78303b88.js"><link rel="prefetch" href="/assets/js/346.d8eaca82.js"><link rel="prefetch" href="/assets/js/347.edd389a1.js"><link rel="prefetch" href="/assets/js/348.21ee9617.js"><link rel="prefetch" href="/assets/js/349.0251471a.js"><link rel="prefetch" href="/assets/js/35.76dc7096.js"><link rel="prefetch" href="/assets/js/350.710b7d30.js"><link rel="prefetch" href="/assets/js/351.535f8d60.js"><link rel="prefetch" href="/assets/js/352.c66fe42e.js"><link rel="prefetch" href="/assets/js/353.ebbcd333.js"><link rel="prefetch" href="/assets/js/354.7cbba2f1.js"><link rel="prefetch" href="/assets/js/355.0106db16.js"><link rel="prefetch" href="/assets/js/356.7debf350.js"><link rel="prefetch" href="/assets/js/357.a43eb887.js"><link rel="prefetch" href="/assets/js/358.28e5d2ed.js"><link rel="prefetch" href="/assets/js/359.956fc3b8.js"><link rel="prefetch" href="/assets/js/36.fc54452c.js"><link rel="prefetch" href="/assets/js/360.13fb600a.js"><link rel="prefetch" href="/assets/js/361.d100f85b.js"><link rel="prefetch" href="/assets/js/362.35277df2.js"><link rel="prefetch" href="/assets/js/363.d993a7fc.js"><link rel="prefetch" href="/assets/js/364.0168c2b0.js"><link rel="prefetch" href="/assets/js/365.bc8af0bb.js"><link rel="prefetch" href="/assets/js/366.2645dc0d.js"><link rel="prefetch" href="/assets/js/367.87368acb.js"><link rel="prefetch" href="/assets/js/368.0b7d41fc.js"><link rel="prefetch" href="/assets/js/369.4bf3f46e.js"><link rel="prefetch" href="/assets/js/37.5a47cee9.js"><link rel="prefetch" href="/assets/js/370.ea5f965e.js"><link rel="prefetch" href="/assets/js/371.1af764ef.js"><link rel="prefetch" href="/assets/js/372.bf6c68e2.js"><link rel="prefetch" href="/assets/js/373.1a605cc8.js"><link rel="prefetch" href="/assets/js/374.34a41a4a.js"><link rel="prefetch" href="/assets/js/375.1d2d3776.js"><link rel="prefetch" href="/assets/js/376.4b7b0b10.js"><link rel="prefetch" href="/assets/js/377.b3d9748a.js"><link rel="prefetch" href="/assets/js/378.7f00fa88.js"><link rel="prefetch" href="/assets/js/379.adcd298a.js"><link rel="prefetch" href="/assets/js/38.6614c565.js"><link rel="prefetch" href="/assets/js/380.6d08bb56.js"><link rel="prefetch" href="/assets/js/381.164bb4e3.js"><link rel="prefetch" href="/assets/js/382.f71f0ca4.js"><link rel="prefetch" href="/assets/js/383.01ba70ad.js"><link rel="prefetch" href="/assets/js/384.22b98cde.js"><link rel="prefetch" href="/assets/js/385.5f1298a9.js"><link rel="prefetch" href="/assets/js/386.01a912bc.js"><link rel="prefetch" href="/assets/js/387.3db4713f.js"><link rel="prefetch" href="/assets/js/388.4cde7d0f.js"><link rel="prefetch" href="/assets/js/389.d96bafad.js"><link rel="prefetch" href="/assets/js/39.1a09ed15.js"><link rel="prefetch" href="/assets/js/390.343bbc06.js"><link rel="prefetch" href="/assets/js/391.68b3e72a.js"><link rel="prefetch" href="/assets/js/392.f4f15e43.js"><link rel="prefetch" href="/assets/js/393.82475934.js"><link rel="prefetch" href="/assets/js/394.3101ea10.js"><link rel="prefetch" href="/assets/js/395.34083342.js"><link rel="prefetch" href="/assets/js/396.780d6efe.js"><link rel="prefetch" href="/assets/js/397.cb686f39.js"><link rel="prefetch" href="/assets/js/398.c4ad669f.js"><link rel="prefetch" href="/assets/js/399.ee8d28ad.js"><link rel="prefetch" href="/assets/js/4.c1dcb1a7.js"><link rel="prefetch" href="/assets/js/40.4216f4f9.js"><link rel="prefetch" href="/assets/js/400.23d48a38.js"><link rel="prefetch" href="/assets/js/401.319d7a68.js"><link rel="prefetch" href="/assets/js/402.25b27bd0.js"><link rel="prefetch" href="/assets/js/403.9a898a40.js"><link rel="prefetch" href="/assets/js/404.e3b49b79.js"><link rel="prefetch" href="/assets/js/405.7695b9f1.js"><link rel="prefetch" href="/assets/js/406.edb801f7.js"><link rel="prefetch" href="/assets/js/407.03c3f725.js"><link rel="prefetch" href="/assets/js/408.4345ef1f.js"><link rel="prefetch" href="/assets/js/409.77c34447.js"><link rel="prefetch" href="/assets/js/41.f035663a.js"><link rel="prefetch" href="/assets/js/410.7f6c0744.js"><link rel="prefetch" href="/assets/js/411.cb19323e.js"><link rel="prefetch" href="/assets/js/412.4b16959d.js"><link rel="prefetch" href="/assets/js/413.ff4f1ca2.js"><link rel="prefetch" href="/assets/js/414.b1ca1298.js"><link rel="prefetch" href="/assets/js/415.c2111593.js"><link rel="prefetch" href="/assets/js/416.a6d18039.js"><link rel="prefetch" href="/assets/js/417.dc36c66d.js"><link rel="prefetch" href="/assets/js/418.e7eba879.js"><link rel="prefetch" href="/assets/js/419.57673b9e.js"><link rel="prefetch" href="/assets/js/42.9c8cf569.js"><link rel="prefetch" href="/assets/js/420.ccd41fe0.js"><link rel="prefetch" href="/assets/js/421.ea69f0b0.js"><link rel="prefetch" href="/assets/js/422.093448e2.js"><link rel="prefetch" href="/assets/js/423.ae003f31.js"><link rel="prefetch" href="/assets/js/424.f670cd2b.js"><link rel="prefetch" href="/assets/js/425.6e814335.js"><link rel="prefetch" href="/assets/js/426.faf45206.js"><link rel="prefetch" href="/assets/js/427.cf6be942.js"><link rel="prefetch" href="/assets/js/428.9ff6199c.js"><link rel="prefetch" href="/assets/js/429.b6ef4678.js"><link rel="prefetch" href="/assets/js/43.717fe06b.js"><link rel="prefetch" href="/assets/js/430.e9575d07.js"><link rel="prefetch" href="/assets/js/431.8bf26a3e.js"><link rel="prefetch" href="/assets/js/432.5eaa2162.js"><link rel="prefetch" href="/assets/js/433.6dab12a1.js"><link rel="prefetch" href="/assets/js/434.fca918e8.js"><link rel="prefetch" href="/assets/js/435.4c8f9ad9.js"><link rel="prefetch" href="/assets/js/436.0f0de1a8.js"><link rel="prefetch" href="/assets/js/437.2221ab9f.js"><link rel="prefetch" href="/assets/js/438.37f28cfb.js"><link rel="prefetch" href="/assets/js/439.1e3f3611.js"><link rel="prefetch" href="/assets/js/44.705dc411.js"><link rel="prefetch" href="/assets/js/440.28ab35e8.js"><link rel="prefetch" href="/assets/js/441.8d006af8.js"><link rel="prefetch" href="/assets/js/442.2618a6e3.js"><link rel="prefetch" href="/assets/js/443.a7723674.js"><link rel="prefetch" href="/assets/js/444.18f23e7c.js"><link rel="prefetch" href="/assets/js/445.f4807c5a.js"><link rel="prefetch" href="/assets/js/446.77a5afc2.js"><link rel="prefetch" href="/assets/js/447.7f653483.js"><link rel="prefetch" href="/assets/js/448.1143c566.js"><link rel="prefetch" href="/assets/js/449.b788a288.js"><link rel="prefetch" href="/assets/js/45.6a225373.js"><link rel="prefetch" href="/assets/js/450.b6463ba3.js"><link rel="prefetch" href="/assets/js/451.fd4d46b9.js"><link rel="prefetch" href="/assets/js/452.e8de4fc2.js"><link rel="prefetch" href="/assets/js/453.4125e5e6.js"><link rel="prefetch" href="/assets/js/454.30af5d0a.js"><link rel="prefetch" href="/assets/js/455.9c919e58.js"><link rel="prefetch" href="/assets/js/456.22dbfa8f.js"><link rel="prefetch" href="/assets/js/457.e9c5248a.js"><link rel="prefetch" href="/assets/js/458.c0a9cf1d.js"><link rel="prefetch" href="/assets/js/459.b5e96042.js"><link rel="prefetch" href="/assets/js/46.515d085a.js"><link rel="prefetch" href="/assets/js/460.b4097efb.js"><link rel="prefetch" href="/assets/js/461.5d545741.js"><link rel="prefetch" href="/assets/js/462.402d4cdd.js"><link rel="prefetch" href="/assets/js/463.e6d6ea07.js"><link rel="prefetch" href="/assets/js/464.df817445.js"><link rel="prefetch" href="/assets/js/465.18a6bc2b.js"><link rel="prefetch" href="/assets/js/466.da313c0c.js"><link rel="prefetch" href="/assets/js/467.41294182.js"><link rel="prefetch" href="/assets/js/468.41c59467.js"><link rel="prefetch" href="/assets/js/469.d55da13c.js"><link rel="prefetch" href="/assets/js/47.a41193df.js"><link rel="prefetch" href="/assets/js/470.7457a92e.js"><link rel="prefetch" href="/assets/js/471.ed739bdf.js"><link rel="prefetch" href="/assets/js/472.83882459.js"><link rel="prefetch" href="/assets/js/473.fe2df51c.js"><link rel="prefetch" href="/assets/js/474.d40797b8.js"><link rel="prefetch" href="/assets/js/475.a00992a2.js"><link rel="prefetch" href="/assets/js/476.c7687189.js"><link rel="prefetch" href="/assets/js/477.fd4fd227.js"><link rel="prefetch" href="/assets/js/478.1ae08c3b.js"><link rel="prefetch" href="/assets/js/479.04a246c6.js"><link rel="prefetch" href="/assets/js/48.fe693306.js"><link rel="prefetch" href="/assets/js/480.36acb4ff.js"><link rel="prefetch" href="/assets/js/481.05d3129e.js"><link rel="prefetch" href="/assets/js/482.1741a02c.js"><link rel="prefetch" href="/assets/js/483.44cf2d25.js"><link rel="prefetch" href="/assets/js/484.9c14e5c6.js"><link rel="prefetch" href="/assets/js/485.ea0c1de1.js"><link rel="prefetch" href="/assets/js/486.8c683697.js"><link rel="prefetch" href="/assets/js/487.8b1eb604.js"><link rel="prefetch" href="/assets/js/488.ae16fca6.js"><link rel="prefetch" href="/assets/js/489.7f674a0d.js"><link rel="prefetch" href="/assets/js/49.a7d05a3d.js"><link rel="prefetch" href="/assets/js/490.52983854.js"><link rel="prefetch" href="/assets/js/491.968e7af4.js"><link rel="prefetch" href="/assets/js/492.e7f58bac.js"><link rel="prefetch" href="/assets/js/493.55afbb68.js"><link rel="prefetch" href="/assets/js/494.ac17d05b.js"><link rel="prefetch" href="/assets/js/495.d1ca2a12.js"><link rel="prefetch" href="/assets/js/496.d6841a0e.js"><link rel="prefetch" href="/assets/js/497.99431b4b.js"><link rel="prefetch" href="/assets/js/498.cacac1d8.js"><link rel="prefetch" href="/assets/js/499.c6b7fab0.js"><link rel="prefetch" href="/assets/js/5.f74a04c4.js"><link rel="prefetch" href="/assets/js/50.f59b29ea.js"><link rel="prefetch" href="/assets/js/500.abba24c7.js"><link rel="prefetch" href="/assets/js/501.e9496674.js"><link rel="prefetch" href="/assets/js/502.3ece0e86.js"><link rel="prefetch" href="/assets/js/503.974421d1.js"><link rel="prefetch" href="/assets/js/504.6e8d8539.js"><link rel="prefetch" href="/assets/js/505.b8161483.js"><link rel="prefetch" href="/assets/js/506.a6a6f2de.js"><link rel="prefetch" href="/assets/js/507.9c6955ee.js"><link rel="prefetch" href="/assets/js/508.223e145d.js"><link rel="prefetch" href="/assets/js/509.553e6f2c.js"><link rel="prefetch" href="/assets/js/51.428c5495.js"><link rel="prefetch" href="/assets/js/510.46e2eab7.js"><link rel="prefetch" href="/assets/js/511.24962b3f.js"><link rel="prefetch" href="/assets/js/512.a29fe236.js"><link rel="prefetch" href="/assets/js/513.8729b339.js"><link rel="prefetch" href="/assets/js/514.41199019.js"><link rel="prefetch" href="/assets/js/515.b1a71e99.js"><link rel="prefetch" href="/assets/js/516.001e3634.js"><link rel="prefetch" href="/assets/js/517.4de05581.js"><link rel="prefetch" href="/assets/js/518.57697c31.js"><link rel="prefetch" href="/assets/js/519.e962365e.js"><link rel="prefetch" href="/assets/js/52.c97c3911.js"><link rel="prefetch" href="/assets/js/520.e7775961.js"><link rel="prefetch" href="/assets/js/521.05b0ce57.js"><link rel="prefetch" href="/assets/js/522.49f7412e.js"><link rel="prefetch" href="/assets/js/523.b3d821b2.js"><link rel="prefetch" href="/assets/js/524.ab2395b7.js"><link rel="prefetch" href="/assets/js/525.25559bb4.js"><link rel="prefetch" href="/assets/js/526.23111d2a.js"><link rel="prefetch" href="/assets/js/527.c61f6e86.js"><link rel="prefetch" href="/assets/js/528.032fa7b6.js"><link rel="prefetch" href="/assets/js/529.3953f346.js"><link rel="prefetch" href="/assets/js/53.77f22b1a.js"><link rel="prefetch" href="/assets/js/530.b882066e.js"><link rel="prefetch" href="/assets/js/531.62dddf23.js"><link rel="prefetch" href="/assets/js/532.1826fe1a.js"><link rel="prefetch" href="/assets/js/533.a2e014bb.js"><link rel="prefetch" href="/assets/js/534.d5d89c00.js"><link rel="prefetch" href="/assets/js/535.4e5d7739.js"><link rel="prefetch" href="/assets/js/536.f2c700db.js"><link rel="prefetch" href="/assets/js/537.80aa278c.js"><link rel="prefetch" href="/assets/js/538.95e2f471.js"><link rel="prefetch" href="/assets/js/539.4e4ecfe8.js"><link rel="prefetch" href="/assets/js/54.d85b2f2e.js"><link rel="prefetch" href="/assets/js/540.00bd44e5.js"><link rel="prefetch" href="/assets/js/541.d740df14.js"><link rel="prefetch" href="/assets/js/542.5aadeaee.js"><link rel="prefetch" href="/assets/js/543.d42c9d9a.js"><link rel="prefetch" href="/assets/js/544.29704685.js"><link rel="prefetch" href="/assets/js/545.7fdb1a83.js"><link rel="prefetch" href="/assets/js/546.6b5655ea.js"><link rel="prefetch" href="/assets/js/547.c98e27c4.js"><link rel="prefetch" href="/assets/js/548.8edec06f.js"><link rel="prefetch" href="/assets/js/549.33b8eae3.js"><link rel="prefetch" href="/assets/js/55.80a4fa71.js"><link rel="prefetch" href="/assets/js/550.cb706b0e.js"><link rel="prefetch" href="/assets/js/551.79598cc6.js"><link rel="prefetch" href="/assets/js/552.69aa5f8b.js"><link rel="prefetch" href="/assets/js/553.7ccb8831.js"><link rel="prefetch" href="/assets/js/554.954013b2.js"><link rel="prefetch" href="/assets/js/555.960d7f8b.js"><link rel="prefetch" href="/assets/js/556.5c054c14.js"><link rel="prefetch" href="/assets/js/557.890045ea.js"><link rel="prefetch" href="/assets/js/558.f72f6668.js"><link rel="prefetch" href="/assets/js/559.452d8ff3.js"><link rel="prefetch" href="/assets/js/56.009b0340.js"><link rel="prefetch" href="/assets/js/560.1656e33f.js"><link rel="prefetch" href="/assets/js/561.bb4650eb.js"><link rel="prefetch" href="/assets/js/562.7322fd81.js"><link rel="prefetch" href="/assets/js/563.a34a68ea.js"><link rel="prefetch" href="/assets/js/564.6da92e18.js"><link rel="prefetch" href="/assets/js/565.01d288e5.js"><link rel="prefetch" href="/assets/js/566.6a3459a1.js"><link rel="prefetch" href="/assets/js/567.e3eb8e54.js"><link rel="prefetch" href="/assets/js/568.f95e0fba.js"><link rel="prefetch" href="/assets/js/569.a42d134c.js"><link rel="prefetch" href="/assets/js/57.25e8dd1c.js"><link rel="prefetch" href="/assets/js/570.87887d15.js"><link rel="prefetch" href="/assets/js/571.ce4b478b.js"><link rel="prefetch" href="/assets/js/572.634418a6.js"><link rel="prefetch" href="/assets/js/573.cd4cf02b.js"><link rel="prefetch" href="/assets/js/574.8bf073fa.js"><link rel="prefetch" href="/assets/js/575.c194dddb.js"><link rel="prefetch" href="/assets/js/576.7750193f.js"><link rel="prefetch" href="/assets/js/577.5daa388a.js"><link rel="prefetch" href="/assets/js/578.54bb0029.js"><link rel="prefetch" href="/assets/js/579.92f58c76.js"><link rel="prefetch" href="/assets/js/58.9c1eb9e5.js"><link rel="prefetch" href="/assets/js/580.0e543efb.js"><link rel="prefetch" href="/assets/js/581.4e0b0b47.js"><link rel="prefetch" href="/assets/js/582.8c172f83.js"><link rel="prefetch" href="/assets/js/583.c91c43e0.js"><link rel="prefetch" href="/assets/js/584.ca68d52b.js"><link rel="prefetch" href="/assets/js/585.663b17d3.js"><link rel="prefetch" href="/assets/js/586.9494847d.js"><link rel="prefetch" href="/assets/js/587.f3805773.js"><link rel="prefetch" href="/assets/js/588.8ae14be1.js"><link rel="prefetch" href="/assets/js/589.b4af88be.js"><link rel="prefetch" href="/assets/js/59.2a730e41.js"><link rel="prefetch" href="/assets/js/590.fb77fea8.js"><link rel="prefetch" href="/assets/js/591.a3aaa57c.js"><link rel="prefetch" href="/assets/js/592.54ec5f32.js"><link rel="prefetch" href="/assets/js/593.96eab5cb.js"><link rel="prefetch" href="/assets/js/594.e356725c.js"><link rel="prefetch" href="/assets/js/595.0a2c4ad4.js"><link rel="prefetch" href="/assets/js/596.2c075cd8.js"><link rel="prefetch" href="/assets/js/597.e904811b.js"><link rel="prefetch" href="/assets/js/598.f6ca8b71.js"><link rel="prefetch" href="/assets/js/599.ae3d12c4.js"><link rel="prefetch" href="/assets/js/6.451e012f.js"><link rel="prefetch" href="/assets/js/60.e6b60343.js"><link rel="prefetch" href="/assets/js/600.e71a0062.js"><link rel="prefetch" href="/assets/js/601.2571a19d.js"><link rel="prefetch" href="/assets/js/602.0f4fa961.js"><link rel="prefetch" href="/assets/js/603.d8387c37.js"><link rel="prefetch" href="/assets/js/604.69433906.js"><link rel="prefetch" href="/assets/js/605.1bc7d87a.js"><link rel="prefetch" href="/assets/js/606.ec419517.js"><link rel="prefetch" href="/assets/js/607.b473fb0b.js"><link rel="prefetch" href="/assets/js/608.a361b48c.js"><link rel="prefetch" href="/assets/js/609.9186f226.js"><link rel="prefetch" href="/assets/js/61.d50a156d.js"><link rel="prefetch" href="/assets/js/610.ff3cf241.js"><link rel="prefetch" href="/assets/js/611.c3c7e648.js"><link rel="prefetch" href="/assets/js/612.2a520ebd.js"><link rel="prefetch" href="/assets/js/613.42936ffc.js"><link rel="prefetch" href="/assets/js/614.3ca0de21.js"><link rel="prefetch" href="/assets/js/615.ecf60a47.js"><link rel="prefetch" href="/assets/js/616.17185e83.js"><link rel="prefetch" href="/assets/js/617.769d4cdf.js"><link rel="prefetch" href="/assets/js/618.015c6376.js"><link rel="prefetch" href="/assets/js/619.3af186d0.js"><link rel="prefetch" href="/assets/js/62.e24b7811.js"><link rel="prefetch" href="/assets/js/620.f8ff3784.js"><link rel="prefetch" href="/assets/js/621.4c21311f.js"><link rel="prefetch" href="/assets/js/622.355178df.js"><link rel="prefetch" href="/assets/js/623.45a30695.js"><link rel="prefetch" href="/assets/js/624.61e89d34.js"><link rel="prefetch" href="/assets/js/625.49e0d1ce.js"><link rel="prefetch" href="/assets/js/626.1b7ae767.js"><link rel="prefetch" href="/assets/js/627.b8c507cf.js"><link rel="prefetch" href="/assets/js/628.c5a43517.js"><link rel="prefetch" href="/assets/js/629.274eb0fd.js"><link rel="prefetch" href="/assets/js/63.b804baab.js"><link rel="prefetch" href="/assets/js/630.69e055ce.js"><link rel="prefetch" href="/assets/js/631.0892fc51.js"><link rel="prefetch" href="/assets/js/632.6a68e9a2.js"><link rel="prefetch" href="/assets/js/633.d536fe74.js"><link rel="prefetch" href="/assets/js/634.24695f39.js"><link rel="prefetch" href="/assets/js/635.3aeede9c.js"><link rel="prefetch" href="/assets/js/636.3628d8a6.js"><link rel="prefetch" href="/assets/js/637.40af5a79.js"><link rel="prefetch" href="/assets/js/638.15e257ae.js"><link rel="prefetch" href="/assets/js/639.31e6597c.js"><link rel="prefetch" href="/assets/js/64.eb5699ff.js"><link rel="prefetch" href="/assets/js/640.a071f6df.js"><link rel="prefetch" href="/assets/js/641.f9edd7bf.js"><link rel="prefetch" href="/assets/js/642.adcb583f.js"><link rel="prefetch" href="/assets/js/643.7c98a990.js"><link rel="prefetch" href="/assets/js/644.fb1213d8.js"><link rel="prefetch" href="/assets/js/645.220a5034.js"><link rel="prefetch" href="/assets/js/646.d66a419b.js"><link rel="prefetch" href="/assets/js/647.12ef89ab.js"><link rel="prefetch" href="/assets/js/648.a3112300.js"><link rel="prefetch" href="/assets/js/649.f457dfa5.js"><link rel="prefetch" href="/assets/js/65.0d8501b5.js"><link rel="prefetch" href="/assets/js/650.cc63d03b.js"><link rel="prefetch" href="/assets/js/651.16d1bbd6.js"><link rel="prefetch" href="/assets/js/652.0f5343f0.js"><link rel="prefetch" href="/assets/js/653.28f7710a.js"><link rel="prefetch" href="/assets/js/654.b343d473.js"><link rel="prefetch" href="/assets/js/655.215fe67b.js"><link rel="prefetch" href="/assets/js/656.79aa1653.js"><link rel="prefetch" href="/assets/js/657.c57f2b5c.js"><link rel="prefetch" href="/assets/js/658.d0aa0b95.js"><link rel="prefetch" href="/assets/js/659.2dfaed93.js"><link rel="prefetch" href="/assets/js/66.8361cc16.js"><link rel="prefetch" href="/assets/js/660.c00b347e.js"><link rel="prefetch" href="/assets/js/661.ecc4f968.js"><link rel="prefetch" href="/assets/js/662.06f83919.js"><link rel="prefetch" href="/assets/js/663.67d8849e.js"><link rel="prefetch" href="/assets/js/664.74dba1a9.js"><link rel="prefetch" href="/assets/js/665.28b450f0.js"><link rel="prefetch" href="/assets/js/666.0f4bb6ba.js"><link rel="prefetch" href="/assets/js/667.586074e3.js"><link rel="prefetch" href="/assets/js/668.b13c0e70.js"><link rel="prefetch" href="/assets/js/669.9d0d4cbc.js"><link rel="prefetch" href="/assets/js/67.37f46ba2.js"><link rel="prefetch" href="/assets/js/670.6b36ca72.js"><link rel="prefetch" href="/assets/js/671.33b2e754.js"><link rel="prefetch" href="/assets/js/672.3b02c287.js"><link rel="prefetch" href="/assets/js/673.3f274929.js"><link rel="prefetch" href="/assets/js/674.7d75584f.js"><link rel="prefetch" href="/assets/js/675.0de52334.js"><link rel="prefetch" href="/assets/js/676.6734133e.js"><link rel="prefetch" href="/assets/js/677.c6f4a973.js"><link rel="prefetch" href="/assets/js/678.1344b6be.js"><link rel="prefetch" href="/assets/js/679.23fed56f.js"><link rel="prefetch" href="/assets/js/68.27dbce5b.js"><link rel="prefetch" href="/assets/js/680.c49329d6.js"><link rel="prefetch" href="/assets/js/681.8df66615.js"><link rel="prefetch" href="/assets/js/682.77b4bff8.js"><link rel="prefetch" href="/assets/js/683.6cf41cf4.js"><link rel="prefetch" href="/assets/js/684.58deecd5.js"><link rel="prefetch" href="/assets/js/685.d2f7480e.js"><link rel="prefetch" href="/assets/js/686.0b77a241.js"><link rel="prefetch" href="/assets/js/687.2cc04b4f.js"><link rel="prefetch" href="/assets/js/688.da24cbae.js"><link rel="prefetch" href="/assets/js/689.a9961f74.js"><link rel="prefetch" href="/assets/js/69.8052a977.js"><link rel="prefetch" href="/assets/js/690.cb736269.js"><link rel="prefetch" href="/assets/js/691.21c13be1.js"><link rel="prefetch" href="/assets/js/692.3ed557d0.js"><link rel="prefetch" href="/assets/js/693.066efe93.js"><link rel="prefetch" href="/assets/js/694.5368f98a.js"><link rel="prefetch" href="/assets/js/695.4fdb93d5.js"><link rel="prefetch" href="/assets/js/696.9c055ac6.js"><link rel="prefetch" href="/assets/js/697.51e0c47c.js"><link rel="prefetch" href="/assets/js/698.08ca1dbd.js"><link rel="prefetch" href="/assets/js/699.ce7e9e2a.js"><link rel="prefetch" href="/assets/js/7.7e21c947.js"><link rel="prefetch" href="/assets/js/70.19faeb78.js"><link rel="prefetch" href="/assets/js/700.3676fa7f.js"><link rel="prefetch" href="/assets/js/701.82db4887.js"><link rel="prefetch" href="/assets/js/702.73425f22.js"><link rel="prefetch" href="/assets/js/703.d9391c74.js"><link rel="prefetch" href="/assets/js/704.d6e275cf.js"><link rel="prefetch" href="/assets/js/705.d2f23969.js"><link rel="prefetch" href="/assets/js/706.1c66dcc1.js"><link rel="prefetch" href="/assets/js/707.0fc5a26a.js"><link rel="prefetch" href="/assets/js/708.97471ee6.js"><link rel="prefetch" href="/assets/js/709.9b4d5665.js"><link rel="prefetch" href="/assets/js/71.d1683810.js"><link rel="prefetch" href="/assets/js/710.75fa8103.js"><link rel="prefetch" href="/assets/js/711.43777b40.js"><link rel="prefetch" href="/assets/js/712.5c583e39.js"><link rel="prefetch" href="/assets/js/713.5aa72111.js"><link rel="prefetch" href="/assets/js/714.e8215702.js"><link rel="prefetch" href="/assets/js/715.46614e7c.js"><link rel="prefetch" href="/assets/js/716.eaac6d69.js"><link rel="prefetch" href="/assets/js/717.c344c042.js"><link rel="prefetch" href="/assets/js/718.437bf0b2.js"><link rel="prefetch" href="/assets/js/719.23aa3deb.js"><link rel="prefetch" href="/assets/js/72.9fa783f0.js"><link rel="prefetch" href="/assets/js/720.9456a449.js"><link rel="prefetch" href="/assets/js/721.67fd324a.js"><link rel="prefetch" href="/assets/js/722.fc5e79ca.js"><link rel="prefetch" href="/assets/js/723.46db8115.js"><link rel="prefetch" href="/assets/js/724.31a11b8c.js"><link rel="prefetch" href="/assets/js/725.49cef603.js"><link rel="prefetch" href="/assets/js/726.7d0a2e7f.js"><link rel="prefetch" href="/assets/js/727.a1de6f02.js"><link rel="prefetch" href="/assets/js/728.7e0a727e.js"><link rel="prefetch" href="/assets/js/729.b6bf04fa.js"><link rel="prefetch" href="/assets/js/73.1ac0ac37.js"><link rel="prefetch" href="/assets/js/730.1c102528.js"><link rel="prefetch" href="/assets/js/731.80403e3d.js"><link rel="prefetch" href="/assets/js/732.cf8b4a6d.js"><link rel="prefetch" href="/assets/js/733.aab88d38.js"><link rel="prefetch" href="/assets/js/734.965a0adc.js"><link rel="prefetch" href="/assets/js/735.f9d33608.js"><link rel="prefetch" href="/assets/js/736.d1621f9e.js"><link rel="prefetch" href="/assets/js/737.a12ea0d3.js"><link rel="prefetch" href="/assets/js/738.96e61512.js"><link rel="prefetch" href="/assets/js/739.9bce4dfe.js"><link rel="prefetch" href="/assets/js/74.1913daec.js"><link rel="prefetch" href="/assets/js/740.c1a0bf7b.js"><link rel="prefetch" href="/assets/js/741.0185115e.js"><link rel="prefetch" href="/assets/js/742.21e99d78.js"><link rel="prefetch" href="/assets/js/743.e5f2407e.js"><link rel="prefetch" href="/assets/js/744.53d4e25a.js"><link rel="prefetch" href="/assets/js/745.9fb6722c.js"><link rel="prefetch" href="/assets/js/746.893e3a2f.js"><link rel="prefetch" href="/assets/js/747.ad94fed4.js"><link rel="prefetch" href="/assets/js/748.3421b09b.js"><link rel="prefetch" href="/assets/js/749.15c364e9.js"><link rel="prefetch" href="/assets/js/75.d63a9540.js"><link rel="prefetch" href="/assets/js/750.4e5379b7.js"><link rel="prefetch" href="/assets/js/751.18b0273f.js"><link rel="prefetch" href="/assets/js/752.24717596.js"><link rel="prefetch" href="/assets/js/753.5868bcc4.js"><link rel="prefetch" href="/assets/js/754.77808a6c.js"><link rel="prefetch" href="/assets/js/755.af7f7a71.js"><link rel="prefetch" href="/assets/js/76.342d837c.js"><link rel="prefetch" href="/assets/js/77.466349c3.js"><link rel="prefetch" href="/assets/js/78.886d05b6.js"><link rel="prefetch" href="/assets/js/79.b478bdab.js"><link rel="prefetch" href="/assets/js/8.9f40767d.js"><link rel="prefetch" href="/assets/js/80.9205cc43.js"><link rel="prefetch" href="/assets/js/81.77f831c9.js"><link rel="prefetch" href="/assets/js/82.650475d1.js"><link rel="prefetch" href="/assets/js/83.aa7e3d4b.js"><link rel="prefetch" href="/assets/js/84.2fc92fb4.js"><link rel="prefetch" href="/assets/js/85.0f633e10.js"><link rel="prefetch" href="/assets/js/86.e862f4bc.js"><link rel="prefetch" href="/assets/js/87.8a869468.js"><link rel="prefetch" href="/assets/js/88.6c584051.js"><link rel="prefetch" href="/assets/js/89.3ab84e02.js"><link rel="prefetch" href="/assets/js/9.7ed864ce.js"><link rel="prefetch" href="/assets/js/90.41e6925d.js"><link rel="prefetch" href="/assets/js/91.55055993.js"><link rel="prefetch" href="/assets/js/92.ced7b439.js"><link rel="prefetch" href="/assets/js/93.41cc8a7f.js"><link rel="prefetch" href="/assets/js/94.6d2b144f.js"><link rel="prefetch" href="/assets/js/95.399a7909.js"><link rel="prefetch" href="/assets/js/96.556f8f9f.js"><link rel="prefetch" href="/assets/js/97.47ecdf46.js"><link rel="prefetch" href="/assets/js/98.fdbe6822.js"><link rel="prefetch" href="/assets/js/99.db8442e4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6ece31e0.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Fanx 知识库" class="logo"> <span class="site-name can-hide">Fanx 知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/779590/" class="nav-link">Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/dc7834/" class="nav-link">Java集合框架</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d7db/" class="nav-link">Java多线程并发</a></li><li class="dropdown-item"><!----> <a href="/pages/dbec4d/" class="nav-link">JavaIo&amp;NIO&amp;AIO</a></li><li class="dropdown-item"><!----> <a href="/pages/b908ce/" class="nav-link">JDK相关特性</a></li><li class="dropdown-item"><!----> <a href="/pages/e59bea/" class="nav-link">JVM相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f8c059/" class="nav-link">数据库基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/d192fd/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/8aa877/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/077e7c/" class="nav-link">MogoDb</a></li><li class="dropdown-item"><!----> <a href="/pages/68281b/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><!----> <span class="title" style="display:;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonFrameworks/mybatis/" class="nav-link">mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/8f6500/" class="nav-link">Spring Framework 5基础</a></li><li class="dropdown-item"><!----> <a href="/pages/7c08d4/" class="nav-link">SpringBoot 2.5.x系列</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源代码学习" class="dropdown-title"><!----> <span class="title" style="display:;">源代码学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/23a632/" class="nav-link">mybatis源码学习</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/java/" class="nav-link">java源代码</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/spring/" class="nav-link">Spring源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试相关" class="dropdown-title"><!----> <span class="title" style="display:;">面试相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2cef48/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/ad2692/" class="nav-link">Spring 框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用的技术工具" class="dropdown-title"><!----> <span class="title" style="display:;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/linux/common/" class="nav-link">linux常用命令实践</a></li><li class="dropdown-item"><!----> <a href="/tool/maven/" class="nav-link">Mavan</a></li><li class="dropdown-item"><!----> <a href="/pages/b25802/" class="nav-link">开发工具详解</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它语言" class="dropdown-title"><!----> <span class="title" style="display:;">其它语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fc414d/" class="nav-link">Python基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题总结" class="dropdown-title"><!----> <span class="title" style="display:;">问题总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/question/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4d0fa7/" class="nav-link">团队相关</a></li><li class="dropdown-item"><!----> <a href="/pages/75c3d7/" class="nav-link">fanx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><!----> <span class="title" style="display:;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/caf303/" class="nav-link">数据结构基础</a></li><li class="dropdown-item"><!----> <a href="/pages/395e23/" class="nav-link">常见排序算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fa3dd3/" class="nav-link">算法思想</a></li><li class="dropdown-item"><!----> <a href="/pages/79d342/" class="nav-link">一些领域算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fdb54d/" class="nav-link">其它算法相关</a></li></ul></div></div> <a href="https://fanxgit.github.io/fanxNotes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/779590/" class="nav-link">Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/dc7834/" class="nav-link">Java集合框架</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d7db/" class="nav-link">Java多线程并发</a></li><li class="dropdown-item"><!----> <a href="/pages/dbec4d/" class="nav-link">JavaIo&amp;NIO&amp;AIO</a></li><li class="dropdown-item"><!----> <a href="/pages/b908ce/" class="nav-link">JDK相关特性</a></li><li class="dropdown-item"><!----> <a href="/pages/e59bea/" class="nav-link">JVM相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f8c059/" class="nav-link">数据库基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/d192fd/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/8aa877/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/077e7c/" class="nav-link">MogoDb</a></li><li class="dropdown-item"><!----> <a href="/pages/68281b/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><!----> <span class="title" style="display:;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonFrameworks/mybatis/" class="nav-link">mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/8f6500/" class="nav-link">Spring Framework 5基础</a></li><li class="dropdown-item"><!----> <a href="/pages/7c08d4/" class="nav-link">SpringBoot 2.5.x系列</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源代码学习" class="dropdown-title"><!----> <span class="title" style="display:;">源代码学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/23a632/" class="nav-link">mybatis源码学习</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/java/" class="nav-link">java源代码</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/spring/" class="nav-link">Spring源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试相关" class="dropdown-title"><!----> <span class="title" style="display:;">面试相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2cef48/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/ad2692/" class="nav-link">Spring 框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用的技术工具" class="dropdown-title"><!----> <span class="title" style="display:;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/linux/common/" class="nav-link">linux常用命令实践</a></li><li class="dropdown-item"><!----> <a href="/tool/maven/" class="nav-link">Mavan</a></li><li class="dropdown-item"><!----> <a href="/pages/b25802/" class="nav-link">开发工具详解</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它语言" class="dropdown-title"><!----> <span class="title" style="display:;">其它语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fc414d/" class="nav-link">Python基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题总结" class="dropdown-title"><!----> <span class="title" style="display:;">问题总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/question/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4d0fa7/" class="nav-link">团队相关</a></li><li class="dropdown-item"><!----> <a href="/pages/75c3d7/" class="nav-link">fanx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><!----> <span class="title" style="display:;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/caf303/" class="nav-link">数据结构基础</a></li><li class="dropdown-item"><!----> <a href="/pages/395e23/" class="nav-link">常见排序算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fa3dd3/" class="nav-link">算法思想</a></li><li class="dropdown-item"><!----> <a href="/pages/79d342/" class="nav-link">一些领域算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fdb54d/" class="nav-link">其它算法相关</a></li></ul></div></div> <a href="https://fanxgit.github.io/fanxNotes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库基础和原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SQL 语言</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SQL - MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>NoSQL - Redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/8aa877/" class="sidebar-link">♥Redis教程 - Redis知识体系详解♥</a></li><li><a href="/pages/49cd50/" class="sidebar-link">Redis入门 - Redis概念和基础</a></li><li><a href="/pages/f673c2/" class="sidebar-link">Redis入门 - 数据类型-5种基础数据类型详解</a></li><li><a href="/pages/7f1faf/" class="sidebar-link">Redis入门 - 数据类型-3种特殊类型详解</a></li><li><a href="/pages/a908e1/" class="sidebar-link">Redis入门 - 数据类型-Stream详解</a></li><li><a href="/pages/439e23/" class="sidebar-link">Redis进阶 - 数据结构-对象机制详解</a></li><li><a href="/pages/63585e/" class="sidebar-link">Redis进阶 - 数据结构-底层数据结构详解</a></li><li><a href="/pages/5b8973/" class="sidebar-link">Redis进阶 - 数据结构-redis对象与编码(底层结构)对应关系详解</a></li><li><a href="/pages/586574/" class="sidebar-link">Redis进阶 - 持久化-RDB和AOF机制详解</a></li><li><a href="/pages/1cb919/" class="sidebar-link">Redis进阶 - 消息传递-发布订阅模式详解</a></li><li><a href="/pages/e96e2e/" class="sidebar-link">Redis进阶 - 事件-Redis事件机制详解</a></li><li><a href="/pages/6f16ff/" class="sidebar-link">Redis进阶 - 事务-Redis事务详解</a></li><li><a href="/pages/ec9d49/" class="sidebar-link">Redis进阶 - 高可用-主从复制详解</a></li><li><a href="/pages/fd09b3/" class="sidebar-link">Redis进阶 - 高可用-哨兵机制（Redis Sentinel）详解</a></li><li><a href="/pages/7fbc60/" class="sidebar-link">Redis进阶 - 高可拓展-分片技术（Redis Cluster）详解</a></li><li><a href="/pages/32bbee/" class="sidebar-link">Redis进阶 - 缓存问题-一致性, 穿击, 穿透, 雪崩, 污染等</a></li><li><a href="/pages/da2861/" class="sidebar-link">Redis进阶 - 版本特性- Redis4.0、5.0、6.0特性整理</a></li><li><a href="/pages/f61c59/" class="sidebar-link">Redis进阶 - 运维监控-Redis的监控详解</a></li><li><a href="/pages/5c2bca/" aria-current="page" class="active sidebar-link">Redis进阶 - 性能调优-Redis性能调优详解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/cff377/" class="sidebar-link">Redis大厂经验 - 微博-万亿级日访问量下，Redis在微博的9年优化历程</a></li><li><a href="/pages/980ea9/" class="sidebar-link">Redis大厂经验 - 美团-Redis 高负载下的中断优化</a></li><li><a href="/pages/486c1c/" class="sidebar-link">Redis面试 - redis问题总结</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NoSQL - MongoDB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NoSQL - ElasticSearch</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=database" title="分类" data-v-06225672>database</a></li><li data-v-06225672><a href="/categories/?category=NoSQL%20-%20Redis" title="分类" data-v-06225672>NoSQL - Redis</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/FanXGit" target="_blank" title="作者" class="beLink" data-v-06225672>fanx</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-08-07</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Redis进阶 - 性能调优-Redis性能调优详解<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="redis进阶-性能调优-redis性能调优详解"><a href="#redis进阶-性能调优-redis性能调优详解" class="header-anchor">#</a> Redis进阶 - 性能调优：Redis性能调优详解</h1> <p>=========================================================</p> <blockquote><p>Redis 的性能问题，涉及到的知识点非常广，几乎涵盖了 CPU、内存、网络、甚至磁盘的方方面面；同时还需要对上文中一些基础或底层有详细的了解。针对Redis的性能调优，这里整理分享一篇水滴与银弹（公众号）的文章，这篇文章可以帮助你构筑Redis性能调优的知识体系。@pdai</p></blockquote> <ul><li><a href="#redis%E8%BF%9B%E9%98%B6---%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98redis%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E8%AF%A6%E8%A7%A3">Redis进阶 - 性能调优：Redis性能调优详解</a> <ul><li><a href="#%E5%89%8D%E8%A8%80">前言</a></li> <li><a href="#redis%E7%9C%9F%E7%9A%84%E5%8F%98%E6%85%A2%E4%BA%86%E5%90%97">Redis真的变慢了吗？</a></li> <li><a href="#%E4%BD%BF%E7%94%A8%E5%A4%8D%E6%9D%82%E5%BA%A6%E8%BF%87%E9%AB%98%E7%9A%84%E5%91%BD%E4%BB%A4">使用复杂度过高的命令</a></li> <li><a href="#%E6%93%8D%E4%BD%9Cbigkey">操作bigkey</a></li> <li><a href="#%E9%9B%86%E4%B8%AD%E8%BF%87%E6%9C%9F">集中过期</a></li> <li><a href="#%E5%AE%9E%E4%BE%8B%E5%86%85%E5%AD%98%E8%BE%BE%E5%88%B0%E4%B8%8A%E9%99%90">实例内存达到上限</a></li> <li><a href="#fork%E8%80%97%E6%97%B6%E4%B8%A5%E9%87%8D">fork耗时严重</a></li> <li><a href="#%E5%BC%80%E5%90%AF%E5%86%85%E5%AD%98%E5%A4%A7%E9%A1%B5">开启内存大页</a></li> <li><a href="#%E5%BC%80%E5%90%AFaof">开启AOF</a></li> <li><a href="#%E7%BB%91%E5%AE%9Acpu">绑定CPU</a></li> <li><a href="#%E4%BD%BF%E7%94%A8swap">使用Swap</a></li> <li><a href="#%E7%A2%8E%E7%89%87%E6%95%B4%E7%90%86">碎片整理</a></li> <li><a href="#%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD%E8%BF%87%E8%BD%BD">网络带宽过载</a></li> <li><a href="#%E5%85%B6%E4%BB%96%E5%8E%9F%E5%9B%A0">其他原因</a></li> <li><a href="#%E6%80%BB%E7%BB%93">总结</a></li> <li><a href="#%E5%90%8E%E8%AE%B0">后记</a></li> <li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0">参考文章</a></li></ul></li></ul> <h1 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h1> <hr> <blockquote><p>Redis 作为优秀的内存数据库，其拥有非常高的性能，单个实例的 OPS 能够达到 10W 左右。但也正因此如此，当我们在使用 Redis 时，如果发现操作延迟变大的情况，就会与我们的预期不符。</p></blockquote> <p>你也许或多或少地，也遇到过以下这些场景：</p> <ul><li>在 Redis 上执行同样的命令，为什么有时响应很快，有时却很慢？</li> <li>为什么 Redis 执行 SET、DEL 命令耗时也很久？</li> <li>为什么我的 Redis 突然慢了一波，之后又恢复正常了？</li> <li>为什么我的 Redis 稳定运行了很久，突然从某个时间点开始变慢了？</li> <li>...</li></ul> <p>如果你并不清楚 Redis 内部的实现原理，那么在排查这种延迟问题时就会一头雾水。</p> <p>如果你也遇到了以上情况，那么，这篇文章将会给你一个「全面」的问题排查思路，并且针对这些导致变慢的场景，我还会给你一个高效的解决方案。</p> <h1 id="redis真的变慢了吗"><a href="#redis真的变慢了吗" class="header-anchor">#</a> Redis真的变慢了吗？</h1> <hr> <blockquote><p>首先，在开始之前，你需要弄清楚 Redis 是否真的变慢了？</p></blockquote> <p>如果你发现你的业务服务 API 响应延迟变长，首先你需要先排查服务内部，究竟是哪个环节拖慢了整个服务。</p> <p>比较高效的做法是，在服务内部集成链路追踪，也就是在服务访问外部依赖的出入口，记录下每次请求外部依赖的响应延时。</p> <p><img src="data:image/jpeg;base64,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" alt=""></p> <p>如果你发现确实是操作 Redis 的这条链路耗时变长了，那么此刻你需要把焦点关注在业务服务到 Redis 这条链路上。</p> <p>从你的业务服务到 Redis 这条链路变慢的原因可能也有 2 个：</p> <ul><li>业务服务器到 Redis 服务器之间的网络存在问题，例如网络线路质量不佳，网络数据包在传输时存在延迟、丢包等情况</li> <li>Redis 本身存在问题，需要进一步排查是什么原因导致 Redis 变慢</li></ul> <p>通常来说，第一种情况发生的概率比较小，如果是服务器之间网络存在问题，那部署在这台业务服务器上的所有服务都会发生网络延迟的情况，此时你需要联系网络运维同事，让其协助解决网络问题。</p> <p>我们这篇文章，重点关注的是第二种情况。</p> <p>也就是从 Redis 角度来排查，是否存在导致变慢的场景，以及都有哪些因素会导致 Redis 的延迟增加，然后针对性地进行优化。</p> <p>排除网络原因，如何确认你的 Redis 是否真的变慢了？</p> <p>首先，你需要对 Redis 进行基准性能测试，了解你的 Redis 在生产环境服务器上的基准性能。</p> <p><strong>什么是基准性能</strong>？</p> <p>简单来讲，基准性能就是指 Redis 在一台负载正常的机器上，其最大的响应延迟和平均响应延迟分别是怎样的？</p> <p>为什么要测试基准性能？我参考别人提供的响应延迟，判断自己的 Redis 是否变慢不行吗？</p> <p>答案是否定的。</p> <p>因为 Redis 在不同的软硬件环境下，它的性能是各不相同的。</p> <p>例如，我的机器配置比较低，当延迟为 2ms 时，我就认为 Redis 变慢了，但是如果你的硬件配置比较高，那么在你的运行环境下，可能延迟是 0.5ms 时就可以认为 Redis 变慢了。</p> <p>所以，你只有了解了你的 Redis 在生产环境服务器上的基准性能，才能进一步评估，当其延迟达到什么程度时，才认为 Redis 确实变慢了。</p> <p><strong>具体如何做</strong>？</p> <p>为了避免业务服务器到 Redis 服务器之间的网络延迟，你需要直接在 Redis 服务器上测试实例的响应延迟情况。执行以下命令，就可以测试出这个实例 60 秒内的最大响应延迟：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ redis-cli -h 127.0.0.1 -p 6379 --intrinsic-latency 60
Max latency so far: 1 microseconds.
Max latency so far: 15 microseconds.
Max latency so far: 17 microseconds.
Max latency so far: 18 microseconds.
Max latency so far: 31 microseconds.
Max latency so far: 32 microseconds.
Max latency so far: 59 microseconds.
Max latency so far: 72 microseconds.
 
1428669267 total runs (avg latency: 0.0420 microseconds / 42.00 nanoseconds per run).
Worst run took 1429x longer than the average latency.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>从输出结果可以看到，这 60 秒内的最大响应延迟为 72 微秒（0.072毫秒）。</p> <p>你还可以使用以下命令，查看一段时间内 Redis 的最小、最大、平均访问延迟：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ redis-cli -h 127.0.0.1 -p 6379 --latency-history -i 1
min: 0, max: 1, avg: 0.13 (100 samples) -- 1.01 seconds range
min: 0, max: 1, avg: 0.12 (99 samples) -- 1.01 seconds range
min: 0, max: 1, avg: 0.13 (99 samples) -- 1.01 seconds range
min: 0, max: 1, avg: 0.10 (99 samples) -- 1.01 seconds range
min: 0, max: 1, avg: 0.13 (98 samples) -- 1.00 seconds range
min: 0, max: 1, avg: 0.08 (99 samples) -- 1.01 seconds range
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>以上输出结果是，每间隔 1 秒，采样 Redis 的平均操作耗时，其结果分布在 0.08 ~ 0.13 毫秒之间。</p> <p>了解了基准性能测试方法，那么你就可以按照以下几步，来判断你的 Redis 是否真的变慢了：</p> <ul><li>在相同配置的服务器上，测试一个正常 Redis 实例的基准性能</li> <li>找到你认为可能变慢的 Redis 实例，测试这个实例的基准性能</li> <li>如果你观察到，这个实例的运行延迟是正常 Redis 基准性能的 2 倍以上，即可认为这个 Redis 实例确实变慢了</li></ul> <p>确认是 Redis 变慢了，那如何排查是哪里发生了问题呢？</p> <p>下面跟着我的思路，我们从易到难，一步步来分析可能导致 Redis 变慢的因素。</p> <h1 id="使用复杂度过高的命令"><a href="#使用复杂度过高的命令" class="header-anchor">#</a> 使用复杂度过高的命令</h1> <hr> <blockquote><p>首先，第一步，你需要去查看一下 Redis 的慢日志（slowlog）。</p></blockquote> <p>Redis 提供了慢日志命令的统计功能，它记录了有哪些命令在执行时耗时比较久。</p> <p>查看 Redis 慢日志之前，你需要设置慢日志的阈值。例如，设置慢日志的阈值为 5 毫秒，并且保留最近 500 条慢日志记录：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 命令执行耗时超过 5 毫秒，记录慢日志
CONFIG SET slowlog-log-slower-than 5000
# 只保留最近 500 条慢日志
CONFIG SET slowlog-max-len 500
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>设置完成之后，所有执行的命令如果操作耗时超过了 5 毫秒，都会被 Redis 记录下来。</p> <p>此时，你可以执行以下命令，就可以查询到最近记录的慢日志：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>127.0.0.1:6379&gt; SLOWLOG get 5
1) 1) (integer) 32693       # 慢日志ID
   2) (integer) 1593763337  # 执行时间戳
   3) (integer) 5299        # 执行耗时(微秒)
   4) 1) &quot;LRANGE&quot;           # 具体执行的命令和参数
      2) &quot;user_list:2000&quot;
      3) &quot;0&quot;
      4) &quot;-1&quot;
2) 1) (integer) 32692
   2) (integer) 1593763337
   3) (integer) 5044
   4) 1) &quot;GET&quot;
      2) &quot;user_info:1000&quot;
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>通过查看慢日志，我们就可以知道在什么时间点，执行了哪些命令比较耗时。</p> <p>如果你的应用程序执行的 Redis 命令有以下特点，那么有可能会导致操作延迟变大：</p> <ul><li>经常使用 O(N) 以上复杂度的命令，例如 SORT、SUNION、ZUNIONSTORE 聚合类命令</li> <li>使用 O(N) 复杂度的命令，但 N 的值非常大</li></ul> <p>第一种情况导致变慢的原因在于，Redis 在操作内存数据时，时间复杂度过高，要花费更多的 CPU 资源。</p> <p>第二种情况导致变慢的原因在于，Redis 一次需要返回给客户端的数据过多，更多时间花费在数据协议的组装和网络传输过程中。</p> <p>另外，我们还可以从资源使用率层面来分析，如果你的应用程序操作 Redis 的 OPS 不是很大，但 Redis 实例的 CPU 使用率却很高，那么很有可能是使用了复杂度过高的命令导致的。</p> <p>除此之外，我们都知道，Redis 是单线程处理客户端请求的，如果你经常使用以上命令，那么当 Redis 处理客户端请求时，一旦前面某个命令发生耗时，就会导致后面的请求发生排队，对于客户端来说，响应延迟也会变长。</p> <p><img src="/assets/img/redis-performance-2.34ee5acc.jpeg" alt=""></p> <p>针对这种情况如何解决呢？</p> <p>答案很简单，你可以使用以下方法优化你的业务：</p> <ul><li>尽量不使用 O(N) 以上复杂度过高的命令，对于数据的聚合操作，放在客户端做</li> <li>执行 O(N) 命令，保证 N 尽量的小（推荐 N &lt;= 300），每次获取尽量少的数据，让 Redis 可以及时处理返回</li></ul> <h1 id="操作bigkey"><a href="#操作bigkey" class="header-anchor">#</a> 操作bigkey</h1> <hr> <blockquote><p>如果你查询慢日志发现，并不是复杂度过高的命令导致的，而都是 SET / DEL 这种简单命令出现在慢日志中，那么你就要怀疑你的实例否写入了 bigkey。</p></blockquote> <p>Redis 在写入数据时，需要为新的数据分配内存，相对应的，当从 Redis 中删除数据时，它会释放对应的内存空间。</p> <p><strong>如果一个 key 写入的 value 非常大，那么 Redis 在分配内存时就会比较耗时</strong>。同样的，当删除这个 key 时，释放内存也会比较耗时，这种类型的 key 我们一般称之为 bigkey。</p> <p>此时，你需要检查你的业务代码，是否存在写入 bigkey 的情况。你需要评估写入一个 key 的数据大小，尽量避免一个 key 存入过大的数据。</p> <p><strong>如果已经写入了 bigkey，那有没有什么办法可以扫描出实例中 bigkey 的分布情况呢</strong>？</p> <p>答案是可以的。</p> <p>Redis 提供了扫描 bigkey 的命令，执行以下命令就可以扫描出，一个实例中 bigkey 的分布情况，输出结果是以类型维度展示的：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ redis-cli -h 127.0.0.1 -p 6379 --bigkeys -i 0.01
 
...
-------- summary -------
 
Sampled 829675 keys in the keyspace!
Total key length in bytes is 10059825 (avg len 12.13)
 
Biggest string found 'key:291880' has 10 bytes
Biggest   list found 'mylist:004' has 40 items
Biggest    set found 'myset:2386' has 38 members
Biggest   hash found 'myhash:3574' has 37 fields
Biggest   zset found 'myzset:2704' has 42 members
 
36313 strings with 363130 bytes (04.38% of keys, avg size 10.00)
787393 lists with 896540 items (94.90% of keys, avg size 1.14)
1994 sets with 40052 members (00.24% of keys, avg size 20.09)
1990 hashs with 39632 fields (00.24% of keys, avg size 19.92)
1985 zsets with 39750 members (00.24% of keys, avg size 20.03)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>从输出结果我们可以很清晰地看到，每种数据类型所占用的最大内存 / 拥有最多元素的 key 是哪一个，以及每种数据类型在整个实例中的占比和平均大小 / 元素数量。</p> <p>其实，使用这个命令的原理，就是 Redis 在内部执行了 SCAN 命令，遍历整个实例中所有的 key，然后针对 key 的类型，分别执行 STRLEN、LLEN、HLEN、SCARD、ZCARD 命令，来获取 String 类型的长度、容器类型（List、Hash、Set、ZSet）的元素个数。</p> <p>这里我需要提醒你的是，当执行这个命令时，要注意 2 个问题：</p> <ul><li>对线上实例进行 bigkey 扫描时，Redis 的 OPS 会突增，为了降低扫描过程中对 Redis 的影响，最好控制一下扫描的频率，指定 -i 参数即可，它表示扫描过程中每次扫描后休息的时间间隔，单位是秒</li> <li>扫描结果中，对于容器类型（List、Hash、Set、ZSet）的 key，只能扫描出元素最多的 key。但一个 key 的元素多，不一定表示占用内存也多，你还需要根据业务情况，进一步评估内存占用情况</li></ul> <p><strong>那针对 bigkey 导致延迟的问题，有什么好的解决方案呢</strong>？</p> <p>这里有两点可以优化：</p> <ul><li>业务应用尽量避免写入 bigkey</li> <li>如果你使用的 Redis 是 4.0 以上版本，用 UNLINK 命令替代 DEL，此命令可以把释放 key 内存的操作，放到后台线程中去执行，从而降低对 Redis 的影响</li> <li>如果你使用的 Redis 是 6.0 以上版本，可以开启 lazy-free 机制（lazyfree-lazy-user-del = yes），在执行 DEL 命令时，释放内存也会放到后台线程中执行</li></ul> <p>但即便可以使用方案 2，我也不建议你在实例中存入 bigkey。</p> <p>这是因为 bigkey 在很多场景下，依旧会产生性能问题。例如，bigkey 在分片集群模式下，对于数据的迁移也会有性能影响，以及我后面即将讲到的数据过期、数据淘汰、透明大页，都会受到 bigkey 的影响。</p> <h1 id="集中过期"><a href="#集中过期" class="header-anchor">#</a> 集中过期</h1> <hr> <blockquote><p>如果你发现，平时在操作 Redis 时，并没有延迟很大的情况发生，但在某个时间点突然出现一波延时，其现象表现为：<strong>变慢的时间点很有规律，例如某个整点，或者每间隔多久就会发生一波延迟</strong>。如果是出现这种情况，那么你需要排查一下，业务代码中是否存在设置大量 key 集中过期的情况。</p></blockquote> <p>如果有大量的 key 在某个固定时间点集中过期，在这个时间点访问 Redis 时，就有可能导致延时变大。</p> <p><strong>为什么集中过期会导致 Redis 延迟变大</strong>？</p> <p>这就需要我们了解 Redis 的过期策略是怎样的。</p> <p>Redis 的过期数据采用被动过期 + 主动过期两种策略：</p> <ul><li><strong>被动过期</strong>：只有当访问某个 key 时，才判断这个 key 是否已过期，如果已过期，则从实例中删除</li> <li><strong>主动过期</strong>：Redis 内部维护了一个定时任务，默认每隔 100 毫秒（1秒10次）就会从全局的过期哈希表中随机取出 20 个 key，然后删除其中过期的 key，如果过期 key 的比例超过了 25%，则继续重复此过程，直到过期 key 的比例下降到 25% 以下，或者这次任务的执行耗时超过了 25 毫秒，才会退出循环</li></ul> <p>注意，<strong>这个主动过期 key 的定时任务，是在 Redis 主线程中执行的</strong>。</p> <p>也就是说如果在执行主动过期的过程中，出现了需要大量删除过期 key 的情况，那么此时应用程序在访问 Redis 时，必须要等待这个过期任务执行结束，Redis 才可以服务这个客户端请求。</p> <p>此时就会出现，应用访问 Redis 延时变大。</p> <p>如果此时需要过期删除的是一个 bigkey，那么这个耗时会更久。而且，这个操作延迟的命令并不会记录在慢日志中。</p> <p>因为慢日志中只记录一个命令真正操作内存数据的耗时，而 Redis 主动删除过期 key 的逻辑，是在命令真正执行之前执行的。</p> <p>所以，此时你会看到，<strong>慢日志中没有操作耗时的命令，但我们的应用程序却感知到了延迟变大，其实时间都花费在了删除过期 key 上</strong>，这种情况我们需要尤为注意。</p> <p><img src="data:image/jpeg;base64,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" alt=""></p> <p><strong>那遇到这种情况，如何分析和排查</strong>？</p> <p>此时，你需要检查你的业务代码，是否存在集中过期 key 的逻辑。</p> <p>一般集中过期使用的是 expireat / pexpireat 命令，你需要在代码中搜索这个关键字。</p> <p>排查代码后，如果确实存在集中过期 key 的逻辑存在，但这种逻辑又是业务所必须的，那此时如何优化，同时又不对 Redis 有性能影响呢？</p> <p>一般有两种方案来规避这个问题：</p> <ul><li>集中过期 key 增加一个随机过期时间，把集中过期的时间打散，降低 Redis 清理过期 key 的压力</li> <li>如果你使用的 Redis 是 4.0 以上版本，可以开启 lazy-free 机制，当删除过期 key 时，把释放内存的操作放到后台线程中执行，避免阻塞主线程</li></ul> <p>第一种方案，在设置 key 的过期时间时，增加一个随机时间，伪代码可以这么写：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 在过期时间点之后的 5 分钟内随机过期掉
redis.expireat(key, expire_time + random(300))
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这样一来，Redis 在处理过期时，不会因为集中删除过多的 key 导致压力过大，从而避免阻塞主线程。</p> <p>第二种方案，Redis 4.0 以上版本，开启 lazy-free 机制：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 释放过期 key 的内存，放到后台线程执行
lazyfree-lazy-expire yes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>另外，除了业务层面的优化和修改配置之外，你还可以通过运维手段及时发现这种情况。</p> <p>运维层面，你需要把 Redis 的各项运行状态数据监控起来，在 Redis 上执行 INFO 命令就可以拿到这个实例所有的运行状态数据。</p> <p>在这里我们需要重点关注 expired_keys 这一项，它代表整个实例到目前为止，累计删除过期 key 的数量。</p> <p>你需要把这个指标监控起来，<strong>当这个指标在很短时间内出现了突增，需要及时报警出来</strong>，然后与业务应用报慢的时间点进行对比分析，确认时间是否一致，如果一致，则可以确认确实是因为集中过期 key 导致的延迟变大。</p> <h1 id="实例内存达到上限"><a href="#实例内存达到上限" class="header-anchor">#</a> 实例内存达到上限</h1> <hr> <blockquote><p>如果你的 Redis 实例设置了内存上限 maxmemory，那么也有可能导致 Redis 变慢。</p></blockquote> <p>当我们把 Redis 当做纯缓存使用时，通常会给这个实例设置一个内存上限 maxmemory，然后设置一个数据淘汰策略。</p> <p>而当实例的内存达到了 maxmemory 后，你可能会发现，在此之后每次写入新数据，操作延迟变大了。</p> <p>这是为什么？</p> <p>原因在于，当 Redis 内存达到 maxmemory 后，每次写入新的数据之前，<strong>Redis 必须先从实例中踢出一部分数据，让整个实例的内存维持在 maxmemory 之下，然后才能把新数据写进来</strong>。</p> <p>这个踢出旧数据的逻辑也是需要消耗时间的，而具体耗时的长短，要取决于你配置的淘汰策略：</p> <ul><li><code>allkeys-lru</code>：不管 key 是否设置了过期，淘汰最近最少访问的 key</li> <li><code>volatile-lru</code>：只淘汰最近最少访问、并设置了过期时间的 key</li> <li><code>allkeys-random</code>：不管 key 是否设置了过期，随机淘汰 key</li> <li><code>volatile-random</code>：只随机淘汰设置了过期时间的 key</li> <li><code>allkeys-ttl</code>：不管 key 是否设置了过期，淘汰即将过期的 key</li> <li><code>noeviction</code>：不淘汰任何 key，实例内存达到 maxmeory 后，再写入新数据直接返回错误</li> <li><code>allkeys-lfu</code>：不管 key 是否设置了过期，淘汰访问频率最低的 key（4.0+版本支持）</li> <li><code>volatile-lfu</code>：只淘汰访问频率最低、并设置了过期时间 key（4.0+版本支持）</li></ul> <p>具体使用哪种策略，我们需要根据具体的业务场景来配置。</p> <p>一般最常使用的是 allkeys-lru / volatile-lru 淘汰策略，它们的处理逻辑是，每次从实例中随机取出一批 key（这个数量可配置），然后淘汰一个最少访问的 key，之后把剩下的 key 暂存到一个池子中，继续随机取一批 key，并与之前池子中的 key 比较，再淘汰一个最少访问的 key。以此往复，直到实例内存降到 maxmemory 之下。</p> <p>需要注意的是，Redis 的淘汰数据的逻辑与删除过期 key 的一样，也是在命令真正执行之前执行的，也就是说它也会增加我们操作 Redis 的延迟，而且，写 OPS 越高，延迟也会越明显。</p> <p><img src="/assets/img/redis-performance-4.c95808bc.jpeg" alt=""></p> <p>另外，如果此时你的 Redis 实例中还存储了 bigkey，那么在淘汰删除 bigkey 释放内存时，也会耗时比较久。</p> <p>看到了么？bigkey 的危害到处都是，这也是前面我提醒你尽量不存储 bigkey 的原因。</p> <p><strong>针对这种情况，如何解决呢</strong>？</p> <p>我给你 4 个方面的优化建议：</p> <ul><li>避免存储 bigkey，降低释放内存的耗时</li> <li>淘汰策略改为随机淘汰，随机淘汰比 LRU 要快很多（视业务情况调整）</li> <li>拆分实例，把淘汰 key 的压力分摊到多个实例上</li> <li>如果使用的是 Redis 4.0 以上版本，开启 layz-free 机制，把淘汰 key 释放内存的操作放到后台线程中执行（配置 lazyfree-lazy-eviction = yes）</li></ul> <h1 id="fork耗时严重"><a href="#fork耗时严重" class="header-anchor">#</a> fork耗时严重</h1> <hr> <blockquote><p>为了保证 Redis 数据的安全性，我们可能会开启后台定时 RDB 和 AOF rewrite 功能。但如果你发现，操作 Redis 延迟变大，都发生在 Redis 后台 RDB 和 AOF rewrite 期间，那你就需要排查，在这期间有可能导致变慢的情况。</p></blockquote> <p>当 Redis 开启了后台 RDB 和 AOF rewrite 后，在执行时，它们都需要主进程创建出一个子进程进行数据的持久化。</p> <p><strong>主进程创建子进程，会调用操作系统提供的 fork 函数</strong>。</p> <p>而 fork 在执行过程中，主进程需要拷贝自己的内存页表给子进程，如果这个实例很大，那么这个拷贝的过程也会比较耗时。</p> <p>而且这个 fork 过程会消耗大量的 CPU 资源，在完成 fork 之前，整个 Redis 实例会被阻塞住，无法处理任何客户端请求。</p> <p>如果此时你的 CPU 资源本来就很紧张，那么 fork 的耗时会更长，甚至达到秒级，这会严重影响 Redis 的性能。</p> <p>那如何确认确实是因为 fork 耗时导致的 Redis 延迟变大呢？</p> <p>你可以在 Redis 上执行 INFO 命令，查看 latest_fork_usec 项，单位微秒。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 上一次 fork 耗时，单位微秒
latest_fork_usec:59477
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这个时间就是主进程在 fork 子进程期间，整个实例阻塞无法处理客户端请求的时间。</p> <p>如果你发现这个耗时很久，就要警惕起来了，这意味在这期间，你的整个 Redis 实例都处于不可用的状态。</p> <p>除了数据持久化会生成 RDB 之外，当主从节点第一次建立数据同步时，主节点也创建子进程生成 RDB，然后发给从节点进行一次全量同步，所以，这个过程也会对 Redis 产生性能影响。</p> <p><img src="data:image/jpeg;base64,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" alt=""></p> <p>要想避免这种情况，你可以采取以下方案进行优化：</p> <ul><li>控制 Redis 实例的内存：尽量在 10G 以下，执行 fork 的耗时与实例大小有关，实例越大，耗时越久</li> <li>合理配置数据持久化策略：在 slave 节点执行 RDB 备份，推荐在低峰期执行，而对于丢失数据不敏感的业务（例如把 Redis 当做纯缓存使用），可以关闭 AOF 和 AOF rewrite</li> <li>Redis 实例不要部署在虚拟机上：fork 的耗时也与系统也有关，虚拟机比物理机耗时更久</li> <li>降低主从库全量同步的概率：适当调大 repl-backlog-size 参数，避免主从全量同步</li></ul> <h1 id="开启内存大页"><a href="#开启内存大页" class="header-anchor">#</a> 开启内存大页</h1> <hr> <blockquote><p>除了上面讲到的子进程 RDB 和 AOF rewrite 期间，fork 耗时导致的延时变大之外，这里还有一个方面也会导致性能问题，这就是操作系统是否开启了内存大页机制。</p></blockquote> <p><strong>什么是内存大页</strong>？</p> <p>我们都知道，应用程序向操作系统申请内存时，是按内存页进行申请的，而常规的内存页大小是 4KB。</p> <p>Linux 内核从 2.6.38 开始，支持了内存大页机制，该机制允许应用程序以 2MB 大小为单位，向操作系统申请内存。</p> <p>应用程序每次向操作系统申请的内存单位变大了，但这也意味着申请内存的耗时变长。</p> <p><strong>这对 Redis 会有什么影响呢</strong>？</p> <p>当 Redis 在执行后台 RDB 和 AOF rewrite 时，采用 fork 子进程的方式来处理。但主进程 fork 子进程后，此时的主进程依旧是可以接收写请求的，而进来的写请求，会采用 Copy On Write（写时复制）的方式操作内存数据。</p> <p>也就是说，主进程一旦有数据需要修改，Redis 并不会直接修改现有内存中的数据，而是先将这块内存数据拷贝出来，再修改这块新内存的数据，这就是所谓的「写时复制」。</p> <p>写时复制你也可以理解成，谁需要发生写操作，谁就需要先拷贝，再修改。</p> <p>这样做的好处是，父进程有任何写操作，并不会影响子进程的数据持久化（子进程只持久化 fork 这一瞬间整个实例中的所有数据即可，不关心新的数据变更，因为子进程只需要一份内存快照，然后持久化到磁盘上）。</p> <p>但是请注意，<strong>主进程在拷贝内存数据时，这个阶段就涉及到新内存的申请，如果此时操作系统开启了内存大页，那么在此期间，客户端即便只修改 10B 的数据，Redis 在申请内存时也会以 2MB 为单位向操作系统申请，申请内存的耗时变长，进而导致每个写请求的延迟增加，影响到 Redis 性能</strong>。</p> <p>同样地，如果这个写请求操作的是一个 bigkey，那主进程在拷贝这个 bigkey 内存块时，一次申请的内存会更大，时间也会更久。可见，bigkey 在这里又一次影响到了性能。</p> <p><img src="/assets/img/redis-performance-6.b2af110c.jpeg" alt=""></p> <p><strong>那如何解决这个问题</strong>？</p> <p>很简单，你只需要关闭内存大页机制就可以了。</p> <p>首先，你需要查看 Redis 机器是否开启了内存大页：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ cat /sys/kernel/mm/transparent_hugepage/enabled
[always] madvise never
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果输出选项是 always，就表示目前开启了内存大页机制，我们需要关掉它：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其实，操作系统提供的内存大页机制，其优势是，可以在一定程序上降低应用程序申请内存的次数。</p> <p>但是对于 Redis 这种对性能和延迟极其敏感的数据库来说，我们希望 Redis 在每次申请内存时，耗时尽量短，所以我不建议你在 Redis 机器上开启这个机制。</p> <h1 id="开启aof"><a href="#开启aof" class="header-anchor">#</a> 开启AOF</h1> <hr> <blockquote><p>前面我们分析了 RDB 和 AOF rewrite 对 Redis 性能的影响，主要关注点在 fork 上。</p></blockquote> <p>其实，关于数据持久化方面，还有影响 Redis 性能的因素，这次我们重点来看 AOF 数据持久化。</p> <p>如果你的 AOF 配置不合理，还是有可能会导致性能问题。</p> <p>当 Redis 开启 AOF 后，其工作原理如下：</p> <ul><li>Redis 执行写命令后，把这个命令写入到 AOF 文件内存中（write 系统调用）</li> <li>Redis 根据配置的 AOF 刷盘策略，把 AOF 内存数据刷到磁盘上（fsync 系统调用）</li></ul> <p>为了保证 AOF 文件数据的安全性，Redis 提供了 3 种刷盘机制：</p> <ul><li>appendfsync always：主线程每次执行写操作后立即刷盘，此方案会占用比较大的磁盘 IO 资源，但数据安全性最高</li> <li>appendfsync no：主线程每次写操作只写内存就返回，内存数据什么时候刷到磁盘，交由操作系统决定，此方案对性能影响最小，但数据安全性也最低，Redis 宕机时丢失的数据取决于操作系统刷盘时机</li> <li>appendfsync everysec：主线程每次写操作只写内存就返回，然后由后台线程每隔 1 秒执行一次刷盘操作（触发fsync系统调用），此方案对性能影响相对较小，但当 Redis 宕机时会丢失 1 秒的数据</li></ul> <p>下面我们依次来分析，这几个机制对性能的影响。</p> <p>如果你的 AOF 配置为 appendfsync always，那么 Redis 每处理一次写操作，都会把这个命令写入到磁盘中才返回，整个过程都是在主线程执行的，这个过程必然会加重 Redis 写负担。</p> <p>原因也很简单，操作磁盘要比操作内存慢几百倍，采用这个配置会严重拖慢 Redis 的性能，因此我不建议你把 AOF 刷盘方式配置为 always。</p> <p>我们接着来看 appendfsync no 配置项。</p> <p>在这种配置下，Redis 每次写操作只写内存，什么时候把内存中的数据刷到磁盘，交给操作系统决定，此方案对 Redis 的性能影响最小，但当 Redis 宕机时，会丢失一部分数据，为了数据的安全性，一般我们也不采取这种配置。</p> <blockquote><p>如果你的 Redis 只用作纯缓存，对于数据丢失不敏感，采用配置 appendfsync no 也是可以的。</p></blockquote> <p>看到这里，我猜你肯定和大多数人的想法一样，选比较折中的方案 appendfsync everysec 就没问题了吧？</p> <p>这个方案优势在于，Redis 主线程写完内存后就返回，具体的刷盘操作是放到后台线程中执行的，后台线程每隔 1 秒把内存中的数据刷到磁盘中。</p> <p>这种方案既兼顾了性能，又尽可能地保证了数据安全，是不是觉得很完美？</p> <p><strong>但是，这里我要给你泼一盆冷水了，采用这种方案你也要警惕一下，因为这种方案还是存在导致 Redis 延迟变大的情况发生，甚至会阻塞整个 Redis</strong>。</p> <p>这是为什么？我把 AOF 最耗时的刷盘操作，放到后台线程中也会影响到 Redis 主线程？</p> <p>你试想这样一种情况：当 Redis 后台线程在执行 AOF 文件刷盘时，如果此时磁盘的 IO 负载很高，那这个后台线程在执行刷盘操作（fsync系统调用）时就会被阻塞住。</p> <p>此时的主线程依旧会接收写请求，紧接着，主线程又需要把数据写到文件内存中（write 系统调用），<strong>但此时的后台子线程由于磁盘负载过高，导致 fsync 发生阻塞，迟迟不能返回，那主线程在执行 write 系统调用时，也会被阻塞住，直到后台线程 fsync 执行完成后，主线程执行 write 才能成功返回</strong>。</p> <p>看到了么？在这个过程中，主线程依旧有阻塞的风险。</p> <p><img src="/assets/img/redis-performance-7.4b59e114.jpeg" alt=""></p> <p>所以，尽管你的 AOF 配置为 appendfsync everysec，也不能掉以轻心，要警惕磁盘压力过大导致的 Redis 有性能问题。</p> <p>那什么情况下会导致磁盘 IO 负载过大？以及如何解决这个问题呢？</p> <p>我总结了以下几种情况，你可以参考进行问题排查：</p> <ul><li>子进程正在执行 AOF rewrite，这个过程会占用大量的磁盘 IO 资源</li> <li>有其他应用程序在执行大量的写文件操作，也会占用磁盘 IO 资源</li></ul> <p>对于情况1，说白了就是，Redis 的 AOF 后台子线程刷盘操作，撞上了子进程 AOF rewrite！</p> <p>这怎么办？难道要关闭 AOF rewrite 才行？</p> <p>幸运的是，Redis 提供了一个配置项，当子进程在 AOF rewrite 期间，可以让后台子线程不执行刷盘（不触发 fsync 系统调用）操作。</p> <p>这相当于在 AOF rewrite 期间，临时把 appendfsync 设置为了 none，配置如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># AOF rewrite 期间，AOF 后台子线程不进行刷盘操作
# 相当于在这期间，临时把 appendfsync 设置为了 none
no-appendfsync-on-rewrite yes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>当然，开启这个配置项，在 AOF rewrite 期间，如果实例发生宕机，那么此时会丢失更多的数据，性能和数据安全性，你需要权衡后进行选择。</p> <p>如果占用磁盘资源的是其他应用程序，那就比较简单了，你需要定位到是哪个应用程序在大量写磁盘，然后把这个应用程序迁移到其他机器上执行就好了，避免对 Redis 产生影响。</p> <p>当然，如果你对 Redis 的性能和数据安全都有很高的要求，那么我建议从硬件层面来优化，更换为 SSD 磁盘，提高磁盘的 IO 能力，保证 AOF 期间有充足的磁盘资源可以使用。</p> <h1 id="绑定cpu"><a href="#绑定cpu" class="header-anchor">#</a> 绑定CPU</h1> <hr> <blockquote><p>很多时候，我们在部署服务时，为了提高服务性能，降低应用程序在多个 CPU 核心之间的上下文切换带来的性能损耗，通常采用的方案是进程绑定 CPU 的方式提高性能。</p></blockquote> <p>但在部署 Redis 时，如果你需要绑定 CPU 来提高其性能，我建议你仔细斟酌后再做操作。</p> <p><strong>为什么</strong>？</p> <p>因为 Redis 在绑定 CPU 时，是有很多考究的，如果你不了解 Redis 的运行原理，随意绑定 CPU 不仅不会提高性能，甚至有可能会带来相反的效果。</p> <p>我们都知道，一般现代的服务器会有多个 CPU，而每个 CPU 又包含多个物理核心，每个物理核心又分为多个逻辑核心，每个物理核下的逻辑核共用 L1/L2 Cache。</p> <p>而 Redis Server 除了主线程服务客户端请求之外，还会创建子进程、子线程。</p> <p>其中子进程用于数据持久化，而子线程用于执行一些比较耗时操作，例如异步释放 fd、异步 AOF 刷盘、异步 lazy-free 等等。</p> <p>如果你把 Redis 进程只绑定了一个 CPU 逻辑核心上，那么当 Redis 在进行数据持久化时，fork 出的子进程会继承父进程的 CPU 使用偏好。</p> <p>而此时的子进程会消耗大量的 CPU 资源进行数据持久化（把实例数据全部扫描出来需要耗费CPU），这就会导致子进程会与主进程发生 CPU 争抢，进而影响到主进程服务客户端请求，访问延迟变大。</p> <p>这就是 Redis 绑定 CPU 带来的性能问题。</p> <p><strong>那如何解决这个问题呢</strong>？</p> <p>如果你确实想要绑定 CPU，可以优化的方案是，不要让 Redis 进程只绑定在一个 CPU 逻辑核上，而是绑定在多个逻辑核心上，而且，绑定的多个逻辑核心最好是同一个物理核心，这样它们还可以共用 L1/L2 Cache。</p> <p>当然，即便我们把 Redis 绑定在多个逻辑核心上，也只能在一定程度上缓解主线程、子进程、后台线程在 CPU 资源上的竞争。</p> <p>因为这些子进程、子线程还是会在这多个逻辑核心上进行切换，存在性能损耗。</p> <p><strong>如何再进一步优化</strong>？</p> <p>可能你已经想到了，我们是否可以让主线程、子进程、后台线程，分别绑定在固定的 CPU 核心上，不让它们来回切换，这样一来，他们各自使用的 CPU 资源互不影响。</p> <p>其实，这个方案 Redis 官方已经想到了。</p> <p>Redis 在 6.0 版本已经推出了这个功能，我们可以通过以下配置，对主线程、后台线程、后台 RDB 进程、AOF rewrite 进程，绑定固定的 CPU 逻辑核心：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># Redis Server 和 IO 线程绑定到 CPU核心 0,2,4,6
server_cpulist 0-7:2
 
# 后台子线程绑定到 CPU核心 1,3
bio_cpulist 1,3
 
# 后台 AOF rewrite 进程绑定到 CPU 核心 8,9,10,11
aof_rewrite_cpulist 8-11
 
# 后台 RDB 进程绑定到 CPU 核心 1,10,11
# bgsave_cpulist 1,10-1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>如果你使用的正好是 Redis 6.0 版本，就可以通过以上配置，来进一步提高 Redis 性能。</p> <p>这里我需要提醒你的是，一般来说，Redis 的性能已经足够优秀，除非你对 Redis 的性能有更加严苛的要求，否则不建议你绑定 CPU。</p> <p>从上面的分析你也能看出，绑定 CPU 需要你对计算机体系结构有非常清晰的了解，否则谨慎操作。</p> <p>我们继续分析还有什么场景会导致 Redis 变慢。</p> <h1 id="使用swap"><a href="#使用swap" class="header-anchor">#</a> 使用Swap</h1> <hr> <p>如果你发现 Redis 突然变得非常慢，<strong>每次的操作耗时都达到了几百毫秒甚至秒级</strong>，那此时你就需要检查 Redis 是否使用到了 Swap，在这种情况下 Redis 基本上已经无法提供高性能的服务了。</p> <p>什么是 Swap？为什么使用 Swap 会导致 Redis 的性能下降？</p> <p>如果你对操作系统有些了解，就会知道操作系统为了缓解内存不足对应用程序的影响，允许把一部分内存中的数据换到磁盘上，以达到应用程序对内存使用的缓冲，这些内存数据被换到磁盘上的区域，就是 Swap。</p> <p>问题就在于，当内存中的数据被换到磁盘上后，Redis 再访问这些数据时，就需要从磁盘上读取，访问磁盘的速度要比访问内存慢几百倍！</p> <p><strong>尤其是针对 Redis 这种对性能要求极高、性能极其敏感的数据库来说，这个操作延时是无法接受的</strong>。</p> <p>此时，你需要检查 Redis 机器的内存使用情况，确认是否存在使用了 Swap。</p> <p>你可以通过以下方式来查看 Redis 进程是否使用到了 Swap：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 先找到 Redis 的进程 ID
$ ps -aux | grep redis-server
 
# 查看 Redis Swap 使用情况
$ cat /proc/$pid/smaps | egrep '^(Swap|Size)'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>输出结果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Size:               1256 kB
Swap:                  0 kB
Size:                  4 kB
Swap:                  0 kB
Size:                132 kB
Swap:                  0 kB
Size:              63488 kB
Swap:                  0 kB
Size:                132 kB
Swap:                  0 kB
Size:              65404 kB
Swap:                  0 kB
Size:            1921024 kB
Swap:                  0 kB
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这个结果会列出 Redis 进程的内存使用情况。</p> <p>每一行 Size 表示 Redis 所用的一块内存大小，Size 下面的 Swap 就表示这块 Size 大小的内存，有多少数据已经被换到磁盘上了，如果这两个值相等，说明这块内存的数据都已经完全被换到磁盘上了。</p> <p>如果只是少量数据被换到磁盘上，例如每一块 Swap 占对应 Size 的比例很小，那影响并不是很大。<strong>如果是几百兆甚至上 GB 的内存被换到了磁盘上，那么你就需要警惕了，这种情况 Redis 的性能肯定会急剧下降</strong>。</p> <p>此时的解决方案是：</p> <ul><li>增加机器的内存，让 Redis 有足够的内存可以使用</li> <li>整理内存空间，释放出足够的内存供 Redis 使用，然后释放 Redis 的 Swap，让 Redis 重新使用内存</li></ul> <p>释放 Redis 的 Swap 过程通常要重启实例，为了避免重启实例对业务的影响，一般会先进行主从切换，然后释放旧主节点的 Swap，重启旧主节点实例，待从库数据同步完成后，再进行主从切换即可。</p> <p>可见，当 Redis 使用到 Swap 后，此时的 Redis 性能基本已达不到高性能的要求（你可以理解为武功被废），所以你也需要提前预防这种情况。</p> <p>预防的办法就是，你需要对 Redis 机器的内存和 Swap 使用情况进行监控，在内存不足或使用到 Swap 时报警出来，及时处理。</p> <h1 id="碎片整理"><a href="#碎片整理" class="header-anchor">#</a> 碎片整理</h1> <hr> <blockquote><p>Redis 的数据都存储在内存中，当我们的应用程序频繁修改 Redis 中的数据时，就有可能会导致 Redis 产生内存碎片。</p></blockquote> <p>内存碎片会降低 Redis 的内存使用率，我们可以通过执行 INFO 命令，得到这个实例的内存碎片率：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># Memory
used_memory:5709194824
used_memory_human:5.32G
used_memory_rss:8264855552
used_memory_rss_human:7.70G
...
mem_fragmentation_ratio:1.45
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>这个内存碎片率是怎么计算的</strong>？</p> <p>很简单，mem_fragmentation_ratio = used_memory_rss / used_memory。</p> <p>其中 used_memory 表示 Redis 存储数据的内存大小，而 used_memory_rss 表示操作系统实际分配给 Redis 进程的大小。</p> <p>如果 mem_fragmentation_ratio &gt; 1.5，说明内存碎片率已经超过了 50%，这时我们就需要采取一些措施来降低内存碎片了。</p> <p>解决的方案一般如下：</p> <ul><li>如果你使用的是 Redis 4.0 以下版本，只能通过重启实例来解决</li> <li>如果你使用的是 Redis 4.0 版本，它正好提供了自动碎片整理的功能，可以通过配置开启碎片自动整理</li></ul> <p>但是，开启内存碎片整理，它也有可能会导致 Redis 性能下降。</p> <p>原因在于，Redis 的碎片整理工作是也在主线程中执行的，当其进行碎片整理时，必然会消耗 CPU 资源，产生更多的耗时，从而影响到客户端的请求。</p> <p>所以，当你需要开启这个功能时，最好提前测试评估它对 Redis 的影响。</p> <p>Redis 碎片整理的参数配置如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 开启自动内存碎片整理（总开关）
activedefrag yes
 
# 内存使用 100MB 以下，不进行碎片整理
active-defrag-ignore-bytes 100mb
 
# 内存碎片率超过 10%，开始碎片整理
active-defrag-threshold-lower 10
# 内存碎片率超过 100%，尽最大努力碎片整理
active-defrag-threshold-upper 100
 
# 内存碎片整理占用 CPU 资源最小百分比
active-defrag-cycle-min 1
# 内存碎片整理占用 CPU 资源最大百分比
active-defrag-cycle-max 25
 
# 碎片整理期间，对于 List/Set/Hash/ZSet 类型元素一次 Scan 的数量
active-defrag-max-scan-fields 1000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>你需要结合 Redis 机器的负载情况，以及应用程序可接受的延迟范围进行评估，合理调整碎片整理的参数，尽可能降低碎片整理期间对 Redis 的影响。</p> <h1 id="网络带宽过载"><a href="#网络带宽过载" class="header-anchor">#</a> 网络带宽过载</h1> <hr> <blockquote><p>如果以上产生性能问题的场景，你都规避掉了，而且 Redis 也稳定运行了很长时间，但在某个时间点之后开始，操作 Redis 突然开始变慢了，而且一直持续下去，这种情况又是什么原因导致？</p></blockquote> <p>此时你需要排查一下 Redis 机器的网络带宽是否过载，是否存在某个实例把整个机器的网路带宽占满的情况。</p> <p>网络带宽过载的情况下，服务器在 TCP 层和网络层就会出现数据包发送延迟、丢包等情况。</p> <p>Redis 的高性能，除了操作内存之外，就在于网络 IO 了，如果网络 IO 存在瓶颈，那么也会严重影响 Redis 的性能。</p> <p>如果确实出现这种情况，你需要及时确认占满网络带宽 Redis 实例，如果属于正常的业务访问，那就需要及时扩容或迁移实例了，避免因为这个实例流量过大，影响这个机器的其他实例。</p> <p>运维层面，你需要对 Redis 机器的各项指标增加监控，包括网络流量，在网络流量达到一定阈值时提前报警，及时确认和扩容。</p> <h1 id="其他原因"><a href="#其他原因" class="header-anchor">#</a> 其他原因</h1> <hr> <p>好了，以上这些方面就是如何排查 Redis 延迟问题的思路和路径。</p> <p>除了以上这些，还有一些比较小的点，你也需要注意一下：</p> <ul><li><strong>频繁短连接</strong></li></ul> <p>你的业务应用，应该使用长连接操作 Redis，避免频繁的短连接。</p> <p>频繁的短连接会导致 Redis 大量时间耗费在连接的建立和释放上，TCP 的三次握手和四次挥手同样也会增加访问延迟。</p> <ul><li><strong>运维监控</strong></li></ul> <p>前面我也提到了，要想提前预知 Redis 变慢的情况发生，必不可少的就是做好完善的监控。</p> <p>监控其实就是对采集 Redis 的各项运行时指标，通常的做法是监控程序定时采集 Redis 的 INFO 信息，然后根据 INFO 信息中的状态数据做数据展示和报警。</p> <p>这里我需要提醒你的是，在写一些监控脚本，或使用开源的监控组件时，也不能掉以轻心。</p> <p>在写监控脚本访问 Redis 时，尽量采用长连接的方式采集状态信息，避免频繁短连接。同时，你还要注意控制访问 Redis 的频率，避免影响到业务请求。</p> <p>在使用一些开源的监控组件时，最好了解一下这些组件的实现原理，以及正确配置这些组件，防止出现监控组件发生 Bug，导致短时大量操作 Redis，影响 Redis 性能的情况发生。</p> <p>我们当时就发生过，DBA 在使用一些开源组件时，因为配置和使用问题，导致监控程序频繁地与 Redis 建立和断开连接，导致 Redis 响应变慢。</p> <ul><li><strong>其它程序争抢资源</strong></li></ul> <p>最后需要提醒你的是，你的 Redis 机器最好专项专用，只用来部署 Redis 实例，不要部署其他应用程序，尽量给 Redis 提供一个相对「安静」的环境，避免其它程序占用 CPU、内存、磁盘资源，导致分配给 Redis 的资源不足而受到影响。</p> <h1 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h1> <hr> <blockquote><p>好了，以上就是我总结的在使用 Redis 过程中，常见的可能导致延迟、甚至阻塞的问题场景，以及如何快速定位和分析这些问题，并且针对性地提供了解决方案。</p></blockquote> <p>这里我也汇总成了思维导图，方便你在排查 Redis 性能问题时，快速地去分析和定位。</p> <p><img src="/assets/img/redis-performance-8.1973fad4.png" alt=""></p> <p>这里再简单总结一下，Redis 的性能问题，既涉及到了业务开发人员的使用方面，也涉及到了 DBA 的运维方面。</p> <p>作为业务开发人员，我们需要了解 Redis 的基本原理，例如各个命令执行的时间复杂度、数据过期策略、数据淘汰策略等，从而更合理地使用 Redis 命令，并且结合业务场景进行优化。</p> <p>作为 DBA 和运维人员，需要了解 Redis 运行机制，例如数据持久化、内存碎片整理、进程绑核配置。除此之外，还需要了解操作系统相关知识，例如写时复制、内存大页、Swap 机制等等。</p> <p>同时，DBA 在部署 Redis 时，需要提前对进行容量规划，预留足够的机器资源，还要对 Redis 机器和实例做好完善的监控，这样才能尽可能地保证 Redis 的稳定运行。</p> <h1 id="后记"><a href="#后记" class="header-anchor">#</a> 后记</h1> <hr> <blockquote><p>如果你能耐心地看到这里，想必你肯定已经对 Redis 的性能调优有了很大的收获。</p></blockquote> <p>你应该也发现了，Redis 的性能问题，涉及到的知识点非常广，几乎涵盖了 CPU、内存、网络、甚至磁盘的方方面面，同时，你还需要了解计算机的体系结构，以及操作系统的各种机制。</p> <p>从资源使用角度来看，包含的知识点如下：</p> <ul><li><strong>CPU 相关</strong>：使用复杂度过高命令、数据的持久化，都与耗费过多的 CPU 资源有关</li> <li><strong>内存相关</strong>：bigkey 内存的申请和释放、数据过期、数据淘汰、碎片整理、内存大页、内存写时复制都与内存息息相关</li> <li><strong>磁盘相关</strong>：数据持久化、AOF 刷盘策略，也会受到磁盘的影响</li> <li><strong>网络相关</strong>：短连接、实例流量过载、网络流量过载，也会降低 Redis 性能</li> <li><strong>计算机系统</strong>：CPU 结构、内存分配，都属于最基础的计算机系统知识</li> <li><strong>操作系统</strong>：写时复制、内存大页、Swap、CPU 绑定，都属于操作系统层面的知识</li></ul> <p>没想到吧？Redis 为了把性能做到极致，涉及到了这么多项优化。</p> <h1 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h1> <hr> <ul><li>公众号：水滴与银弹</li> <li>原文：Redis为什么变慢了？一文讲透如何排查Redis性能问题</li> <li>本文为「水滴与银弹」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明)</li></ul></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://fanxgit.github.io/fanxNotes/edit/master/docs/database/04.NoSQL - Redis/19.Redis进阶 - 性能调优-Redis性能调优详解.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/17/2023, 5:04:28 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/f61c59/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Redis进阶 - 运维监控-Redis的监控详解</div></a> <a href="/pages/cff377/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Redis大厂经验 - 微博-万亿级日访问量下，Redis在微博的9年优化历程</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/f61c59/" class="prev">Redis进阶 - 运维监控-Redis的监控详解</a></span> <span class="next"><a href="/pages/cff377/">Redis大厂经验 - 微博-万亿级日访问量下，Redis在微博的9年优化历程</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/797621/"><div>
            VuePress+GithubPages教程
            <!----></div></a> <span class="date">11-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/016620/"><div>
            java打jar包整理
            <!----></div></a> <span class="date">11-19</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/b23a10/"><div>
            多线程问题总结
            <!----></div></a> <span class="date">11-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.38fd400a.js" defer></script><script src="/assets/js/3.e11db813.js" defer></script><script src="/assets/js/149.cb6f2cb0.js" defer></script>
  </body>
</html>
