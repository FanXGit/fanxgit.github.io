<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES详解 - 原理-ES原理之索引文档流程详解 | Fanx 知识库</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/logo.svg">[object Object]
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.6ece31e0.css" as="style"><link rel="preload" href="/assets/js/app.38fd400a.js" as="script"><link rel="preload" href="/assets/js/3.e11db813.js" as="script"><link rel="preload" href="/assets/js/80.9205cc43.js" as="script"><link rel="prefetch" href="/assets/js/10.939e2dd4.js"><link rel="prefetch" href="/assets/js/100.4a08f581.js"><link rel="prefetch" href="/assets/js/101.45cd45c9.js"><link rel="prefetch" href="/assets/js/102.ac1359d1.js"><link rel="prefetch" href="/assets/js/103.22344102.js"><link rel="prefetch" href="/assets/js/104.5071cdfd.js"><link rel="prefetch" href="/assets/js/105.7767c121.js"><link rel="prefetch" href="/assets/js/106.809b79f1.js"><link rel="prefetch" href="/assets/js/107.62fd626a.js"><link rel="prefetch" href="/assets/js/108.0583fdc1.js"><link rel="prefetch" href="/assets/js/109.fa127771.js"><link rel="prefetch" href="/assets/js/11.6463adc8.js"><link rel="prefetch" href="/assets/js/110.5cf9f09c.js"><link rel="prefetch" href="/assets/js/111.9d963667.js"><link rel="prefetch" href="/assets/js/112.bc2b8a6e.js"><link rel="prefetch" href="/assets/js/113.2ae29573.js"><link rel="prefetch" href="/assets/js/114.0b2cedfa.js"><link rel="prefetch" href="/assets/js/115.652e433e.js"><link rel="prefetch" href="/assets/js/116.bcc5d64a.js"><link rel="prefetch" href="/assets/js/117.30b02d0d.js"><link rel="prefetch" href="/assets/js/118.87f4f927.js"><link rel="prefetch" href="/assets/js/119.05839492.js"><link rel="prefetch" href="/assets/js/12.a17960e5.js"><link rel="prefetch" href="/assets/js/120.3d772c9c.js"><link rel="prefetch" href="/assets/js/121.bd8fcebf.js"><link rel="prefetch" href="/assets/js/122.e58d2205.js"><link rel="prefetch" href="/assets/js/123.f2c2826d.js"><link rel="prefetch" href="/assets/js/124.12d9ff87.js"><link rel="prefetch" href="/assets/js/125.c7e4bf1c.js"><link rel="prefetch" href="/assets/js/126.71c358fb.js"><link rel="prefetch" href="/assets/js/127.fb1922e5.js"><link rel="prefetch" href="/assets/js/128.25cbf771.js"><link rel="prefetch" href="/assets/js/129.50047ea3.js"><link rel="prefetch" href="/assets/js/13.727ebfda.js"><link rel="prefetch" href="/assets/js/130.a77cfa28.js"><link rel="prefetch" href="/assets/js/131.1618c1f5.js"><link rel="prefetch" href="/assets/js/132.4073573b.js"><link rel="prefetch" href="/assets/js/133.f6e4882f.js"><link rel="prefetch" href="/assets/js/134.1de81973.js"><link rel="prefetch" href="/assets/js/135.43148a0c.js"><link rel="prefetch" href="/assets/js/136.12b3ef34.js"><link rel="prefetch" href="/assets/js/137.accefc34.js"><link rel="prefetch" href="/assets/js/138.8d3115ff.js"><link rel="prefetch" href="/assets/js/139.6e492e2b.js"><link rel="prefetch" href="/assets/js/14.bc6d3062.js"><link rel="prefetch" href="/assets/js/140.3d98f006.js"><link rel="prefetch" href="/assets/js/141.542d08af.js"><link rel="prefetch" href="/assets/js/142.c91a19a2.js"><link rel="prefetch" href="/assets/js/143.0c681ed2.js"><link rel="prefetch" href="/assets/js/144.62e9c646.js"><link rel="prefetch" href="/assets/js/145.ebc34777.js"><link rel="prefetch" href="/assets/js/146.d94a04a7.js"><link rel="prefetch" href="/assets/js/147.b45158de.js"><link rel="prefetch" href="/assets/js/148.5dfa6740.js"><link rel="prefetch" href="/assets/js/149.cb6f2cb0.js"><link rel="prefetch" href="/assets/js/15.a9468bf1.js"><link rel="prefetch" href="/assets/js/150.9f58dbc6.js"><link rel="prefetch" href="/assets/js/151.0a1c07e3.js"><link rel="prefetch" href="/assets/js/152.eafe4843.js"><link rel="prefetch" href="/assets/js/153.fb94cab5.js"><link rel="prefetch" href="/assets/js/154.07f7a11d.js"><link rel="prefetch" href="/assets/js/155.7f6da40b.js"><link rel="prefetch" href="/assets/js/156.2f007ca1.js"><link rel="prefetch" href="/assets/js/157.a35b5249.js"><link rel="prefetch" href="/assets/js/158.540f7a5a.js"><link rel="prefetch" href="/assets/js/159.f62e0315.js"><link rel="prefetch" href="/assets/js/16.ace3b806.js"><link rel="prefetch" href="/assets/js/160.e043c758.js"><link rel="prefetch" href="/assets/js/161.d90141bf.js"><link rel="prefetch" href="/assets/js/162.ddcdbfb9.js"><link rel="prefetch" href="/assets/js/163.f1ba395e.js"><link rel="prefetch" href="/assets/js/164.9f398973.js"><link rel="prefetch" href="/assets/js/165.0db3da51.js"><link rel="prefetch" href="/assets/js/166.b5305797.js"><link rel="prefetch" href="/assets/js/167.e7b2f76b.js"><link rel="prefetch" href="/assets/js/168.a2ecf883.js"><link rel="prefetch" href="/assets/js/169.88bd4d26.js"><link rel="prefetch" href="/assets/js/17.60481837.js"><link rel="prefetch" href="/assets/js/170.fb1699e2.js"><link rel="prefetch" href="/assets/js/171.47268bef.js"><link rel="prefetch" href="/assets/js/172.79002327.js"><link rel="prefetch" href="/assets/js/173.3b1813fb.js"><link rel="prefetch" href="/assets/js/174.362811a9.js"><link rel="prefetch" href="/assets/js/175.bb48bcd7.js"><link rel="prefetch" href="/assets/js/176.97bbf32c.js"><link rel="prefetch" href="/assets/js/177.0717ff7a.js"><link rel="prefetch" href="/assets/js/178.75bff3b7.js"><link rel="prefetch" href="/assets/js/179.3e7db0a2.js"><link rel="prefetch" href="/assets/js/18.dd3c5709.js"><link rel="prefetch" href="/assets/js/180.c81da8dd.js"><link rel="prefetch" href="/assets/js/181.142d6d1c.js"><link rel="prefetch" href="/assets/js/182.fb312040.js"><link rel="prefetch" href="/assets/js/183.3684267e.js"><link rel="prefetch" href="/assets/js/184.ec2a13bc.js"><link rel="prefetch" href="/assets/js/185.a7acace4.js"><link rel="prefetch" href="/assets/js/186.7df28551.js"><link rel="prefetch" href="/assets/js/187.347e9348.js"><link rel="prefetch" href="/assets/js/188.07356026.js"><link rel="prefetch" href="/assets/js/189.0816176d.js"><link rel="prefetch" href="/assets/js/19.cc2d4ad1.js"><link rel="prefetch" href="/assets/js/190.fd5dd8cc.js"><link rel="prefetch" href="/assets/js/191.a938967e.js"><link rel="prefetch" href="/assets/js/192.859b71a1.js"><link rel="prefetch" href="/assets/js/193.adcf2ec3.js"><link rel="prefetch" href="/assets/js/194.69d1169c.js"><link rel="prefetch" href="/assets/js/195.ad7cbcc4.js"><link rel="prefetch" href="/assets/js/196.b65138da.js"><link rel="prefetch" href="/assets/js/197.b4fca73b.js"><link rel="prefetch" href="/assets/js/198.2494a23f.js"><link rel="prefetch" href="/assets/js/199.404b9ce1.js"><link rel="prefetch" href="/assets/js/2.938bab56.js"><link rel="prefetch" href="/assets/js/20.361e2bf6.js"><link rel="prefetch" href="/assets/js/200.42b54eae.js"><link rel="prefetch" href="/assets/js/201.ab495eb8.js"><link rel="prefetch" href="/assets/js/202.2cbc5c9a.js"><link rel="prefetch" href="/assets/js/203.abf3fde5.js"><link rel="prefetch" href="/assets/js/204.4fdd4cfb.js"><link rel="prefetch" href="/assets/js/205.411987d7.js"><link rel="prefetch" href="/assets/js/206.dbcab3ae.js"><link rel="prefetch" href="/assets/js/207.f1429354.js"><link rel="prefetch" href="/assets/js/208.f763286c.js"><link rel="prefetch" href="/assets/js/209.c1edbca5.js"><link rel="prefetch" href="/assets/js/21.ae1e88a3.js"><link rel="prefetch" href="/assets/js/210.b2a1501d.js"><link rel="prefetch" href="/assets/js/211.fe1fd5f7.js"><link rel="prefetch" href="/assets/js/212.0fd39a8f.js"><link rel="prefetch" href="/assets/js/213.bb3fc163.js"><link rel="prefetch" href="/assets/js/214.c42e1ef3.js"><link rel="prefetch" href="/assets/js/215.4f0fa915.js"><link rel="prefetch" href="/assets/js/216.07c485c9.js"><link rel="prefetch" href="/assets/js/217.ada25e7a.js"><link rel="prefetch" href="/assets/js/218.2f761d3c.js"><link rel="prefetch" href="/assets/js/219.32d1a663.js"><link rel="prefetch" href="/assets/js/22.0b09d67f.js"><link rel="prefetch" href="/assets/js/220.36c56cf4.js"><link rel="prefetch" href="/assets/js/221.3e0431e2.js"><link rel="prefetch" href="/assets/js/222.90aa0ff7.js"><link rel="prefetch" href="/assets/js/223.5966d7df.js"><link rel="prefetch" href="/assets/js/224.7e2329e1.js"><link rel="prefetch" href="/assets/js/225.2ed3675d.js"><link rel="prefetch" href="/assets/js/226.fa3cef02.js"><link rel="prefetch" href="/assets/js/227.07bf7bca.js"><link rel="prefetch" href="/assets/js/228.9ac2589a.js"><link rel="prefetch" href="/assets/js/229.b980e141.js"><link rel="prefetch" href="/assets/js/23.31ed5c2f.js"><link rel="prefetch" href="/assets/js/230.2c32e874.js"><link rel="prefetch" href="/assets/js/231.723e20cb.js"><link rel="prefetch" href="/assets/js/232.1f94511c.js"><link rel="prefetch" href="/assets/js/233.2d477f71.js"><link rel="prefetch" href="/assets/js/234.10141c75.js"><link rel="prefetch" href="/assets/js/235.a328b127.js"><link rel="prefetch" href="/assets/js/236.42419c3b.js"><link rel="prefetch" href="/assets/js/237.648ca44e.js"><link rel="prefetch" href="/assets/js/238.4b363b75.js"><link rel="prefetch" href="/assets/js/239.fe711a73.js"><link rel="prefetch" href="/assets/js/24.fe75e3fa.js"><link rel="prefetch" href="/assets/js/240.6baa12bf.js"><link rel="prefetch" href="/assets/js/241.6f375dc4.js"><link rel="prefetch" href="/assets/js/242.aee8e39d.js"><link rel="prefetch" href="/assets/js/243.bfc7f6e1.js"><link rel="prefetch" href="/assets/js/244.c73a14a7.js"><link rel="prefetch" href="/assets/js/245.a2352aa1.js"><link rel="prefetch" href="/assets/js/246.b12c3ae6.js"><link rel="prefetch" href="/assets/js/247.2f768275.js"><link rel="prefetch" href="/assets/js/248.3f79dfb1.js"><link rel="prefetch" href="/assets/js/249.7fd0cb75.js"><link rel="prefetch" href="/assets/js/25.f2e379df.js"><link rel="prefetch" href="/assets/js/250.df3f1d0a.js"><link rel="prefetch" href="/assets/js/251.a3865750.js"><link rel="prefetch" href="/assets/js/252.d62542df.js"><link rel="prefetch" href="/assets/js/253.59b2f200.js"><link rel="prefetch" href="/assets/js/254.522d17b5.js"><link rel="prefetch" href="/assets/js/255.0f95a196.js"><link rel="prefetch" href="/assets/js/256.31b37cbe.js"><link rel="prefetch" href="/assets/js/257.ff22ad12.js"><link rel="prefetch" href="/assets/js/258.15205e0b.js"><link rel="prefetch" href="/assets/js/259.f3b7c5aa.js"><link rel="prefetch" href="/assets/js/26.45264b04.js"><link rel="prefetch" href="/assets/js/260.fec3c7aa.js"><link rel="prefetch" href="/assets/js/261.d965ee56.js"><link rel="prefetch" href="/assets/js/262.76a7105b.js"><link rel="prefetch" href="/assets/js/263.e684cc46.js"><link rel="prefetch" href="/assets/js/264.59297da0.js"><link rel="prefetch" href="/assets/js/265.66182ed2.js"><link rel="prefetch" href="/assets/js/266.eec50d90.js"><link rel="prefetch" href="/assets/js/267.c85bce12.js"><link rel="prefetch" href="/assets/js/268.ef544f0c.js"><link rel="prefetch" href="/assets/js/269.8cfb5c6a.js"><link rel="prefetch" href="/assets/js/27.4e065810.js"><link rel="prefetch" href="/assets/js/270.b66cab3c.js"><link rel="prefetch" href="/assets/js/271.c1b7d136.js"><link rel="prefetch" href="/assets/js/272.0d7950c3.js"><link rel="prefetch" href="/assets/js/273.06349cca.js"><link rel="prefetch" href="/assets/js/274.9b442c09.js"><link rel="prefetch" href="/assets/js/275.11082d81.js"><link rel="prefetch" href="/assets/js/276.ce0abe31.js"><link rel="prefetch" href="/assets/js/277.4b7fcc53.js"><link rel="prefetch" href="/assets/js/278.129d0397.js"><link rel="prefetch" href="/assets/js/279.5c021f7c.js"><link rel="prefetch" href="/assets/js/28.126ecd33.js"><link rel="prefetch" href="/assets/js/280.d183c9e3.js"><link rel="prefetch" href="/assets/js/281.0df67750.js"><link rel="prefetch" href="/assets/js/282.8fdd2372.js"><link rel="prefetch" href="/assets/js/283.dae956df.js"><link rel="prefetch" href="/assets/js/284.c5dc7189.js"><link rel="prefetch" href="/assets/js/285.7f5a7367.js"><link rel="prefetch" href="/assets/js/286.d9bfcef5.js"><link rel="prefetch" href="/assets/js/287.4fa6a5c5.js"><link rel="prefetch" href="/assets/js/288.57904d2d.js"><link rel="prefetch" href="/assets/js/289.b96d7c2f.js"><link rel="prefetch" href="/assets/js/29.8f5db82a.js"><link rel="prefetch" href="/assets/js/290.8dda9646.js"><link rel="prefetch" href="/assets/js/291.ab433493.js"><link rel="prefetch" href="/assets/js/292.e2d59796.js"><link rel="prefetch" href="/assets/js/293.30f9fcc4.js"><link rel="prefetch" href="/assets/js/294.158492dc.js"><link rel="prefetch" href="/assets/js/295.33e3a53d.js"><link rel="prefetch" href="/assets/js/296.49d7a2de.js"><link rel="prefetch" href="/assets/js/297.1b7572ac.js"><link rel="prefetch" href="/assets/js/298.00e4586a.js"><link rel="prefetch" href="/assets/js/299.d8fb6ff9.js"><link rel="prefetch" href="/assets/js/30.ef97cb8e.js"><link rel="prefetch" href="/assets/js/300.90e9dadf.js"><link rel="prefetch" href="/assets/js/301.d5592ea1.js"><link rel="prefetch" href="/assets/js/302.b08dc1ea.js"><link rel="prefetch" href="/assets/js/303.bef541c8.js"><link rel="prefetch" href="/assets/js/304.be3f7081.js"><link rel="prefetch" href="/assets/js/305.13718421.js"><link rel="prefetch" href="/assets/js/306.41685aa2.js"><link rel="prefetch" href="/assets/js/307.6d569102.js"><link rel="prefetch" href="/assets/js/308.aaabab89.js"><link rel="prefetch" href="/assets/js/309.910ecc42.js"><link rel="prefetch" href="/assets/js/31.795b3334.js"><link rel="prefetch" href="/assets/js/310.104b7753.js"><link rel="prefetch" href="/assets/js/311.45f4a7da.js"><link rel="prefetch" href="/assets/js/312.180c7e45.js"><link rel="prefetch" href="/assets/js/313.87d3a801.js"><link rel="prefetch" href="/assets/js/314.7739b1ef.js"><link rel="prefetch" href="/assets/js/315.54a1fac0.js"><link rel="prefetch" href="/assets/js/316.a978a787.js"><link rel="prefetch" href="/assets/js/317.84f65f2c.js"><link rel="prefetch" href="/assets/js/318.7f8caff8.js"><link rel="prefetch" href="/assets/js/319.0b5276f3.js"><link rel="prefetch" href="/assets/js/32.e65c7229.js"><link rel="prefetch" href="/assets/js/320.ba90589a.js"><link rel="prefetch" href="/assets/js/321.b6810c5a.js"><link rel="prefetch" href="/assets/js/322.2eaa727d.js"><link rel="prefetch" href="/assets/js/323.17573ee3.js"><link rel="prefetch" href="/assets/js/324.806fd6ca.js"><link rel="prefetch" href="/assets/js/325.4cd65079.js"><link rel="prefetch" href="/assets/js/326.fe0e2e22.js"><link rel="prefetch" href="/assets/js/327.a64d0209.js"><link rel="prefetch" href="/assets/js/328.aca1c89a.js"><link rel="prefetch" href="/assets/js/329.53ccf1dd.js"><link rel="prefetch" href="/assets/js/33.9a57aab8.js"><link rel="prefetch" href="/assets/js/330.92822a09.js"><link rel="prefetch" href="/assets/js/331.6b82baff.js"><link rel="prefetch" href="/assets/js/332.fc20f585.js"><link rel="prefetch" href="/assets/js/333.005ba8e3.js"><link rel="prefetch" href="/assets/js/334.9d3309b8.js"><link rel="prefetch" href="/assets/js/335.0e938f19.js"><link rel="prefetch" href="/assets/js/336.01fe9903.js"><link rel="prefetch" href="/assets/js/337.e207d67c.js"><link rel="prefetch" href="/assets/js/338.bfcf6bc8.js"><link rel="prefetch" href="/assets/js/339.a502aa64.js"><link rel="prefetch" href="/assets/js/34.3835d35c.js"><link rel="prefetch" href="/assets/js/340.3888b147.js"><link rel="prefetch" href="/assets/js/341.20297f95.js"><link rel="prefetch" href="/assets/js/342.9cd149e9.js"><link rel="prefetch" href="/assets/js/343.faac8369.js"><link rel="prefetch" href="/assets/js/344.da8cd079.js"><link rel="prefetch" href="/assets/js/345.78303b88.js"><link rel="prefetch" href="/assets/js/346.d8eaca82.js"><link rel="prefetch" href="/assets/js/347.edd389a1.js"><link rel="prefetch" href="/assets/js/348.21ee9617.js"><link rel="prefetch" href="/assets/js/349.0251471a.js"><link rel="prefetch" href="/assets/js/35.76dc7096.js"><link rel="prefetch" href="/assets/js/350.710b7d30.js"><link rel="prefetch" href="/assets/js/351.535f8d60.js"><link rel="prefetch" href="/assets/js/352.c66fe42e.js"><link rel="prefetch" href="/assets/js/353.ebbcd333.js"><link rel="prefetch" href="/assets/js/354.7cbba2f1.js"><link rel="prefetch" href="/assets/js/355.0106db16.js"><link rel="prefetch" href="/assets/js/356.7debf350.js"><link rel="prefetch" href="/assets/js/357.a43eb887.js"><link rel="prefetch" href="/assets/js/358.28e5d2ed.js"><link rel="prefetch" href="/assets/js/359.956fc3b8.js"><link rel="prefetch" href="/assets/js/36.fc54452c.js"><link rel="prefetch" href="/assets/js/360.13fb600a.js"><link rel="prefetch" href="/assets/js/361.d100f85b.js"><link rel="prefetch" href="/assets/js/362.35277df2.js"><link rel="prefetch" href="/assets/js/363.d993a7fc.js"><link rel="prefetch" href="/assets/js/364.0168c2b0.js"><link rel="prefetch" href="/assets/js/365.bc8af0bb.js"><link rel="prefetch" href="/assets/js/366.2645dc0d.js"><link rel="prefetch" href="/assets/js/367.87368acb.js"><link rel="prefetch" href="/assets/js/368.0b7d41fc.js"><link rel="prefetch" href="/assets/js/369.4bf3f46e.js"><link rel="prefetch" href="/assets/js/37.5a47cee9.js"><link rel="prefetch" href="/assets/js/370.ea5f965e.js"><link rel="prefetch" href="/assets/js/371.1af764ef.js"><link rel="prefetch" href="/assets/js/372.bf6c68e2.js"><link rel="prefetch" href="/assets/js/373.1a605cc8.js"><link rel="prefetch" href="/assets/js/374.34a41a4a.js"><link rel="prefetch" href="/assets/js/375.1d2d3776.js"><link rel="prefetch" href="/assets/js/376.4b7b0b10.js"><link rel="prefetch" href="/assets/js/377.b3d9748a.js"><link rel="prefetch" href="/assets/js/378.7f00fa88.js"><link rel="prefetch" href="/assets/js/379.adcd298a.js"><link rel="prefetch" href="/assets/js/38.6614c565.js"><link rel="prefetch" href="/assets/js/380.6d08bb56.js"><link rel="prefetch" href="/assets/js/381.164bb4e3.js"><link rel="prefetch" href="/assets/js/382.f71f0ca4.js"><link rel="prefetch" href="/assets/js/383.01ba70ad.js"><link rel="prefetch" href="/assets/js/384.22b98cde.js"><link rel="prefetch" href="/assets/js/385.5f1298a9.js"><link rel="prefetch" href="/assets/js/386.01a912bc.js"><link rel="prefetch" href="/assets/js/387.3db4713f.js"><link rel="prefetch" href="/assets/js/388.4cde7d0f.js"><link rel="prefetch" href="/assets/js/389.d96bafad.js"><link rel="prefetch" href="/assets/js/39.1a09ed15.js"><link rel="prefetch" href="/assets/js/390.343bbc06.js"><link rel="prefetch" href="/assets/js/391.68b3e72a.js"><link rel="prefetch" href="/assets/js/392.f4f15e43.js"><link rel="prefetch" href="/assets/js/393.82475934.js"><link rel="prefetch" href="/assets/js/394.3101ea10.js"><link rel="prefetch" href="/assets/js/395.34083342.js"><link rel="prefetch" href="/assets/js/396.780d6efe.js"><link rel="prefetch" href="/assets/js/397.cb686f39.js"><link rel="prefetch" href="/assets/js/398.c4ad669f.js"><link rel="prefetch" href="/assets/js/399.ee8d28ad.js"><link rel="prefetch" href="/assets/js/4.c1dcb1a7.js"><link rel="prefetch" href="/assets/js/40.4216f4f9.js"><link rel="prefetch" href="/assets/js/400.23d48a38.js"><link rel="prefetch" href="/assets/js/401.319d7a68.js"><link rel="prefetch" href="/assets/js/402.25b27bd0.js"><link rel="prefetch" href="/assets/js/403.9a898a40.js"><link rel="prefetch" href="/assets/js/404.e3b49b79.js"><link rel="prefetch" href="/assets/js/405.7695b9f1.js"><link rel="prefetch" href="/assets/js/406.edb801f7.js"><link rel="prefetch" href="/assets/js/407.03c3f725.js"><link rel="prefetch" href="/assets/js/408.4345ef1f.js"><link rel="prefetch" href="/assets/js/409.77c34447.js"><link rel="prefetch" href="/assets/js/41.f035663a.js"><link rel="prefetch" href="/assets/js/410.7f6c0744.js"><link rel="prefetch" href="/assets/js/411.cb19323e.js"><link rel="prefetch" href="/assets/js/412.4b16959d.js"><link rel="prefetch" href="/assets/js/413.ff4f1ca2.js"><link rel="prefetch" href="/assets/js/414.b1ca1298.js"><link rel="prefetch" href="/assets/js/415.c2111593.js"><link rel="prefetch" href="/assets/js/416.a6d18039.js"><link rel="prefetch" href="/assets/js/417.dc36c66d.js"><link rel="prefetch" href="/assets/js/418.e7eba879.js"><link rel="prefetch" href="/assets/js/419.57673b9e.js"><link rel="prefetch" href="/assets/js/42.9c8cf569.js"><link rel="prefetch" href="/assets/js/420.ccd41fe0.js"><link rel="prefetch" href="/assets/js/421.ea69f0b0.js"><link rel="prefetch" href="/assets/js/422.093448e2.js"><link rel="prefetch" href="/assets/js/423.ae003f31.js"><link rel="prefetch" href="/assets/js/424.f670cd2b.js"><link rel="prefetch" href="/assets/js/425.6e814335.js"><link rel="prefetch" href="/assets/js/426.faf45206.js"><link rel="prefetch" href="/assets/js/427.cf6be942.js"><link rel="prefetch" href="/assets/js/428.9ff6199c.js"><link rel="prefetch" href="/assets/js/429.b6ef4678.js"><link rel="prefetch" href="/assets/js/43.717fe06b.js"><link rel="prefetch" href="/assets/js/430.e9575d07.js"><link rel="prefetch" href="/assets/js/431.8bf26a3e.js"><link rel="prefetch" href="/assets/js/432.5eaa2162.js"><link rel="prefetch" href="/assets/js/433.6dab12a1.js"><link rel="prefetch" href="/assets/js/434.fca918e8.js"><link rel="prefetch" href="/assets/js/435.4c8f9ad9.js"><link rel="prefetch" href="/assets/js/436.0f0de1a8.js"><link rel="prefetch" href="/assets/js/437.2221ab9f.js"><link rel="prefetch" href="/assets/js/438.37f28cfb.js"><link rel="prefetch" href="/assets/js/439.1e3f3611.js"><link rel="prefetch" href="/assets/js/44.705dc411.js"><link rel="prefetch" href="/assets/js/440.28ab35e8.js"><link rel="prefetch" href="/assets/js/441.8d006af8.js"><link rel="prefetch" href="/assets/js/442.2618a6e3.js"><link rel="prefetch" href="/assets/js/443.a7723674.js"><link rel="prefetch" href="/assets/js/444.18f23e7c.js"><link rel="prefetch" href="/assets/js/445.f4807c5a.js"><link rel="prefetch" href="/assets/js/446.77a5afc2.js"><link rel="prefetch" href="/assets/js/447.7f653483.js"><link rel="prefetch" href="/assets/js/448.1143c566.js"><link rel="prefetch" href="/assets/js/449.b788a288.js"><link rel="prefetch" href="/assets/js/45.6a225373.js"><link rel="prefetch" href="/assets/js/450.b6463ba3.js"><link rel="prefetch" href="/assets/js/451.fd4d46b9.js"><link rel="prefetch" href="/assets/js/452.e8de4fc2.js"><link rel="prefetch" href="/assets/js/453.4125e5e6.js"><link rel="prefetch" href="/assets/js/454.30af5d0a.js"><link rel="prefetch" href="/assets/js/455.9c919e58.js"><link rel="prefetch" href="/assets/js/456.22dbfa8f.js"><link rel="prefetch" href="/assets/js/457.e9c5248a.js"><link rel="prefetch" href="/assets/js/458.c0a9cf1d.js"><link rel="prefetch" href="/assets/js/459.b5e96042.js"><link rel="prefetch" href="/assets/js/46.515d085a.js"><link rel="prefetch" href="/assets/js/460.b4097efb.js"><link rel="prefetch" href="/assets/js/461.5d545741.js"><link rel="prefetch" href="/assets/js/462.402d4cdd.js"><link rel="prefetch" href="/assets/js/463.e6d6ea07.js"><link rel="prefetch" href="/assets/js/464.df817445.js"><link rel="prefetch" href="/assets/js/465.18a6bc2b.js"><link rel="prefetch" href="/assets/js/466.da313c0c.js"><link rel="prefetch" href="/assets/js/467.41294182.js"><link rel="prefetch" href="/assets/js/468.41c59467.js"><link rel="prefetch" href="/assets/js/469.d55da13c.js"><link rel="prefetch" href="/assets/js/47.a41193df.js"><link rel="prefetch" href="/assets/js/470.7457a92e.js"><link rel="prefetch" href="/assets/js/471.ed739bdf.js"><link rel="prefetch" href="/assets/js/472.83882459.js"><link rel="prefetch" href="/assets/js/473.fe2df51c.js"><link rel="prefetch" href="/assets/js/474.d40797b8.js"><link rel="prefetch" href="/assets/js/475.a00992a2.js"><link rel="prefetch" href="/assets/js/476.c7687189.js"><link rel="prefetch" href="/assets/js/477.fd4fd227.js"><link rel="prefetch" href="/assets/js/478.1ae08c3b.js"><link rel="prefetch" href="/assets/js/479.04a246c6.js"><link rel="prefetch" href="/assets/js/48.fe693306.js"><link rel="prefetch" href="/assets/js/480.36acb4ff.js"><link rel="prefetch" href="/assets/js/481.05d3129e.js"><link rel="prefetch" href="/assets/js/482.1741a02c.js"><link rel="prefetch" href="/assets/js/483.44cf2d25.js"><link rel="prefetch" href="/assets/js/484.9c14e5c6.js"><link rel="prefetch" href="/assets/js/485.ea0c1de1.js"><link rel="prefetch" href="/assets/js/486.8c683697.js"><link rel="prefetch" href="/assets/js/487.8b1eb604.js"><link rel="prefetch" href="/assets/js/488.ae16fca6.js"><link rel="prefetch" href="/assets/js/489.7f674a0d.js"><link rel="prefetch" href="/assets/js/49.a7d05a3d.js"><link rel="prefetch" href="/assets/js/490.52983854.js"><link rel="prefetch" href="/assets/js/491.968e7af4.js"><link rel="prefetch" href="/assets/js/492.e7f58bac.js"><link rel="prefetch" href="/assets/js/493.55afbb68.js"><link rel="prefetch" href="/assets/js/494.ac17d05b.js"><link rel="prefetch" href="/assets/js/495.d1ca2a12.js"><link rel="prefetch" href="/assets/js/496.d6841a0e.js"><link rel="prefetch" href="/assets/js/497.99431b4b.js"><link rel="prefetch" href="/assets/js/498.cacac1d8.js"><link rel="prefetch" href="/assets/js/499.c6b7fab0.js"><link rel="prefetch" href="/assets/js/5.f74a04c4.js"><link rel="prefetch" href="/assets/js/50.f59b29ea.js"><link rel="prefetch" href="/assets/js/500.abba24c7.js"><link rel="prefetch" href="/assets/js/501.e9496674.js"><link rel="prefetch" href="/assets/js/502.3ece0e86.js"><link rel="prefetch" href="/assets/js/503.974421d1.js"><link rel="prefetch" href="/assets/js/504.6e8d8539.js"><link rel="prefetch" href="/assets/js/505.b8161483.js"><link rel="prefetch" href="/assets/js/506.a6a6f2de.js"><link rel="prefetch" href="/assets/js/507.9c6955ee.js"><link rel="prefetch" href="/assets/js/508.223e145d.js"><link rel="prefetch" href="/assets/js/509.553e6f2c.js"><link rel="prefetch" href="/assets/js/51.428c5495.js"><link rel="prefetch" href="/assets/js/510.46e2eab7.js"><link rel="prefetch" href="/assets/js/511.24962b3f.js"><link rel="prefetch" href="/assets/js/512.a29fe236.js"><link rel="prefetch" href="/assets/js/513.8729b339.js"><link rel="prefetch" href="/assets/js/514.41199019.js"><link rel="prefetch" href="/assets/js/515.b1a71e99.js"><link rel="prefetch" href="/assets/js/516.001e3634.js"><link rel="prefetch" href="/assets/js/517.4de05581.js"><link rel="prefetch" href="/assets/js/518.57697c31.js"><link rel="prefetch" href="/assets/js/519.e962365e.js"><link rel="prefetch" href="/assets/js/52.c97c3911.js"><link rel="prefetch" href="/assets/js/520.e7775961.js"><link rel="prefetch" href="/assets/js/521.05b0ce57.js"><link rel="prefetch" href="/assets/js/522.49f7412e.js"><link rel="prefetch" href="/assets/js/523.b3d821b2.js"><link rel="prefetch" href="/assets/js/524.ab2395b7.js"><link rel="prefetch" href="/assets/js/525.25559bb4.js"><link rel="prefetch" href="/assets/js/526.23111d2a.js"><link rel="prefetch" href="/assets/js/527.c61f6e86.js"><link rel="prefetch" href="/assets/js/528.032fa7b6.js"><link rel="prefetch" href="/assets/js/529.3953f346.js"><link rel="prefetch" href="/assets/js/53.77f22b1a.js"><link rel="prefetch" href="/assets/js/530.b882066e.js"><link rel="prefetch" href="/assets/js/531.62dddf23.js"><link rel="prefetch" href="/assets/js/532.1826fe1a.js"><link rel="prefetch" href="/assets/js/533.a2e014bb.js"><link rel="prefetch" href="/assets/js/534.d5d89c00.js"><link rel="prefetch" href="/assets/js/535.4e5d7739.js"><link rel="prefetch" href="/assets/js/536.f2c700db.js"><link rel="prefetch" href="/assets/js/537.80aa278c.js"><link rel="prefetch" href="/assets/js/538.95e2f471.js"><link rel="prefetch" href="/assets/js/539.4e4ecfe8.js"><link rel="prefetch" href="/assets/js/54.d85b2f2e.js"><link rel="prefetch" href="/assets/js/540.00bd44e5.js"><link rel="prefetch" href="/assets/js/541.d740df14.js"><link rel="prefetch" href="/assets/js/542.5aadeaee.js"><link rel="prefetch" href="/assets/js/543.d42c9d9a.js"><link rel="prefetch" href="/assets/js/544.29704685.js"><link rel="prefetch" href="/assets/js/545.7fdb1a83.js"><link rel="prefetch" href="/assets/js/546.6b5655ea.js"><link rel="prefetch" href="/assets/js/547.c98e27c4.js"><link rel="prefetch" href="/assets/js/548.8edec06f.js"><link rel="prefetch" href="/assets/js/549.33b8eae3.js"><link rel="prefetch" href="/assets/js/55.80a4fa71.js"><link rel="prefetch" href="/assets/js/550.cb706b0e.js"><link rel="prefetch" href="/assets/js/551.79598cc6.js"><link rel="prefetch" href="/assets/js/552.69aa5f8b.js"><link rel="prefetch" href="/assets/js/553.7ccb8831.js"><link rel="prefetch" href="/assets/js/554.954013b2.js"><link rel="prefetch" href="/assets/js/555.960d7f8b.js"><link rel="prefetch" href="/assets/js/556.5c054c14.js"><link rel="prefetch" href="/assets/js/557.890045ea.js"><link rel="prefetch" href="/assets/js/558.f72f6668.js"><link rel="prefetch" href="/assets/js/559.452d8ff3.js"><link rel="prefetch" href="/assets/js/56.009b0340.js"><link rel="prefetch" href="/assets/js/560.1656e33f.js"><link rel="prefetch" href="/assets/js/561.bb4650eb.js"><link rel="prefetch" href="/assets/js/562.7322fd81.js"><link rel="prefetch" href="/assets/js/563.a34a68ea.js"><link rel="prefetch" href="/assets/js/564.6da92e18.js"><link rel="prefetch" href="/assets/js/565.01d288e5.js"><link rel="prefetch" href="/assets/js/566.6a3459a1.js"><link rel="prefetch" href="/assets/js/567.e3eb8e54.js"><link rel="prefetch" href="/assets/js/568.f95e0fba.js"><link rel="prefetch" href="/assets/js/569.a42d134c.js"><link rel="prefetch" href="/assets/js/57.25e8dd1c.js"><link rel="prefetch" href="/assets/js/570.87887d15.js"><link rel="prefetch" href="/assets/js/571.ce4b478b.js"><link rel="prefetch" href="/assets/js/572.634418a6.js"><link rel="prefetch" href="/assets/js/573.cd4cf02b.js"><link rel="prefetch" href="/assets/js/574.8bf073fa.js"><link rel="prefetch" href="/assets/js/575.c194dddb.js"><link rel="prefetch" href="/assets/js/576.7750193f.js"><link rel="prefetch" href="/assets/js/577.5daa388a.js"><link rel="prefetch" href="/assets/js/578.54bb0029.js"><link rel="prefetch" href="/assets/js/579.92f58c76.js"><link rel="prefetch" href="/assets/js/58.9c1eb9e5.js"><link rel="prefetch" href="/assets/js/580.0e543efb.js"><link rel="prefetch" href="/assets/js/581.4e0b0b47.js"><link rel="prefetch" href="/assets/js/582.8c172f83.js"><link rel="prefetch" href="/assets/js/583.c91c43e0.js"><link rel="prefetch" href="/assets/js/584.ca68d52b.js"><link rel="prefetch" href="/assets/js/585.663b17d3.js"><link rel="prefetch" href="/assets/js/586.9494847d.js"><link rel="prefetch" href="/assets/js/587.f3805773.js"><link rel="prefetch" href="/assets/js/588.8ae14be1.js"><link rel="prefetch" href="/assets/js/589.b4af88be.js"><link rel="prefetch" href="/assets/js/59.2a730e41.js"><link rel="prefetch" href="/assets/js/590.fb77fea8.js"><link rel="prefetch" href="/assets/js/591.a3aaa57c.js"><link rel="prefetch" href="/assets/js/592.54ec5f32.js"><link rel="prefetch" href="/assets/js/593.96eab5cb.js"><link rel="prefetch" href="/assets/js/594.e356725c.js"><link rel="prefetch" href="/assets/js/595.0a2c4ad4.js"><link rel="prefetch" href="/assets/js/596.2c075cd8.js"><link rel="prefetch" href="/assets/js/597.e904811b.js"><link rel="prefetch" href="/assets/js/598.f6ca8b71.js"><link rel="prefetch" href="/assets/js/599.ae3d12c4.js"><link rel="prefetch" href="/assets/js/6.451e012f.js"><link rel="prefetch" href="/assets/js/60.e6b60343.js"><link rel="prefetch" href="/assets/js/600.e71a0062.js"><link rel="prefetch" href="/assets/js/601.2571a19d.js"><link rel="prefetch" href="/assets/js/602.0f4fa961.js"><link rel="prefetch" href="/assets/js/603.d8387c37.js"><link rel="prefetch" href="/assets/js/604.69433906.js"><link rel="prefetch" href="/assets/js/605.1bc7d87a.js"><link rel="prefetch" href="/assets/js/606.ec419517.js"><link rel="prefetch" href="/assets/js/607.b473fb0b.js"><link rel="prefetch" href="/assets/js/608.a361b48c.js"><link rel="prefetch" href="/assets/js/609.9186f226.js"><link rel="prefetch" href="/assets/js/61.d50a156d.js"><link rel="prefetch" href="/assets/js/610.ff3cf241.js"><link rel="prefetch" href="/assets/js/611.c3c7e648.js"><link rel="prefetch" href="/assets/js/612.2a520ebd.js"><link rel="prefetch" href="/assets/js/613.42936ffc.js"><link rel="prefetch" href="/assets/js/614.3ca0de21.js"><link rel="prefetch" href="/assets/js/615.ecf60a47.js"><link rel="prefetch" href="/assets/js/616.17185e83.js"><link rel="prefetch" href="/assets/js/617.769d4cdf.js"><link rel="prefetch" href="/assets/js/618.015c6376.js"><link rel="prefetch" href="/assets/js/619.3af186d0.js"><link rel="prefetch" href="/assets/js/62.e24b7811.js"><link rel="prefetch" href="/assets/js/620.f8ff3784.js"><link rel="prefetch" href="/assets/js/621.4c21311f.js"><link rel="prefetch" href="/assets/js/622.355178df.js"><link rel="prefetch" href="/assets/js/623.45a30695.js"><link rel="prefetch" href="/assets/js/624.61e89d34.js"><link rel="prefetch" href="/assets/js/625.49e0d1ce.js"><link rel="prefetch" href="/assets/js/626.1b7ae767.js"><link rel="prefetch" href="/assets/js/627.b8c507cf.js"><link rel="prefetch" href="/assets/js/628.c5a43517.js"><link rel="prefetch" href="/assets/js/629.274eb0fd.js"><link rel="prefetch" href="/assets/js/63.b804baab.js"><link rel="prefetch" href="/assets/js/630.69e055ce.js"><link rel="prefetch" href="/assets/js/631.0892fc51.js"><link rel="prefetch" href="/assets/js/632.6a68e9a2.js"><link rel="prefetch" href="/assets/js/633.d536fe74.js"><link rel="prefetch" href="/assets/js/634.24695f39.js"><link rel="prefetch" href="/assets/js/635.3aeede9c.js"><link rel="prefetch" href="/assets/js/636.3628d8a6.js"><link rel="prefetch" href="/assets/js/637.40af5a79.js"><link rel="prefetch" href="/assets/js/638.15e257ae.js"><link rel="prefetch" href="/assets/js/639.31e6597c.js"><link rel="prefetch" href="/assets/js/64.eb5699ff.js"><link rel="prefetch" href="/assets/js/640.a071f6df.js"><link rel="prefetch" href="/assets/js/641.f9edd7bf.js"><link rel="prefetch" href="/assets/js/642.adcb583f.js"><link rel="prefetch" href="/assets/js/643.7c98a990.js"><link rel="prefetch" href="/assets/js/644.fb1213d8.js"><link rel="prefetch" href="/assets/js/645.220a5034.js"><link rel="prefetch" href="/assets/js/646.d66a419b.js"><link rel="prefetch" href="/assets/js/647.12ef89ab.js"><link rel="prefetch" href="/assets/js/648.a3112300.js"><link rel="prefetch" href="/assets/js/649.f457dfa5.js"><link rel="prefetch" href="/assets/js/65.0d8501b5.js"><link rel="prefetch" href="/assets/js/650.cc63d03b.js"><link rel="prefetch" href="/assets/js/651.16d1bbd6.js"><link rel="prefetch" href="/assets/js/652.0f5343f0.js"><link rel="prefetch" href="/assets/js/653.28f7710a.js"><link rel="prefetch" href="/assets/js/654.b343d473.js"><link rel="prefetch" href="/assets/js/655.215fe67b.js"><link rel="prefetch" href="/assets/js/656.79aa1653.js"><link rel="prefetch" href="/assets/js/657.c57f2b5c.js"><link rel="prefetch" href="/assets/js/658.d0aa0b95.js"><link rel="prefetch" href="/assets/js/659.2dfaed93.js"><link rel="prefetch" href="/assets/js/66.8361cc16.js"><link rel="prefetch" href="/assets/js/660.c00b347e.js"><link rel="prefetch" href="/assets/js/661.ecc4f968.js"><link rel="prefetch" href="/assets/js/662.06f83919.js"><link rel="prefetch" href="/assets/js/663.67d8849e.js"><link rel="prefetch" href="/assets/js/664.74dba1a9.js"><link rel="prefetch" href="/assets/js/665.28b450f0.js"><link rel="prefetch" href="/assets/js/666.0f4bb6ba.js"><link rel="prefetch" href="/assets/js/667.586074e3.js"><link rel="prefetch" href="/assets/js/668.b13c0e70.js"><link rel="prefetch" href="/assets/js/669.9d0d4cbc.js"><link rel="prefetch" href="/assets/js/67.37f46ba2.js"><link rel="prefetch" href="/assets/js/670.6b36ca72.js"><link rel="prefetch" href="/assets/js/671.33b2e754.js"><link rel="prefetch" href="/assets/js/672.3b02c287.js"><link rel="prefetch" href="/assets/js/673.3f274929.js"><link rel="prefetch" href="/assets/js/674.7d75584f.js"><link rel="prefetch" href="/assets/js/675.0de52334.js"><link rel="prefetch" href="/assets/js/676.6734133e.js"><link rel="prefetch" href="/assets/js/677.c6f4a973.js"><link rel="prefetch" href="/assets/js/678.1344b6be.js"><link rel="prefetch" href="/assets/js/679.23fed56f.js"><link rel="prefetch" href="/assets/js/68.27dbce5b.js"><link rel="prefetch" href="/assets/js/680.c49329d6.js"><link rel="prefetch" href="/assets/js/681.8df66615.js"><link rel="prefetch" href="/assets/js/682.77b4bff8.js"><link rel="prefetch" href="/assets/js/683.6cf41cf4.js"><link rel="prefetch" href="/assets/js/684.58deecd5.js"><link rel="prefetch" href="/assets/js/685.d2f7480e.js"><link rel="prefetch" href="/assets/js/686.0b77a241.js"><link rel="prefetch" href="/assets/js/687.2cc04b4f.js"><link rel="prefetch" href="/assets/js/688.da24cbae.js"><link rel="prefetch" href="/assets/js/689.a9961f74.js"><link rel="prefetch" href="/assets/js/69.8052a977.js"><link rel="prefetch" href="/assets/js/690.cb736269.js"><link rel="prefetch" href="/assets/js/691.21c13be1.js"><link rel="prefetch" href="/assets/js/692.3ed557d0.js"><link rel="prefetch" href="/assets/js/693.066efe93.js"><link rel="prefetch" href="/assets/js/694.5368f98a.js"><link rel="prefetch" href="/assets/js/695.4fdb93d5.js"><link rel="prefetch" href="/assets/js/696.9c055ac6.js"><link rel="prefetch" href="/assets/js/697.51e0c47c.js"><link rel="prefetch" href="/assets/js/698.08ca1dbd.js"><link rel="prefetch" href="/assets/js/699.ce7e9e2a.js"><link rel="prefetch" href="/assets/js/7.7e21c947.js"><link rel="prefetch" href="/assets/js/70.19faeb78.js"><link rel="prefetch" href="/assets/js/700.3676fa7f.js"><link rel="prefetch" href="/assets/js/701.82db4887.js"><link rel="prefetch" href="/assets/js/702.73425f22.js"><link rel="prefetch" href="/assets/js/703.d9391c74.js"><link rel="prefetch" href="/assets/js/704.d6e275cf.js"><link rel="prefetch" href="/assets/js/705.d2f23969.js"><link rel="prefetch" href="/assets/js/706.1c66dcc1.js"><link rel="prefetch" href="/assets/js/707.0fc5a26a.js"><link rel="prefetch" href="/assets/js/708.97471ee6.js"><link rel="prefetch" href="/assets/js/709.9b4d5665.js"><link rel="prefetch" href="/assets/js/71.d1683810.js"><link rel="prefetch" href="/assets/js/710.75fa8103.js"><link rel="prefetch" href="/assets/js/711.43777b40.js"><link rel="prefetch" href="/assets/js/712.5c583e39.js"><link rel="prefetch" href="/assets/js/713.5aa72111.js"><link rel="prefetch" href="/assets/js/714.e8215702.js"><link rel="prefetch" href="/assets/js/715.46614e7c.js"><link rel="prefetch" href="/assets/js/716.eaac6d69.js"><link rel="prefetch" href="/assets/js/717.c344c042.js"><link rel="prefetch" href="/assets/js/718.437bf0b2.js"><link rel="prefetch" href="/assets/js/719.23aa3deb.js"><link rel="prefetch" href="/assets/js/72.9fa783f0.js"><link rel="prefetch" href="/assets/js/720.9456a449.js"><link rel="prefetch" href="/assets/js/721.67fd324a.js"><link rel="prefetch" href="/assets/js/722.fc5e79ca.js"><link rel="prefetch" href="/assets/js/723.46db8115.js"><link rel="prefetch" href="/assets/js/724.31a11b8c.js"><link rel="prefetch" href="/assets/js/725.49cef603.js"><link rel="prefetch" href="/assets/js/726.7d0a2e7f.js"><link rel="prefetch" href="/assets/js/727.a1de6f02.js"><link rel="prefetch" href="/assets/js/728.7e0a727e.js"><link rel="prefetch" href="/assets/js/729.b6bf04fa.js"><link rel="prefetch" href="/assets/js/73.1ac0ac37.js"><link rel="prefetch" href="/assets/js/730.1c102528.js"><link rel="prefetch" href="/assets/js/731.80403e3d.js"><link rel="prefetch" href="/assets/js/732.cf8b4a6d.js"><link rel="prefetch" href="/assets/js/733.aab88d38.js"><link rel="prefetch" href="/assets/js/734.965a0adc.js"><link rel="prefetch" href="/assets/js/735.f9d33608.js"><link rel="prefetch" href="/assets/js/736.d1621f9e.js"><link rel="prefetch" href="/assets/js/737.a12ea0d3.js"><link rel="prefetch" href="/assets/js/738.96e61512.js"><link rel="prefetch" href="/assets/js/739.9bce4dfe.js"><link rel="prefetch" href="/assets/js/74.1913daec.js"><link rel="prefetch" href="/assets/js/740.c1a0bf7b.js"><link rel="prefetch" href="/assets/js/741.0185115e.js"><link rel="prefetch" href="/assets/js/742.21e99d78.js"><link rel="prefetch" href="/assets/js/743.e5f2407e.js"><link rel="prefetch" href="/assets/js/744.53d4e25a.js"><link rel="prefetch" href="/assets/js/745.9fb6722c.js"><link rel="prefetch" href="/assets/js/746.893e3a2f.js"><link rel="prefetch" href="/assets/js/747.ad94fed4.js"><link rel="prefetch" href="/assets/js/748.3421b09b.js"><link rel="prefetch" href="/assets/js/749.15c364e9.js"><link rel="prefetch" href="/assets/js/75.d63a9540.js"><link rel="prefetch" href="/assets/js/750.4e5379b7.js"><link rel="prefetch" href="/assets/js/751.18b0273f.js"><link rel="prefetch" href="/assets/js/752.24717596.js"><link rel="prefetch" href="/assets/js/753.5868bcc4.js"><link rel="prefetch" href="/assets/js/754.77808a6c.js"><link rel="prefetch" href="/assets/js/755.af7f7a71.js"><link rel="prefetch" href="/assets/js/76.342d837c.js"><link rel="prefetch" href="/assets/js/77.466349c3.js"><link rel="prefetch" href="/assets/js/78.886d05b6.js"><link rel="prefetch" href="/assets/js/79.b478bdab.js"><link rel="prefetch" href="/assets/js/8.9f40767d.js"><link rel="prefetch" href="/assets/js/81.77f831c9.js"><link rel="prefetch" href="/assets/js/82.650475d1.js"><link rel="prefetch" href="/assets/js/83.aa7e3d4b.js"><link rel="prefetch" href="/assets/js/84.2fc92fb4.js"><link rel="prefetch" href="/assets/js/85.0f633e10.js"><link rel="prefetch" href="/assets/js/86.e862f4bc.js"><link rel="prefetch" href="/assets/js/87.8a869468.js"><link rel="prefetch" href="/assets/js/88.6c584051.js"><link rel="prefetch" href="/assets/js/89.3ab84e02.js"><link rel="prefetch" href="/assets/js/9.7ed864ce.js"><link rel="prefetch" href="/assets/js/90.41e6925d.js"><link rel="prefetch" href="/assets/js/91.55055993.js"><link rel="prefetch" href="/assets/js/92.ced7b439.js"><link rel="prefetch" href="/assets/js/93.41cc8a7f.js"><link rel="prefetch" href="/assets/js/94.6d2b144f.js"><link rel="prefetch" href="/assets/js/95.399a7909.js"><link rel="prefetch" href="/assets/js/96.556f8f9f.js"><link rel="prefetch" href="/assets/js/97.47ecdf46.js"><link rel="prefetch" href="/assets/js/98.fdbe6822.js"><link rel="prefetch" href="/assets/js/99.db8442e4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6ece31e0.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Fanx 知识库" class="logo"> <span class="site-name can-hide">Fanx 知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/779590/" class="nav-link">Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/dc7834/" class="nav-link">Java集合框架</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d7db/" class="nav-link">Java多线程并发</a></li><li class="dropdown-item"><!----> <a href="/pages/dbec4d/" class="nav-link">JavaIo&amp;NIO&amp;AIO</a></li><li class="dropdown-item"><!----> <a href="/pages/b908ce/" class="nav-link">JDK相关特性</a></li><li class="dropdown-item"><!----> <a href="/pages/e59bea/" class="nav-link">JVM相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f8c059/" class="nav-link">数据库基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/d192fd/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/8aa877/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/077e7c/" class="nav-link">MogoDb</a></li><li class="dropdown-item"><!----> <a href="/pages/68281b/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><!----> <span class="title" style="display:;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonFrameworks/mybatis/" class="nav-link">mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/8f6500/" class="nav-link">Spring Framework 5基础</a></li><li class="dropdown-item"><!----> <a href="/pages/7c08d4/" class="nav-link">SpringBoot 2.5.x系列</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源代码学习" class="dropdown-title"><!----> <span class="title" style="display:;">源代码学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/23a632/" class="nav-link">mybatis源码学习</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/java/" class="nav-link">java源代码</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/spring/" class="nav-link">Spring源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试相关" class="dropdown-title"><!----> <span class="title" style="display:;">面试相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2cef48/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/ad2692/" class="nav-link">Spring 框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用的技术工具" class="dropdown-title"><!----> <span class="title" style="display:;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/linux/common/" class="nav-link">linux常用命令实践</a></li><li class="dropdown-item"><!----> <a href="/tool/maven/" class="nav-link">Mavan</a></li><li class="dropdown-item"><!----> <a href="/pages/b25802/" class="nav-link">开发工具详解</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它语言" class="dropdown-title"><!----> <span class="title" style="display:;">其它语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fc414d/" class="nav-link">Python基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题总结" class="dropdown-title"><!----> <span class="title" style="display:;">问题总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/question/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4d0fa7/" class="nav-link">团队相关</a></li><li class="dropdown-item"><!----> <a href="/pages/75c3d7/" class="nav-link">fanx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><!----> <span class="title" style="display:;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/caf303/" class="nav-link">数据结构基础</a></li><li class="dropdown-item"><!----> <a href="/pages/395e23/" class="nav-link">常见排序算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fa3dd3/" class="nav-link">算法思想</a></li><li class="dropdown-item"><!----> <a href="/pages/79d342/" class="nav-link">一些领域算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fdb54d/" class="nav-link">其它算法相关</a></li></ul></div></div> <a href="https://fanxgit.github.io/fanxNotes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/779590/" class="nav-link">Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/dc7834/" class="nav-link">Java集合框架</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d7db/" class="nav-link">Java多线程并发</a></li><li class="dropdown-item"><!----> <a href="/pages/dbec4d/" class="nav-link">JavaIo&amp;NIO&amp;AIO</a></li><li class="dropdown-item"><!----> <a href="/pages/b908ce/" class="nav-link">JDK相关特性</a></li><li class="dropdown-item"><!----> <a href="/pages/e59bea/" class="nav-link">JVM相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f8c059/" class="nav-link">数据库基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/d192fd/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/8aa877/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/077e7c/" class="nav-link">MogoDb</a></li><li class="dropdown-item"><!----> <a href="/pages/68281b/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><!----> <span class="title" style="display:;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonFrameworks/mybatis/" class="nav-link">mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/8f6500/" class="nav-link">Spring Framework 5基础</a></li><li class="dropdown-item"><!----> <a href="/pages/7c08d4/" class="nav-link">SpringBoot 2.5.x系列</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源代码学习" class="dropdown-title"><!----> <span class="title" style="display:;">源代码学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/23a632/" class="nav-link">mybatis源码学习</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/java/" class="nav-link">java源代码</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/spring/" class="nav-link">Spring源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试相关" class="dropdown-title"><!----> <span class="title" style="display:;">面试相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2cef48/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/ad2692/" class="nav-link">Spring 框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用的技术工具" class="dropdown-title"><!----> <span class="title" style="display:;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/linux/common/" class="nav-link">linux常用命令实践</a></li><li class="dropdown-item"><!----> <a href="/tool/maven/" class="nav-link">Mavan</a></li><li class="dropdown-item"><!----> <a href="/pages/b25802/" class="nav-link">开发工具详解</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它语言" class="dropdown-title"><!----> <span class="title" style="display:;">其它语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fc414d/" class="nav-link">Python基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题总结" class="dropdown-title"><!----> <span class="title" style="display:;">问题总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/question/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4d0fa7/" class="nav-link">团队相关</a></li><li class="dropdown-item"><!----> <a href="/pages/75c3d7/" class="nav-link">fanx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><!----> <span class="title" style="display:;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/caf303/" class="nav-link">数据结构基础</a></li><li class="dropdown-item"><!----> <a href="/pages/395e23/" class="nav-link">常见排序算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fa3dd3/" class="nav-link">算法思想</a></li><li class="dropdown-item"><!----> <a href="/pages/79d342/" class="nav-link">一些领域算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fdb54d/" class="nav-link">其它算法相关</a></li></ul></div></div> <a href="https://fanxgit.github.io/fanxNotes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库基础和原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SQL 语言</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SQL - MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NoSQL - Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NoSQL - MongoDB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>NoSQL - ElasticSearch</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/68281b/" class="sidebar-link">♥ElasticSearch知识体系详解♥</a></li><li><a href="/pages/0f4ae1/" class="sidebar-link">ES详解 - 认知-ElasticSearch基础概念</a></li><li><a href="/pages/34773d/" class="sidebar-link">ES详解 - 认知-Elastic Stack生态和场景方案</a></li><li><a href="/pages/26395b/" class="sidebar-link">ES详解 - 安装-ElasticSearch和Kibana安装</a></li><li><a href="/pages/1a2c2d/" class="sidebar-link">ES详解 - 入门-查询和聚合的基础使用</a></li><li><a href="/pages/8619f4/" class="sidebar-link">ES详解 - 索引-索引管理详解</a></li><li><a href="/pages/f5722e/" class="sidebar-link">ES详解 - 索引-索引模板(Index Template)详解</a></li><li><a href="/pages/22600b/" class="sidebar-link">ES详解 - 查询-DSL查询之复合查询详解</a></li><li><a href="/pages/ca6096/" class="sidebar-link">ES详解 - 查询-DSL查询之全文搜索详解</a></li><li><a href="/pages/be5113/" class="sidebar-link">ES详解 - 查询-DSL查询之Term详解</a></li><li><a href="/pages/cd972b/" class="sidebar-link">ES详解 - 聚合-聚合查询之Bucket聚合详解</a></li><li><a href="/pages/e56aa6/" class="sidebar-link">ES详解 - 聚合-聚合查询之Metric聚合详解</a></li><li><a href="/pages/af13d0/" class="sidebar-link">ES详解 - 聚合-聚合查询之Pipline聚合详解</a></li><li><a href="/pages/23c4ab/" class="sidebar-link">ES详解 - 原理-从图解构筑对ES原理的初步认知</a></li><li><a href="/pages/3f7859/" class="sidebar-link">ES详解 - 原理-ES原理知识点补充和整体结构</a></li><li><a href="/pages/ecc207/" aria-current="page" class="active sidebar-link">ES详解 - 原理-ES原理之索引文档流程详解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/a75ec4/" class="sidebar-link">ES详解 - 原理-ES原理之读取文档流程详解</a></li><li><a href="/pages/eaf4de/" class="sidebar-link">ES详解 - 优化-ElasticSearch性能优化详解</a></li><li><a href="/pages/ea48fb/" class="sidebar-link">大厂实践 - 哈啰-记录一次ElasticSearch的查询性能优化</a></li><li><a href="/pages/da50d6/" class="sidebar-link">大厂实践 - 腾讯-腾讯万亿级 Elasticsearch 技术实践</a></li><li><a href="/pages/05fe86/" class="sidebar-link">大厂实践 - 美团-美团外卖搜索基于Elasticsearch的优化实践</a></li><li><a href="/pages/bf681e/" class="sidebar-link">ES详解 - 资料-Awesome Elasticsearch</a></li><li><a href="/pages/eae483/" class="sidebar-link">ElasticSearch - WrapperQuery</a></li><li><a href="/pages/f3a293/" class="sidebar-link">ElasticSearch - 备份和迁移</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=database" title="分类" data-v-06225672>database</a></li><li data-v-06225672><a href="/categories/?category=NoSQL%20-%20ElasticSearch" title="分类" data-v-06225672>NoSQL - ElasticSearch</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/FanXGit" target="_blank" title="作者" class="beLink" data-v-06225672>fanx</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-08-07</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">ES详解 - 原理-ES原理之索引文档流程详解<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="es详解-原理-es原理之索引文档流程详解"><a href="#es详解-原理-es原理之索引文档流程详解" class="header-anchor">#</a> ES详解 - 原理：ES原理之索引文档流程详解</h1> <p>===================================================</p> <blockquote><p>ElasticSearch中最重要原理是文档的索引和文档的读取，本文带你理解ES文档的索引过程。@pdai</p></blockquote> <ul><li><a href="#es%E8%AF%A6%E8%A7%A3---%E5%8E%9F%E7%90%86es%E5%8E%9F%E7%90%86%E4%B9%8B%E7%B4%A2%E5%BC%95%E6%96%87%E6%A1%A3%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3">ES详解 - 原理：ES原理之索引文档流程详解</a> <ul><li><a href="#%E6%96%87%E6%A1%A3%E7%B4%A2%E5%BC%95%E6%AD%A5%E9%AA%A4%E9%A1%BA%E5%BA%8F">文档索引步骤顺序</a> <ul><li><a href="#%E5%8D%95%E4%B8%AA%E6%96%87%E6%A1%A3">单个文档</a></li> <li><a href="#%E5%A4%9A%E4%B8%AA%E6%96%87%E6%A1%A3">多个文档</a></li></ul></li> <li><a href="#%E6%96%87%E6%A1%A3%E7%B4%A2%E5%BC%95%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3">文档索引过程详解</a> <ul><li><a href="#%E6%95%B4%E4%BD%93%E7%9A%84%E7%B4%A2%E5%BC%95%E6%B5%81%E7%A8%8B">整体的索引流程</a></li> <li><a href="#%E5%88%86%E6%AD%A5%E9%AA%A4%E7%9C%8B%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E8%BF%87%E7%A8%8B">分步骤看数据持久化过程</a></li></ul></li> <li><a href="#%E6%B7%B1%E5%85%A5elasticsearch%E7%B4%A2%E5%BC%95%E6%96%87%E6%A1%A3%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6">深入ElasticSearch索引文档的实现机制</a> <ul><li><a href="#%E5%86%99%E6%93%8D%E4%BD%9C%E7%9A%84%E5%85%B3%E9%94%AE%E7%82%B9">写操作的关键点</a></li> <li><a href="#lucene%E7%9A%84%E5%86%99">Lucene的写</a></li> <li><a href="#elasticsearch%E7%9A%84%E5%86%99">Elasticsearch的写</a></li> <li><a href="#elasticsearch%E5%86%99%E5%85%A5%E8%AF%B7%E6%B1%82%E7%B1%BB%E5%9E%8B">Elasticsearch写入请求类型</a> <ul><li><a href="#client-node">Client Node</a></li> <li><a href="#primary-node">Primary Node</a></li> <li><a href="#replica-node">Replica Node</a></li></ul></li> <li><a href="#%E6%9C%80%E5%90%8E">最后</a></li></ul></li> <li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3">参考文档</a></li></ul></li></ul> <h1 id="文档索引步骤顺序"><a href="#文档索引步骤顺序" class="header-anchor">#</a> 文档索引步骤顺序</h1> <hr> <h3 id="单个文档"><a href="#单个文档" class="header-anchor">#</a> 单个文档</h3> <p>新建单个文档所需要的步骤顺序：</p> <p><img src="data:image/png;base64,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" alt=""></p> <ol><li>客户端向 Node 1 发送新建、索引或者删除请求。</li> <li>节点使用文档的 _id 确定文档属于分片 0 。请求会被转发到 Node 3，因为分片 0 的主分片目前被分配在 Node 3 上。</li> <li>Node 3 在主分片上面执行请求。如果成功了，它将请求并行转发到 Node 1 和 Node 2 的副本分片上。一旦所有的副本分片都报告成功, Node 3 将向协调节点报告成功，协调节点向客户端报告成功。</li></ol> <h3 id="多个文档"><a href="#多个文档" class="header-anchor">#</a> 多个文档</h3> <p>使用 bulk 修改多个文档步骤顺序：</p> <p><img src="/assets/img/es-th-2-23.d30b4a11.png" alt=""></p> <ol><li>客户端向 Node 1 发送 bulk 请求。</li> <li>Node 1 为每个节点创建一个批量请求，并将这些请求并行转发到每个包含主分片的节点主机。</li> <li>主分片一个接一个按顺序执行每个操作。当每个操作成功时，主分片并行转发新文档（或删除）到副本分片，然后执行下一个操作。 一旦所有的副本分片报告所有操作成功，该节点将向协调节点报告成功，协调节点将这些响应收集整理并返回给客户端。</li></ol> <h1 id="文档索引过程详解"><a href="#文档索引过程详解" class="header-anchor">#</a> 文档索引过程详解</h1> <hr> <h3 id="整体的索引流程"><a href="#整体的索引流程" class="header-anchor">#</a> 整体的索引流程</h3> <blockquote><p>先看下整体的索引流程</p></blockquote> <p><img src="/assets/img/es-th-2-5.e2a318eb.jpeg" alt=""></p> <ul><li>协调节点默认使用文档ID参与计算（也支持通过routing），以便为路由提供合适的分片。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>shard = hash(document_id) % (num_of_primary_shards)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>当分片所在的节点接收到来自协调节点的请求后，会将请求写入到Memory Buffer，然后定时（默认是每隔1秒）写入到Filesystem Cache，这个从Momery Buffer到Filesystem Cache的过程就叫做refresh；</li> <li>当然在某些情况下，存在Momery Buffer和Filesystem Cache的数据可能会丢失，ES是通过translog的机制来保证数据的可靠性的。其实现机制是接收到请求后，同时也会写入到translog中，当Filesystem cache中的数据写入到磁盘中时，才会清除掉，这个过程叫做flush。</li> <li>在flush过程中，内存中的缓冲将被清除，内容被写入一个新段，段的fsync将创建一个新的提交点，并将内容刷新到磁盘，旧的translog将被删除并开始一个新的translog。 flush触发的时机是定时触发（默认30分钟）或者translog变得太大（默认为512M）时。</li></ul> <h3 id="分步骤看数据持久化过程"><a href="#分步骤看数据持久化过程" class="header-anchor">#</a> 分步骤看数据持久化过程</h3> <blockquote><p><strong>通过分步骤看数据持久化过程</strong>：<strong>write -&gt; refresh -&gt; flush -&gt; merge</strong></p></blockquote> <ul><li><strong>write 过程</strong></li></ul> <p><img src="data:image/png;base64,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" alt=""></p> <p>一个新文档过来，会存储在 in-memory buffer 内存缓存区中，顺便会记录 Translog（Elasticsearch 增加了一个 translog ，或者叫事务日志，在每一次对 Elasticsearch 进行操作时均进行了日志记录）。</p> <p>这时候数据还没到 segment ，是搜不到这个新文档的。数据只有被 refresh 后，才可以被搜索到。</p> <ul><li><strong>refresh 过程</strong></li></ul> <p><img src="data:image/png;base64,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" alt=""></p> <p>refresh 默认 1 秒钟，执行一次上图流程。ES 是支持修改这个值的，通过 index.refresh_interval 设置 refresh （冲刷）间隔时间。refresh 流程大致如下：</p> <ol><li>in-memory buffer 中的文档写入到新的 segment 中，但 segment 是存储在文件系统的缓存中。此时文档可以被搜索到</li> <li>最后清空 in-memory buffer。注意: Translog 没有被清空，为了将 segment 数据写到磁盘</li> <li>文档经过 refresh 后， segment 暂时写到文件系统缓存，这样避免了性能 IO 操作，又可以使文档搜索到。refresh 默认 1 秒执行一次，性能损耗太大。一般建议稍微延长这个 refresh 时间间隔，比如 5 s。因此，ES 其实就是准实时，达不到真正的实时。</li></ol> <ul><li><strong>flush 过程</strong></li></ul> <p>每隔一段时间—​例如 translog 变得越来越大—​索引被刷新（flush）；一个新的 translog 被创建，并且一个全量提交被执行</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>上个过程中 segment 在文件系统缓存中，会有意外故障文档丢失。那么，为了保证文档不会丢失，需要将文档写入磁盘。那么文档从文件缓存写入磁盘的过程就是 flush。写入磁盘后，清空 translog。具体过程如下：</p> <ol><li>所有在内存缓冲区的文档都被写入一个新的段。</li> <li>缓冲区被清空。</li> <li>一个Commit Point被写入硬盘。</li> <li>文件系统缓存通过 fsync 被刷新（flush）。</li> <li>老的 translog 被删除。</li></ol> <ul><li><strong>merge 过程</strong></li></ul> <p>由于自动刷新流程每秒会创建一个新的段 ，这样会导致短时间内的段数量暴增。而段数目太多会带来较大的麻烦。 每一个段都会消耗文件句柄、内存和cpu运行周期。更重要的是，每个搜索请求都必须轮流检查每个段；所以段越多，搜索也就越慢。</p> <p>Elasticsearch通过在后台进行Merge Segment来解决这个问题。小的段被合并到大的段，然后这些大的段再被合并到更大的段。</p> <p>当索引的时候，刷新（refresh）操作会创建新的段并将段打开以供搜索使用。合并进程选择一小部分大小相似的段，并且在后台将它们合并到更大的段中。这并不会中断索引和搜索。</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>一旦合并结束，老的段被删除：</p> <ol><li>新的段被刷新（flush）到了磁盘。 ** 写入一个包含新段且排除旧的和较小的段的新提交点。</li> <li>新的段被打开用来搜索。</li> <li>老的段被删除。</li></ol> <p><img src="data:image/png;base64,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" alt=""></p> <p>合并大的段需要消耗大量的I/O和CPU资源，如果任其发展会影响搜索性能。Elasticsearch在默认情况下会对合并流程进行资源限制，所以搜索仍然 有足够的资源很好地执行。</p> <h1 id="深入elasticsearch索引文档的实现机制"><a href="#深入elasticsearch索引文档的实现机制" class="header-anchor">#</a> 深入ElasticSearch索引文档的实现机制</h1> <hr> <p>提示</p> <p>作为选读内容。</p> <h3 id="写操作的关键点"><a href="#写操作的关键点" class="header-anchor">#</a> 写操作的关键点</h3> <p>在考虑或分析一个分布式系统的写操作时，一般需要从下面几个方面考虑：</p> <ul><li>可靠性：或者是持久性，数据写入系统成功后，数据不会被回滚或丢失。</li> <li>一致性：数据写入成功后，再次查询时必须能保证读取到最新版本的数据，不能读取到旧数据。</li> <li>原子性：一个写入或者更新操作，要么完全成功，要么完全失败，不允许出现中间状态。</li> <li>隔离性：多个写入操作相互不影响。</li> <li>实时性：写入后是否可以立即被查询到。</li> <li>性能：写入性能，吞吐量到底怎么样。</li></ul> <p>Elasticsearch作为分布式系统，也需要在写入的时候满足上述的四个特点，我们在后面的写流程介绍中会涉及到上述四个方面。</p> <p>接下来,我们一层一层剖析Elasticsearch内部的写机制。</p> <h3 id="lucene的写"><a href="#lucene的写" class="header-anchor">#</a> Lucene的写</h3> <p>众所周知，Elasticsearch内部使用了Lucene完成索引创建和搜索功能，Lucene中写操作主要是通过IndexWriter类实现，IndexWriter提供三个接口：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> public long addDocument();
 public long updateDocuments();
 public long deleteDocuments();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>通过这三个接口可以完成单个文档的写入，更新和删除功能，包括了分词，倒排创建，正排创建等等所有搜索相关的流程。只要Doc通过IndesWriter写入后，后面就可以通过IndexSearcher搜索了，看起来功能已经完善了，但是仍然有一些问题没有解：</p> <ul><li>上述操作是单机的，而不是我们需要的分布式。</li> <li>文档写入Lucene后并不是立即可查询的，需要生成完整的Segment后才可被搜索，如何保证实时性？</li> <li>Lucene生成的Segment是在内存中，如果机器宕机或掉电后，内存中的Segment会丢失，如何保证数据可靠性 ？</li> <li>Lucene不支持部分文档更新，但是这又是一个强需求，如何支持部分更新？</li></ul> <p>上述问题，在Lucene中是没有解决的，那么就需要Elasticsearch中解决上述问题。</p> <p>我们再来看Elasticsearch中的写机制。</p> <h3 id="elasticsearch的写"><a href="#elasticsearch的写" class="header-anchor">#</a> Elasticsearch的写</h3> <p>Elasticsearch采用多Shard方式，通过配置routing规则将数据分成多个数据子集，每个数据子集提供独立的索引和搜索功能。当写入文档的时候，根据routing规则，将文档发送给特定Shard中建立索引。这样就能实现分布式了。</p> <p>此外，Elasticsearch整体架构上采用了一主多副的方式：</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>每个Index由多个Shard组成，每个Shard有一个主节点和多个副本节点，副本个数可配。但每次写入的时候，写入请求会先根据_routing规则选择发给哪个Shard，Index Request中可以设置使用哪个Filed的值作为路由参数，如果没有设置，则使用Mapping中的配置，如果mapping中也没有配置，则使用_id作为路由参数，然后通过_routing的Hash值选择出Shard（在OperationRouting类中），最后从集群的Meta中找出出该Shard的Primary节点。</p> <p>请求接着会发送给Primary Shard，在Primary Shard上执行成功后，再从Primary Shard上将请求同时发送给多个Replica Shard，请求在多个Replica Shard上执行成功并返回给Primary Shard后，写入请求执行成功，返回结果给客户端。</p> <p>这种模式下，写入操作的延时就等于latency = Latency(Primary Write) + Max(Replicas Write)。只要有副本在，写入延时最小也是两次单Shard的写入时延总和，写入效率会较低，但是这样的好处也很明显，避免写入后，单机或磁盘故障导致数据丢失，在数据重要性和性能方面，一般都是优先选择数据，除非一些允许丢数据的特殊场景。</p> <p>采用多个副本后，避免了单机或磁盘故障发生时，对已经持久化后的数据造成损害，但是Elasticsearch里为了减少磁盘IO保证读写性能，一般是每隔一段时间（比如5分钟）才会把Lucene的Segment写入磁盘持久化，对于写入内存，但还未Flush到磁盘的Lucene数据，如果发生机器宕机或者掉电，那么内存中的数据也会丢失，这时候如何保证？</p> <p>对于这种问题，Elasticsearch学习了数据库中的处理方式：增加CommitLog模块，Elasticsearch中叫TransLog。</p> <p><img src="/assets/img/es-th-3-4.a7382989.jpeg" alt=""></p> <p>在每一个Shard中，写入流程分为两部分，先写入Lucene，再写入TransLog。</p> <p>写入请求到达Shard后，先写Lucene文件，创建好索引，此时索引还在内存里面，接着去写TransLog，写完TransLog后，刷新TransLog数据到磁盘上，写磁盘成功后，请求返回给用户。这里有几个关键点:</p> <ul><li>一是和数据库不同，数据库是先写CommitLog，然后再写内存，而Elasticsearch是先写内存，最后才写TransLog，一种可能的原因是Lucene的内存写入会有很复杂的逻辑，很容易失败，比如分词，字段长度超过限制等，比较重，为了避免TransLog中有大量无效记录，减少recover的复杂度和提高速度，所以就把写Lucene放在了最前面。</li> <li>二是写Lucene内存后，并不是可被搜索的，需要通过Refresh把内存的对象转成完整的Segment后，然后再次reopen后才能被搜索，一般这个时间设置为1秒钟，导致写入Elasticsearch的文档，最快要1秒钟才可被从搜索到，所以Elasticsearch在搜索方面是NRT（Near Real Time）近实时的系统。</li> <li>三是当Elasticsearch作为NoSQL数据库时，查询方式是GetById，这种查询可以直接从TransLog中查询，这时候就成了RT（Real Time）实时系统。四是每隔一段比较长的时间，比如30分钟后，Lucene会把内存中生成的新Segment刷新到磁盘上，刷新后索引文件已经持久化了，历史的TransLog就没用了，会清空掉旧的TransLog。</li></ul> <p>上面介绍了Elasticsearch在写入时的两个关键模块，Replica和TransLog，接下来，我们看一下Update流程：</p> <p><img src="/assets/img/es-th-3-5.f294276f.jpeg" alt=""></p> <p>Lucene中不支持部分字段的Update，所以需要在Elasticsearch中实现该功能，具体流程如下：</p> <ul><li>收到Update请求后，从Segment或者TransLog中读取同id的完整Doc，记录版本号为V1。</li> <li>将版本V1的全量Doc和请求中的部分字段Doc合并为一个完整的Doc，同时更新内存中的VersionMap。获取到完整Doc后，Update请求就变成了Index请求。 加锁。</li> <li>再次从versionMap中读取该id的最大版本号V2，如果versionMap中没有，则从Segment或者TransLog中读取，这里基本都会从versionMap中获取到。</li> <li>检查版本是否冲突(V1==V2)，如果冲突，则回退到开始的“Update doc”阶段，重新执行。如果不冲突，则执行最新的Add请求。</li> <li>在Index Doc阶段，首先将Version + 1得到V3，再将Doc加入到Lucene中去，Lucene中会先删同id下的已存在doc id，然后再增加新Doc。写入Lucene成功后，将当前V3更新到versionMap中。</li> <li>释放锁，部分更新的流程就结束了。</li></ul> <p>介绍完部分更新的流程后，大家应该从整体架构上对Elasticsearch的写入有了一个初步的映象，接下来我们详细剖析下写入的详细步骤。</p> <h3 id="elasticsearch写入请求类型"><a href="#elasticsearch写入请求类型" class="header-anchor">#</a> Elasticsearch写入请求类型</h3> <blockquote><p>Elasticsearch中的写入请求类型，主要包括下列几个：Index(Create)，Update，Delete和Bulk，其中前3个是单文档操作，后一个Bulk是多文档操作，其中Bulk中可以包括Index(Create)，Update和Delete。</p></blockquote> <p>在6.0.0及其之后的版本中，前3个单文档操作的实现基本都和Bulk操作一致，甚至有些就是通过调用Bulk的接口实现的。估计接下来几个版本后，Index(Create)，Update，Delete都会被当做Bulk的一种特例化操作被处理。这样，代码和逻辑都会更清晰一些。</p> <p>下面，我们就以Bulk请求为例来介绍写入流程。</p> <p><img src="/assets/img/es-th-3-6.9bb1c30d.jpeg" alt=""></p> <ul><li>红色：Client Node。</li> <li>绿色：Primary Node。</li> <li>蓝色：Replica Node。</li></ul> <h4 id="client-node"><a href="#client-node" class="header-anchor">#</a> Client Node</h4> <blockquote><p>Client Node 也包括了前面说过的Parse Request，这里就不再赘述了，接下来看一下其他的部分。</p></blockquote> <ol><li><strong>Ingest Pipeline</strong></li></ol> <p>在这一步可以对原始文档做一些处理，比如HTML解析，自定义的处理，具体处理逻辑可以通过插件来实现。在Elasticsearch中，由于Ingest Pipeline会比较耗费CPU等资源，可以设置专门的Ingest Node，专门用来处理Ingest Pipeline逻辑。</p> <p>如果当前Node不能执行Ingest Pipeline，则会将请求发给另一台可以执行Ingest Pipeline的Node。</p> <ol start="2"><li><strong>Auto Create Index</strong></li></ol> <p>判断当前Index是否存在，如果不存在，则需要自动创建Index，这里需要和Master交互。也可以通过配置关闭自动创建Index的功能。</p> <ol start="3"><li><strong>Set Routing</strong></li></ol> <p>设置路由条件，如果Request中指定了路由条件，则直接使用Request中的Routing，否则使用Mapping中配置的，如果Mapping中无配置，则使用默认的_id字段值。</p> <p>在这一步中，如果没有指定id字段，则会自动生成一个唯一的_id字段，目前使用的是UUID。</p> <ol start="4"><li><strong>Construct BulkShardRequest</strong></li></ol> <p>由于Bulk Request中会包括多个(Index/Update/Delete)请求，这些请求根据routing可能会落在多个Shard上执行，这一步会按Shard挑拣Single Write Request，同一个Shard中的请求聚集在一起，构建BulkShardRequest，每个BulkShardRequest对应一个Shard。</p> <ol start="5"><li><strong>Send Request To Primary</strong></li></ol> <p>这一步会将每一个BulkShardRequest请求发送给相应Shard的Primary Node。</p> <h4 id="primary-node"><a href="#primary-node" class="header-anchor">#</a> Primary Node</h4> <blockquote><p>Primary 请求的入口是在PrimaryOperationTransportHandler的messageReceived，我们来看一下相关的逻辑流程。</p></blockquote> <ol><li><strong>Index or Update or Delete</strong></li></ol> <p>循环执行每个Single Write Request，对于每个Request，根据操作类型(CREATE/INDEX/UPDATE/DELETE)选择不同的处理逻辑。</p> <p>其中，Create/Index是直接新增Doc，Delete是直接根据_id删除Doc，Update会稍微复杂些，我们下面就以Update为例来介绍。</p> <ol start="2"><li><strong>Translate Update To Index or Delete</strong></li></ol> <p>这一步是Update操作的特有步骤，在这里，会将Update请求转换为Index或者Delete请求。首先，会通过GetRequest查询到已经存在的同_id Doc（如果有）的完整字段和值（依赖_source字段），然后和请求中的Doc合并。同时，这里会获取到读到的Doc版本号，记做V1。</p> <ol start="3"><li><strong>Parse Doc</strong></li></ol> <p>这里会解析Doc中各个字段。生成ParsedDocument对象，同时会生成uid Term。在Elasticsearch中，_uid = type # _id，对用户，_Id可见，而Elasticsearch中存储的是_uid。这一部分生成的ParsedDocument中也有Elasticsearch的系统字段，大部分会根据当前内容填充，部分未知的会在后面继续填充ParsedDocument。</p> <ol start="4"><li><strong>Update Mapping</strong></li></ol> <p>Elasticsearch中有个自动更新Mapping的功能，就在这一步生效。会先挑选出Mapping中未包含的新Field，然后判断是否运行自动更新Mapping，如果允许，则更新Mapping。</p> <ol start="5"><li><strong>Get Sequence Id and Version</strong></li></ol> <p>由于当前是Primary Shard，则会从SequenceNumber Service获取一个sequenceID和Version。SequenceID在Shard级别每次递增1，SequenceID在写入Doc成功后，会用来初始化LocalCheckpoint。Version则是根据当前Doc的最大Version递增1。</p> <ol start="6"><li><strong>Add Doc To Lucene</strong></li></ol> <p>这一步开始的时候会给特定_uid加锁，然后判断该_uid对应的Version是否等于之前Translate Update To Index步骤里获取到的Version，如果不相等，则说明刚才读取Doc后，该Doc发生了变化，出现了版本冲突，这时候会抛出一个VersionConflict的异常，该异常会在Primary Node最开始处捕获，重新从“Translate Update To Index or Delete”开始执行。</p> <p>如果Version相等，则继续执行，如果已经存在同id的Doc，则会调用Lucene的UpdateDocument(uid, doc)接口，先根据uid删除Doc，然后再Index新Doc。如果是首次写入，则直接调用Lucene的AddDocument接口完成Doc的Index，AddDocument也是通过UpdateDocument实现。</p> <p>这一步中有个问题是，如何保证Delete-Then-Add的原子性，怎么避免中间状态时被Refresh？答案是在开始Delete之前，会加一个Refresh Lock，禁止被Refresh，只有等Add完后释放了Refresh Lock后才能被Refresh，这样就保证了Delete-Then-Add的原子性。</p> <p>Lucene的UpdateDocument接口中就只是处理多个Field，会遍历每个Field逐个处理，处理顺序是invert index，store field，doc values，point dimension，后续会有文章专门介绍Lucene中的写入。</p> <ol start="7"><li><strong>Write Translog</strong></li></ol> <p>写完Lucene的Segment后，会以keyvalue的形式写TransLog，Key是_id，Value是Doc内容。当查询的时候，如果请求是GetDocByID，则可以直接根据_id从TransLog中读取到，满足NoSQL场景下的实时性要去。</p> <p>需要注意的是，这里只是写入到内存的TransLog，是否Sync到磁盘的逻辑还在后面。</p> <p>这一步的最后，会标记当前SequenceID已经成功执行，接着会更新当前Shard的LocalCheckPoint。</p> <ol start="8"><li><strong>Renew Bulk Request</strong></li></ol> <p>这里会重新构造Bulk Request，原因是前面已经将UpdateRequest翻译成了Index或Delete请求，则后续所有Replica中只需要执行Index或Delete请求就可以了，不需要再执行Update逻辑，一是保证Replica中逻辑更简单，性能更好，二是保证同一个请求在Primary和Replica中的执行结果一样。</p> <ol start="9"><li><strong>Flush Translog</strong></li></ol> <p>这里会根据TransLog的策略，选择不同的执行方式，要么是立即Flush到磁盘，要么是等到以后再Flush。Flush的频率越高，可靠性越高，对写入性能影响越大。</p> <ol start="10"><li><strong>Send Requests To Replicas</strong></li></ol> <p>这里会将刚才构造的新的Bulk Request并行发送给多个Replica，然后等待Replica的返回，这里需要等待所有Replica返回后（可能有成功，也有可能失败），Primary Node才会返回用户。如果某个Replica失败了，则Primary会给Master发送一个Remove Shard请求，要求Master将该Replica Shard从可用节点中移除。</p> <p>这里，同时会将SequenceID，PrimaryTerm，GlobalCheckPoint等传递给Replica。</p> <p>发送给Replica的请求中，Action Name等于原始ActionName + [R]，这里的R表示Replica。通过这个[R]的不同，可以找到处理Replica请求的Handler。</p> <ol start="11"><li><strong>Receive Response From Replicas</strong></li></ol> <p>Replica中请求都处理完后，会更新Primary Node的LocalCheckPoint。</p> <h4 id="replica-node"><a href="#replica-node" class="header-anchor">#</a> Replica Node</h4> <blockquote><p>Replica 请求的入口是在ReplicaOperationTransportHandler的messageReceived，我们来看一下相关的逻辑流程。</p></blockquote> <ol><li><strong>Index or Delete</strong></li></ol> <p>根据请求类型是Index还是Delete，选择不同的执行逻辑。这里没有Update，是因为在Primary Node中已经将Update转换成了Index或Delete请求了。</p> <ol start="2"><li><p><strong>Parse Doc</strong></p></li> <li><p><strong>Update Mapping</strong></p></li></ol> <p>以上都和Primary Node中逻辑一致。</p> <ol start="4"><li><strong>Get Sequence Id and Version</strong></li></ol> <p>Primary Node中会生成Sequence ID和Version，然后放入ReplicaRequest中，这里只需要从Request中获取到就行。</p> <ol start="5"><li><strong>Add Doc To Lucene</strong></li></ol> <p>由于已经在Primary Node中将部分Update请求转换成了Index或Delete请求，这里只需要处理Index和Delete两种请求，不再需要处理Update请求了。比Primary Node会更简单一些。</p> <ol start="6"><li><p><strong>Write Translog</strong></p></li> <li><p><strong>Flush Translog</strong></p></li></ol> <p>以上都和Primary Node中逻辑一致。</p> <h3 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h3> <p>上面详细介绍了Elasticsearch的写入流程及其各个流程的工作机制，我们在这里再次总结下之前提出的分布式系统中的六大特性：</p> <ul><li>可靠性：由于Lucene的设计中不考虑可靠性，在Elasticsearch中通过Replica和TransLog两套机制保证数据的可靠性。</li> <li>一致性：Lucene中的Flush锁只保证Update接口里面Delete和Add中间不会Flush，但是Add完成后仍然有可能立即发生Flush，导致Segment可读。这样就没法保证Primary和所有其他Replica可以同一时间Flush，就会出现查询不稳定的情况，这里只能实现最终一致性。</li> <li>原子性：Add和Delete都是直接调用Lucene的接口，是原子的。当部分更新时，使用Version和锁保证更新是原子的。</li> <li>隔离性：仍然采用Version和局部锁来保证更新的是特定版本的数据。</li> <li>实时性：使用定期Refresh Segment到内存，并且Reopen Segment方式保证搜索可以在较短时间（比如1秒）内被搜索到。通过将未刷新到磁盘数据记入TransLog，保证对未提交数据可以通过ID实时访问到。</li> <li>性能：性能是一个系统性工程，所有环节都要考虑对性能的影响，在Elasticsearch中，在很多地方的设计都考虑到了性能，一是不需要所有Replica都返回后才能返回给用户，只需要返回特定数目的就行；二是生成的Segment现在内存中提供服务，等一段时间后才刷新到磁盘，Segment在内存这段时间的可靠性由TransLog保证；三是TransLog可以配置为周期性的Flush，但这个会给可靠性带来伤害；四是每个线程持有一个Segment，多线程时相互不影响，相互独立，性能更好；五是系统的写入流程对版本依赖较重，读取频率较高，因此采用了versionMap，减少热点数据的多次磁盘IO开销。Lucene中针对性能做了大量的优化。</li></ul> <h1 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h1> <hr> <p>https://www.elastic.co/guide/cn/elasticsearch/guide/current/distrib-read.html</p> <p>https://www.elastic.co/guide/cn/elasticsearch/guide/current/distrib-multi-doc.html</p> <p>https://www.elastic.co/guide/cn/elasticsearch/guide/current/inside-a-shard.html</p> <p>https://zhuanlan.zhihu.com/p/34674517</p> <p>https://zhuanlan.zhihu.com/p/34669354</p> <p>https://www.cnblogs.com/yangwenbo214/p/9831479.html)</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://fanxgit.github.io/fanxNotes/edit/master/docs/database/06.NoSQL - ElasticSearch/16.ES详解 - 原理-ES原理之索引文档流程详解.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/17/2023, 5:04:28 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/3f7859/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">ES详解 - 原理-ES原理知识点补充和整体结构</div></a> <a href="/pages/a75ec4/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">ES详解 - 原理-ES原理之读取文档流程详解</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/3f7859/" class="prev">ES详解 - 原理-ES原理知识点补充和整体结构</a></span> <span class="next"><a href="/pages/a75ec4/">ES详解 - 原理-ES原理之读取文档流程详解</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/797621/"><div>
            VuePress+GithubPages教程
            <!----></div></a> <span class="date">11-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/016620/"><div>
            java打jar包整理
            <!----></div></a> <span class="date">11-19</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/b23a10/"><div>
            多线程问题总结
            <!----></div></a> <span class="date">11-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.38fd400a.js" defer></script><script src="/assets/js/3.e11db813.js" defer></script><script src="/assets/js/80.9205cc43.js" defer></script>
  </body>
</html>
