<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JUC锁-ReentrantReadWriteLock详解 | Fanx 知识库</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/logo.svg">[object Object]
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.6ece31e0.css" as="style"><link rel="preload" href="/assets/js/app.38fd400a.js" as="script"><link rel="preload" href="/assets/js/3.e11db813.js" as="script"><link rel="preload" href="/assets/js/59.2a730e41.js" as="script"><link rel="prefetch" href="/assets/js/10.939e2dd4.js"><link rel="prefetch" href="/assets/js/100.4a08f581.js"><link rel="prefetch" href="/assets/js/101.45cd45c9.js"><link rel="prefetch" href="/assets/js/102.ac1359d1.js"><link rel="prefetch" href="/assets/js/103.22344102.js"><link rel="prefetch" href="/assets/js/104.5071cdfd.js"><link rel="prefetch" href="/assets/js/105.7767c121.js"><link rel="prefetch" href="/assets/js/106.809b79f1.js"><link rel="prefetch" href="/assets/js/107.62fd626a.js"><link rel="prefetch" href="/assets/js/108.0583fdc1.js"><link rel="prefetch" href="/assets/js/109.fa127771.js"><link rel="prefetch" href="/assets/js/11.6463adc8.js"><link rel="prefetch" href="/assets/js/110.5cf9f09c.js"><link rel="prefetch" href="/assets/js/111.9d963667.js"><link rel="prefetch" href="/assets/js/112.bc2b8a6e.js"><link rel="prefetch" href="/assets/js/113.2ae29573.js"><link rel="prefetch" href="/assets/js/114.0b2cedfa.js"><link rel="prefetch" href="/assets/js/115.652e433e.js"><link rel="prefetch" href="/assets/js/116.bcc5d64a.js"><link rel="prefetch" href="/assets/js/117.30b02d0d.js"><link rel="prefetch" href="/assets/js/118.87f4f927.js"><link rel="prefetch" href="/assets/js/119.05839492.js"><link rel="prefetch" href="/assets/js/12.a17960e5.js"><link rel="prefetch" href="/assets/js/120.3d772c9c.js"><link rel="prefetch" href="/assets/js/121.bd8fcebf.js"><link rel="prefetch" href="/assets/js/122.e58d2205.js"><link rel="prefetch" href="/assets/js/123.f2c2826d.js"><link rel="prefetch" href="/assets/js/124.12d9ff87.js"><link rel="prefetch" href="/assets/js/125.c7e4bf1c.js"><link rel="prefetch" href="/assets/js/126.71c358fb.js"><link rel="prefetch" href="/assets/js/127.fb1922e5.js"><link rel="prefetch" href="/assets/js/128.25cbf771.js"><link rel="prefetch" href="/assets/js/129.50047ea3.js"><link rel="prefetch" href="/assets/js/13.727ebfda.js"><link rel="prefetch" href="/assets/js/130.a77cfa28.js"><link rel="prefetch" href="/assets/js/131.1618c1f5.js"><link rel="prefetch" href="/assets/js/132.4073573b.js"><link rel="prefetch" href="/assets/js/133.f6e4882f.js"><link rel="prefetch" href="/assets/js/134.1de81973.js"><link rel="prefetch" href="/assets/js/135.43148a0c.js"><link rel="prefetch" href="/assets/js/136.12b3ef34.js"><link rel="prefetch" href="/assets/js/137.accefc34.js"><link rel="prefetch" href="/assets/js/138.8d3115ff.js"><link rel="prefetch" href="/assets/js/139.6e492e2b.js"><link rel="prefetch" href="/assets/js/14.bc6d3062.js"><link rel="prefetch" href="/assets/js/140.3d98f006.js"><link rel="prefetch" href="/assets/js/141.542d08af.js"><link rel="prefetch" href="/assets/js/142.c91a19a2.js"><link rel="prefetch" href="/assets/js/143.0c681ed2.js"><link rel="prefetch" href="/assets/js/144.62e9c646.js"><link rel="prefetch" href="/assets/js/145.ebc34777.js"><link rel="prefetch" href="/assets/js/146.d94a04a7.js"><link rel="prefetch" href="/assets/js/147.b45158de.js"><link rel="prefetch" href="/assets/js/148.5dfa6740.js"><link rel="prefetch" href="/assets/js/149.cb6f2cb0.js"><link rel="prefetch" href="/assets/js/15.a9468bf1.js"><link rel="prefetch" href="/assets/js/150.9f58dbc6.js"><link rel="prefetch" href="/assets/js/151.0a1c07e3.js"><link rel="prefetch" href="/assets/js/152.eafe4843.js"><link rel="prefetch" href="/assets/js/153.fb94cab5.js"><link rel="prefetch" href="/assets/js/154.07f7a11d.js"><link rel="prefetch" href="/assets/js/155.7f6da40b.js"><link rel="prefetch" href="/assets/js/156.2f007ca1.js"><link rel="prefetch" href="/assets/js/157.a35b5249.js"><link rel="prefetch" href="/assets/js/158.540f7a5a.js"><link rel="prefetch" href="/assets/js/159.f62e0315.js"><link rel="prefetch" href="/assets/js/16.ace3b806.js"><link rel="prefetch" href="/assets/js/160.e043c758.js"><link rel="prefetch" href="/assets/js/161.d90141bf.js"><link rel="prefetch" href="/assets/js/162.ddcdbfb9.js"><link rel="prefetch" href="/assets/js/163.f1ba395e.js"><link rel="prefetch" href="/assets/js/164.9f398973.js"><link rel="prefetch" href="/assets/js/165.0db3da51.js"><link rel="prefetch" href="/assets/js/166.b5305797.js"><link rel="prefetch" href="/assets/js/167.e7b2f76b.js"><link rel="prefetch" href="/assets/js/168.a2ecf883.js"><link rel="prefetch" href="/assets/js/169.88bd4d26.js"><link rel="prefetch" href="/assets/js/17.60481837.js"><link rel="prefetch" href="/assets/js/170.fb1699e2.js"><link rel="prefetch" href="/assets/js/171.47268bef.js"><link rel="prefetch" href="/assets/js/172.79002327.js"><link rel="prefetch" href="/assets/js/173.3b1813fb.js"><link rel="prefetch" href="/assets/js/174.362811a9.js"><link rel="prefetch" href="/assets/js/175.bb48bcd7.js"><link rel="prefetch" href="/assets/js/176.97bbf32c.js"><link rel="prefetch" href="/assets/js/177.0717ff7a.js"><link rel="prefetch" href="/assets/js/178.75bff3b7.js"><link rel="prefetch" href="/assets/js/179.3e7db0a2.js"><link rel="prefetch" href="/assets/js/18.dd3c5709.js"><link rel="prefetch" href="/assets/js/180.c81da8dd.js"><link rel="prefetch" href="/assets/js/181.142d6d1c.js"><link rel="prefetch" href="/assets/js/182.fb312040.js"><link rel="prefetch" href="/assets/js/183.3684267e.js"><link rel="prefetch" href="/assets/js/184.ec2a13bc.js"><link rel="prefetch" href="/assets/js/185.a7acace4.js"><link rel="prefetch" href="/assets/js/186.7df28551.js"><link rel="prefetch" href="/assets/js/187.347e9348.js"><link rel="prefetch" href="/assets/js/188.07356026.js"><link rel="prefetch" href="/assets/js/189.0816176d.js"><link rel="prefetch" href="/assets/js/19.cc2d4ad1.js"><link rel="prefetch" href="/assets/js/190.fd5dd8cc.js"><link rel="prefetch" href="/assets/js/191.a938967e.js"><link rel="prefetch" href="/assets/js/192.859b71a1.js"><link rel="prefetch" href="/assets/js/193.adcf2ec3.js"><link rel="prefetch" href="/assets/js/194.69d1169c.js"><link rel="prefetch" href="/assets/js/195.ad7cbcc4.js"><link rel="prefetch" href="/assets/js/196.b65138da.js"><link rel="prefetch" href="/assets/js/197.b4fca73b.js"><link rel="prefetch" href="/assets/js/198.2494a23f.js"><link rel="prefetch" href="/assets/js/199.404b9ce1.js"><link rel="prefetch" href="/assets/js/2.938bab56.js"><link rel="prefetch" href="/assets/js/20.361e2bf6.js"><link rel="prefetch" href="/assets/js/200.42b54eae.js"><link rel="prefetch" href="/assets/js/201.ab495eb8.js"><link rel="prefetch" href="/assets/js/202.2cbc5c9a.js"><link rel="prefetch" href="/assets/js/203.abf3fde5.js"><link rel="prefetch" href="/assets/js/204.4fdd4cfb.js"><link rel="prefetch" href="/assets/js/205.411987d7.js"><link rel="prefetch" href="/assets/js/206.dbcab3ae.js"><link rel="prefetch" href="/assets/js/207.f1429354.js"><link rel="prefetch" href="/assets/js/208.f763286c.js"><link rel="prefetch" href="/assets/js/209.c1edbca5.js"><link rel="prefetch" href="/assets/js/21.ae1e88a3.js"><link rel="prefetch" href="/assets/js/210.b2a1501d.js"><link rel="prefetch" href="/assets/js/211.fe1fd5f7.js"><link rel="prefetch" href="/assets/js/212.0fd39a8f.js"><link rel="prefetch" href="/assets/js/213.bb3fc163.js"><link rel="prefetch" href="/assets/js/214.c42e1ef3.js"><link rel="prefetch" href="/assets/js/215.4f0fa915.js"><link rel="prefetch" href="/assets/js/216.07c485c9.js"><link rel="prefetch" href="/assets/js/217.ada25e7a.js"><link rel="prefetch" href="/assets/js/218.2f761d3c.js"><link rel="prefetch" href="/assets/js/219.32d1a663.js"><link rel="prefetch" href="/assets/js/22.0b09d67f.js"><link rel="prefetch" href="/assets/js/220.36c56cf4.js"><link rel="prefetch" href="/assets/js/221.3e0431e2.js"><link rel="prefetch" href="/assets/js/222.90aa0ff7.js"><link rel="prefetch" href="/assets/js/223.5966d7df.js"><link rel="prefetch" href="/assets/js/224.7e2329e1.js"><link rel="prefetch" href="/assets/js/225.2ed3675d.js"><link rel="prefetch" href="/assets/js/226.fa3cef02.js"><link rel="prefetch" href="/assets/js/227.07bf7bca.js"><link rel="prefetch" href="/assets/js/228.9ac2589a.js"><link rel="prefetch" href="/assets/js/229.b980e141.js"><link rel="prefetch" href="/assets/js/23.31ed5c2f.js"><link rel="prefetch" href="/assets/js/230.2c32e874.js"><link rel="prefetch" href="/assets/js/231.723e20cb.js"><link rel="prefetch" href="/assets/js/232.1f94511c.js"><link rel="prefetch" href="/assets/js/233.2d477f71.js"><link rel="prefetch" href="/assets/js/234.10141c75.js"><link rel="prefetch" href="/assets/js/235.a328b127.js"><link rel="prefetch" href="/assets/js/236.42419c3b.js"><link rel="prefetch" href="/assets/js/237.648ca44e.js"><link rel="prefetch" href="/assets/js/238.4b363b75.js"><link rel="prefetch" href="/assets/js/239.fe711a73.js"><link rel="prefetch" href="/assets/js/24.fe75e3fa.js"><link rel="prefetch" href="/assets/js/240.6baa12bf.js"><link rel="prefetch" href="/assets/js/241.6f375dc4.js"><link rel="prefetch" href="/assets/js/242.aee8e39d.js"><link rel="prefetch" href="/assets/js/243.bfc7f6e1.js"><link rel="prefetch" href="/assets/js/244.c73a14a7.js"><link rel="prefetch" href="/assets/js/245.a2352aa1.js"><link rel="prefetch" href="/assets/js/246.b12c3ae6.js"><link rel="prefetch" href="/assets/js/247.2f768275.js"><link rel="prefetch" href="/assets/js/248.3f79dfb1.js"><link rel="prefetch" href="/assets/js/249.7fd0cb75.js"><link rel="prefetch" href="/assets/js/25.f2e379df.js"><link rel="prefetch" href="/assets/js/250.df3f1d0a.js"><link rel="prefetch" href="/assets/js/251.a3865750.js"><link rel="prefetch" href="/assets/js/252.d62542df.js"><link rel="prefetch" href="/assets/js/253.59b2f200.js"><link rel="prefetch" href="/assets/js/254.522d17b5.js"><link rel="prefetch" href="/assets/js/255.0f95a196.js"><link rel="prefetch" href="/assets/js/256.31b37cbe.js"><link rel="prefetch" href="/assets/js/257.ff22ad12.js"><link rel="prefetch" href="/assets/js/258.15205e0b.js"><link rel="prefetch" href="/assets/js/259.f3b7c5aa.js"><link rel="prefetch" href="/assets/js/26.45264b04.js"><link rel="prefetch" href="/assets/js/260.fec3c7aa.js"><link rel="prefetch" href="/assets/js/261.d965ee56.js"><link rel="prefetch" href="/assets/js/262.76a7105b.js"><link rel="prefetch" href="/assets/js/263.e684cc46.js"><link rel="prefetch" href="/assets/js/264.59297da0.js"><link rel="prefetch" href="/assets/js/265.66182ed2.js"><link rel="prefetch" href="/assets/js/266.eec50d90.js"><link rel="prefetch" href="/assets/js/267.c85bce12.js"><link rel="prefetch" href="/assets/js/268.ef544f0c.js"><link rel="prefetch" href="/assets/js/269.8cfb5c6a.js"><link rel="prefetch" href="/assets/js/27.4e065810.js"><link rel="prefetch" href="/assets/js/270.b66cab3c.js"><link rel="prefetch" href="/assets/js/271.c1b7d136.js"><link rel="prefetch" href="/assets/js/272.0d7950c3.js"><link rel="prefetch" href="/assets/js/273.06349cca.js"><link rel="prefetch" href="/assets/js/274.9b442c09.js"><link rel="prefetch" href="/assets/js/275.11082d81.js"><link rel="prefetch" href="/assets/js/276.ce0abe31.js"><link rel="prefetch" href="/assets/js/277.4b7fcc53.js"><link rel="prefetch" href="/assets/js/278.129d0397.js"><link rel="prefetch" href="/assets/js/279.5c021f7c.js"><link rel="prefetch" href="/assets/js/28.126ecd33.js"><link rel="prefetch" href="/assets/js/280.d183c9e3.js"><link rel="prefetch" href="/assets/js/281.0df67750.js"><link rel="prefetch" href="/assets/js/282.8fdd2372.js"><link rel="prefetch" href="/assets/js/283.dae956df.js"><link rel="prefetch" href="/assets/js/284.c5dc7189.js"><link rel="prefetch" href="/assets/js/285.7f5a7367.js"><link rel="prefetch" href="/assets/js/286.d9bfcef5.js"><link rel="prefetch" href="/assets/js/287.4fa6a5c5.js"><link rel="prefetch" href="/assets/js/288.57904d2d.js"><link rel="prefetch" href="/assets/js/289.b96d7c2f.js"><link rel="prefetch" href="/assets/js/29.8f5db82a.js"><link rel="prefetch" href="/assets/js/290.8dda9646.js"><link rel="prefetch" href="/assets/js/291.ab433493.js"><link rel="prefetch" href="/assets/js/292.e2d59796.js"><link rel="prefetch" href="/assets/js/293.30f9fcc4.js"><link rel="prefetch" href="/assets/js/294.158492dc.js"><link rel="prefetch" href="/assets/js/295.33e3a53d.js"><link rel="prefetch" href="/assets/js/296.49d7a2de.js"><link rel="prefetch" href="/assets/js/297.1b7572ac.js"><link rel="prefetch" href="/assets/js/298.00e4586a.js"><link rel="prefetch" href="/assets/js/299.d8fb6ff9.js"><link rel="prefetch" href="/assets/js/30.ef97cb8e.js"><link rel="prefetch" href="/assets/js/300.90e9dadf.js"><link rel="prefetch" href="/assets/js/301.d5592ea1.js"><link rel="prefetch" href="/assets/js/302.b08dc1ea.js"><link rel="prefetch" href="/assets/js/303.bef541c8.js"><link rel="prefetch" href="/assets/js/304.be3f7081.js"><link rel="prefetch" href="/assets/js/305.13718421.js"><link rel="prefetch" href="/assets/js/306.41685aa2.js"><link rel="prefetch" href="/assets/js/307.6d569102.js"><link rel="prefetch" href="/assets/js/308.aaabab89.js"><link rel="prefetch" href="/assets/js/309.910ecc42.js"><link rel="prefetch" href="/assets/js/31.795b3334.js"><link rel="prefetch" href="/assets/js/310.104b7753.js"><link rel="prefetch" href="/assets/js/311.45f4a7da.js"><link rel="prefetch" href="/assets/js/312.180c7e45.js"><link rel="prefetch" href="/assets/js/313.87d3a801.js"><link rel="prefetch" href="/assets/js/314.7739b1ef.js"><link rel="prefetch" href="/assets/js/315.54a1fac0.js"><link rel="prefetch" href="/assets/js/316.a978a787.js"><link rel="prefetch" href="/assets/js/317.84f65f2c.js"><link rel="prefetch" href="/assets/js/318.7f8caff8.js"><link rel="prefetch" href="/assets/js/319.0b5276f3.js"><link rel="prefetch" href="/assets/js/32.e65c7229.js"><link rel="prefetch" href="/assets/js/320.ba90589a.js"><link rel="prefetch" href="/assets/js/321.b6810c5a.js"><link rel="prefetch" href="/assets/js/322.2eaa727d.js"><link rel="prefetch" href="/assets/js/323.17573ee3.js"><link rel="prefetch" href="/assets/js/324.806fd6ca.js"><link rel="prefetch" href="/assets/js/325.4cd65079.js"><link rel="prefetch" href="/assets/js/326.fe0e2e22.js"><link rel="prefetch" href="/assets/js/327.a64d0209.js"><link rel="prefetch" href="/assets/js/328.aca1c89a.js"><link rel="prefetch" href="/assets/js/329.53ccf1dd.js"><link rel="prefetch" href="/assets/js/33.9a57aab8.js"><link rel="prefetch" href="/assets/js/330.92822a09.js"><link rel="prefetch" href="/assets/js/331.6b82baff.js"><link rel="prefetch" href="/assets/js/332.fc20f585.js"><link rel="prefetch" href="/assets/js/333.005ba8e3.js"><link rel="prefetch" href="/assets/js/334.9d3309b8.js"><link rel="prefetch" href="/assets/js/335.0e938f19.js"><link rel="prefetch" href="/assets/js/336.01fe9903.js"><link rel="prefetch" href="/assets/js/337.e207d67c.js"><link rel="prefetch" href="/assets/js/338.bfcf6bc8.js"><link rel="prefetch" href="/assets/js/339.a502aa64.js"><link rel="prefetch" href="/assets/js/34.3835d35c.js"><link rel="prefetch" href="/assets/js/340.3888b147.js"><link rel="prefetch" href="/assets/js/341.20297f95.js"><link rel="prefetch" href="/assets/js/342.9cd149e9.js"><link rel="prefetch" href="/assets/js/343.faac8369.js"><link rel="prefetch" href="/assets/js/344.da8cd079.js"><link rel="prefetch" href="/assets/js/345.78303b88.js"><link rel="prefetch" href="/assets/js/346.d8eaca82.js"><link rel="prefetch" href="/assets/js/347.edd389a1.js"><link rel="prefetch" href="/assets/js/348.21ee9617.js"><link rel="prefetch" href="/assets/js/349.0251471a.js"><link rel="prefetch" href="/assets/js/35.76dc7096.js"><link rel="prefetch" href="/assets/js/350.710b7d30.js"><link rel="prefetch" href="/assets/js/351.535f8d60.js"><link rel="prefetch" href="/assets/js/352.c66fe42e.js"><link rel="prefetch" href="/assets/js/353.ebbcd333.js"><link rel="prefetch" href="/assets/js/354.7cbba2f1.js"><link rel="prefetch" href="/assets/js/355.0106db16.js"><link rel="prefetch" href="/assets/js/356.7debf350.js"><link rel="prefetch" href="/assets/js/357.a43eb887.js"><link rel="prefetch" href="/assets/js/358.28e5d2ed.js"><link rel="prefetch" href="/assets/js/359.956fc3b8.js"><link rel="prefetch" href="/assets/js/36.fc54452c.js"><link rel="prefetch" href="/assets/js/360.13fb600a.js"><link rel="prefetch" href="/assets/js/361.d100f85b.js"><link rel="prefetch" href="/assets/js/362.35277df2.js"><link rel="prefetch" href="/assets/js/363.d993a7fc.js"><link rel="prefetch" href="/assets/js/364.0168c2b0.js"><link rel="prefetch" href="/assets/js/365.bc8af0bb.js"><link rel="prefetch" href="/assets/js/366.2645dc0d.js"><link rel="prefetch" href="/assets/js/367.87368acb.js"><link rel="prefetch" href="/assets/js/368.0b7d41fc.js"><link rel="prefetch" href="/assets/js/369.4bf3f46e.js"><link rel="prefetch" href="/assets/js/37.5a47cee9.js"><link rel="prefetch" href="/assets/js/370.ea5f965e.js"><link rel="prefetch" href="/assets/js/371.1af764ef.js"><link rel="prefetch" href="/assets/js/372.bf6c68e2.js"><link rel="prefetch" href="/assets/js/373.1a605cc8.js"><link rel="prefetch" href="/assets/js/374.34a41a4a.js"><link rel="prefetch" href="/assets/js/375.1d2d3776.js"><link rel="prefetch" href="/assets/js/376.4b7b0b10.js"><link rel="prefetch" href="/assets/js/377.b3d9748a.js"><link rel="prefetch" href="/assets/js/378.7f00fa88.js"><link rel="prefetch" href="/assets/js/379.adcd298a.js"><link rel="prefetch" href="/assets/js/38.6614c565.js"><link rel="prefetch" href="/assets/js/380.6d08bb56.js"><link rel="prefetch" href="/assets/js/381.164bb4e3.js"><link rel="prefetch" href="/assets/js/382.f71f0ca4.js"><link rel="prefetch" href="/assets/js/383.01ba70ad.js"><link rel="prefetch" href="/assets/js/384.22b98cde.js"><link rel="prefetch" href="/assets/js/385.5f1298a9.js"><link rel="prefetch" href="/assets/js/386.01a912bc.js"><link rel="prefetch" href="/assets/js/387.3db4713f.js"><link rel="prefetch" href="/assets/js/388.4cde7d0f.js"><link rel="prefetch" href="/assets/js/389.d96bafad.js"><link rel="prefetch" href="/assets/js/39.1a09ed15.js"><link rel="prefetch" href="/assets/js/390.343bbc06.js"><link rel="prefetch" href="/assets/js/391.68b3e72a.js"><link rel="prefetch" href="/assets/js/392.f4f15e43.js"><link rel="prefetch" href="/assets/js/393.82475934.js"><link rel="prefetch" href="/assets/js/394.3101ea10.js"><link rel="prefetch" href="/assets/js/395.34083342.js"><link rel="prefetch" href="/assets/js/396.780d6efe.js"><link rel="prefetch" href="/assets/js/397.cb686f39.js"><link rel="prefetch" href="/assets/js/398.c4ad669f.js"><link rel="prefetch" href="/assets/js/399.ee8d28ad.js"><link rel="prefetch" href="/assets/js/4.c1dcb1a7.js"><link rel="prefetch" href="/assets/js/40.4216f4f9.js"><link rel="prefetch" href="/assets/js/400.23d48a38.js"><link rel="prefetch" href="/assets/js/401.319d7a68.js"><link rel="prefetch" href="/assets/js/402.25b27bd0.js"><link rel="prefetch" href="/assets/js/403.9a898a40.js"><link rel="prefetch" href="/assets/js/404.e3b49b79.js"><link rel="prefetch" href="/assets/js/405.7695b9f1.js"><link rel="prefetch" href="/assets/js/406.edb801f7.js"><link rel="prefetch" href="/assets/js/407.03c3f725.js"><link rel="prefetch" href="/assets/js/408.4345ef1f.js"><link rel="prefetch" href="/assets/js/409.77c34447.js"><link rel="prefetch" href="/assets/js/41.f035663a.js"><link rel="prefetch" href="/assets/js/410.7f6c0744.js"><link rel="prefetch" href="/assets/js/411.cb19323e.js"><link rel="prefetch" href="/assets/js/412.4b16959d.js"><link rel="prefetch" href="/assets/js/413.ff4f1ca2.js"><link rel="prefetch" href="/assets/js/414.b1ca1298.js"><link rel="prefetch" href="/assets/js/415.c2111593.js"><link rel="prefetch" href="/assets/js/416.a6d18039.js"><link rel="prefetch" href="/assets/js/417.dc36c66d.js"><link rel="prefetch" href="/assets/js/418.e7eba879.js"><link rel="prefetch" href="/assets/js/419.57673b9e.js"><link rel="prefetch" href="/assets/js/42.9c8cf569.js"><link rel="prefetch" href="/assets/js/420.ccd41fe0.js"><link rel="prefetch" href="/assets/js/421.ea69f0b0.js"><link rel="prefetch" href="/assets/js/422.093448e2.js"><link rel="prefetch" href="/assets/js/423.ae003f31.js"><link rel="prefetch" href="/assets/js/424.f670cd2b.js"><link rel="prefetch" href="/assets/js/425.6e814335.js"><link rel="prefetch" href="/assets/js/426.faf45206.js"><link rel="prefetch" href="/assets/js/427.cf6be942.js"><link rel="prefetch" href="/assets/js/428.9ff6199c.js"><link rel="prefetch" href="/assets/js/429.b6ef4678.js"><link rel="prefetch" href="/assets/js/43.717fe06b.js"><link rel="prefetch" href="/assets/js/430.e9575d07.js"><link rel="prefetch" href="/assets/js/431.8bf26a3e.js"><link rel="prefetch" href="/assets/js/432.5eaa2162.js"><link rel="prefetch" href="/assets/js/433.6dab12a1.js"><link rel="prefetch" href="/assets/js/434.fca918e8.js"><link rel="prefetch" href="/assets/js/435.4c8f9ad9.js"><link rel="prefetch" href="/assets/js/436.0f0de1a8.js"><link rel="prefetch" href="/assets/js/437.2221ab9f.js"><link rel="prefetch" href="/assets/js/438.37f28cfb.js"><link rel="prefetch" href="/assets/js/439.1e3f3611.js"><link rel="prefetch" href="/assets/js/44.705dc411.js"><link rel="prefetch" href="/assets/js/440.28ab35e8.js"><link rel="prefetch" href="/assets/js/441.8d006af8.js"><link rel="prefetch" href="/assets/js/442.2618a6e3.js"><link rel="prefetch" href="/assets/js/443.a7723674.js"><link rel="prefetch" href="/assets/js/444.18f23e7c.js"><link rel="prefetch" href="/assets/js/445.f4807c5a.js"><link rel="prefetch" href="/assets/js/446.77a5afc2.js"><link rel="prefetch" href="/assets/js/447.7f653483.js"><link rel="prefetch" href="/assets/js/448.1143c566.js"><link rel="prefetch" href="/assets/js/449.b788a288.js"><link rel="prefetch" href="/assets/js/45.6a225373.js"><link rel="prefetch" href="/assets/js/450.b6463ba3.js"><link rel="prefetch" href="/assets/js/451.fd4d46b9.js"><link rel="prefetch" href="/assets/js/452.e8de4fc2.js"><link rel="prefetch" href="/assets/js/453.4125e5e6.js"><link rel="prefetch" href="/assets/js/454.30af5d0a.js"><link rel="prefetch" href="/assets/js/455.9c919e58.js"><link rel="prefetch" href="/assets/js/456.22dbfa8f.js"><link rel="prefetch" href="/assets/js/457.e9c5248a.js"><link rel="prefetch" href="/assets/js/458.c0a9cf1d.js"><link rel="prefetch" href="/assets/js/459.b5e96042.js"><link rel="prefetch" href="/assets/js/46.515d085a.js"><link rel="prefetch" href="/assets/js/460.b4097efb.js"><link rel="prefetch" href="/assets/js/461.5d545741.js"><link rel="prefetch" href="/assets/js/462.402d4cdd.js"><link rel="prefetch" href="/assets/js/463.e6d6ea07.js"><link rel="prefetch" href="/assets/js/464.df817445.js"><link rel="prefetch" href="/assets/js/465.18a6bc2b.js"><link rel="prefetch" href="/assets/js/466.da313c0c.js"><link rel="prefetch" href="/assets/js/467.41294182.js"><link rel="prefetch" href="/assets/js/468.41c59467.js"><link rel="prefetch" href="/assets/js/469.d55da13c.js"><link rel="prefetch" href="/assets/js/47.a41193df.js"><link rel="prefetch" href="/assets/js/470.7457a92e.js"><link rel="prefetch" href="/assets/js/471.ed739bdf.js"><link rel="prefetch" href="/assets/js/472.83882459.js"><link rel="prefetch" href="/assets/js/473.fe2df51c.js"><link rel="prefetch" href="/assets/js/474.d40797b8.js"><link rel="prefetch" href="/assets/js/475.a00992a2.js"><link rel="prefetch" href="/assets/js/476.c7687189.js"><link rel="prefetch" href="/assets/js/477.fd4fd227.js"><link rel="prefetch" href="/assets/js/478.1ae08c3b.js"><link rel="prefetch" href="/assets/js/479.04a246c6.js"><link rel="prefetch" href="/assets/js/48.fe693306.js"><link rel="prefetch" href="/assets/js/480.36acb4ff.js"><link rel="prefetch" href="/assets/js/481.05d3129e.js"><link rel="prefetch" href="/assets/js/482.1741a02c.js"><link rel="prefetch" href="/assets/js/483.44cf2d25.js"><link rel="prefetch" href="/assets/js/484.9c14e5c6.js"><link rel="prefetch" href="/assets/js/485.ea0c1de1.js"><link rel="prefetch" href="/assets/js/486.8c683697.js"><link rel="prefetch" href="/assets/js/487.8b1eb604.js"><link rel="prefetch" href="/assets/js/488.ae16fca6.js"><link rel="prefetch" href="/assets/js/489.7f674a0d.js"><link rel="prefetch" href="/assets/js/49.a7d05a3d.js"><link rel="prefetch" href="/assets/js/490.52983854.js"><link rel="prefetch" href="/assets/js/491.968e7af4.js"><link rel="prefetch" href="/assets/js/492.e7f58bac.js"><link rel="prefetch" href="/assets/js/493.55afbb68.js"><link rel="prefetch" href="/assets/js/494.ac17d05b.js"><link rel="prefetch" href="/assets/js/495.d1ca2a12.js"><link rel="prefetch" href="/assets/js/496.d6841a0e.js"><link rel="prefetch" href="/assets/js/497.99431b4b.js"><link rel="prefetch" href="/assets/js/498.cacac1d8.js"><link rel="prefetch" href="/assets/js/499.c6b7fab0.js"><link rel="prefetch" href="/assets/js/5.f74a04c4.js"><link rel="prefetch" href="/assets/js/50.f59b29ea.js"><link rel="prefetch" href="/assets/js/500.abba24c7.js"><link rel="prefetch" href="/assets/js/501.e9496674.js"><link rel="prefetch" href="/assets/js/502.3ece0e86.js"><link rel="prefetch" href="/assets/js/503.974421d1.js"><link rel="prefetch" href="/assets/js/504.6e8d8539.js"><link rel="prefetch" href="/assets/js/505.b8161483.js"><link rel="prefetch" href="/assets/js/506.a6a6f2de.js"><link rel="prefetch" href="/assets/js/507.9c6955ee.js"><link rel="prefetch" href="/assets/js/508.223e145d.js"><link rel="prefetch" href="/assets/js/509.553e6f2c.js"><link rel="prefetch" href="/assets/js/51.428c5495.js"><link rel="prefetch" href="/assets/js/510.46e2eab7.js"><link rel="prefetch" href="/assets/js/511.24962b3f.js"><link rel="prefetch" href="/assets/js/512.a29fe236.js"><link rel="prefetch" href="/assets/js/513.8729b339.js"><link rel="prefetch" href="/assets/js/514.41199019.js"><link rel="prefetch" href="/assets/js/515.b1a71e99.js"><link rel="prefetch" href="/assets/js/516.001e3634.js"><link rel="prefetch" href="/assets/js/517.4de05581.js"><link rel="prefetch" href="/assets/js/518.57697c31.js"><link rel="prefetch" href="/assets/js/519.e962365e.js"><link rel="prefetch" href="/assets/js/52.c97c3911.js"><link rel="prefetch" href="/assets/js/520.e7775961.js"><link rel="prefetch" href="/assets/js/521.05b0ce57.js"><link rel="prefetch" href="/assets/js/522.49f7412e.js"><link rel="prefetch" href="/assets/js/523.b3d821b2.js"><link rel="prefetch" href="/assets/js/524.ab2395b7.js"><link rel="prefetch" href="/assets/js/525.25559bb4.js"><link rel="prefetch" href="/assets/js/526.23111d2a.js"><link rel="prefetch" href="/assets/js/527.c61f6e86.js"><link rel="prefetch" href="/assets/js/528.032fa7b6.js"><link rel="prefetch" href="/assets/js/529.3953f346.js"><link rel="prefetch" href="/assets/js/53.77f22b1a.js"><link rel="prefetch" href="/assets/js/530.b882066e.js"><link rel="prefetch" href="/assets/js/531.62dddf23.js"><link rel="prefetch" href="/assets/js/532.1826fe1a.js"><link rel="prefetch" href="/assets/js/533.a2e014bb.js"><link rel="prefetch" href="/assets/js/534.d5d89c00.js"><link rel="prefetch" href="/assets/js/535.4e5d7739.js"><link rel="prefetch" href="/assets/js/536.f2c700db.js"><link rel="prefetch" href="/assets/js/537.80aa278c.js"><link rel="prefetch" href="/assets/js/538.95e2f471.js"><link rel="prefetch" href="/assets/js/539.4e4ecfe8.js"><link rel="prefetch" href="/assets/js/54.d85b2f2e.js"><link rel="prefetch" href="/assets/js/540.00bd44e5.js"><link rel="prefetch" href="/assets/js/541.d740df14.js"><link rel="prefetch" href="/assets/js/542.5aadeaee.js"><link rel="prefetch" href="/assets/js/543.d42c9d9a.js"><link rel="prefetch" href="/assets/js/544.29704685.js"><link rel="prefetch" href="/assets/js/545.7fdb1a83.js"><link rel="prefetch" href="/assets/js/546.6b5655ea.js"><link rel="prefetch" href="/assets/js/547.c98e27c4.js"><link rel="prefetch" href="/assets/js/548.8edec06f.js"><link rel="prefetch" href="/assets/js/549.33b8eae3.js"><link rel="prefetch" href="/assets/js/55.80a4fa71.js"><link rel="prefetch" href="/assets/js/550.cb706b0e.js"><link rel="prefetch" href="/assets/js/551.79598cc6.js"><link rel="prefetch" href="/assets/js/552.69aa5f8b.js"><link rel="prefetch" href="/assets/js/553.7ccb8831.js"><link rel="prefetch" href="/assets/js/554.954013b2.js"><link rel="prefetch" href="/assets/js/555.960d7f8b.js"><link rel="prefetch" href="/assets/js/556.5c054c14.js"><link rel="prefetch" href="/assets/js/557.890045ea.js"><link rel="prefetch" href="/assets/js/558.f72f6668.js"><link rel="prefetch" href="/assets/js/559.452d8ff3.js"><link rel="prefetch" href="/assets/js/56.009b0340.js"><link rel="prefetch" href="/assets/js/560.1656e33f.js"><link rel="prefetch" href="/assets/js/561.bb4650eb.js"><link rel="prefetch" href="/assets/js/562.7322fd81.js"><link rel="prefetch" href="/assets/js/563.a34a68ea.js"><link rel="prefetch" href="/assets/js/564.6da92e18.js"><link rel="prefetch" href="/assets/js/565.01d288e5.js"><link rel="prefetch" href="/assets/js/566.6a3459a1.js"><link rel="prefetch" href="/assets/js/567.e3eb8e54.js"><link rel="prefetch" href="/assets/js/568.f95e0fba.js"><link rel="prefetch" href="/assets/js/569.a42d134c.js"><link rel="prefetch" href="/assets/js/57.25e8dd1c.js"><link rel="prefetch" href="/assets/js/570.87887d15.js"><link rel="prefetch" href="/assets/js/571.ce4b478b.js"><link rel="prefetch" href="/assets/js/572.634418a6.js"><link rel="prefetch" href="/assets/js/573.cd4cf02b.js"><link rel="prefetch" href="/assets/js/574.8bf073fa.js"><link rel="prefetch" href="/assets/js/575.c194dddb.js"><link rel="prefetch" href="/assets/js/576.7750193f.js"><link rel="prefetch" href="/assets/js/577.5daa388a.js"><link rel="prefetch" href="/assets/js/578.54bb0029.js"><link rel="prefetch" href="/assets/js/579.92f58c76.js"><link rel="prefetch" href="/assets/js/58.9c1eb9e5.js"><link rel="prefetch" href="/assets/js/580.0e543efb.js"><link rel="prefetch" href="/assets/js/581.4e0b0b47.js"><link rel="prefetch" href="/assets/js/582.8c172f83.js"><link rel="prefetch" href="/assets/js/583.c91c43e0.js"><link rel="prefetch" href="/assets/js/584.ca68d52b.js"><link rel="prefetch" href="/assets/js/585.663b17d3.js"><link rel="prefetch" href="/assets/js/586.9494847d.js"><link rel="prefetch" href="/assets/js/587.f3805773.js"><link rel="prefetch" href="/assets/js/588.8ae14be1.js"><link rel="prefetch" href="/assets/js/589.b4af88be.js"><link rel="prefetch" href="/assets/js/590.fb77fea8.js"><link rel="prefetch" href="/assets/js/591.a3aaa57c.js"><link rel="prefetch" href="/assets/js/592.54ec5f32.js"><link rel="prefetch" href="/assets/js/593.96eab5cb.js"><link rel="prefetch" href="/assets/js/594.e356725c.js"><link rel="prefetch" href="/assets/js/595.0a2c4ad4.js"><link rel="prefetch" href="/assets/js/596.2c075cd8.js"><link rel="prefetch" href="/assets/js/597.e904811b.js"><link rel="prefetch" href="/assets/js/598.f6ca8b71.js"><link rel="prefetch" href="/assets/js/599.ae3d12c4.js"><link rel="prefetch" href="/assets/js/6.451e012f.js"><link rel="prefetch" href="/assets/js/60.e6b60343.js"><link rel="prefetch" href="/assets/js/600.e71a0062.js"><link rel="prefetch" href="/assets/js/601.2571a19d.js"><link rel="prefetch" href="/assets/js/602.0f4fa961.js"><link rel="prefetch" href="/assets/js/603.d8387c37.js"><link rel="prefetch" href="/assets/js/604.69433906.js"><link rel="prefetch" href="/assets/js/605.1bc7d87a.js"><link rel="prefetch" href="/assets/js/606.ec419517.js"><link rel="prefetch" href="/assets/js/607.b473fb0b.js"><link rel="prefetch" href="/assets/js/608.a361b48c.js"><link rel="prefetch" href="/assets/js/609.9186f226.js"><link rel="prefetch" href="/assets/js/61.d50a156d.js"><link rel="prefetch" href="/assets/js/610.ff3cf241.js"><link rel="prefetch" href="/assets/js/611.c3c7e648.js"><link rel="prefetch" href="/assets/js/612.2a520ebd.js"><link rel="prefetch" href="/assets/js/613.42936ffc.js"><link rel="prefetch" href="/assets/js/614.3ca0de21.js"><link rel="prefetch" href="/assets/js/615.ecf60a47.js"><link rel="prefetch" href="/assets/js/616.17185e83.js"><link rel="prefetch" href="/assets/js/617.769d4cdf.js"><link rel="prefetch" href="/assets/js/618.015c6376.js"><link rel="prefetch" href="/assets/js/619.3af186d0.js"><link rel="prefetch" href="/assets/js/62.e24b7811.js"><link rel="prefetch" href="/assets/js/620.f8ff3784.js"><link rel="prefetch" href="/assets/js/621.4c21311f.js"><link rel="prefetch" href="/assets/js/622.355178df.js"><link rel="prefetch" href="/assets/js/623.45a30695.js"><link rel="prefetch" href="/assets/js/624.61e89d34.js"><link rel="prefetch" href="/assets/js/625.49e0d1ce.js"><link rel="prefetch" href="/assets/js/626.1b7ae767.js"><link rel="prefetch" href="/assets/js/627.b8c507cf.js"><link rel="prefetch" href="/assets/js/628.c5a43517.js"><link rel="prefetch" href="/assets/js/629.274eb0fd.js"><link rel="prefetch" href="/assets/js/63.b804baab.js"><link rel="prefetch" href="/assets/js/630.69e055ce.js"><link rel="prefetch" href="/assets/js/631.0892fc51.js"><link rel="prefetch" href="/assets/js/632.6a68e9a2.js"><link rel="prefetch" href="/assets/js/633.d536fe74.js"><link rel="prefetch" href="/assets/js/634.24695f39.js"><link rel="prefetch" href="/assets/js/635.3aeede9c.js"><link rel="prefetch" href="/assets/js/636.3628d8a6.js"><link rel="prefetch" href="/assets/js/637.40af5a79.js"><link rel="prefetch" href="/assets/js/638.15e257ae.js"><link rel="prefetch" href="/assets/js/639.31e6597c.js"><link rel="prefetch" href="/assets/js/64.eb5699ff.js"><link rel="prefetch" href="/assets/js/640.a071f6df.js"><link rel="prefetch" href="/assets/js/641.f9edd7bf.js"><link rel="prefetch" href="/assets/js/642.adcb583f.js"><link rel="prefetch" href="/assets/js/643.7c98a990.js"><link rel="prefetch" href="/assets/js/644.fb1213d8.js"><link rel="prefetch" href="/assets/js/645.220a5034.js"><link rel="prefetch" href="/assets/js/646.d66a419b.js"><link rel="prefetch" href="/assets/js/647.12ef89ab.js"><link rel="prefetch" href="/assets/js/648.a3112300.js"><link rel="prefetch" href="/assets/js/649.f457dfa5.js"><link rel="prefetch" href="/assets/js/65.0d8501b5.js"><link rel="prefetch" href="/assets/js/650.cc63d03b.js"><link rel="prefetch" href="/assets/js/651.16d1bbd6.js"><link rel="prefetch" href="/assets/js/652.0f5343f0.js"><link rel="prefetch" href="/assets/js/653.28f7710a.js"><link rel="prefetch" href="/assets/js/654.b343d473.js"><link rel="prefetch" href="/assets/js/655.215fe67b.js"><link rel="prefetch" href="/assets/js/656.79aa1653.js"><link rel="prefetch" href="/assets/js/657.c57f2b5c.js"><link rel="prefetch" href="/assets/js/658.d0aa0b95.js"><link rel="prefetch" href="/assets/js/659.2dfaed93.js"><link rel="prefetch" href="/assets/js/66.8361cc16.js"><link rel="prefetch" href="/assets/js/660.c00b347e.js"><link rel="prefetch" href="/assets/js/661.ecc4f968.js"><link rel="prefetch" href="/assets/js/662.06f83919.js"><link rel="prefetch" href="/assets/js/663.67d8849e.js"><link rel="prefetch" href="/assets/js/664.74dba1a9.js"><link rel="prefetch" href="/assets/js/665.28b450f0.js"><link rel="prefetch" href="/assets/js/666.0f4bb6ba.js"><link rel="prefetch" href="/assets/js/667.586074e3.js"><link rel="prefetch" href="/assets/js/668.b13c0e70.js"><link rel="prefetch" href="/assets/js/669.9d0d4cbc.js"><link rel="prefetch" href="/assets/js/67.37f46ba2.js"><link rel="prefetch" href="/assets/js/670.6b36ca72.js"><link rel="prefetch" href="/assets/js/671.33b2e754.js"><link rel="prefetch" href="/assets/js/672.3b02c287.js"><link rel="prefetch" href="/assets/js/673.3f274929.js"><link rel="prefetch" href="/assets/js/674.7d75584f.js"><link rel="prefetch" href="/assets/js/675.0de52334.js"><link rel="prefetch" href="/assets/js/676.6734133e.js"><link rel="prefetch" href="/assets/js/677.c6f4a973.js"><link rel="prefetch" href="/assets/js/678.1344b6be.js"><link rel="prefetch" href="/assets/js/679.23fed56f.js"><link rel="prefetch" href="/assets/js/68.27dbce5b.js"><link rel="prefetch" href="/assets/js/680.c49329d6.js"><link rel="prefetch" href="/assets/js/681.8df66615.js"><link rel="prefetch" href="/assets/js/682.77b4bff8.js"><link rel="prefetch" href="/assets/js/683.6cf41cf4.js"><link rel="prefetch" href="/assets/js/684.58deecd5.js"><link rel="prefetch" href="/assets/js/685.d2f7480e.js"><link rel="prefetch" href="/assets/js/686.0b77a241.js"><link rel="prefetch" href="/assets/js/687.2cc04b4f.js"><link rel="prefetch" href="/assets/js/688.da24cbae.js"><link rel="prefetch" href="/assets/js/689.a9961f74.js"><link rel="prefetch" href="/assets/js/69.8052a977.js"><link rel="prefetch" href="/assets/js/690.cb736269.js"><link rel="prefetch" href="/assets/js/691.21c13be1.js"><link rel="prefetch" href="/assets/js/692.3ed557d0.js"><link rel="prefetch" href="/assets/js/693.066efe93.js"><link rel="prefetch" href="/assets/js/694.5368f98a.js"><link rel="prefetch" href="/assets/js/695.4fdb93d5.js"><link rel="prefetch" href="/assets/js/696.9c055ac6.js"><link rel="prefetch" href="/assets/js/697.51e0c47c.js"><link rel="prefetch" href="/assets/js/698.08ca1dbd.js"><link rel="prefetch" href="/assets/js/699.ce7e9e2a.js"><link rel="prefetch" href="/assets/js/7.7e21c947.js"><link rel="prefetch" href="/assets/js/70.19faeb78.js"><link rel="prefetch" href="/assets/js/700.3676fa7f.js"><link rel="prefetch" href="/assets/js/701.82db4887.js"><link rel="prefetch" href="/assets/js/702.73425f22.js"><link rel="prefetch" href="/assets/js/703.d9391c74.js"><link rel="prefetch" href="/assets/js/704.d6e275cf.js"><link rel="prefetch" href="/assets/js/705.d2f23969.js"><link rel="prefetch" href="/assets/js/706.1c66dcc1.js"><link rel="prefetch" href="/assets/js/707.0fc5a26a.js"><link rel="prefetch" href="/assets/js/708.97471ee6.js"><link rel="prefetch" href="/assets/js/709.9b4d5665.js"><link rel="prefetch" href="/assets/js/71.d1683810.js"><link rel="prefetch" href="/assets/js/710.75fa8103.js"><link rel="prefetch" href="/assets/js/711.43777b40.js"><link rel="prefetch" href="/assets/js/712.5c583e39.js"><link rel="prefetch" href="/assets/js/713.5aa72111.js"><link rel="prefetch" href="/assets/js/714.e8215702.js"><link rel="prefetch" href="/assets/js/715.46614e7c.js"><link rel="prefetch" href="/assets/js/716.eaac6d69.js"><link rel="prefetch" href="/assets/js/717.c344c042.js"><link rel="prefetch" href="/assets/js/718.437bf0b2.js"><link rel="prefetch" href="/assets/js/719.23aa3deb.js"><link rel="prefetch" href="/assets/js/72.9fa783f0.js"><link rel="prefetch" href="/assets/js/720.9456a449.js"><link rel="prefetch" href="/assets/js/721.67fd324a.js"><link rel="prefetch" href="/assets/js/722.fc5e79ca.js"><link rel="prefetch" href="/assets/js/723.46db8115.js"><link rel="prefetch" href="/assets/js/724.31a11b8c.js"><link rel="prefetch" href="/assets/js/725.49cef603.js"><link rel="prefetch" href="/assets/js/726.7d0a2e7f.js"><link rel="prefetch" href="/assets/js/727.a1de6f02.js"><link rel="prefetch" href="/assets/js/728.7e0a727e.js"><link rel="prefetch" href="/assets/js/729.b6bf04fa.js"><link rel="prefetch" href="/assets/js/73.1ac0ac37.js"><link rel="prefetch" href="/assets/js/730.1c102528.js"><link rel="prefetch" href="/assets/js/731.80403e3d.js"><link rel="prefetch" href="/assets/js/732.cf8b4a6d.js"><link rel="prefetch" href="/assets/js/733.aab88d38.js"><link rel="prefetch" href="/assets/js/734.965a0adc.js"><link rel="prefetch" href="/assets/js/735.f9d33608.js"><link rel="prefetch" href="/assets/js/736.d1621f9e.js"><link rel="prefetch" href="/assets/js/737.a12ea0d3.js"><link rel="prefetch" href="/assets/js/738.96e61512.js"><link rel="prefetch" href="/assets/js/739.9bce4dfe.js"><link rel="prefetch" href="/assets/js/74.1913daec.js"><link rel="prefetch" href="/assets/js/740.c1a0bf7b.js"><link rel="prefetch" href="/assets/js/741.0185115e.js"><link rel="prefetch" href="/assets/js/742.21e99d78.js"><link rel="prefetch" href="/assets/js/743.e5f2407e.js"><link rel="prefetch" href="/assets/js/744.53d4e25a.js"><link rel="prefetch" href="/assets/js/745.9fb6722c.js"><link rel="prefetch" href="/assets/js/746.893e3a2f.js"><link rel="prefetch" href="/assets/js/747.ad94fed4.js"><link rel="prefetch" href="/assets/js/748.3421b09b.js"><link rel="prefetch" href="/assets/js/749.15c364e9.js"><link rel="prefetch" href="/assets/js/75.d63a9540.js"><link rel="prefetch" href="/assets/js/750.4e5379b7.js"><link rel="prefetch" href="/assets/js/751.18b0273f.js"><link rel="prefetch" href="/assets/js/752.24717596.js"><link rel="prefetch" href="/assets/js/753.5868bcc4.js"><link rel="prefetch" href="/assets/js/754.77808a6c.js"><link rel="prefetch" href="/assets/js/755.af7f7a71.js"><link rel="prefetch" href="/assets/js/76.342d837c.js"><link rel="prefetch" href="/assets/js/77.466349c3.js"><link rel="prefetch" href="/assets/js/78.886d05b6.js"><link rel="prefetch" href="/assets/js/79.b478bdab.js"><link rel="prefetch" href="/assets/js/8.9f40767d.js"><link rel="prefetch" href="/assets/js/80.9205cc43.js"><link rel="prefetch" href="/assets/js/81.77f831c9.js"><link rel="prefetch" href="/assets/js/82.650475d1.js"><link rel="prefetch" href="/assets/js/83.aa7e3d4b.js"><link rel="prefetch" href="/assets/js/84.2fc92fb4.js"><link rel="prefetch" href="/assets/js/85.0f633e10.js"><link rel="prefetch" href="/assets/js/86.e862f4bc.js"><link rel="prefetch" href="/assets/js/87.8a869468.js"><link rel="prefetch" href="/assets/js/88.6c584051.js"><link rel="prefetch" href="/assets/js/89.3ab84e02.js"><link rel="prefetch" href="/assets/js/9.7ed864ce.js"><link rel="prefetch" href="/assets/js/90.41e6925d.js"><link rel="prefetch" href="/assets/js/91.55055993.js"><link rel="prefetch" href="/assets/js/92.ced7b439.js"><link rel="prefetch" href="/assets/js/93.41cc8a7f.js"><link rel="prefetch" href="/assets/js/94.6d2b144f.js"><link rel="prefetch" href="/assets/js/95.399a7909.js"><link rel="prefetch" href="/assets/js/96.556f8f9f.js"><link rel="prefetch" href="/assets/js/97.47ecdf46.js"><link rel="prefetch" href="/assets/js/98.fdbe6822.js"><link rel="prefetch" href="/assets/js/99.db8442e4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6ece31e0.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Fanx 知识库" class="logo"> <span class="site-name can-hide">Fanx 知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/779590/" class="nav-link">Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/dc7834/" class="nav-link">Java集合框架</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d7db/" class="nav-link">Java多线程并发</a></li><li class="dropdown-item"><!----> <a href="/pages/dbec4d/" class="nav-link">JavaIo&amp;NIO&amp;AIO</a></li><li class="dropdown-item"><!----> <a href="/pages/b908ce/" class="nav-link">JDK相关特性</a></li><li class="dropdown-item"><!----> <a href="/pages/e59bea/" class="nav-link">JVM相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f8c059/" class="nav-link">数据库基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/d192fd/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/8aa877/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/077e7c/" class="nav-link">MogoDb</a></li><li class="dropdown-item"><!----> <a href="/pages/68281b/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><!----> <span class="title" style="display:;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonFrameworks/mybatis/" class="nav-link">mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/8f6500/" class="nav-link">Spring Framework 5基础</a></li><li class="dropdown-item"><!----> <a href="/pages/7c08d4/" class="nav-link">SpringBoot 2.5.x系列</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源代码学习" class="dropdown-title"><!----> <span class="title" style="display:;">源代码学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/23a632/" class="nav-link">mybatis源码学习</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/java/" class="nav-link">java源代码</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/spring/" class="nav-link">Spring源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试相关" class="dropdown-title"><!----> <span class="title" style="display:;">面试相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2cef48/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/ad2692/" class="nav-link">Spring 框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用的技术工具" class="dropdown-title"><!----> <span class="title" style="display:;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/linux/common/" class="nav-link">linux常用命令实践</a></li><li class="dropdown-item"><!----> <a href="/tool/maven/" class="nav-link">Mavan</a></li><li class="dropdown-item"><!----> <a href="/pages/b25802/" class="nav-link">开发工具详解</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它语言" class="dropdown-title"><!----> <span class="title" style="display:;">其它语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fc414d/" class="nav-link">Python基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题总结" class="dropdown-title"><!----> <span class="title" style="display:;">问题总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/question/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4d0fa7/" class="nav-link">团队相关</a></li><li class="dropdown-item"><!----> <a href="/pages/75c3d7/" class="nav-link">fanx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><!----> <span class="title" style="display:;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/caf303/" class="nav-link">数据结构基础</a></li><li class="dropdown-item"><!----> <a href="/pages/395e23/" class="nav-link">常见排序算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fa3dd3/" class="nav-link">算法思想</a></li><li class="dropdown-item"><!----> <a href="/pages/79d342/" class="nav-link">一些领域算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fdb54d/" class="nav-link">其它算法相关</a></li></ul></div></div> <a href="https://fanxgit.github.io/fanxNotes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/779590/" class="nav-link">Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/dc7834/" class="nav-link">Java集合框架</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d7db/" class="nav-link">Java多线程并发</a></li><li class="dropdown-item"><!----> <a href="/pages/dbec4d/" class="nav-link">JavaIo&amp;NIO&amp;AIO</a></li><li class="dropdown-item"><!----> <a href="/pages/b908ce/" class="nav-link">JDK相关特性</a></li><li class="dropdown-item"><!----> <a href="/pages/e59bea/" class="nav-link">JVM相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f8c059/" class="nav-link">数据库基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/d192fd/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/8aa877/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/077e7c/" class="nav-link">MogoDb</a></li><li class="dropdown-item"><!----> <a href="/pages/68281b/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><!----> <span class="title" style="display:;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonFrameworks/mybatis/" class="nav-link">mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/8f6500/" class="nav-link">Spring Framework 5基础</a></li><li class="dropdown-item"><!----> <a href="/pages/7c08d4/" class="nav-link">SpringBoot 2.5.x系列</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源代码学习" class="dropdown-title"><!----> <span class="title" style="display:;">源代码学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/23a632/" class="nav-link">mybatis源码学习</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/java/" class="nav-link">java源代码</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/spring/" class="nav-link">Spring源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试相关" class="dropdown-title"><!----> <span class="title" style="display:;">面试相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2cef48/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/ad2692/" class="nav-link">Spring 框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用的技术工具" class="dropdown-title"><!----> <span class="title" style="display:;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/linux/common/" class="nav-link">linux常用命令实践</a></li><li class="dropdown-item"><!----> <a href="/tool/maven/" class="nav-link">Mavan</a></li><li class="dropdown-item"><!----> <a href="/pages/b25802/" class="nav-link">开发工具详解</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它语言" class="dropdown-title"><!----> <span class="title" style="display:;">其它语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fc414d/" class="nav-link">Python基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题总结" class="dropdown-title"><!----> <span class="title" style="display:;">问题总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/question/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4d0fa7/" class="nav-link">团队相关</a></li><li class="dropdown-item"><!----> <a href="/pages/75c3d7/" class="nav-link">fanx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><!----> <span class="title" style="display:;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/caf303/" class="nav-link">数据结构基础</a></li><li class="dropdown-item"><!----> <a href="/pages/395e23/" class="nav-link">常见排序算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fa3dd3/" class="nav-link">算法思想</a></li><li class="dropdown-item"><!----> <a href="/pages/79d342/" class="nav-link">一些领域算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fdb54d/" class="nav-link">其它算法相关</a></li></ul></div></div> <a href="https://fanxgit.github.io/fanxNotes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>集合框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java多线程与并发</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f2d7db/" class="sidebar-link">Java并发知识体系详解</a></li><li><a href="/pages/e49d07/" class="sidebar-link">Java 并发 - 理论基础</a></li><li><a href="/pages/0e4c2e/" class="sidebar-link">Java 并发 - 线程基础</a></li><li><a href="/pages/03aac1/" class="sidebar-link">Java并发 - Java中所有的锁</a></li><li><a href="/pages/b1fa07/" class="sidebar-link">关键字-synchronized详解</a></li><li><a href="/pages/e8097b/" class="sidebar-link">关键字-volatile详解</a></li><li><a href="/pages/44d29e/" class="sidebar-link">关键字-final详解</a></li><li><a href="/pages/52b863/" class="sidebar-link">JUC - 类汇总和学习指南</a></li><li><a href="/pages/60879f/" class="sidebar-link">JUC原子类-CAS, Unsafe和原子类详解</a></li><li><a href="/pages/3f52bd/" class="sidebar-link">JUC锁-LockSupport详解</a></li><li><a href="/pages/620379/" class="sidebar-link">JUC锁-锁核心类AQS详解</a></li><li><a href="/pages/e5e4ff/" class="sidebar-link">JUC锁-ReentrantLock详解</a></li><li><a href="/pages/926698/" aria-current="page" class="active sidebar-link">JUC锁-ReentrantReadWriteLock详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/926698/#juc锁-reentrantreadwritelock详解" class="sidebar-link">JUC锁: ReentrantReadWriteLock详解</a></li><li class="sidebar-sub-header level2"><a href="/pages/926698/#带着bat大厂的面试问题去理解" class="sidebar-link">带着BAT大厂的面试问题去理解</a></li><li class="sidebar-sub-header level2"><a href="/pages/926698/#reentrantreadwritelock数据结构" class="sidebar-link">ReentrantReadWriteLock数据结构</a></li><li class="sidebar-sub-header level2"><a href="/pages/926698/#reentrantreadwritelock源码分析" class="sidebar-link">ReentrantReadWriteLock源码分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/926698/#类的继承关系" class="sidebar-link">类的继承关系</a></li><li class="sidebar-sub-header level3"><a href="/pages/926698/#类的内部类" class="sidebar-link">类的内部类</a></li><li class="sidebar-sub-header level3"><a href="/pages/926698/#内部类-sync类" class="sidebar-link">内部类 - Sync类</a></li><li class="sidebar-sub-header level3"><a href="/pages/926698/#内部类-sync核心函数分析" class="sidebar-link">内部类 - Sync核心函数分析</a></li><li class="sidebar-sub-header level3"><a href="/pages/926698/#类的属性" class="sidebar-link">类的属性</a></li><li class="sidebar-sub-header level3"><a href="/pages/926698/#类的构造函数" class="sidebar-link">类的构造函数</a></li><li class="sidebar-sub-header level3"><a href="/pages/926698/#核心函数分析" class="sidebar-link">核心函数分析</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/926698/#reentrantreadwritelock示例" class="sidebar-link">ReentrantReadWriteLock示例</a></li><li class="sidebar-sub-header level2"><a href="/pages/926698/#更深入理解" class="sidebar-link">更深入理解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/926698/#什么是锁升降级" class="sidebar-link">什么是锁升降级?</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/926698/#参考文章" class="sidebar-link">参考文章</a></li></ul></li><li><a href="/pages/e33954/" class="sidebar-link">JUC集合-ConcurrentHashMap详解</a></li><li><a href="/pages/ccc6d9/" class="sidebar-link">JUC集合-CopyOnWriteArrayList详解</a></li><li><a href="/pages/3e2c89/" class="sidebar-link">JUC集合-ConcurrentLinkedQueue详解</a></li><li><a href="/pages/24b41a/" class="sidebar-link">JUC集合-BlockingQueue详解</a></li><li><a href="/pages/bcf3da/" class="sidebar-link">JUC线程池-FutureTask详解</a></li><li><a href="/pages/1fce0f/" class="sidebar-link">JUC线程池-ThreadPoolExecutor详解</a></li><li><a href="/pages/85bf53/" class="sidebar-link">JUC线程池-ScheduledThreadPoolExecutor详解</a></li><li><a href="/pages/688f62/" class="sidebar-link">JUC线程池-ForkJoin框架详解</a></li><li><a href="/pages/ee399a/" class="sidebar-link">JUC工具类-CountDownLatch详解</a></li><li><a href="/pages/cf70b6/" class="sidebar-link">JUC工具类-CyclicBarrier详解</a></li><li><a href="/pages/725172/" class="sidebar-link">JUC工具类-Semaphore详解</a></li><li><a href="/pages/9e2bd7/" class="sidebar-link">JUC工具类-Phaser详解</a></li><li><a href="/pages/0baf76/" class="sidebar-link">JUC工具类-Exchanger详解</a></li><li><a href="/pages/d277df/" class="sidebar-link">Java 并发 - ThreadLocal详解</a></li><li><a href="/pages/b23a10/" class="sidebar-link">多线程问题总结</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java IO-NIO-AIO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java8 特性详解</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java8各版本特性概述</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JVM相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java其它相关</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/web/#Java" data-v-06225672>Java</a></li><li data-v-06225672><a href="/web/#Java多线程与并发" data-v-06225672>Java多线程与并发</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/FanXGit" target="_blank" title="作者" class="beLink" data-v-06225672>fanx</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-07-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">JUC锁-ReentrantReadWriteLock详解<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="juc锁-reentrantreadwritelock详解"><a href="#juc锁-reentrantreadwritelock详解" class="header-anchor">#</a> JUC锁: ReentrantReadWriteLock详解</h2> <blockquote><p>ReentrantReadWriteLock表示可重入读写锁，ReentrantReadWriteLock中包含了两种锁，读锁ReadLock和写锁WriteLock，可以通过这两种锁实现线程间的同步。@pdai</p></blockquote> <h2 id="带着bat大厂的面试问题去理解"><a href="#带着bat大厂的面试问题去理解" class="header-anchor">#</a> 带着BAT大厂的面试问题去理解</h2> <hr> <p>提示</p> <p>请带着这些问题继续后文，会很大程度上帮助你更好的理解相关知识点。@pdai</p> <ul><li>为了有了ReentrantLock还需要ReentrantReadWriteLock?</li> <li>ReentrantReadWriteLock底层实现原理?</li> <li>ReentrantReadWriteLock底层读写状态如何设计的? 高16位为读锁，低16位为写锁</li> <li>读锁和写锁的最大数量是多少?</li> <li>本地线程计数器ThreadLocalHoldCounter是用来做什么的?</li> <li>缓存计数器HoldCounter是用来做什么的?</li> <li>写锁的获取与释放是怎么实现的?</li> <li>读锁的获取与释放是怎么实现的?</li> <li>RentrantReadWriteLock为什么不支持锁升级?</li> <li>什么是锁的升降级? RentrantReadWriteLock为什么不支持锁升级?</li></ul> <h2 id="reentrantreadwritelock数据结构"><a href="#reentrantreadwritelock数据结构" class="header-anchor">#</a> ReentrantReadWriteLock数据结构</h2> <hr> <p>ReentrantReadWriteLock底层是基于ReentrantLock和AbstractQueuedSynchronizer来实现的，所以，ReentrantReadWriteLock的数据结构也依托于AQS的数据结构。</p> <h2 id="reentrantreadwritelock源码分析"><a href="#reentrantreadwritelock源码分析" class="header-anchor">#</a> ReentrantReadWriteLock源码分析</h2> <hr> <h3 id="类的继承关系"><a href="#类的继承关系" class="header-anchor">#</a> 类的继承关系</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class ReentrantReadWriteLock implements ReadWriteLock, java.io.Serializable {} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>说明: 可以看到，ReentrantReadWriteLock实现了ReadWriteLock接口，ReadWriteLock接口定义了获取读锁和写锁的规范，具体需要实现类去实现；同时其还实现了Serializable接口，表示可以进行序列化，在源代码中可以看到ReentrantReadWriteLock实现了自己的序列化逻辑。</p> <h3 id="类的内部类"><a href="#类的内部类" class="header-anchor">#</a> 类的内部类</h3> <p>ReentrantReadWriteLock有五个内部类，五个内部类之间也是相互关联的。内部类的关系如下图所示。</p> <p><img src="/assets/img/thread_java-thread-x-readwritelock-1.1bcee27d.png" alt=""></p> <p>说明: 如上图所示，Sync继承自AQS、NonfairSync继承自Sync类、FairSync继承自Sync类；ReadLock实现了Lock接口、WriteLock也实现了Lock接口。</p> <h3 id="内部类-sync类"><a href="#内部类-sync类" class="header-anchor">#</a> 内部类 - Sync类</h3> <ul><li>类的继承关系</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>abstract static class Sync extends AbstractQueuedSynchronizer {} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>说明: Sync抽象类继承自AQS抽象类，Sync类提供了对ReentrantReadWriteLock的支持。</p> <ul><li>类的内部类</li></ul> <p>Sync类内部存在两个内部类，分别为HoldCounter和ThreadLocalHoldCounter，其中HoldCounter主要与读锁配套使用，其中，HoldCounter源码如下。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 计数器
static final class HoldCounter {
    // 计数
    int count = 0;
    // Use id, not reference, to avoid garbage retention
    // 获取当前线程的TID属性的值
    final long tid = getThreadId(Thread.currentThread());
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>说明: HoldCounter主要有两个属性，count和tid，其中count表示某个读线程重入的次数，tid表示该线程的tid字段的值，该字段可以用来唯一标识一个线程。ThreadLocalHoldCounter的源码如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 本地线程计数器
static final class ThreadLocalHoldCounter
    extends ThreadLocal&lt;HoldCounter&gt; {
    // 重写初始化方法，在没有进行set的情况下，获取的都是该HoldCounter值
    public HoldCounter initialValue() {
        return new HoldCounter();
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>说明: ThreadLocalHoldCounter重写了ThreadLocal的initialValue方法，ThreadLocal类可以将线程与对象相关联。在没有进行set的情况下，get到的均是initialValue方法里面生成的那个HolderCounter对象。</p> <ul><li>类的属性</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>abstract static class Sync extends AbstractQueuedSynchronizer {
    // 版本序列号
    private static final long serialVersionUID = 6317671515068378041L;        
    // 高16位为读锁，低16位为写锁
    static final int SHARED_SHIFT   = 16;
    // 读锁单位
    static final int SHARED_UNIT    = (1 &lt;&lt; SHARED_SHIFT);
    // 读锁最大数量
    static final int MAX_COUNT      = (1 &lt;&lt; SHARED_SHIFT) - 1;
    // 写锁最大数量
    static final int EXCLUSIVE_MASK = (1 &lt;&lt; SHARED_SHIFT) - 1;
    // 本地线程计数器
    private transient ThreadLocalHoldCounter readHolds;
    // 缓存的计数器
    private transient HoldCounter cachedHoldCounter;
    // 第一个读线程
    private transient Thread firstReader = null;
    // 第一个读线程的计数
    private transient int firstReaderHoldCount;
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>说明: 该属性中包括了读锁、写锁线程的最大量。本地线程计数器等。</p> <ul><li>类的构造函数</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 构造函数
Sync() {
    // 本地线程计数器
    readHolds = new ThreadLocalHoldCounter();
    // 设置AQS的状态
    setState(getState()); // ensures visibility of readHolds
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>说明: 在Sync的构造函数中设置了本地线程计数器和AQS的状态state。</p> <h3 id="内部类-sync核心函数分析"><a href="#内部类-sync核心函数分析" class="header-anchor">#</a> 内部类 - Sync核心函数分析</h3> <p>对ReentrantReadWriteLock对象的操作绝大多数都转发至Sync对象进行处理。下面对Sync类中的重点函数进行分析</p> <ul><li>sharedCount函数</li></ul> <p>表示占有读锁的线程数量，源码如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>static int sharedCount(int c)    { return c &gt;&gt;&gt; SHARED_SHIFT; } 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>说明: 直接将state右移16位，就可以得到读锁的线程数量，因为state的高16位表示读锁，对应的低十六位表示写锁数量。</p> <ul><li>exclusiveCount函数</li></ul> <p>表示占有写锁的线程数量，源码如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>static int exclusiveCount(int c) { return c &amp; EXCLUSIVE_MASK; } 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>说明: 直接将状态state和(2^16 - 1)做与运算，其等效于将state模上2^16。写锁数量由state的低十六位表示。</p> <ul><li>tryRelease函数</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>/*
* Note that tryRelease and tryAcquire can be called by
* Conditions. So it is possible that their arguments contain
* both read and write holds that are all released during a
* condition wait and re-established in tryAcquire.
*/

protected final boolean tryRelease(int releases) {
    // 判断是否伪独占线程
    if (!isHeldExclusively())
        throw new IllegalMonitorStateException();
    // 计算释放资源后的写锁的数量
    int nextc = getState() - releases;
    boolean free = exclusiveCount(nextc) == 0; // 是否释放成功
    if (free)
        setExclusiveOwnerThread(null); // 设置独占线程为空
    setState(nextc); // 设置状态
    return free;
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>说明: 此函数用于释放写锁资源，首先会判断该线程是否为独占线程，若不为独占线程，则抛出异常，否则，计算释放资源后的写锁的数量，若为0，表示成功释放，资源不将被占用，否则，表示资源还被占用。其函数流程图如下。</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUkAAAG/CAIAAABaI7L7AAAdgklEQVR4Xu3d7XnqPLOG4U0vKSR1pBVaeUpJHTSximDrRclEjD5sCWxppOv8kcMejW2MuGMWZMH/3QHM6P90AcAUyDYwJ7INzIlsA3Mi28CcyDYwJ7INzKk927fb7evr6+Pj44LZuVl2c/39/a0fBBhYY7b/++8/N9/up0u4HsN03Cz7Gb9er3oMo2rJtptpN83//v3TA5iam3E371y9rWjJtnt65n6L6yoW4Ob98/NTVzGklmy7X948FV+Tv3TrKobUku3L5aJLWAazbwXZ/qNeHI6p5nA1WZnSIqc5AbKtxWcXV5LFuDKlRU5zAmRbi88ursTFZM+U1jlT68i2Fp9dHOOQ6ok3n8z0JzgNsq3FZ1eo+AXVEPfPZO6zmwnZ1uKzK1Quec9bzGPiU5sM2f6ho5khzWpBydUnMPGpTYZsa/HZqUq4GjdPb8FTNopsa/HZFSp+4RJ56p7L3Gc3E7KtxWcXV3xR6qoh2T+Nuc9uJmT7SfLUksV7dPWO61Oa++xmQrafJE+tUAx/qqFZzX12MyHbf3LnFdfVFfsSeeqey9xnNxOy/aNwUmoo7txsmMncZzcTso06zL4VZBt1mH0ryDbqMPtWtGSbz1Ra1r9//8i2FS3Z5rMQl8VnIRrSku3v728+w3hBfIaxLS3Zdq7Xq//uARK+AjfLfPeAOY3Zvj+u3u7p2QVrcHPNFduW9mwv68KLSbCAbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbFcj2zCBbO91u92+Hly2/cL397duAoZBtit8fHxcAv/+/dMdwDDIdoX//vtPgn29XvUwMBKyXUcu3Vy0MTiyXcdfurloY3xku9rn5ycXbYyPbFf4/v7++vpyT8t5kRzjI9vbfKTdU3F3xXbPyW+3m/vpli+PN8MIOcZEtrNcht2/qz8eXJjj5+Gu4kPuGlwnIcdQyLYWRtotuFXdEWnYBDga2f7hLsKv55OQYxyrZ1ueV/t3tt71vHrz+TxwtEWzHUb60NfD1OtwhBynWSvbPtLy/z2Oi3RshZD7v9gr0BvgSKtkW6LlfvaNVq9fLucjzH1Nnm35a5PRrpan/aOgFy7U3c2ZbRcV/1LWaJGOTRlyn2r5Sci7mCrbpt+CesubcN2FSQ4jTcLPN0O2TUc6ZvR04vTGYY4rOI7hbE//J58q5CP/yyKJJPdlL9tT/gO1zL98cLHw/pm/eifpVhzMTLZ3Rlo/oAK6tV7VTsrNudFc3Rv/TfLc7c/VcRwD2VZvTevhZ7nHkKr/5j1LNauFpNxWydWdlZyq++RMuVPI1XGccbPddo36iWaKbg2UR++/DTvbNpf3kP6Cjn9ml5O75bk6jjNcttsiLXKPoVz9/hs2XU3Z0yY98cJxdv6D5QT+zkzSrTjYKNl+12vC+gEV0K0Pvi4/VVu4eU5tZ7JZhvxouFql+3sHuRufq+M4nbPd8b3cMFThIy8Om4jrcSVHHSIYefr9Eo+26XjHYhB9sn3E32D5TG6STrVtuLqzkismhZ3Jo0tx/z73IOTLOjXb4T8LT3jGuD8kezqT2duzoae2UsIGWXgvQ39jj7c4I9tnvtITBqMckqdsPdOtD2FdllWxLOyUZVmVohp9uxdfrYQVx2b7/HdoVIRCQdfPqKp4yboqymqyOSnsTO6tYZ8vIuRzOyTbHR80hQgpudFkPVm85+sxdcOUsEEWTnP+r2Cc4J3Z7hhpEQajHJLcaFyPK6IwpBRuWHn1NGf+0wkneEO2x3mRpuoCeMlTbeFqKBzSu0hJbri5ej5CPof2bI/25ooKT06yP7SzJzeUk9ytulVqtbsj3qrEaaqzPVqkcYJw0v31fGX63hlVdbblGbjPdsdn4DhN9z9lHcfM2RYjvHK2UzwfvhLXq6jNN/e22TAa/uEdMzSJ7dkW44c8ng+pJIck+Yo0qIXkamyzYRBEusDKJN7fkm0hIf8a6QMDklGMZ+g3v9meeKjQkLTZ0N2YMziU8SdRvDPb3mi/9WUyVDiFFH09uVxYDXclwk6hm37pvtON/8xrHCPM107vz7YYIeRxhNSqEtb/tvyl2sKfyQUlV+/Fvyx6IdI1RpvEggOzLUZ4lVVNSTxDv/n9oUZDMuoX1Gq4oOTqJ3vXx2CsaZBJ3OOMbIte743H8yGxVEmOOwtsZbvXnT+ZvpNY5dRsizMfZ2oyJM/JSQrrYWdYV51SjxekLUfajsPflr3XObP2Fn2yLY7+W/RclmRZFf1qsjMUtv3u+4nqTCoMvW6EFzumdOisvVfnbIuTX6r1M6TmScVSirlKvHm4Wih6haFmRPpoR8zaQUbJtlBvsR4XchXR8KfUFRmShuRqWI+3EoWhBv/xf7BP8d5ZO9Rw2RbvfbCqcPrl8GdYD8UVoYaS+9m/eZuTn+/gLbN2jnGz7b34JPOR6P9RlcKqLOcq4nffaft7GhDpXl6ZtZONnm0Rhvy9b5KHsyXLTxEMhKOyVSzsfB75UxjKOfqlR2xqmLVezGRbLPimzplvGaKMbJ9h+kf89CdoEdk+1WR/RDnCn+gih2z3YfoVpjDSDa8a4hxkuzNDIfeRfuO7fTgU2R6F+ksYPdzVaX+lgzci22N58U3y9zL0nAIxsj2ojiH3b00TaevI9uh8yE94e4n3sSZDts04KHsH7RbdkW173pLG054OoBeybVjD32x3/Gc8Tka2Z7D5gjaRXhDZnkr8RvTIb5vjUGR7QuEfkOWu5Jge2Z6ZodnF2xmafbJdzdDs4u0Mzf6i2b7k6dbInh7MytDsr5ttXXrI1UN7ejArQ7O/brZzdGtkTw9mZWj21822Lj3k6qE9PZiVodlfN9s5ujWypwezMjT7i2b7FYZmF29naPaXy/bzRTpLbxYoj2JuhmZ/uWzHamerth8zMTT7i2Y7nKHa2artx0wMzT7Z1s/Sg660PT2YlaHZJ9vVs1Xbj5kYmn2yXT1btf2YiaHZXzHbfnpkkmpnq7YfMzE0+8tlW12xc4IttPIo5mZo9pfL9usMzS7eztDsk+1qhmYXb2do9sl2NUOzi3fxH5LnuNn3C+N/ohbZ3ut2u30+XB6fl+bwwabrcLMvr8V443/4PNmu8PHxIVPrlvUwpuY/BtNzy3p4PGS7gn9K5vHRxasJL93jX7TvZLuWv3Rz0V6TfCi9HhgS2a7jL91ctNfkL90mLtp3st3Ayq9tHMHQC6jt2Xa/vdyjPHx5CbNys9z9C8/89zTxeNs/F43Z9t9E635aeX6CV7hZ9jN+vV712Cn8N6u6BzSPN3cPuPthz1y0ZNvt3e16/Pfu8V5uxn3A9MDB/EOZx5uyORct2ebLK5flv5NYVw+28ynoatx9Up6Llmy7Xxg8NVqTv3Tr6sG4aCe5++RS/PPnlmyX94i5nT/75x/RivI9YyPbySPuLMaVc2weVzVs9t/39Rzt/Nvw4hFl86o7vDB6KdLdgfJog/IObWT7njposqLExbiSo3Zea3MPqsGvlrcqj57j/Nvw4hFl8+Qd3rBauD3xUG7DuLNBeSfzZDt5x8ULscJQM7/P5J5zNymuX/b528UpzB1RNlf7aV4t3J7kUHwDkm0Nyvsxk+1Y8mZc8nTrr8JQm3CHyZ37ohpKdip7eo52/m1oPqJMfXyHqyE1Wl4Nt43tbBPS36C8+YTZ1qWHXP1eHGoQ7y1XkZ9JahPfKT87Ov8GvHhEud/UfavuT3WUwqoaiqk9F+zpKShvbiDbPxMSzZCimmNPOw3IUKFnp3APueVcMdkjNvd2mvOP/uIR1fwWVst8W7hJjmrQO3oIG5qV92Mg21580LiSK97z9fvzkGr7m4oi6VTbqtW4UlgV4SHi4vnOP+6LR5TN1d0Y36uhXN3z93+Bag5Xk5U25f1MmO0c3fpLDRU6q5T3o26SX45vSVxRq+WjHMHcEeVein+GC0qu3sDfAEU3NSnvZ8Js69JDrn6PhgqdVQr78UNhQ1wZ1vk3svmIl1+yqn7Gq2KzstkQ22yoVd7hhNnO0a2/CkOvyO1W6mGDX85tIjYbTnD+bXjxiOoODx8MshwfYrOy2eArZaq/VnkPxrIdHrpwM3a2eZsNbTZ3Kw2btzbXkGw+2vkHffGI6n5O7i0u5iqXfcJN1B5yqw3Ke7CU7fJd83uvbgg3kQ116R02dysNYafayq9uNpzJ3BHV/Zy8A+NDbFY2G+JKebVBeQ+Wsr1Z8Wrvwc2GNpu79Q1xW1jZ7ImHjmbuiOq+Sj48LvuorZS4qCqyGu+wTXkPZrIdS96MuBhXlM2GNpu7Lcyur4ejvjn0132u8w/dfMTwvgp3InUZ3UM6c5vk6mKzoVZ5h4azjS7On/3zj2hF+Z4h26hz/uyff0QryvcM2Uad82ffHZHPXYkd8rkrfKbSsjYfT0fg89KSDvm8ND4LcVldPgvRf86pri7PTUQ5hi3Z5jNl19TrM4zvweeT64El+Sv25vfbtGT7/ntfu18bJHwFbpb7fvfA/fcBfcHj69/LV2yvMdv33/v6Y/nvcFmEm2sum7a0Z3s1l9NfQwJeQbb3ItuwhWzvRbZhC9nei2zDFrK9F9mGLWR7L7INW8j2XmQbtpDtvcg2bCHbe5Ft2EK29yLbsIVs70W2YQvZ3otswxayvRfZhi1key+yDVvI9l5kG7aQ7b3INmwh23uRbdhCtvci27CFbO9FtmEL2d5wu90+Hy6PzwzjY8NgBdneFn7eIx+UDSvI9jZ3oZZs7/nsWGAEZHsXf+nmog1DyPYu/tLNRRuGkO29/DfOuZ/u6s23z2F8ZHubj/Tl97tabreb/8o7VyHkGBbZzlKRjr/5zH9LFiHHmMi2thnpGCHHgMj2j4ZIxwg5xrF6tt8S6RghR3eLZvugSMcIOXpZK9unRTpGyHGyJbLdMdIxQo5zzJztoSIdI+Q41ITZHjzSsTlCftmiN8DB5sm2i8T1ev34+LAS6dgcIfcIc3fmsy2RdtzC7XbTHQZZDzkX6hFYzfaUkY5ZDLlPtfwk5L0Yy/YbI518zCWL91Q9rvhiTnOnF4bcnfiYIQ9vf3gihfPCcWxke0+kf6OxIeyPl9VCrh4uhHKjcXNc8XJ14UIe3hWDhPxx1zaeMg4ydLb3RFrseeiEPf7hKBW/EP7cU1dyDXHz78ETVGeOuzcGDLnYfyI4yIjZrop0bM+jKtej6s+h+xEPlfs96ZFOVfFy9YJxQq7POaBbcbyBsq0eo7WRFvph9StsCNp/KrF4NKyohVqyz5hu3a17yHM3PlfHofpn+12RFnseSSpL8SZSCRtUUS3s4ZuP1ivkuRPM1XGobtl+e6S9/Q+jsFOW1UKyHg6pwyX3GS/vIf2vODnkuZudq+NQZ2f7oEgLHZFnqjNejhfUsirG+8wJ25Ty6Fscfbd7+pwDuhXHOynb5zy2yuQRFj/swqFwQXX6omqQilrNLceVePQ4h05E7kRydRzq2Gwf+kiqtSeH8UK5GO8zJ2zzneFyofMgQ00NjnBItrs8blRCFN+g+uPl5EJcTK4q+0fLnUfrMlk4wTuzPfijJJnMOGPJpIUJD4tqtUw1J5c7Gnz6UOsN2VaPiaNfjG0WpysXsFxn3FOI5eaQNBQ6uyDkc2jPtpVI36MYS1EWcqPxkNTjyh7xtjnS0xEhN60624YijXcJJ93/X7Rabiu9Uxzs1Wzzu3wFL/5Cd/1k+3zV2RYv/o8O0y5jPGc+2ouRFmS7i/ZsC+sh108fI2GnWpjSuyItyHYXb8i2sB5yr5xbP1ruMUo+2uVdkRZku4t3ZlvYDbm6UOds9rgT97v6+vrSY4M54SPZyHYXh2Rb2Ap5eE1WIferZdLsHscSaVd3yZGhcZwQaUG2uzg220KFfLQPDw/DGaZUhTasFypuWX6LuZMd6mF9ZqQF2e7ipGwLH/LLMF/6Eae3nNt4VRXdCYYN7hzdrzNZ7aVLpAXZ7uLsbIvvUb/ZJxndkDSEnWNmu2+kBdnuolu2xQgh/9+1O0O3ZiItCyNke5BIC7LdRf9si44hT2b4nqqrSpxt9y/ty/O/t097qXy0SAuy3cVA2RbnhzzOsBfX44oX1j/PfZ182EgLst3FiNkWp4V8T2Lj1VDc6bnrdlh/o/EjLch2F0NnWxwdcoliLOwJtnhSGHo7Q5EWZLsLG9kWB4U8F06pFxpyQ+9lMdKCbHdhLNvioJCPxnSkBdnuwmq2xZQhnyPSgmx3YT7bYoKQTxZpQba7mCfbwlzIfaT9bXY/j37P7Hxku4sJsy0GD3kc6dFu4buQ7S5mzrYYKuTrRFqQ7S6WyLaQkJ8fqgUjLch2F2tl2zszZmcea1hku4sVsy2OC95xe7aIbHexdLbFG6PY8Wn/sMh2F2T7SXPIh3q5bjRkuwuynbYz5ER6D7LdBdnekAw5ka5Ctrsg23uFISfSVch2F2S72uWU/9Q5E7LdBdmuRrZrke0uyHY1sl2LbHdBtquR7VpkuwuyXY1s1yLbXZDtamS7FtnugmxXI9u1yHYXK2b7kqdbU3a2QZDtLhbNti495OrKzjYIst3FotnO0a0pO9sgyHYXi2Zblx5ydWVnGwTZ7mLRbOfo1pSdbRBku4sVs/0isl2LbHexVrb1ZTpDb/ZsswEK2e5irWzHGoLasMniyHYXK2Y7DGdDUBs2WRzZ7oJsPwm6sna2QZDtLsh2dVAbNlkc2e6CbFcHtWGTxZHtLpbLtk+m5HN/UG+32+fD5fF5ac73LN+hezSy3cVa2VZX7JxgiycfHx/S45b1MDLIdhdrZftF7jEq2f5vum/JPg7Z7oJs1/GXbi7aVch2F2S7jr90c9GuQra7INvVvr6+dAlFZLuL9mx/P743J3x5CbNys+zmuvl9AbLdRWO2r9erm283Z7fbTY9hOm6W3Vy7GXfzrsd2INtdtGTbTzPfhrUg/wtdV7eQ7S5asv3K0zOY1pbStq3wopZsu1/ePBVfk3uydsn/bU8O2e6iJdsNs4tpNMw+2e5iuGzv3/nTK7kpqrmwGmto8JW43mDnTna2vVfDQcl2F8Nl+/68/5+Y/gq6/tpUf7iQ7IlXYw0NuWP5itweRbWphU37O9+l4YhkuwsD2U4uh6vJHrWQ2zan3BAfRS1LxQsrwbhelUpc92SHZXqzt2rYP9nuYsRsh8JjqeM+P54Tws7CJtIW0k2/ZFQtqE2k6OvJ5XhV7KnvWT5Cw/7JdheGs63kRn09/JlcUHL1+2NIqMpz44+w/rflr1w9Fu5KFkRh6L0a9k+2uxgr2+Hj2K8+j/80hMsFvkea49VwQcnVQ6on3uTvpjyo0YK4OazEo16u/l4NRyHbXYyVbc/vv/Yo5X61z3hBydVF3CCH8FR9v2R/sthFwy0h212Mm22/EFOdOXGbX5CKWpC2HGnznWo12RaOhsuh596fHrUQL+dIz3EajkK2uxg622p5c1XEe5CfseRWimorbx43x0VZjiU7c5vk6sdpOCLZ7sJStuPjxhUvjoTqTG6YLHqFIeF74gPF28YVEW+erItc/TgNRyTbXYybbfWwTh40LOaWk5VkZuKtRGEolLzN6hCKDEmDqni19eM0HJFsdzFottUhckcM67nlZCXZHG8lkkPqdvrl8GdYD8UVL1e/54dy9eM0HJFsdzFotsNlSUt8XNWZXJZKwf6esE1VCquynKvkil7b0EEajki2uxgx255KiCr6hU25/YRktNBWGEoK+8P9J6n+kDSEq5uCHbxfw/7JdhfjZhtjaph9st0F2Uadhtkn2120ZJsPS1sWn7tiSEu2+by0ZbWltG0rvKgl29+PzznVVSzARbThO1XIdhct2b4Hn0/Ok/MVuFn2+Wz7ThWy3UVjtu+/Exa+9YKJtV2xPbLdRXu2l3WpfzFpcWS7C7JdjWzXIttdkO1qZLsW2e6CbFcj27XIdhdkuxrZrkW2uyDb1ch2LbLdBdmuRrZrke0uyHY1sl2LbHdBtquR7VpkuwuyXY1s1yLbXZDtamS7FtnugmxXI9u1yHYXZLsa2a5Ftrsg29XIdi2y3QXZrka2a5HtLsh2NbJdi2x3Qbarke1aZLsLsl2NbNci212Q7WpkuxbZ7oJs73W73T4fLo8PD3O++SDnfch2F2S7wsfHx+UXn+K8H9nugmxXcI9RyXbzh34uiGx3Qbbr+Es3F+0qZLsLsl3HX7q5aFch212Q7Wpt362xMrLdRXu2b7ebe5SHLy9hVm6WX/mCR7LdRWO23ZNSN9/up0u4HsN03Cz7Gb9er3psB7LdRUu23UzzFdwLcjPuv+BRD2wh2120ZNs9PePFpDW5eW9IKdnuoiXb7pc3T8XX5C/durqFbHfRku0Lf1C9sIbZJ9tdzJ/t/bf2+bXhhLi/sJq0p2dwDadAtruYP9v35xscZlWdiKyq/riYrPjVuC1UHjWh4RTIdhcrZju5HK4mewoLufpln79dWNBwg8l2F0tkOxTeeHUiz4lLCDvlpyqW7ekZXMMpkO0uyHZWYTTM9k/uI3qbzG8Ec5K3v/zHDmS7i8mzrZIW33I1Wva8qd5b3BAKR8udg1M3Xv5CMSwqZLuLybPt+Rtce7M3+3dmW34vqHjn+gcnN9un2p8I2R7QQtn2CzHVmRO2SWe4Kj/DYlxRq/GeB+dusP+jY3/jdyLb51sr22p5c1Uk2+Ld5jafiT9H9w/s6/X6E9yt6za6WDrb8YnEFS+5VVzMbS42G8YXnoIknGwPaKFsq0wmzyKOa7wcF/d3FpatiG+zSzj/v2BAq2Rb3ebcKeSCl+zfk22/utlgiLkbvKxVsh0uS97iE8mFMO6UYjwUb1joiYcGZ+4GL2uJbHu5MEv89khuG/P1cDTciffXbYrdW76ahbKNt2D2rSDbqMPsW0G2UYfZt6Il23ym0rL+/ftHtq1oyTafhbists9CRBct2f7+/uYzjBfU/BnG6KIl2871evX/s4+Er8DN8ivfPYAuGrN9//2Pe39v12Jqbq65YtvSnu1lXXgxCRaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7WpkGyaQ7b1ut9vnw+Xx4WF8fhgGR7YrfHx8XH65ZT0MjIRsV3AXask2376AwZHtOv7SzUUb4yPbdfylm4s2xke2q319fekSMB6yDczppWzfbjd3EQtfPcas3Cy7ueZtP0Pas+2//M395Lu4V+Bmma/7s6Ux226m+ZreBfE1vYY0Zts9PeO14jW5ef/8/NRVjKcx2+6XN0/F1+Qu3Rf+ot6Cxmwzuytj9k0g27vIy8V6YEncDyaQ7SfheUmekycbjubobWYx8anNhGxrcmrlcyyP3nc02DXxqc2EbGtke9PEpzYTsp31v2fVkXA016Ya5jPxqc2EbGfF5xhWchnO1Wcy8anNhGz/+bnsPoczl9Xa+kwmPrWZkG0tDqcKeXJ0sz6TiU9tJmRbS4YzPt9kW6E+k4lPbSZkW4vD6RcKGVZUw3wmPrWZkG3Nn1oyornlpM0GuyY+tZmQba0Q4MJQbLPBrolPbSZk+4m6aBdcdtDbzGLiU5sJ2f4TnpRKaShuTtpssGviU5sJ2UY1Zt8Eso1qzL4JZBvVmH0TGrPNZyoti89UsqIx23wW4rL4LEQrGrP9/f3NZxgviM8wNqQx2871evXfPUDCV+Bmme8esKU92/fH1ds9PeM7gxbh5portiEvZRvAsMg2MCeyDcyJbANzItvAnMg2MCeyDcyJbANzItvAnMg2MKf/B/us9+NH8xtWAAAAAElFTkSuQmCC" alt=""></p> <ul><li>tryAcquire函数</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>protected final boolean tryAcquire(int acquires) {
    /*
        * Walkthrough:
        * 1. If read count nonzero or write count nonzero
        *    and owner is a different thread, fail.
        * 2. If count would saturate, fail. (This can only
        *    happen if count is already nonzero.)
        * 3. Otherwise, this thread is eligible for lock if
        *    it is either a reentrant acquire or
        *    queue policy allows it. If so, update state
        *    and set owner.
        */
    // 获取当前线程
    Thread current = Thread.currentThread();
    // 获取状态
    int c = getState();
    // 写线程数量
    int w = exclusiveCount(c);
    if (c != 0) { // 状态不为0
        // (Note: if c != 0 and w == 0 then shared count != 0)
        if (w == 0 || current != getExclusiveOwnerThread()) // 写线程数量为0或者当前线程没有占有独占资源
            return false;
        if (w + exclusiveCount(acquires) &gt; MAX_COUNT) // 判断是否超过最高写线程数量
            throw new Error(&quot;Maximum lock count exceeded&quot;);
        // Reentrant acquire
        // 设置AQS状态
        setState(c + acquires);
        return true;
    }
    if (writerShouldBlock() ||
        !compareAndSetState(c, c + acquires)) // 写线程是否应该被阻塞
        return false;
    // 设置独占线程
    setExclusiveOwnerThread(current);
    return true;
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>说明: 此函数用于获取写锁，首先会获取state，判断是否为0，若为0，表示此时没有读锁线程，再判断写线程是否应该被阻塞，而在非公平策略下总是不会被阻塞，在公平策略下会进行判断(判断同步队列中是否有等待时间更长的线程，若存在，则需要被阻塞，否则，无需阻塞)，之后在设置状态state，然后返回true。若state不为0，则表示此时存在读锁或写锁线程，若写锁线程数量为0或者当前线程为独占锁线程，则返回false，表示不成功，否则，判断写锁线程的重入次数是否大于了最大值，若是，则抛出异常，否则，设置状态state，返回true，表示成功。其函数流程图如下</p> <p><img src="/assets/img/thread_java-thread-x-readwritelock-3.2a5b5d06.png" alt=""></p> <ul><li>tryReleaseShared函数</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>protected final boolean tryReleaseShared(int unused) {
    // 获取当前线程
    Thread current = Thread.currentThread();
    if (firstReader == current) { // 当前线程为第一个读线程
        // assert firstReaderHoldCount &gt; 0;
        if (firstReaderHoldCount == 1) // 读线程占用的资源数为1
            firstReader = null;
        else // 减少占用的资源
            firstReaderHoldCount--;
    } else { // 当前线程不为第一个读线程
        // 获取缓存的计数器
        HoldCounter rh = cachedHoldCounter;
        if (rh == null || rh.tid != getThreadId(current)) // 计数器为空或者计数器的tid不为当前正在运行的线程的tid
            // 获取当前线程对应的计数器
            rh = readHolds.get();
        // 获取计数
        int count = rh.count;
        if (count &lt;= 1) { // 计数小于等于1
            // 移除
            readHolds.remove();
            if (count &lt;= 0) // 计数小于等于0，抛出异常
                throw unmatchedUnlockException();
        }
        // 减少计数
        --rh.count;
    }
    for (;;) { // 无限循环
        // 获取状态
        int c = getState();
        // 获取状态
        int nextc = c - SHARED_UNIT;
        if (compareAndSetState(c, nextc)) // 比较并进行设置
            // Releasing the read lock has no effect on readers,
            // but it may allow waiting writers to proceed if
            // both read and write locks are now free.
            return nextc == 0;
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>说明: 此函数表示读锁线程释放锁。首先判断当前线程是否为第一个读线程firstReader，若是，则判断第一个读线程占有的资源数firstReaderHoldCount是否为1，若是，则设置第一个读线程firstReader为空，否则，将第一个读线程占有的资源数firstReaderHoldCount减1；若当前线程不是第一个读线程，那么首先会获取缓存计数器(上一个读锁线程对应的计数器 )，若计数器为空或者tid不等于当前线程的tid值，则获取当前线程的计数器，如果计数器的计数count小于等于1，则移除当前线程对应的计数器，如果计数器的计数count小于等于0，则抛出异常，之后再减少计数即可。无论何种情况，都会进入无限循环，该循环可以确保成功设置状态state。其流程图如下</p> <p><img src="/assets/img/thread_java-thread-x-readwritelock-4.756ae129.png" alt=""></p> <ul><li>tryAcquireShared函数</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>private IllegalMonitorStateException unmatchedUnlockException() {
    return new IllegalMonitorStateException(
        &quot;attempt to unlock read lock, not locked by current thread&quot;);
}

// 共享模式下获取资源
protected final int tryAcquireShared(int unused) {
    /*
        * Walkthrough:
        * 1. If write lock held by another thread, fail.
        * 2. Otherwise, this thread is eligible for
        *    lock wrt state, so ask if it should block
        *    because of queue policy. If not, try
        *    to grant by CASing state and updating count.
        *    Note that step does not check for reentrant
        *    acquires, which is postponed to full version
        *    to avoid having to check hold count in
        *    the more typical non-reentrant case.
        * 3. If step 2 fails either because thread
        *    apparently not eligible or CAS fails or count
        *    saturated, chain to version with full retry loop.
        */
    // 获取当前线程
    Thread current = Thread.currentThread();
    // 获取状态
    int c = getState();
    if (exclusiveCount(c) != 0 &amp;&amp;
        getExclusiveOwnerThread() != current) // 写线程数不为0并且占有资源的不是当前线程
        return -1;
    // 读锁数量
    int r = sharedCount(c);
    if (!readerShouldBlock() &amp;&amp;
        r &lt; MAX_COUNT &amp;&amp;
        compareAndSetState(c, c + SHARED_UNIT)) { // 读线程是否应该被阻塞、并且小于最大值、并且比较设置成功
        if (r == 0) { // 读锁数量为0
            // 设置第一个读线程
            firstReader = current;
            // 读线程占用的资源数为1
            firstReaderHoldCount = 1;
        } else if (firstReader == current) { // 当前线程为第一个读线程
            // 占用资源数加1
            firstReaderHoldCount++;
        } else { // 读锁数量不为0并且不为当前线程
            // 获取计数器
            HoldCounter rh = cachedHoldCounter;
            if (rh == null || rh.tid != getThreadId(current)) // 计数器为空或者计数器的tid不为当前正在运行的线程的tid
                // 获取当前线程对应的计数器
                cachedHoldCounter = rh = readHolds.get();
            else if (rh.count == 0) // 计数为0
                // 设置
                readHolds.set(rh);
            rh.count++;
        }
        return 1;
    }
    return fullTryAcquireShared(current);
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>说明: 此函数表示读锁线程获取读锁。首先判断写锁是否为0并且当前线程不占有独占锁，直接返回；否则，判断读线程是否需要被阻塞并且读锁数量是否小于最大值并且比较设置状态成功，若当前没有读锁，则设置第一个读线程firstReader和firstReaderHoldCount；若当前线程线程为第一个读线程，则增加firstReaderHoldCount；否则，将设置当前线程对应的HoldCounter对象的值。流程图如下。</p> <p><img src="/assets/img/thread_java-thread-x-readwritelock-5.535f3954.png" alt=""></p> <ul><li>fullTryAcquireShared函数</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>final int fullTryAcquireShared(Thread current) {
    /*
        * This code is in part redundant with that in
        * tryAcquireShared but is simpler overall by not
        * complicating tryAcquireShared with interactions between
        * retries and lazily reading hold counts.
        */
    HoldCounter rh = null;
    for (;;) { // 无限循环
        // 获取状态
        int c = getState();
        if (exclusiveCount(c) != 0) { // 写线程数量不为0
            if (getExclusiveOwnerThread() != current) // 不为当前线程
                return -1;
            // else we hold the exclusive lock; blocking here
            // would cause deadlock.
        } else if (readerShouldBlock()) { // 写线程数量为0并且读线程被阻塞
            // Make sure we're not acquiring read lock reentrantly
            if (firstReader == current) { // 当前线程为第一个读线程
                // assert firstReaderHoldCount &gt; 0;
            } else { // 当前线程不为第一个读线程
                if (rh == null) { // 计数器不为空
                    // 
                    rh = cachedHoldCounter;
                    if (rh == null || rh.tid != getThreadId(current)) { // 计数器为空或者计数器的tid不为当前正在运行的线程的tid
                        rh = readHolds.get();
                        if (rh.count == 0)
                            readHolds.remove();
                    }
                }
                if (rh.count == 0)
                    return -1;
            }
        }
        if (sharedCount(c) == MAX_COUNT) // 读锁数量为最大值，抛出异常
            throw new Error(&quot;Maximum lock count exceeded&quot;);
        if (compareAndSetState(c, c + SHARED_UNIT)) { // 比较并且设置成功
            if (sharedCount(c) == 0) { // 读线程数量为0
                // 设置第一个读线程
                firstReader = current;
                // 
                firstReaderHoldCount = 1;
            } else if (firstReader == current) {
                firstReaderHoldCount++;
            } else {
                if (rh == null)
                    rh = cachedHoldCounter;
                if (rh == null || rh.tid != getThreadId(current))
                    rh = readHolds.get();
                else if (rh.count == 0)
                    readHolds.set(rh);
                rh.count++;
                cachedHoldCounter = rh; // cache for release
            }
            return 1;
        }
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>说明: 在tryAcquireShared函数中，如果下列三个条件不满足(读线程是否应该被阻塞、小于最大值、比较设置成功)则会进行fullTryAcquireShared函数中，它用来保证相关操作可以成功。其逻辑与tryAcquireShared逻辑类似，不再累赘。</p> <p>而其他内部类的操作基本上都是转化到了对Sync对象的操作，在此不再累赘。</p> <h3 id="类的属性"><a href="#类的属性" class="header-anchor">#</a> 类的属性</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class ReentrantReadWriteLock
        implements ReadWriteLock, java.io.Serializable {
    // 版本序列号 
    private static final long serialVersionUID = -6992448646407690164L;    
    // 读锁
    private final ReentrantReadWriteLock.ReadLock readerLock;
    // 写锁
    private final ReentrantReadWriteLock.WriteLock writerLock;
    // 同步队列
    final Sync sync;
    
    private static final sun.misc.Unsafe UNSAFE;
    // 线程ID的偏移地址
    private static final long TID_OFFSET;
    static {
        try {
            UNSAFE = sun.misc.Unsafe.getUnsafe();
            Class&lt;?&gt; tk = Thread.class;
            // 获取线程的tid字段的内存地址
            TID_OFFSET = UNSAFE.objectFieldOffset
                (tk.getDeclaredField(&quot;tid&quot;));
        } catch (Exception e) {
            throw new Error(e);
        }
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>说明: 可以看到ReentrantReadWriteLock属性包括了一个ReentrantReadWriteLock.ReadLock对象，表示读锁；一个ReentrantReadWriteLock.WriteLock对象，表示写锁；一个Sync对象，表示同步队列。</p> <h3 id="类的构造函数"><a href="#类的构造函数" class="header-anchor">#</a> 类的构造函数</h3> <ul><li>ReentrantReadWriteLock()型构造函数</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>public ReentrantReadWriteLock() {
    this(false);
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>说明: 此构造函数会调用另外一个有参构造函数。</p> <ul><li>ReentrantReadWriteLock(boolean)型构造函数</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>public ReentrantReadWriteLock(boolean fair) {
    // 公平策略或者是非公平策略
    sync = fair ? new FairSync() : new NonfairSync();
    // 读锁
    readerLock = new ReadLock(this);
    // 写锁
    writerLock = new WriteLock(this);
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>说明: 可以指定设置公平策略或者非公平策略，并且该构造函数中生成了读锁与写锁两个对象。</p> <h3 id="核心函数分析"><a href="#核心函数分析" class="header-anchor">#</a> 核心函数分析</h3> <p>对ReentrantReadWriteLock的操作基本上都转化为了对Sync对象的操作，而Sync的函数已经分析过，不再累赘。</p> <h2 id="reentrantreadwritelock示例"><a href="#reentrantreadwritelock示例" class="header-anchor">#</a> ReentrantReadWriteLock示例</h2> <hr> <p>下面给出了一个使用ReentrantReadWriteLock的示例，源代码如下。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.locks.ReentrantReadWriteLock;

class ReadThread extends Thread {
    private ReentrantReadWriteLock rrwLock;
    
    public ReadThread(String name, ReentrantReadWriteLock rrwLock) {
        super(name);
        this.rrwLock = rrwLock;
    }
    
    public void run() {
        System.out.println(Thread.currentThread().getName() + &quot; trying to lock&quot;);
        try {
            rrwLock.readLock().lock();
            System.out.println(Thread.currentThread().getName() + &quot; lock successfully&quot;);
            Thread.sleep(5000);        
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            rrwLock.readLock().unlock();
            System.out.println(Thread.currentThread().getName() + &quot; unlock successfully&quot;);
        }
    }
}

class WriteThread extends Thread {
    private ReentrantReadWriteLock rrwLock;
    
    public WriteThread(String name, ReentrantReadWriteLock rrwLock) {
        super(name);
        this.rrwLock = rrwLock;
    }
    
    public void run() {
        System.out.println(Thread.currentThread().getName() + &quot; trying to lock&quot;);
        try {
            rrwLock.writeLock().lock();
            System.out.println(Thread.currentThread().getName() + &quot; lock successfully&quot;);    
        } finally {
            rrwLock.writeLock().unlock();
            System.out.println(Thread.currentThread().getName() + &quot; unlock successfully&quot;);
        }
    }
}

public class ReentrantReadWriteLockDemo {
    public static void main(String[] args) {
        ReentrantReadWriteLock rrwLock = new ReentrantReadWriteLock();
        ReadThread rt1 = new ReadThread(&quot;rt1&quot;, rrwLock);
        ReadThread rt2 = new ReadThread(&quot;rt2&quot;, rrwLock);
        WriteThread wt1 = new WriteThread(&quot;wt1&quot;, rrwLock);
        rt1.start();
        rt2.start();
        wt1.start();
    } 
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><p>运行结果(某一次):</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>rt1 trying to lock
rt2 trying to lock
wt1 trying to lock
rt1 lock successfully
rt2 lock successfully
rt1 unlock successfully
rt2 unlock successfully
wt1 lock successfully
wt1 unlock successfully 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>说明: 程序中生成了一个ReentrantReadWriteLock对象，并且设置了两个读线程，一个写线程。根据结果，可能存在如下的时序图。</p> <p><img src="/assets/img/thread_java-thread-x-readwritelock-6.4e8a5cf9.png" alt=""></p> <ul><li>rt1线程执行rrwLock.readLock().lock操作，主要的函数调用如下。</li></ul> <p><img src="/assets/img/thread_java-thread-x-readwritelock-7.d2a89432.png" alt=""></p> <p>说明: 此时，AQS的状态state为2^16 次方，即表示此时读线程数量为1。</p> <ul><li>rt2线程执行rrwLock.readLock().lock操作，主要的函数调用如下。</li></ul> <p><img src="/assets/img/thread_java-thread-x-readwritelock-8.60796f05.png" alt=""></p> <p>说明: 此时，AQS的状态state为2 * 2^16次方，即表示此时读线程数量为2。</p> <ul><li>wt1线程执行rrwLock.writeLock().lock操作，主要的函数调用如下。</li></ul> <p><img src="/assets/img/thread_java-thread-x-readwritelock-9.390b35c6.png" alt=""></p> <p>说明: 此时，在同步队列Sync queue中存在两个结点，并且wt1线程会被禁止运行。</p> <ul><li>rt1线程执行rrwLock.readLock().unlock操作，主要的函数调用如下。</li></ul> <p><img src="data:image/png;base64,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" alt=""></p> <p>说明: 此时，AQS的state为2^16次方，表示还有一个读线程。</p> <ul><li>rt2线程执行rrwLock.readLock().unlock操作，主要的函数调用如下。</li></ul> <p><img src="/assets/img/thread_java-thread-x-readwritelock-11.9bea6a87.png" alt=""></p> <p>说明: 当rt2线程执行unlock操作后，AQS的state为0，并且wt1线程将会被unpark，其获得CPU资源就可以运行。</p> <ul><li>wt1线程获得CPU资源，继续运行，需要恢复。由于之前acquireQueued函数中的parkAndCheckInterrupt函数中被禁止的，所以，恢复到parkAndCheckInterrupt函数中，主要的函数调用如下</li></ul> <p><img src="/assets/img/thread_java-thread-x-readwritelock-12.b0f6d1f5.png" alt=""></p> <p>说明: 最后，sync queue队列中只有一个结点，并且头节点尾节点均指向它，AQS的state值为1，表示此时有一个写线程。</p> <ul><li>wt1执行rrwLock.writeLock().unlock操作，主要的函数调用如下。</li></ul> <p><img src="data:image/png;base64,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" alt=""></p> <p>说明: 此时，AQS的state为0，表示没有任何读线程或者写线程了。并且Sync queue结构与上一个状态的结构相同，没有变化。</p> <h2 id="更深入理解"><a href="#更深入理解" class="header-anchor">#</a> 更深入理解</h2> <hr> <h3 id="什么是锁升降级"><a href="#什么是锁升降级" class="header-anchor">#</a> 什么是锁升降级?</h3> <p>锁降级指的是写锁降级成为读锁。如果当前线程拥有写锁，然后将其释放，最后再获取读锁，这种分段完成的过程不能称之为锁降级。锁降级是指把持住(当前拥有的)写锁，再获取到读锁，随后释放(先前拥有的)写锁的过程。</p> <p>接下来看一个锁降级的示例。因为数据不常变化，所以多个线程可以并发地进行数据处理，当数据变更后，如果当前线程感知到数据变化，则进行数据的准备工作，同时其他处理线程被阻塞，直到当前线程完成数据的准备工作，如代码如下所示：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public void processData() {
    readLock.lock();
    if (!update) {
        // 必须先释放读锁
        readLock.unlock();
        // 锁降级从写锁获取到开始
        writeLock.lock();
        try {
            if (!update) {
                // 准备数据的流程(略)
                update = true;
            }
            readLock.lock();
        } finally {
            writeLock.unlock();
        }
        // 锁降级完成，写锁降级为读锁
    }
    try {
        // 使用数据的流程(略)
    } finally {
        readLock.unlock();
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>上述示例中，当数据发生变更后，update变量(布尔类型且volatile修饰)被设置为false，此时所有访问processData()方法的线程都能够感知到变化，但只有一个线程能够获取到写锁，其他线程会被阻塞在读锁和写锁的lock()方法上。当前线程获取写锁完成数据准备之后，再获取读锁，随后释放写锁，完成锁降级。</p> <p>锁降级中读锁的获取是否必要呢? 答案是必要的。主要是为了保证数据的可见性，如果当前线程不获取读锁而是直接释放写锁，假设此刻另一个线程(记作线程T)获取了写锁并修改了数据，那么当前线程无法感知线程T的数据更新。如果当前线程获取读锁，即遵循锁降级的步骤，则线程T将会被阻塞，直到当前线程使用数据并释放读锁之后，线程T才能获取写锁进行数据更新。</p> <p>RentrantReadWriteLock不支持锁升级(把持读锁、获取写锁，最后释放读锁的过程)。目的也是保证数据可见性，如果读锁已被多个线程获取，其中任意线程成功获取了写锁并更新了数据，则其更新对其他获取到读锁的线程是不可见的。</p> <h2 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h2> <hr> <ul><li>文章主要参考自leesf的https://www.cnblogs.com/leesf456/p/5419132.html，在此基础上做了增改。</li> <li>https://blog.csdn.net/jiankunking/article/details/83954263</li></ul></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://fanxgit.github.io/fanxNotes/edit/master/docs/Java/03.Java多线程与并发/13.JUC锁-ReentrantReadWriteLock详解.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">7/30/2023, 10:42:56 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/e5e4ff/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">JUC锁-ReentrantLock详解</div></a> <a href="/pages/e33954/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">JUC集合-ConcurrentHashMap详解</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/e5e4ff/" class="prev">JUC锁-ReentrantLock详解</a></span> <span class="next"><a href="/pages/e33954/">JUC集合-ConcurrentHashMap详解</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/797621/"><div>
            VuePress+GithubPages教程
            <!----></div></a> <span class="date">11-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/016620/"><div>
            java打jar包整理
            <!----></div></a> <span class="date">11-19</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/b23a10/"><div>
            多线程问题总结
            <!----></div></a> <span class="date">11-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.38fd400a.js" defer></script><script src="/assets/js/3.e11db813.js" defer></script><script src="/assets/js/59.2a730e41.js" defer></script>
  </body>
</html>
