<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JUC锁-锁核心类AQS详解 | Fanx 知识库</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/logo.svg">[object Object]
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.6ece31e0.css" as="style"><link rel="preload" href="/assets/js/app.38fd400a.js" as="script"><link rel="preload" href="/assets/js/3.e11db813.js" as="script"><link rel="preload" href="/assets/js/21.ae1e88a3.js" as="script"><link rel="prefetch" href="/assets/js/10.939e2dd4.js"><link rel="prefetch" href="/assets/js/100.4a08f581.js"><link rel="prefetch" href="/assets/js/101.45cd45c9.js"><link rel="prefetch" href="/assets/js/102.ac1359d1.js"><link rel="prefetch" href="/assets/js/103.22344102.js"><link rel="prefetch" href="/assets/js/104.5071cdfd.js"><link rel="prefetch" href="/assets/js/105.7767c121.js"><link rel="prefetch" href="/assets/js/106.809b79f1.js"><link rel="prefetch" href="/assets/js/107.62fd626a.js"><link rel="prefetch" href="/assets/js/108.0583fdc1.js"><link rel="prefetch" href="/assets/js/109.fa127771.js"><link rel="prefetch" href="/assets/js/11.6463adc8.js"><link rel="prefetch" href="/assets/js/110.5cf9f09c.js"><link rel="prefetch" href="/assets/js/111.9d963667.js"><link rel="prefetch" href="/assets/js/112.bc2b8a6e.js"><link rel="prefetch" href="/assets/js/113.2ae29573.js"><link rel="prefetch" href="/assets/js/114.0b2cedfa.js"><link rel="prefetch" href="/assets/js/115.652e433e.js"><link rel="prefetch" href="/assets/js/116.bcc5d64a.js"><link rel="prefetch" href="/assets/js/117.30b02d0d.js"><link rel="prefetch" href="/assets/js/118.87f4f927.js"><link rel="prefetch" href="/assets/js/119.05839492.js"><link rel="prefetch" href="/assets/js/12.a17960e5.js"><link rel="prefetch" href="/assets/js/120.3d772c9c.js"><link rel="prefetch" href="/assets/js/121.bd8fcebf.js"><link rel="prefetch" href="/assets/js/122.e58d2205.js"><link rel="prefetch" href="/assets/js/123.f2c2826d.js"><link rel="prefetch" href="/assets/js/124.12d9ff87.js"><link rel="prefetch" href="/assets/js/125.c7e4bf1c.js"><link rel="prefetch" href="/assets/js/126.71c358fb.js"><link rel="prefetch" href="/assets/js/127.fb1922e5.js"><link rel="prefetch" href="/assets/js/128.25cbf771.js"><link rel="prefetch" href="/assets/js/129.50047ea3.js"><link rel="prefetch" href="/assets/js/13.727ebfda.js"><link rel="prefetch" href="/assets/js/130.a77cfa28.js"><link rel="prefetch" href="/assets/js/131.1618c1f5.js"><link rel="prefetch" href="/assets/js/132.4073573b.js"><link rel="prefetch" href="/assets/js/133.f6e4882f.js"><link rel="prefetch" href="/assets/js/134.1de81973.js"><link rel="prefetch" href="/assets/js/135.43148a0c.js"><link rel="prefetch" href="/assets/js/136.12b3ef34.js"><link rel="prefetch" href="/assets/js/137.accefc34.js"><link rel="prefetch" href="/assets/js/138.8d3115ff.js"><link rel="prefetch" href="/assets/js/139.6e492e2b.js"><link rel="prefetch" href="/assets/js/14.bc6d3062.js"><link rel="prefetch" href="/assets/js/140.3d98f006.js"><link rel="prefetch" href="/assets/js/141.542d08af.js"><link rel="prefetch" href="/assets/js/142.c91a19a2.js"><link rel="prefetch" href="/assets/js/143.0c681ed2.js"><link rel="prefetch" href="/assets/js/144.62e9c646.js"><link rel="prefetch" href="/assets/js/145.ebc34777.js"><link rel="prefetch" href="/assets/js/146.d94a04a7.js"><link rel="prefetch" href="/assets/js/147.b45158de.js"><link rel="prefetch" href="/assets/js/148.5dfa6740.js"><link rel="prefetch" href="/assets/js/149.cb6f2cb0.js"><link rel="prefetch" href="/assets/js/15.a9468bf1.js"><link rel="prefetch" href="/assets/js/150.9f58dbc6.js"><link rel="prefetch" href="/assets/js/151.0a1c07e3.js"><link rel="prefetch" href="/assets/js/152.eafe4843.js"><link rel="prefetch" href="/assets/js/153.fb94cab5.js"><link rel="prefetch" href="/assets/js/154.07f7a11d.js"><link rel="prefetch" href="/assets/js/155.7f6da40b.js"><link rel="prefetch" href="/assets/js/156.2f007ca1.js"><link rel="prefetch" href="/assets/js/157.a35b5249.js"><link rel="prefetch" href="/assets/js/158.540f7a5a.js"><link rel="prefetch" href="/assets/js/159.f62e0315.js"><link rel="prefetch" href="/assets/js/16.ace3b806.js"><link rel="prefetch" href="/assets/js/160.e043c758.js"><link rel="prefetch" href="/assets/js/161.d90141bf.js"><link rel="prefetch" href="/assets/js/162.ddcdbfb9.js"><link rel="prefetch" href="/assets/js/163.f1ba395e.js"><link rel="prefetch" href="/assets/js/164.9f398973.js"><link rel="prefetch" href="/assets/js/165.0db3da51.js"><link rel="prefetch" href="/assets/js/166.b5305797.js"><link rel="prefetch" href="/assets/js/167.e7b2f76b.js"><link rel="prefetch" href="/assets/js/168.a2ecf883.js"><link rel="prefetch" href="/assets/js/169.88bd4d26.js"><link rel="prefetch" href="/assets/js/17.60481837.js"><link rel="prefetch" href="/assets/js/170.fb1699e2.js"><link rel="prefetch" href="/assets/js/171.47268bef.js"><link rel="prefetch" href="/assets/js/172.79002327.js"><link rel="prefetch" href="/assets/js/173.3b1813fb.js"><link rel="prefetch" href="/assets/js/174.362811a9.js"><link rel="prefetch" href="/assets/js/175.bb48bcd7.js"><link rel="prefetch" href="/assets/js/176.97bbf32c.js"><link rel="prefetch" href="/assets/js/177.0717ff7a.js"><link rel="prefetch" href="/assets/js/178.75bff3b7.js"><link rel="prefetch" href="/assets/js/179.3e7db0a2.js"><link rel="prefetch" href="/assets/js/18.dd3c5709.js"><link rel="prefetch" href="/assets/js/180.c81da8dd.js"><link rel="prefetch" href="/assets/js/181.142d6d1c.js"><link rel="prefetch" href="/assets/js/182.fb312040.js"><link rel="prefetch" href="/assets/js/183.3684267e.js"><link rel="prefetch" href="/assets/js/184.ec2a13bc.js"><link rel="prefetch" href="/assets/js/185.a7acace4.js"><link rel="prefetch" href="/assets/js/186.7df28551.js"><link rel="prefetch" href="/assets/js/187.347e9348.js"><link rel="prefetch" href="/assets/js/188.07356026.js"><link rel="prefetch" href="/assets/js/189.0816176d.js"><link rel="prefetch" href="/assets/js/19.cc2d4ad1.js"><link rel="prefetch" href="/assets/js/190.fd5dd8cc.js"><link rel="prefetch" href="/assets/js/191.a938967e.js"><link rel="prefetch" href="/assets/js/192.859b71a1.js"><link rel="prefetch" href="/assets/js/193.adcf2ec3.js"><link rel="prefetch" href="/assets/js/194.69d1169c.js"><link rel="prefetch" href="/assets/js/195.ad7cbcc4.js"><link rel="prefetch" href="/assets/js/196.b65138da.js"><link rel="prefetch" href="/assets/js/197.b4fca73b.js"><link rel="prefetch" href="/assets/js/198.2494a23f.js"><link rel="prefetch" href="/assets/js/199.404b9ce1.js"><link rel="prefetch" href="/assets/js/2.938bab56.js"><link rel="prefetch" href="/assets/js/20.361e2bf6.js"><link rel="prefetch" href="/assets/js/200.42b54eae.js"><link rel="prefetch" href="/assets/js/201.ab495eb8.js"><link rel="prefetch" href="/assets/js/202.2cbc5c9a.js"><link rel="prefetch" href="/assets/js/203.abf3fde5.js"><link rel="prefetch" href="/assets/js/204.4fdd4cfb.js"><link rel="prefetch" href="/assets/js/205.411987d7.js"><link rel="prefetch" href="/assets/js/206.dbcab3ae.js"><link rel="prefetch" href="/assets/js/207.f1429354.js"><link rel="prefetch" href="/assets/js/208.f763286c.js"><link rel="prefetch" href="/assets/js/209.c1edbca5.js"><link rel="prefetch" href="/assets/js/210.b2a1501d.js"><link rel="prefetch" href="/assets/js/211.fe1fd5f7.js"><link rel="prefetch" href="/assets/js/212.0fd39a8f.js"><link rel="prefetch" href="/assets/js/213.bb3fc163.js"><link rel="prefetch" href="/assets/js/214.c42e1ef3.js"><link rel="prefetch" href="/assets/js/215.4f0fa915.js"><link rel="prefetch" href="/assets/js/216.07c485c9.js"><link rel="prefetch" href="/assets/js/217.ada25e7a.js"><link rel="prefetch" href="/assets/js/218.2f761d3c.js"><link rel="prefetch" href="/assets/js/219.32d1a663.js"><link rel="prefetch" href="/assets/js/22.0b09d67f.js"><link rel="prefetch" href="/assets/js/220.36c56cf4.js"><link rel="prefetch" href="/assets/js/221.3e0431e2.js"><link rel="prefetch" href="/assets/js/222.90aa0ff7.js"><link rel="prefetch" href="/assets/js/223.5966d7df.js"><link rel="prefetch" href="/assets/js/224.7e2329e1.js"><link rel="prefetch" href="/assets/js/225.2ed3675d.js"><link rel="prefetch" href="/assets/js/226.fa3cef02.js"><link rel="prefetch" href="/assets/js/227.07bf7bca.js"><link rel="prefetch" href="/assets/js/228.9ac2589a.js"><link rel="prefetch" href="/assets/js/229.b980e141.js"><link rel="prefetch" href="/assets/js/23.31ed5c2f.js"><link rel="prefetch" href="/assets/js/230.2c32e874.js"><link rel="prefetch" href="/assets/js/231.723e20cb.js"><link rel="prefetch" href="/assets/js/232.1f94511c.js"><link rel="prefetch" href="/assets/js/233.2d477f71.js"><link rel="prefetch" href="/assets/js/234.10141c75.js"><link rel="prefetch" href="/assets/js/235.a328b127.js"><link rel="prefetch" href="/assets/js/236.42419c3b.js"><link rel="prefetch" href="/assets/js/237.648ca44e.js"><link rel="prefetch" href="/assets/js/238.4b363b75.js"><link rel="prefetch" href="/assets/js/239.fe711a73.js"><link rel="prefetch" href="/assets/js/24.fe75e3fa.js"><link rel="prefetch" href="/assets/js/240.6baa12bf.js"><link rel="prefetch" href="/assets/js/241.6f375dc4.js"><link rel="prefetch" href="/assets/js/242.aee8e39d.js"><link rel="prefetch" href="/assets/js/243.bfc7f6e1.js"><link rel="prefetch" href="/assets/js/244.c73a14a7.js"><link rel="prefetch" href="/assets/js/245.a2352aa1.js"><link rel="prefetch" href="/assets/js/246.b12c3ae6.js"><link rel="prefetch" href="/assets/js/247.2f768275.js"><link rel="prefetch" href="/assets/js/248.3f79dfb1.js"><link rel="prefetch" href="/assets/js/249.7fd0cb75.js"><link rel="prefetch" href="/assets/js/25.f2e379df.js"><link rel="prefetch" href="/assets/js/250.df3f1d0a.js"><link rel="prefetch" href="/assets/js/251.a3865750.js"><link rel="prefetch" href="/assets/js/252.d62542df.js"><link rel="prefetch" href="/assets/js/253.59b2f200.js"><link rel="prefetch" href="/assets/js/254.522d17b5.js"><link rel="prefetch" href="/assets/js/255.0f95a196.js"><link rel="prefetch" href="/assets/js/256.31b37cbe.js"><link rel="prefetch" href="/assets/js/257.ff22ad12.js"><link rel="prefetch" href="/assets/js/258.15205e0b.js"><link rel="prefetch" href="/assets/js/259.f3b7c5aa.js"><link rel="prefetch" href="/assets/js/26.45264b04.js"><link rel="prefetch" href="/assets/js/260.fec3c7aa.js"><link rel="prefetch" href="/assets/js/261.d965ee56.js"><link rel="prefetch" href="/assets/js/262.76a7105b.js"><link rel="prefetch" href="/assets/js/263.e684cc46.js"><link rel="prefetch" href="/assets/js/264.59297da0.js"><link rel="prefetch" href="/assets/js/265.66182ed2.js"><link rel="prefetch" href="/assets/js/266.eec50d90.js"><link rel="prefetch" href="/assets/js/267.c85bce12.js"><link rel="prefetch" href="/assets/js/268.ef544f0c.js"><link rel="prefetch" href="/assets/js/269.8cfb5c6a.js"><link rel="prefetch" href="/assets/js/27.4e065810.js"><link rel="prefetch" href="/assets/js/270.b66cab3c.js"><link rel="prefetch" href="/assets/js/271.c1b7d136.js"><link rel="prefetch" href="/assets/js/272.0d7950c3.js"><link rel="prefetch" href="/assets/js/273.06349cca.js"><link rel="prefetch" href="/assets/js/274.9b442c09.js"><link rel="prefetch" href="/assets/js/275.11082d81.js"><link rel="prefetch" href="/assets/js/276.ce0abe31.js"><link rel="prefetch" href="/assets/js/277.4b7fcc53.js"><link rel="prefetch" href="/assets/js/278.129d0397.js"><link rel="prefetch" href="/assets/js/279.5c021f7c.js"><link rel="prefetch" href="/assets/js/28.126ecd33.js"><link rel="prefetch" href="/assets/js/280.d183c9e3.js"><link rel="prefetch" href="/assets/js/281.0df67750.js"><link rel="prefetch" href="/assets/js/282.8fdd2372.js"><link rel="prefetch" href="/assets/js/283.dae956df.js"><link rel="prefetch" href="/assets/js/284.c5dc7189.js"><link rel="prefetch" href="/assets/js/285.7f5a7367.js"><link rel="prefetch" href="/assets/js/286.d9bfcef5.js"><link rel="prefetch" href="/assets/js/287.4fa6a5c5.js"><link rel="prefetch" href="/assets/js/288.57904d2d.js"><link rel="prefetch" href="/assets/js/289.b96d7c2f.js"><link rel="prefetch" href="/assets/js/29.8f5db82a.js"><link rel="prefetch" href="/assets/js/290.8dda9646.js"><link rel="prefetch" href="/assets/js/291.ab433493.js"><link rel="prefetch" href="/assets/js/292.e2d59796.js"><link rel="prefetch" href="/assets/js/293.30f9fcc4.js"><link rel="prefetch" href="/assets/js/294.158492dc.js"><link rel="prefetch" href="/assets/js/295.33e3a53d.js"><link rel="prefetch" href="/assets/js/296.49d7a2de.js"><link rel="prefetch" href="/assets/js/297.1b7572ac.js"><link rel="prefetch" href="/assets/js/298.00e4586a.js"><link rel="prefetch" href="/assets/js/299.d8fb6ff9.js"><link rel="prefetch" href="/assets/js/30.ef97cb8e.js"><link rel="prefetch" href="/assets/js/300.90e9dadf.js"><link rel="prefetch" href="/assets/js/301.d5592ea1.js"><link rel="prefetch" href="/assets/js/302.b08dc1ea.js"><link rel="prefetch" href="/assets/js/303.bef541c8.js"><link rel="prefetch" href="/assets/js/304.be3f7081.js"><link rel="prefetch" href="/assets/js/305.13718421.js"><link rel="prefetch" href="/assets/js/306.41685aa2.js"><link rel="prefetch" href="/assets/js/307.6d569102.js"><link rel="prefetch" href="/assets/js/308.aaabab89.js"><link rel="prefetch" href="/assets/js/309.910ecc42.js"><link rel="prefetch" href="/assets/js/31.795b3334.js"><link rel="prefetch" href="/assets/js/310.104b7753.js"><link rel="prefetch" href="/assets/js/311.45f4a7da.js"><link rel="prefetch" href="/assets/js/312.180c7e45.js"><link rel="prefetch" href="/assets/js/313.87d3a801.js"><link rel="prefetch" href="/assets/js/314.7739b1ef.js"><link rel="prefetch" href="/assets/js/315.54a1fac0.js"><link rel="prefetch" href="/assets/js/316.a978a787.js"><link rel="prefetch" href="/assets/js/317.84f65f2c.js"><link rel="prefetch" href="/assets/js/318.7f8caff8.js"><link rel="prefetch" href="/assets/js/319.0b5276f3.js"><link rel="prefetch" href="/assets/js/32.e65c7229.js"><link rel="prefetch" href="/assets/js/320.ba90589a.js"><link rel="prefetch" href="/assets/js/321.b6810c5a.js"><link rel="prefetch" href="/assets/js/322.2eaa727d.js"><link rel="prefetch" href="/assets/js/323.17573ee3.js"><link rel="prefetch" href="/assets/js/324.806fd6ca.js"><link rel="prefetch" href="/assets/js/325.4cd65079.js"><link rel="prefetch" href="/assets/js/326.fe0e2e22.js"><link rel="prefetch" href="/assets/js/327.a64d0209.js"><link rel="prefetch" href="/assets/js/328.aca1c89a.js"><link rel="prefetch" href="/assets/js/329.53ccf1dd.js"><link rel="prefetch" href="/assets/js/33.9a57aab8.js"><link rel="prefetch" href="/assets/js/330.92822a09.js"><link rel="prefetch" href="/assets/js/331.6b82baff.js"><link rel="prefetch" href="/assets/js/332.fc20f585.js"><link rel="prefetch" href="/assets/js/333.005ba8e3.js"><link rel="prefetch" href="/assets/js/334.9d3309b8.js"><link rel="prefetch" href="/assets/js/335.0e938f19.js"><link rel="prefetch" href="/assets/js/336.01fe9903.js"><link rel="prefetch" href="/assets/js/337.e207d67c.js"><link rel="prefetch" href="/assets/js/338.bfcf6bc8.js"><link rel="prefetch" href="/assets/js/339.a502aa64.js"><link rel="prefetch" href="/assets/js/34.3835d35c.js"><link rel="prefetch" href="/assets/js/340.3888b147.js"><link rel="prefetch" href="/assets/js/341.20297f95.js"><link rel="prefetch" href="/assets/js/342.9cd149e9.js"><link rel="prefetch" href="/assets/js/343.faac8369.js"><link rel="prefetch" href="/assets/js/344.da8cd079.js"><link rel="prefetch" href="/assets/js/345.78303b88.js"><link rel="prefetch" href="/assets/js/346.d8eaca82.js"><link rel="prefetch" href="/assets/js/347.edd389a1.js"><link rel="prefetch" href="/assets/js/348.21ee9617.js"><link rel="prefetch" href="/assets/js/349.0251471a.js"><link rel="prefetch" href="/assets/js/35.76dc7096.js"><link rel="prefetch" href="/assets/js/350.710b7d30.js"><link rel="prefetch" href="/assets/js/351.535f8d60.js"><link rel="prefetch" href="/assets/js/352.c66fe42e.js"><link rel="prefetch" href="/assets/js/353.ebbcd333.js"><link rel="prefetch" href="/assets/js/354.7cbba2f1.js"><link rel="prefetch" href="/assets/js/355.0106db16.js"><link rel="prefetch" href="/assets/js/356.7debf350.js"><link rel="prefetch" href="/assets/js/357.a43eb887.js"><link rel="prefetch" href="/assets/js/358.28e5d2ed.js"><link rel="prefetch" href="/assets/js/359.956fc3b8.js"><link rel="prefetch" href="/assets/js/36.fc54452c.js"><link rel="prefetch" href="/assets/js/360.13fb600a.js"><link rel="prefetch" href="/assets/js/361.d100f85b.js"><link rel="prefetch" href="/assets/js/362.35277df2.js"><link rel="prefetch" href="/assets/js/363.d993a7fc.js"><link rel="prefetch" href="/assets/js/364.0168c2b0.js"><link rel="prefetch" href="/assets/js/365.bc8af0bb.js"><link rel="prefetch" href="/assets/js/366.2645dc0d.js"><link rel="prefetch" href="/assets/js/367.87368acb.js"><link rel="prefetch" href="/assets/js/368.0b7d41fc.js"><link rel="prefetch" href="/assets/js/369.4bf3f46e.js"><link rel="prefetch" href="/assets/js/37.5a47cee9.js"><link rel="prefetch" href="/assets/js/370.ea5f965e.js"><link rel="prefetch" href="/assets/js/371.1af764ef.js"><link rel="prefetch" href="/assets/js/372.bf6c68e2.js"><link rel="prefetch" href="/assets/js/373.1a605cc8.js"><link rel="prefetch" href="/assets/js/374.34a41a4a.js"><link rel="prefetch" href="/assets/js/375.1d2d3776.js"><link rel="prefetch" href="/assets/js/376.4b7b0b10.js"><link rel="prefetch" href="/assets/js/377.b3d9748a.js"><link rel="prefetch" href="/assets/js/378.7f00fa88.js"><link rel="prefetch" href="/assets/js/379.adcd298a.js"><link rel="prefetch" href="/assets/js/38.6614c565.js"><link rel="prefetch" href="/assets/js/380.6d08bb56.js"><link rel="prefetch" href="/assets/js/381.164bb4e3.js"><link rel="prefetch" href="/assets/js/382.f71f0ca4.js"><link rel="prefetch" href="/assets/js/383.01ba70ad.js"><link rel="prefetch" href="/assets/js/384.22b98cde.js"><link rel="prefetch" href="/assets/js/385.5f1298a9.js"><link rel="prefetch" href="/assets/js/386.01a912bc.js"><link rel="prefetch" href="/assets/js/387.3db4713f.js"><link rel="prefetch" href="/assets/js/388.4cde7d0f.js"><link rel="prefetch" href="/assets/js/389.d96bafad.js"><link rel="prefetch" href="/assets/js/39.1a09ed15.js"><link rel="prefetch" href="/assets/js/390.343bbc06.js"><link rel="prefetch" href="/assets/js/391.68b3e72a.js"><link rel="prefetch" href="/assets/js/392.f4f15e43.js"><link rel="prefetch" href="/assets/js/393.82475934.js"><link rel="prefetch" href="/assets/js/394.3101ea10.js"><link rel="prefetch" href="/assets/js/395.34083342.js"><link rel="prefetch" href="/assets/js/396.780d6efe.js"><link rel="prefetch" href="/assets/js/397.cb686f39.js"><link rel="prefetch" href="/assets/js/398.c4ad669f.js"><link rel="prefetch" href="/assets/js/399.ee8d28ad.js"><link rel="prefetch" href="/assets/js/4.c1dcb1a7.js"><link rel="prefetch" href="/assets/js/40.4216f4f9.js"><link rel="prefetch" href="/assets/js/400.23d48a38.js"><link rel="prefetch" href="/assets/js/401.319d7a68.js"><link rel="prefetch" href="/assets/js/402.25b27bd0.js"><link rel="prefetch" href="/assets/js/403.9a898a40.js"><link rel="prefetch" href="/assets/js/404.e3b49b79.js"><link rel="prefetch" href="/assets/js/405.7695b9f1.js"><link rel="prefetch" href="/assets/js/406.edb801f7.js"><link rel="prefetch" href="/assets/js/407.03c3f725.js"><link rel="prefetch" href="/assets/js/408.4345ef1f.js"><link rel="prefetch" href="/assets/js/409.77c34447.js"><link rel="prefetch" href="/assets/js/41.f035663a.js"><link rel="prefetch" href="/assets/js/410.7f6c0744.js"><link rel="prefetch" href="/assets/js/411.cb19323e.js"><link rel="prefetch" href="/assets/js/412.4b16959d.js"><link rel="prefetch" href="/assets/js/413.ff4f1ca2.js"><link rel="prefetch" href="/assets/js/414.b1ca1298.js"><link rel="prefetch" href="/assets/js/415.c2111593.js"><link rel="prefetch" href="/assets/js/416.a6d18039.js"><link rel="prefetch" href="/assets/js/417.dc36c66d.js"><link rel="prefetch" href="/assets/js/418.e7eba879.js"><link rel="prefetch" href="/assets/js/419.57673b9e.js"><link rel="prefetch" href="/assets/js/42.9c8cf569.js"><link rel="prefetch" href="/assets/js/420.ccd41fe0.js"><link rel="prefetch" href="/assets/js/421.ea69f0b0.js"><link rel="prefetch" href="/assets/js/422.093448e2.js"><link rel="prefetch" href="/assets/js/423.ae003f31.js"><link rel="prefetch" href="/assets/js/424.f670cd2b.js"><link rel="prefetch" href="/assets/js/425.6e814335.js"><link rel="prefetch" href="/assets/js/426.faf45206.js"><link rel="prefetch" href="/assets/js/427.cf6be942.js"><link rel="prefetch" href="/assets/js/428.9ff6199c.js"><link rel="prefetch" href="/assets/js/429.b6ef4678.js"><link rel="prefetch" href="/assets/js/43.717fe06b.js"><link rel="prefetch" href="/assets/js/430.e9575d07.js"><link rel="prefetch" href="/assets/js/431.8bf26a3e.js"><link rel="prefetch" href="/assets/js/432.5eaa2162.js"><link rel="prefetch" href="/assets/js/433.6dab12a1.js"><link rel="prefetch" href="/assets/js/434.fca918e8.js"><link rel="prefetch" href="/assets/js/435.4c8f9ad9.js"><link rel="prefetch" href="/assets/js/436.0f0de1a8.js"><link rel="prefetch" href="/assets/js/437.2221ab9f.js"><link rel="prefetch" href="/assets/js/438.37f28cfb.js"><link rel="prefetch" href="/assets/js/439.1e3f3611.js"><link rel="prefetch" href="/assets/js/44.705dc411.js"><link rel="prefetch" href="/assets/js/440.28ab35e8.js"><link rel="prefetch" href="/assets/js/441.8d006af8.js"><link rel="prefetch" href="/assets/js/442.2618a6e3.js"><link rel="prefetch" href="/assets/js/443.a7723674.js"><link rel="prefetch" href="/assets/js/444.18f23e7c.js"><link rel="prefetch" href="/assets/js/445.f4807c5a.js"><link rel="prefetch" href="/assets/js/446.77a5afc2.js"><link rel="prefetch" href="/assets/js/447.7f653483.js"><link rel="prefetch" href="/assets/js/448.1143c566.js"><link rel="prefetch" href="/assets/js/449.b788a288.js"><link rel="prefetch" href="/assets/js/45.6a225373.js"><link rel="prefetch" href="/assets/js/450.b6463ba3.js"><link rel="prefetch" href="/assets/js/451.fd4d46b9.js"><link rel="prefetch" href="/assets/js/452.e8de4fc2.js"><link rel="prefetch" href="/assets/js/453.4125e5e6.js"><link rel="prefetch" href="/assets/js/454.30af5d0a.js"><link rel="prefetch" href="/assets/js/455.9c919e58.js"><link rel="prefetch" href="/assets/js/456.22dbfa8f.js"><link rel="prefetch" href="/assets/js/457.e9c5248a.js"><link rel="prefetch" href="/assets/js/458.c0a9cf1d.js"><link rel="prefetch" href="/assets/js/459.b5e96042.js"><link rel="prefetch" href="/assets/js/46.515d085a.js"><link rel="prefetch" href="/assets/js/460.b4097efb.js"><link rel="prefetch" href="/assets/js/461.5d545741.js"><link rel="prefetch" href="/assets/js/462.402d4cdd.js"><link rel="prefetch" href="/assets/js/463.e6d6ea07.js"><link rel="prefetch" href="/assets/js/464.df817445.js"><link rel="prefetch" href="/assets/js/465.18a6bc2b.js"><link rel="prefetch" href="/assets/js/466.da313c0c.js"><link rel="prefetch" href="/assets/js/467.41294182.js"><link rel="prefetch" href="/assets/js/468.41c59467.js"><link rel="prefetch" href="/assets/js/469.d55da13c.js"><link rel="prefetch" href="/assets/js/47.a41193df.js"><link rel="prefetch" href="/assets/js/470.7457a92e.js"><link rel="prefetch" href="/assets/js/471.ed739bdf.js"><link rel="prefetch" href="/assets/js/472.83882459.js"><link rel="prefetch" href="/assets/js/473.fe2df51c.js"><link rel="prefetch" href="/assets/js/474.d40797b8.js"><link rel="prefetch" href="/assets/js/475.a00992a2.js"><link rel="prefetch" href="/assets/js/476.c7687189.js"><link rel="prefetch" href="/assets/js/477.fd4fd227.js"><link rel="prefetch" href="/assets/js/478.1ae08c3b.js"><link rel="prefetch" href="/assets/js/479.04a246c6.js"><link rel="prefetch" href="/assets/js/48.fe693306.js"><link rel="prefetch" href="/assets/js/480.36acb4ff.js"><link rel="prefetch" href="/assets/js/481.05d3129e.js"><link rel="prefetch" href="/assets/js/482.1741a02c.js"><link rel="prefetch" href="/assets/js/483.44cf2d25.js"><link rel="prefetch" href="/assets/js/484.9c14e5c6.js"><link rel="prefetch" href="/assets/js/485.ea0c1de1.js"><link rel="prefetch" href="/assets/js/486.8c683697.js"><link rel="prefetch" href="/assets/js/487.8b1eb604.js"><link rel="prefetch" href="/assets/js/488.ae16fca6.js"><link rel="prefetch" href="/assets/js/489.7f674a0d.js"><link rel="prefetch" href="/assets/js/49.a7d05a3d.js"><link rel="prefetch" href="/assets/js/490.52983854.js"><link rel="prefetch" href="/assets/js/491.968e7af4.js"><link rel="prefetch" href="/assets/js/492.e7f58bac.js"><link rel="prefetch" href="/assets/js/493.55afbb68.js"><link rel="prefetch" href="/assets/js/494.ac17d05b.js"><link rel="prefetch" href="/assets/js/495.d1ca2a12.js"><link rel="prefetch" href="/assets/js/496.d6841a0e.js"><link rel="prefetch" href="/assets/js/497.99431b4b.js"><link rel="prefetch" href="/assets/js/498.cacac1d8.js"><link rel="prefetch" href="/assets/js/499.c6b7fab0.js"><link rel="prefetch" href="/assets/js/5.f74a04c4.js"><link rel="prefetch" href="/assets/js/50.f59b29ea.js"><link rel="prefetch" href="/assets/js/500.abba24c7.js"><link rel="prefetch" href="/assets/js/501.e9496674.js"><link rel="prefetch" href="/assets/js/502.3ece0e86.js"><link rel="prefetch" href="/assets/js/503.974421d1.js"><link rel="prefetch" href="/assets/js/504.6e8d8539.js"><link rel="prefetch" href="/assets/js/505.b8161483.js"><link rel="prefetch" href="/assets/js/506.a6a6f2de.js"><link rel="prefetch" href="/assets/js/507.9c6955ee.js"><link rel="prefetch" href="/assets/js/508.223e145d.js"><link rel="prefetch" href="/assets/js/509.553e6f2c.js"><link rel="prefetch" href="/assets/js/51.428c5495.js"><link rel="prefetch" href="/assets/js/510.46e2eab7.js"><link rel="prefetch" href="/assets/js/511.24962b3f.js"><link rel="prefetch" href="/assets/js/512.a29fe236.js"><link rel="prefetch" href="/assets/js/513.8729b339.js"><link rel="prefetch" href="/assets/js/514.41199019.js"><link rel="prefetch" href="/assets/js/515.b1a71e99.js"><link rel="prefetch" href="/assets/js/516.001e3634.js"><link rel="prefetch" href="/assets/js/517.4de05581.js"><link rel="prefetch" href="/assets/js/518.57697c31.js"><link rel="prefetch" href="/assets/js/519.e962365e.js"><link rel="prefetch" href="/assets/js/52.c97c3911.js"><link rel="prefetch" href="/assets/js/520.e7775961.js"><link rel="prefetch" href="/assets/js/521.05b0ce57.js"><link rel="prefetch" href="/assets/js/522.49f7412e.js"><link rel="prefetch" href="/assets/js/523.b3d821b2.js"><link rel="prefetch" href="/assets/js/524.ab2395b7.js"><link rel="prefetch" href="/assets/js/525.25559bb4.js"><link rel="prefetch" href="/assets/js/526.23111d2a.js"><link rel="prefetch" href="/assets/js/527.c61f6e86.js"><link rel="prefetch" href="/assets/js/528.032fa7b6.js"><link rel="prefetch" href="/assets/js/529.3953f346.js"><link rel="prefetch" href="/assets/js/53.77f22b1a.js"><link rel="prefetch" href="/assets/js/530.b882066e.js"><link rel="prefetch" href="/assets/js/531.62dddf23.js"><link rel="prefetch" href="/assets/js/532.1826fe1a.js"><link rel="prefetch" href="/assets/js/533.a2e014bb.js"><link rel="prefetch" href="/assets/js/534.d5d89c00.js"><link rel="prefetch" href="/assets/js/535.4e5d7739.js"><link rel="prefetch" href="/assets/js/536.f2c700db.js"><link rel="prefetch" href="/assets/js/537.80aa278c.js"><link rel="prefetch" href="/assets/js/538.95e2f471.js"><link rel="prefetch" href="/assets/js/539.4e4ecfe8.js"><link rel="prefetch" href="/assets/js/54.d85b2f2e.js"><link rel="prefetch" href="/assets/js/540.00bd44e5.js"><link rel="prefetch" href="/assets/js/541.d740df14.js"><link rel="prefetch" href="/assets/js/542.5aadeaee.js"><link rel="prefetch" href="/assets/js/543.d42c9d9a.js"><link rel="prefetch" href="/assets/js/544.29704685.js"><link rel="prefetch" href="/assets/js/545.7fdb1a83.js"><link rel="prefetch" href="/assets/js/546.6b5655ea.js"><link rel="prefetch" href="/assets/js/547.c98e27c4.js"><link rel="prefetch" href="/assets/js/548.8edec06f.js"><link rel="prefetch" href="/assets/js/549.33b8eae3.js"><link rel="prefetch" href="/assets/js/55.80a4fa71.js"><link rel="prefetch" href="/assets/js/550.cb706b0e.js"><link rel="prefetch" href="/assets/js/551.79598cc6.js"><link rel="prefetch" href="/assets/js/552.69aa5f8b.js"><link rel="prefetch" href="/assets/js/553.7ccb8831.js"><link rel="prefetch" href="/assets/js/554.954013b2.js"><link rel="prefetch" href="/assets/js/555.960d7f8b.js"><link rel="prefetch" href="/assets/js/556.5c054c14.js"><link rel="prefetch" href="/assets/js/557.890045ea.js"><link rel="prefetch" href="/assets/js/558.f72f6668.js"><link rel="prefetch" href="/assets/js/559.452d8ff3.js"><link rel="prefetch" href="/assets/js/56.009b0340.js"><link rel="prefetch" href="/assets/js/560.1656e33f.js"><link rel="prefetch" href="/assets/js/561.bb4650eb.js"><link rel="prefetch" href="/assets/js/562.7322fd81.js"><link rel="prefetch" href="/assets/js/563.a34a68ea.js"><link rel="prefetch" href="/assets/js/564.6da92e18.js"><link rel="prefetch" href="/assets/js/565.01d288e5.js"><link rel="prefetch" href="/assets/js/566.6a3459a1.js"><link rel="prefetch" href="/assets/js/567.e3eb8e54.js"><link rel="prefetch" href="/assets/js/568.f95e0fba.js"><link rel="prefetch" href="/assets/js/569.a42d134c.js"><link rel="prefetch" href="/assets/js/57.25e8dd1c.js"><link rel="prefetch" href="/assets/js/570.87887d15.js"><link rel="prefetch" href="/assets/js/571.ce4b478b.js"><link rel="prefetch" href="/assets/js/572.634418a6.js"><link rel="prefetch" href="/assets/js/573.cd4cf02b.js"><link rel="prefetch" href="/assets/js/574.8bf073fa.js"><link rel="prefetch" href="/assets/js/575.c194dddb.js"><link rel="prefetch" href="/assets/js/576.7750193f.js"><link rel="prefetch" href="/assets/js/577.5daa388a.js"><link rel="prefetch" href="/assets/js/578.54bb0029.js"><link rel="prefetch" href="/assets/js/579.92f58c76.js"><link rel="prefetch" href="/assets/js/58.9c1eb9e5.js"><link rel="prefetch" href="/assets/js/580.0e543efb.js"><link rel="prefetch" href="/assets/js/581.4e0b0b47.js"><link rel="prefetch" href="/assets/js/582.8c172f83.js"><link rel="prefetch" href="/assets/js/583.c91c43e0.js"><link rel="prefetch" href="/assets/js/584.ca68d52b.js"><link rel="prefetch" href="/assets/js/585.663b17d3.js"><link rel="prefetch" href="/assets/js/586.9494847d.js"><link rel="prefetch" href="/assets/js/587.f3805773.js"><link rel="prefetch" href="/assets/js/588.8ae14be1.js"><link rel="prefetch" href="/assets/js/589.b4af88be.js"><link rel="prefetch" href="/assets/js/59.2a730e41.js"><link rel="prefetch" href="/assets/js/590.fb77fea8.js"><link rel="prefetch" href="/assets/js/591.a3aaa57c.js"><link rel="prefetch" href="/assets/js/592.54ec5f32.js"><link rel="prefetch" href="/assets/js/593.96eab5cb.js"><link rel="prefetch" href="/assets/js/594.e356725c.js"><link rel="prefetch" href="/assets/js/595.0a2c4ad4.js"><link rel="prefetch" href="/assets/js/596.2c075cd8.js"><link rel="prefetch" href="/assets/js/597.e904811b.js"><link rel="prefetch" href="/assets/js/598.f6ca8b71.js"><link rel="prefetch" href="/assets/js/599.ae3d12c4.js"><link rel="prefetch" href="/assets/js/6.451e012f.js"><link rel="prefetch" href="/assets/js/60.e6b60343.js"><link rel="prefetch" href="/assets/js/600.e71a0062.js"><link rel="prefetch" href="/assets/js/601.2571a19d.js"><link rel="prefetch" href="/assets/js/602.0f4fa961.js"><link rel="prefetch" href="/assets/js/603.d8387c37.js"><link rel="prefetch" href="/assets/js/604.69433906.js"><link rel="prefetch" href="/assets/js/605.1bc7d87a.js"><link rel="prefetch" href="/assets/js/606.ec419517.js"><link rel="prefetch" href="/assets/js/607.b473fb0b.js"><link rel="prefetch" href="/assets/js/608.a361b48c.js"><link rel="prefetch" href="/assets/js/609.9186f226.js"><link rel="prefetch" href="/assets/js/61.d50a156d.js"><link rel="prefetch" href="/assets/js/610.ff3cf241.js"><link rel="prefetch" href="/assets/js/611.c3c7e648.js"><link rel="prefetch" href="/assets/js/612.2a520ebd.js"><link rel="prefetch" href="/assets/js/613.42936ffc.js"><link rel="prefetch" href="/assets/js/614.3ca0de21.js"><link rel="prefetch" href="/assets/js/615.ecf60a47.js"><link rel="prefetch" href="/assets/js/616.17185e83.js"><link rel="prefetch" href="/assets/js/617.769d4cdf.js"><link rel="prefetch" href="/assets/js/618.015c6376.js"><link rel="prefetch" href="/assets/js/619.3af186d0.js"><link rel="prefetch" href="/assets/js/62.e24b7811.js"><link rel="prefetch" href="/assets/js/620.f8ff3784.js"><link rel="prefetch" href="/assets/js/621.4c21311f.js"><link rel="prefetch" href="/assets/js/622.355178df.js"><link rel="prefetch" href="/assets/js/623.45a30695.js"><link rel="prefetch" href="/assets/js/624.61e89d34.js"><link rel="prefetch" href="/assets/js/625.49e0d1ce.js"><link rel="prefetch" href="/assets/js/626.1b7ae767.js"><link rel="prefetch" href="/assets/js/627.b8c507cf.js"><link rel="prefetch" href="/assets/js/628.c5a43517.js"><link rel="prefetch" href="/assets/js/629.274eb0fd.js"><link rel="prefetch" href="/assets/js/63.b804baab.js"><link rel="prefetch" href="/assets/js/630.69e055ce.js"><link rel="prefetch" href="/assets/js/631.0892fc51.js"><link rel="prefetch" href="/assets/js/632.6a68e9a2.js"><link rel="prefetch" href="/assets/js/633.d536fe74.js"><link rel="prefetch" href="/assets/js/634.24695f39.js"><link rel="prefetch" href="/assets/js/635.3aeede9c.js"><link rel="prefetch" href="/assets/js/636.3628d8a6.js"><link rel="prefetch" href="/assets/js/637.40af5a79.js"><link rel="prefetch" href="/assets/js/638.15e257ae.js"><link rel="prefetch" href="/assets/js/639.31e6597c.js"><link rel="prefetch" href="/assets/js/64.eb5699ff.js"><link rel="prefetch" href="/assets/js/640.a071f6df.js"><link rel="prefetch" href="/assets/js/641.f9edd7bf.js"><link rel="prefetch" href="/assets/js/642.adcb583f.js"><link rel="prefetch" href="/assets/js/643.7c98a990.js"><link rel="prefetch" href="/assets/js/644.fb1213d8.js"><link rel="prefetch" href="/assets/js/645.220a5034.js"><link rel="prefetch" href="/assets/js/646.d66a419b.js"><link rel="prefetch" href="/assets/js/647.12ef89ab.js"><link rel="prefetch" href="/assets/js/648.a3112300.js"><link rel="prefetch" href="/assets/js/649.f457dfa5.js"><link rel="prefetch" href="/assets/js/65.0d8501b5.js"><link rel="prefetch" href="/assets/js/650.cc63d03b.js"><link rel="prefetch" href="/assets/js/651.16d1bbd6.js"><link rel="prefetch" href="/assets/js/652.0f5343f0.js"><link rel="prefetch" href="/assets/js/653.28f7710a.js"><link rel="prefetch" href="/assets/js/654.b343d473.js"><link rel="prefetch" href="/assets/js/655.215fe67b.js"><link rel="prefetch" href="/assets/js/656.79aa1653.js"><link rel="prefetch" href="/assets/js/657.c57f2b5c.js"><link rel="prefetch" href="/assets/js/658.d0aa0b95.js"><link rel="prefetch" href="/assets/js/659.2dfaed93.js"><link rel="prefetch" href="/assets/js/66.8361cc16.js"><link rel="prefetch" href="/assets/js/660.c00b347e.js"><link rel="prefetch" href="/assets/js/661.ecc4f968.js"><link rel="prefetch" href="/assets/js/662.06f83919.js"><link rel="prefetch" href="/assets/js/663.67d8849e.js"><link rel="prefetch" href="/assets/js/664.74dba1a9.js"><link rel="prefetch" href="/assets/js/665.28b450f0.js"><link rel="prefetch" href="/assets/js/666.0f4bb6ba.js"><link rel="prefetch" href="/assets/js/667.586074e3.js"><link rel="prefetch" href="/assets/js/668.b13c0e70.js"><link rel="prefetch" href="/assets/js/669.9d0d4cbc.js"><link rel="prefetch" href="/assets/js/67.37f46ba2.js"><link rel="prefetch" href="/assets/js/670.6b36ca72.js"><link rel="prefetch" href="/assets/js/671.33b2e754.js"><link rel="prefetch" href="/assets/js/672.3b02c287.js"><link rel="prefetch" href="/assets/js/673.3f274929.js"><link rel="prefetch" href="/assets/js/674.7d75584f.js"><link rel="prefetch" href="/assets/js/675.0de52334.js"><link rel="prefetch" href="/assets/js/676.6734133e.js"><link rel="prefetch" href="/assets/js/677.c6f4a973.js"><link rel="prefetch" href="/assets/js/678.1344b6be.js"><link rel="prefetch" href="/assets/js/679.23fed56f.js"><link rel="prefetch" href="/assets/js/68.27dbce5b.js"><link rel="prefetch" href="/assets/js/680.c49329d6.js"><link rel="prefetch" href="/assets/js/681.8df66615.js"><link rel="prefetch" href="/assets/js/682.77b4bff8.js"><link rel="prefetch" href="/assets/js/683.6cf41cf4.js"><link rel="prefetch" href="/assets/js/684.58deecd5.js"><link rel="prefetch" href="/assets/js/685.d2f7480e.js"><link rel="prefetch" href="/assets/js/686.0b77a241.js"><link rel="prefetch" href="/assets/js/687.2cc04b4f.js"><link rel="prefetch" href="/assets/js/688.da24cbae.js"><link rel="prefetch" href="/assets/js/689.a9961f74.js"><link rel="prefetch" href="/assets/js/69.8052a977.js"><link rel="prefetch" href="/assets/js/690.cb736269.js"><link rel="prefetch" href="/assets/js/691.21c13be1.js"><link rel="prefetch" href="/assets/js/692.3ed557d0.js"><link rel="prefetch" href="/assets/js/693.066efe93.js"><link rel="prefetch" href="/assets/js/694.5368f98a.js"><link rel="prefetch" href="/assets/js/695.4fdb93d5.js"><link rel="prefetch" href="/assets/js/696.9c055ac6.js"><link rel="prefetch" href="/assets/js/697.51e0c47c.js"><link rel="prefetch" href="/assets/js/698.08ca1dbd.js"><link rel="prefetch" href="/assets/js/699.ce7e9e2a.js"><link rel="prefetch" href="/assets/js/7.7e21c947.js"><link rel="prefetch" href="/assets/js/70.19faeb78.js"><link rel="prefetch" href="/assets/js/700.3676fa7f.js"><link rel="prefetch" href="/assets/js/701.82db4887.js"><link rel="prefetch" href="/assets/js/702.73425f22.js"><link rel="prefetch" href="/assets/js/703.d9391c74.js"><link rel="prefetch" href="/assets/js/704.d6e275cf.js"><link rel="prefetch" href="/assets/js/705.d2f23969.js"><link rel="prefetch" href="/assets/js/706.1c66dcc1.js"><link rel="prefetch" href="/assets/js/707.0fc5a26a.js"><link rel="prefetch" href="/assets/js/708.97471ee6.js"><link rel="prefetch" href="/assets/js/709.9b4d5665.js"><link rel="prefetch" href="/assets/js/71.d1683810.js"><link rel="prefetch" href="/assets/js/710.75fa8103.js"><link rel="prefetch" href="/assets/js/711.43777b40.js"><link rel="prefetch" href="/assets/js/712.5c583e39.js"><link rel="prefetch" href="/assets/js/713.5aa72111.js"><link rel="prefetch" href="/assets/js/714.e8215702.js"><link rel="prefetch" href="/assets/js/715.46614e7c.js"><link rel="prefetch" href="/assets/js/716.eaac6d69.js"><link rel="prefetch" href="/assets/js/717.c344c042.js"><link rel="prefetch" href="/assets/js/718.437bf0b2.js"><link rel="prefetch" href="/assets/js/719.23aa3deb.js"><link rel="prefetch" href="/assets/js/72.9fa783f0.js"><link rel="prefetch" href="/assets/js/720.9456a449.js"><link rel="prefetch" href="/assets/js/721.67fd324a.js"><link rel="prefetch" href="/assets/js/722.fc5e79ca.js"><link rel="prefetch" href="/assets/js/723.46db8115.js"><link rel="prefetch" href="/assets/js/724.31a11b8c.js"><link rel="prefetch" href="/assets/js/725.49cef603.js"><link rel="prefetch" href="/assets/js/726.7d0a2e7f.js"><link rel="prefetch" href="/assets/js/727.a1de6f02.js"><link rel="prefetch" href="/assets/js/728.7e0a727e.js"><link rel="prefetch" href="/assets/js/729.b6bf04fa.js"><link rel="prefetch" href="/assets/js/73.1ac0ac37.js"><link rel="prefetch" href="/assets/js/730.1c102528.js"><link rel="prefetch" href="/assets/js/731.80403e3d.js"><link rel="prefetch" href="/assets/js/732.cf8b4a6d.js"><link rel="prefetch" href="/assets/js/733.aab88d38.js"><link rel="prefetch" href="/assets/js/734.965a0adc.js"><link rel="prefetch" href="/assets/js/735.f9d33608.js"><link rel="prefetch" href="/assets/js/736.d1621f9e.js"><link rel="prefetch" href="/assets/js/737.a12ea0d3.js"><link rel="prefetch" href="/assets/js/738.96e61512.js"><link rel="prefetch" href="/assets/js/739.9bce4dfe.js"><link rel="prefetch" href="/assets/js/74.1913daec.js"><link rel="prefetch" href="/assets/js/740.c1a0bf7b.js"><link rel="prefetch" href="/assets/js/741.0185115e.js"><link rel="prefetch" href="/assets/js/742.21e99d78.js"><link rel="prefetch" href="/assets/js/743.e5f2407e.js"><link rel="prefetch" href="/assets/js/744.53d4e25a.js"><link rel="prefetch" href="/assets/js/745.9fb6722c.js"><link rel="prefetch" href="/assets/js/746.893e3a2f.js"><link rel="prefetch" href="/assets/js/747.ad94fed4.js"><link rel="prefetch" href="/assets/js/748.3421b09b.js"><link rel="prefetch" href="/assets/js/749.15c364e9.js"><link rel="prefetch" href="/assets/js/75.d63a9540.js"><link rel="prefetch" href="/assets/js/750.4e5379b7.js"><link rel="prefetch" href="/assets/js/751.18b0273f.js"><link rel="prefetch" href="/assets/js/752.24717596.js"><link rel="prefetch" href="/assets/js/753.5868bcc4.js"><link rel="prefetch" href="/assets/js/754.77808a6c.js"><link rel="prefetch" href="/assets/js/755.af7f7a71.js"><link rel="prefetch" href="/assets/js/76.342d837c.js"><link rel="prefetch" href="/assets/js/77.466349c3.js"><link rel="prefetch" href="/assets/js/78.886d05b6.js"><link rel="prefetch" href="/assets/js/79.b478bdab.js"><link rel="prefetch" href="/assets/js/8.9f40767d.js"><link rel="prefetch" href="/assets/js/80.9205cc43.js"><link rel="prefetch" href="/assets/js/81.77f831c9.js"><link rel="prefetch" href="/assets/js/82.650475d1.js"><link rel="prefetch" href="/assets/js/83.aa7e3d4b.js"><link rel="prefetch" href="/assets/js/84.2fc92fb4.js"><link rel="prefetch" href="/assets/js/85.0f633e10.js"><link rel="prefetch" href="/assets/js/86.e862f4bc.js"><link rel="prefetch" href="/assets/js/87.8a869468.js"><link rel="prefetch" href="/assets/js/88.6c584051.js"><link rel="prefetch" href="/assets/js/89.3ab84e02.js"><link rel="prefetch" href="/assets/js/9.7ed864ce.js"><link rel="prefetch" href="/assets/js/90.41e6925d.js"><link rel="prefetch" href="/assets/js/91.55055993.js"><link rel="prefetch" href="/assets/js/92.ced7b439.js"><link rel="prefetch" href="/assets/js/93.41cc8a7f.js"><link rel="prefetch" href="/assets/js/94.6d2b144f.js"><link rel="prefetch" href="/assets/js/95.399a7909.js"><link rel="prefetch" href="/assets/js/96.556f8f9f.js"><link rel="prefetch" href="/assets/js/97.47ecdf46.js"><link rel="prefetch" href="/assets/js/98.fdbe6822.js"><link rel="prefetch" href="/assets/js/99.db8442e4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6ece31e0.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Fanx 知识库" class="logo"> <span class="site-name can-hide">Fanx 知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/779590/" class="nav-link">Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/dc7834/" class="nav-link">Java集合框架</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d7db/" class="nav-link">Java多线程并发</a></li><li class="dropdown-item"><!----> <a href="/pages/dbec4d/" class="nav-link">JavaIo&amp;NIO&amp;AIO</a></li><li class="dropdown-item"><!----> <a href="/pages/b908ce/" class="nav-link">JDK相关特性</a></li><li class="dropdown-item"><!----> <a href="/pages/e59bea/" class="nav-link">JVM相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f8c059/" class="nav-link">数据库基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/d192fd/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/8aa877/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/077e7c/" class="nav-link">MogoDb</a></li><li class="dropdown-item"><!----> <a href="/pages/68281b/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><!----> <span class="title" style="display:;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonFrameworks/mybatis/" class="nav-link">mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/8f6500/" class="nav-link">Spring Framework 5基础</a></li><li class="dropdown-item"><!----> <a href="/pages/7c08d4/" class="nav-link">SpringBoot 2.5.x系列</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源代码学习" class="dropdown-title"><!----> <span class="title" style="display:;">源代码学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/23a632/" class="nav-link">mybatis源码学习</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/java/" class="nav-link">java源代码</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/spring/" class="nav-link">Spring源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试相关" class="dropdown-title"><!----> <span class="title" style="display:;">面试相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2cef48/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/ad2692/" class="nav-link">Spring 框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用的技术工具" class="dropdown-title"><!----> <span class="title" style="display:;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/linux/common/" class="nav-link">linux常用命令实践</a></li><li class="dropdown-item"><!----> <a href="/tool/maven/" class="nav-link">Mavan</a></li><li class="dropdown-item"><!----> <a href="/pages/b25802/" class="nav-link">开发工具详解</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它语言" class="dropdown-title"><!----> <span class="title" style="display:;">其它语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fc414d/" class="nav-link">Python基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题总结" class="dropdown-title"><!----> <span class="title" style="display:;">问题总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/question/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4d0fa7/" class="nav-link">团队相关</a></li><li class="dropdown-item"><!----> <a href="/pages/75c3d7/" class="nav-link">fanx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><!----> <span class="title" style="display:;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/caf303/" class="nav-link">数据结构基础</a></li><li class="dropdown-item"><!----> <a href="/pages/395e23/" class="nav-link">常见排序算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fa3dd3/" class="nav-link">算法思想</a></li><li class="dropdown-item"><!----> <a href="/pages/79d342/" class="nav-link">一些领域算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fdb54d/" class="nav-link">其它算法相关</a></li></ul></div></div> <a href="https://fanxgit.github.io/fanxNotes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/779590/" class="nav-link">Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/dc7834/" class="nav-link">Java集合框架</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d7db/" class="nav-link">Java多线程并发</a></li><li class="dropdown-item"><!----> <a href="/pages/dbec4d/" class="nav-link">JavaIo&amp;NIO&amp;AIO</a></li><li class="dropdown-item"><!----> <a href="/pages/b908ce/" class="nav-link">JDK相关特性</a></li><li class="dropdown-item"><!----> <a href="/pages/e59bea/" class="nav-link">JVM相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f8c059/" class="nav-link">数据库基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/d192fd/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/8aa877/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/077e7c/" class="nav-link">MogoDb</a></li><li class="dropdown-item"><!----> <a href="/pages/68281b/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><!----> <span class="title" style="display:;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonFrameworks/mybatis/" class="nav-link">mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/8f6500/" class="nav-link">Spring Framework 5基础</a></li><li class="dropdown-item"><!----> <a href="/pages/7c08d4/" class="nav-link">SpringBoot 2.5.x系列</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源代码学习" class="dropdown-title"><!----> <span class="title" style="display:;">源代码学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/23a632/" class="nav-link">mybatis源码学习</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/java/" class="nav-link">java源代码</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/spring/" class="nav-link">Spring源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试相关" class="dropdown-title"><!----> <span class="title" style="display:;">面试相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2cef48/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/ad2692/" class="nav-link">Spring 框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用的技术工具" class="dropdown-title"><!----> <span class="title" style="display:;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/linux/common/" class="nav-link">linux常用命令实践</a></li><li class="dropdown-item"><!----> <a href="/tool/maven/" class="nav-link">Mavan</a></li><li class="dropdown-item"><!----> <a href="/pages/b25802/" class="nav-link">开发工具详解</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它语言" class="dropdown-title"><!----> <span class="title" style="display:;">其它语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fc414d/" class="nav-link">Python基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题总结" class="dropdown-title"><!----> <span class="title" style="display:;">问题总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/question/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4d0fa7/" class="nav-link">团队相关</a></li><li class="dropdown-item"><!----> <a href="/pages/75c3d7/" class="nav-link">fanx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><!----> <span class="title" style="display:;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/caf303/" class="nav-link">数据结构基础</a></li><li class="dropdown-item"><!----> <a href="/pages/395e23/" class="nav-link">常见排序算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fa3dd3/" class="nav-link">算法思想</a></li><li class="dropdown-item"><!----> <a href="/pages/79d342/" class="nav-link">一些领域算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fdb54d/" class="nav-link">其它算法相关</a></li></ul></div></div> <a href="https://fanxgit.github.io/fanxNotes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>集合框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java多线程与并发</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f2d7db/" class="sidebar-link">Java并发知识体系详解</a></li><li><a href="/pages/e49d07/" class="sidebar-link">Java 并发 - 理论基础</a></li><li><a href="/pages/0e4c2e/" class="sidebar-link">Java 并发 - 线程基础</a></li><li><a href="/pages/03aac1/" class="sidebar-link">Java并发 - Java中所有的锁</a></li><li><a href="/pages/b1fa07/" class="sidebar-link">关键字-synchronized详解</a></li><li><a href="/pages/e8097b/" class="sidebar-link">关键字-volatile详解</a></li><li><a href="/pages/44d29e/" class="sidebar-link">关键字-final详解</a></li><li><a href="/pages/52b863/" class="sidebar-link">JUC - 类汇总和学习指南</a></li><li><a href="/pages/60879f/" class="sidebar-link">JUC原子类-CAS, Unsafe和原子类详解</a></li><li><a href="/pages/3f52bd/" class="sidebar-link">JUC锁-LockSupport详解</a></li><li><a href="/pages/620379/" aria-current="page" class="active sidebar-link">JUC锁-锁核心类AQS详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/620379/#juc锁-锁核心类aqs详解" class="sidebar-link">JUC锁: 锁核心类AQS详解</a></li><li class="sidebar-sub-header level2"><a href="/pages/620379/#带着bat大厂的面试问题去理解" class="sidebar-link">##带着BAT大厂的面试问题去理解</a></li><li class="sidebar-sub-header level2"><a href="/pages/620379/#abstractqueuedsynchronizer简介" class="sidebar-link">AbstractQueuedSynchronizer简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/620379/#aqs-核心思想" class="sidebar-link">AQS 核心思想</a></li><li class="sidebar-sub-header level3"><a href="/pages/620379/#aqs-对资源的共享方式" class="sidebar-link">AQS 对资源的共享方式</a></li><li class="sidebar-sub-header level3"><a href="/pages/620379/#aqs底层使用了模板方法模式" class="sidebar-link">AQS底层使用了模板方法模式</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/620379/#abstractqueuedsynchronizer数据结构" class="sidebar-link">AbstractQueuedSynchronizer数据结构</a></li><li class="sidebar-sub-header level2"><a href="/pages/620379/#abstractqueuedsynchronizer源码分析" class="sidebar-link">AbstractQueuedSynchronizer源码分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/620379/#类的继承关系" class="sidebar-link">类的继承关系</a></li><li class="sidebar-sub-header level3"><a href="/pages/620379/#类的内部类-node类" class="sidebar-link">类的内部类 - Node类</a></li><li class="sidebar-sub-header level3"><a href="/pages/620379/#类的内部类-conditionobject类" class="sidebar-link">类的内部类 - ConditionObject类</a></li><li class="sidebar-sub-header level3"><a href="/pages/620379/#类的属性" class="sidebar-link">类的属性</a></li><li class="sidebar-sub-header level3"><a href="/pages/620379/#类的构造方法" class="sidebar-link">类的构造方法</a></li><li class="sidebar-sub-header level3"><a href="/pages/620379/#类的核心方法-acquire方法" class="sidebar-link">类的核心方法 - acquire方法</a></li><li class="sidebar-sub-header level3"><a href="/pages/620379/#类的核心方法-release方法" class="sidebar-link">类的核心方法 - release方法</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/620379/#abstractqueuedsynchronizer示例详解一" class="sidebar-link">AbstractQueuedSynchronizer示例详解一</a></li><li class="sidebar-sub-header level2"><a href="/pages/620379/#abstractqueuedsynchronizer示例详解二" class="sidebar-link">AbstractQueuedSynchronizer示例详解二</a></li><li class="sidebar-sub-header level2"><a href="/pages/620379/#abstractqueuedsynchronizer总结" class="sidebar-link">AbstractQueuedSynchronizer总结</a></li><li class="sidebar-sub-header level2"><a href="/pages/620379/#参考文章" class="sidebar-link">参考文章</a></li></ul></li><li><a href="/pages/e5e4ff/" class="sidebar-link">JUC锁-ReentrantLock详解</a></li><li><a href="/pages/926698/" class="sidebar-link">JUC锁-ReentrantReadWriteLock详解</a></li><li><a href="/pages/e33954/" class="sidebar-link">JUC集合-ConcurrentHashMap详解</a></li><li><a href="/pages/ccc6d9/" class="sidebar-link">JUC集合-CopyOnWriteArrayList详解</a></li><li><a href="/pages/3e2c89/" class="sidebar-link">JUC集合-ConcurrentLinkedQueue详解</a></li><li><a href="/pages/24b41a/" class="sidebar-link">JUC集合-BlockingQueue详解</a></li><li><a href="/pages/bcf3da/" class="sidebar-link">JUC线程池-FutureTask详解</a></li><li><a href="/pages/1fce0f/" class="sidebar-link">JUC线程池-ThreadPoolExecutor详解</a></li><li><a href="/pages/85bf53/" class="sidebar-link">JUC线程池-ScheduledThreadPoolExecutor详解</a></li><li><a href="/pages/688f62/" class="sidebar-link">JUC线程池-ForkJoin框架详解</a></li><li><a href="/pages/ee399a/" class="sidebar-link">JUC工具类-CountDownLatch详解</a></li><li><a href="/pages/cf70b6/" class="sidebar-link">JUC工具类-CyclicBarrier详解</a></li><li><a href="/pages/725172/" class="sidebar-link">JUC工具类-Semaphore详解</a></li><li><a href="/pages/9e2bd7/" class="sidebar-link">JUC工具类-Phaser详解</a></li><li><a href="/pages/0baf76/" class="sidebar-link">JUC工具类-Exchanger详解</a></li><li><a href="/pages/d277df/" class="sidebar-link">Java 并发 - ThreadLocal详解</a></li><li><a href="/pages/b23a10/" class="sidebar-link">多线程问题总结</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java IO-NIO-AIO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java8 特性详解</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java8各版本特性概述</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JVM相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java其它相关</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/web/#Java" data-v-06225672>Java</a></li><li data-v-06225672><a href="/web/#Java多线程与并发" data-v-06225672>Java多线程与并发</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/FanXGit" target="_blank" title="作者" class="beLink" data-v-06225672>fanx</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-07-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">JUC锁-锁核心类AQS详解<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="juc锁-锁核心类aqs详解"><a href="#juc锁-锁核心类aqs详解" class="header-anchor">#</a> JUC锁: 锁核心类AQS详解</h2> <blockquote><p>AbstractQueuedSynchronizer抽象类是核心，需要重点掌握。它提供了一个基于FIFO队列，可以用于构建锁或者其他相关同步装置的基础框架。@pdai</p></blockquote> <h2 id="带着bat大厂的面试问题去理解"><a href="#带着bat大厂的面试问题去理解" class="header-anchor">#</a> ##带着BAT大厂的面试问题去理解</h2> <p>提示</p> <p>请带着这些问题继续后文，会很大程度上帮助你更好的理解相关知识点。@pdai</p> <ul><li>什么是AQS? 为什么它是核心?</li> <li>AQS的核心思想是什么? 它是怎么实现的? 底层数据结构等</li> <li>AQS有哪些核心的方法?</li> <li>AQS定义什么样的资源获取方式? AQS定义了两种资源获取方式：<code>独占</code>(只有一个线程能访问执行，又根据是否按队列的顺序分为<code>公平锁</code>和<code>非公平锁</code>，如<code>ReentrantLock</code>) 和<code>共享</code>(多个线程可同时访问执行，如<code>Semaphore</code>、<code>CountDownLatch</code>、 <code>CyclicBarrier</code> )。<code>ReentrantReadWriteLock</code>可以看成是组合式，允许多个线程同时对某一资源进行读。</li> <li>AQS底层使用了什么样的设计模式? 模板</li> <li>AQS的应用示例?</li></ul> <h2 id="abstractqueuedsynchronizer简介"><a href="#abstractqueuedsynchronizer简介" class="header-anchor">#</a> AbstractQueuedSynchronizer简介</h2> <hr> <p>AQS是一个用来构建锁和同步器的框架，使用AQS能简单且高效地构造出应用广泛的大量的同步器，比如我们提到的ReentrantLock，Semaphore，其他的诸如ReentrantReadWriteLock，SynchronousQueue，FutureTask等等皆是基于AQS的。当然，我们自己也能利用AQS非常轻松容易地构造出符合我们自己需求的同步器。</p> <h3 id="aqs-核心思想"><a href="#aqs-核心思想" class="header-anchor">#</a> AQS 核心思想</h3> <p>AQS核心思想是，如果被请求的共享资源空闲，则将当前请求资源的线程设置为有效的工作线程，并且将共享资源设置为锁定状态。如果被请求的共享资源被占用，那么就需要一套线程阻塞等待以及被唤醒时锁分配的机制，这个机制AQS是用CLH队列锁实现的，即将暂时获取不到锁的线程加入到队列中。</p> <blockquote><p>CLH(Craig,Landin,and Hagersten)队列是一个虚拟的双向队列(虚拟的双向队列即不存在队列实例，仅存在结点之间的关联关系)。AQS是将每条请求共享资源的线程封装成一个CLH锁队列的一个结点(Node)来实现锁的分配。</p></blockquote> <p>AQS使用一个int成员变量来表示同步状态，通过内置的FIFO队列来完成获取资源线程的排队工作。AQS使用CAS对该同步状态进行原子操作实现对其值的修改。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>private volatile int state;//共享变量，使用volatile修饰保证线程可见性 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>状态信息通过procted类型的getState，setState，compareAndSetState进行操作</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//返回同步状态的当前值
protected final int getState() {  
        return state;
}
 // 设置同步状态的值
protected final void setState(int newState) { 
        state = newState;
}
//原子地(CAS操作)将同步状态值设置为给定值update如果当前同步状态的值等于expect(期望值)
protected final boolean compareAndSetState(int expect, int update) {
        return unsafe.compareAndSwapInt(this, stateOffset, expect, update);
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="aqs-对资源的共享方式"><a href="#aqs-对资源的共享方式" class="header-anchor">#</a> AQS 对资源的共享方式</h3> <p>AQS定义两种资源共享方式</p> <ul><li>Exclusive(独占)：只有一个线程能执行，如ReentrantLock。又可分为公平锁和非公平锁：
<ul><li>公平锁：按照线程在队列中的排队顺序，先到者先拿到锁</li> <li>非公平锁：当线程要获取锁时，无视队列顺序直接去抢锁，谁抢到就是谁的</li></ul></li> <li>Share(共享)：多个线程可同时执行，如Semaphore/CountDownLatch。Semaphore、CountDownLatCh、 CyclicBarrier、ReadWriteLock 我们都会在后面讲到。</li></ul> <p>ReentrantReadWriteLock 可以看成是组合式，因为ReentrantReadWriteLock也就是读写锁允许多个线程同时对某一资源进行读。</p> <p>不同的自定义同步器争用共享资源的方式也不同。自定义同步器在实现时只需要实现共享资源 state 的获取与释放方式即可，至于具体线程等待队列的维护(如获取资源失败入队/唤醒出队等)，AQS已经在上层已经帮我们实现好了。</p> <h3 id="aqs底层使用了模板方法模式"><a href="#aqs底层使用了模板方法模式" class="header-anchor">#</a> AQS底层使用了模板方法模式</h3> <blockquote><p>同步器的设计是基于模板方法模式的，如果需要自定义同步器一般的方式是这样(模板方法模式很经典的一个应用)：</p></blockquote> <p>使用者继承AbstractQueuedSynchronizer并重写指定的方法。(这些重写方法很简单，无非是对于共享资源state的获取和释放) 将AQS组合在自定义同步组件的实现中，并调用其模板方法，而这些模板方法会调用使用者重写的方法。</p> <p>这和我们以往通过实现接口的方式有很大区别，模板方法模式请参看：<a href="https://pdai.tech/md/dev-spec/pattern/17_template.html" target="_blank" rel="noopener noreferrer">设计模式行为型 - 模板方法(Template Method)详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>AQS使用了模板方法模式，自定义同步器时需要重写下面几个AQS提供的模板方法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>isHeldExclusively()//该线程是否正在独占资源。只有用到condition才需要去实现它。
tryAcquire(int)//独占方式。尝试获取资源，成功则返回true，失败则返回false。
tryRelease(int)//独占方式。尝试释放资源，成功则返回true，失败则返回false。
tryAcquireShared(int)//共享方式。尝试获取资源。负数表示失败；0表示成功，但没有剩余可用资源；正数表示成功，且有剩余资源。
tryReleaseShared(int)//共享方式。尝试释放资源，成功则返回true，失败则返回false。 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>默认情况下，每个方法都抛出 UnsupportedOperationException。 这些方法的实现必须是内部线程安全的，并且通常应该简短而不是阻塞。AQS类中的其他方法都是final ，所以无法被其他类使用，只有这几个方法可以被其他类使用。</p> <p>以ReentrantLock为例，state初始化为0，表示未锁定状态。A线程lock()时，会调用tryAcquire()独占该锁并将state+1。此后，其他线程再tryAcquire()时就会失败，直到A线程unlock()到state=0(即释放锁)为止，其它线程才有机会获取该锁。当然，释放锁之前，A线程自己是可以重复获取此锁的(state会累加)，这就是可重入的概念。但要注意，获取多少次就要释放多么次，这样才能保证state是能回到零态的。</p> <h2 id="abstractqueuedsynchronizer数据结构"><a href="#abstractqueuedsynchronizer数据结构" class="header-anchor">#</a> AbstractQueuedSynchronizer数据结构</h2> <hr> <p>AbstractQueuedSynchronizer类底层的数据结构是使用<code>CLH(Craig,Landin,and Hagersten)队列</code>是一个虚拟的双向队列(虚拟的双向队列即不存在队列实例，仅存在结点之间的关联关系)。AQS是将每条请求共享资源的线程封装成一个CLH锁队列的一个结点(Node)来实现锁的分配。其中Sync queue，即同步队列，是双向链表，包括head结点和tail结点，head结点主要用作后续的调度。而Condition queue不是必须的，其是一个单向链表，只有当使用Condition时，才会存在此单向链表。并且可能会有多个Condition queue。</p> <p><img src="/assets/img/thread_java-thread-x-juc-aqs-1.6a4d140c.png" alt="image"></p> <h2 id="abstractqueuedsynchronizer源码分析"><a href="#abstractqueuedsynchronizer源码分析" class="header-anchor">#</a> AbstractQueuedSynchronizer源码分析</h2> <hr> <h3 id="类的继承关系"><a href="#类的继承关系" class="header-anchor">#</a> 类的继承关系</h3> <p>AbstractQueuedSynchronizer继承自AbstractOwnableSynchronizer抽象类，并且实现了Serializable接口，可以进行序列化。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public abstract class AbstractQueuedSynchronizer extends AbstractOwnableSynchronizer implements java.io.Serializable 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中AbstractOwnableSynchronizer抽象类的源码如下:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public abstract class AbstractOwnableSynchronizer implements java.io.Serializable {
    
    // 版本序列号
    private static final long serialVersionUID = 3737899427754241961L;
    // 构造方法
    protected AbstractOwnableSynchronizer() { }
    // 独占模式下的线程
    private transient Thread exclusiveOwnerThread;
    
    // 设置独占线程 
    protected final void setExclusiveOwnerThread(Thread thread) {
        exclusiveOwnerThread = thread;
    }
    
    // 获取独占线程 
    protected final Thread getExclusiveOwnerThread() {
        return exclusiveOwnerThread;
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>AbstractOwnableSynchronizer抽象类中，可以设置独占资源线程和获取独占资源线程。分别为setExclusiveOwnerThread与getExclusiveOwnerThread方法，这两个方法会被子类调用。</p> <blockquote><p>AbstractQueuedSynchronizer类有两个内部类，分别为Node类与ConditionObject类。下面分别做介绍。</p></blockquote> <h3 id="类的内部类-node类"><a href="#类的内部类-node类" class="header-anchor">#</a> 类的内部类 - Node类</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>static final class Node {
    // 模式，分为共享与独占
    // 共享模式
    static final Node SHARED = new Node();
    // 独占模式
    static final Node EXCLUSIVE = null;        
    // 结点状态
    // CANCELLED，值为1，表示当前的线程被取消
    // SIGNAL，值为-1，表示当前节点的后继节点包含的线程需要运行，也就是unpark
    // CONDITION，值为-2，表示当前节点在等待condition，也就是在condition队列中
    // PROPAGATE，值为-3，表示当前场景下后续的acquireShared能够得以执行
    // 值为0，表示当前节点在sync队列中，等待着获取锁
    static final int CANCELLED =  1;
    static final int SIGNAL    = -1;
    static final int CONDITION = -2;
    static final int PROPAGATE = -3;        

    // 结点状态
    volatile int waitStatus;        
    // 前驱结点
    volatile Node prev;    
    // 后继结点
    volatile Node next;        
    // 结点所对应的线程
    volatile Thread thread;        
    // 下一个等待者
    Node nextWaiter;
    
    // 结点是否在共享模式下等待
    final boolean isShared() {
        return nextWaiter == SHARED;
    }
    
    // 获取前驱结点，若前驱结点为空，抛出异常
    final Node predecessor() throws NullPointerException {
        // 保存前驱结点
        Node p = prev; 
        if (p == null) // 前驱结点为空，抛出异常
            throw new NullPointerException();
        else // 前驱结点不为空，返回
            return p;
    }
    
    // 无参构造方法
    Node() {    // Used to establish initial head or SHARED marker
    }
    
    // 构造方法
        Node(Thread thread, Node mode) {    // Used by addWaiter
        this.nextWaiter = mode;
        this.thread = thread;
    }
    
    // 构造方法
    Node(Thread thread, int waitStatus) { // Used by Condition
        this.waitStatus = waitStatus;
        this.thread = thread;
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>每个线程被阻塞的线程都会被封装成一个Node结点，放入队列。每个节点包含了一个Thread类型的引用，并且每个节点都存在一个状态，具体状态如下。</p> <ul><li><p><code>CANCELLED</code>，值为1，表示当前的线程被取消。</p></li> <li><p><code>SIGNAL</code>，值为-1，表示当前节点的后继节点包含的线程需要运行，需要进行unpark操作。</p></li> <li><p><code>CONDITION</code>，值为-2，表示当前节点在等待condition，也就是在condition queue中。</p></li> <li><p><code>PROPAGATE</code>，值为-3，表示当前场景下后续的acquireShared能够得以执行。</p></li> <li><p>值为0，表示当前节点在sync queue中，等待着获取锁。</p></li></ul> <h3 id="类的内部类-conditionobject类"><a href="#类的内部类-conditionobject类" class="header-anchor">#</a> 类的内部类 - ConditionObject类</h3> <p>这个类有点长，耐心看下:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 内部类
public class ConditionObject implements Condition, java.io.Serializable {
    // 版本号
    private static final long serialVersionUID = 1173984872572414699L;
    /** First node of condition queue. */
    // condition队列的头节点
    private transient Node firstWaiter;
    /** Last node of condition queue. */
    // condition队列的尾结点
    private transient Node lastWaiter;

    /**
        * Creates a new {@code ConditionObject} instance.
        */
    // 构造方法
    public ConditionObject() { }

    // Internal methods

    /**
        * Adds a new waiter to wait queue.
        * @return its new wait node
        */
    // 添加新的waiter到wait队列
    private Node addConditionWaiter() {
        // 保存尾结点
        Node t = lastWaiter;
        // If lastWaiter is cancelled, clean out.
        if (t != null &amp;&amp; t.waitStatus != Node.CONDITION) { // 尾结点不为空，并且尾结点的状态不为CONDITION
            // 清除状态为CONDITION的结点
            unlinkCancelledWaiters(); 
            // 将最后一个结点重新赋值给t
            t = lastWaiter;
        }
        // 新建一个结点
        Node node = new Node(Thread.currentThread(), Node.CONDITION);
        if (t == null) // 尾结点为空
            // 设置condition队列的头节点
            firstWaiter = node;
        else // 尾结点不为空
            // 设置为节点的nextWaiter域为node结点
            t.nextWaiter = node;
        // 更新condition队列的尾结点
        lastWaiter = node;
        return node;
    }

    /**
        * Removes and transfers nodes until hit non-cancelled one or
        * null. Split out from signal in part to encourage compilers
        * to inline the case of no waiters.
        * @param first (non-null) the first node on condition queue
        */
    private void doSignal(Node first) {
        // 循环
        do {
            if ( (firstWaiter = first.nextWaiter) == null) // 该节点的nextWaiter为空
                // 设置尾结点为空
                lastWaiter = null;
            // 设置first结点的nextWaiter域
            first.nextWaiter = null;
        } while (!transferForSignal(first) &amp;&amp;
                    (first = firstWaiter) != null); // 将结点从condition队列转移到sync队列失败并且condition队列中的头节点不为空，一直循环
    }

    /**
        * Removes and transfers all nodes.
        * @param first (non-null) the first node on condition queue
        */
    private void doSignalAll(Node first) {
        // condition队列的头节点尾结点都设置为空
        lastWaiter = firstWaiter = null;
        // 循环
        do {
            // 获取first结点的nextWaiter域结点
            Node next = first.nextWaiter;
            // 设置first结点的nextWaiter域为空
            first.nextWaiter = null;
            // 将first结点从condition队列转移到sync队列
            transferForSignal(first);
            // 重新设置first
            first = next;
        } while (first != null);
    }

    /**
        * Unlinks cancelled waiter nodes from condition queue.
        * Called only while holding lock. This is called when
        * cancellation occurred during condition wait, and upon
        * insertion of a new waiter when lastWaiter is seen to have
        * been cancelled. This method is needed to avoid garbage
        * retention in the absence of signals. So even though it may
        * require a full traversal, it comes into play only when
        * timeouts or cancellations occur in the absence of
        * signals. It traverses all nodes rather than stopping at a
        * particular target to unlink all pointers to garbage nodes
        * without requiring many re-traversals during cancellation
        * storms.
        */
    // 从condition队列中清除状态为CANCEL的结点
    private void unlinkCancelledWaiters() {
        // 保存condition队列头节点
        Node t = firstWaiter;
        Node trail = null;
        while (t != null) { // t不为空
            // 下一个结点
            Node next = t.nextWaiter;
            if (t.waitStatus != Node.CONDITION) { // t结点的状态不为CONDTION状态
                // 设置t节点的nextWaiter域为空
                t.nextWaiter = null;
                if (trail == null) // trail为空
                    // 重新设置condition队列的头节点
                    firstWaiter = next;
                else // trail不为空
                    // 设置trail结点的nextWaiter域为next结点
                    trail.nextWaiter = next;
                if (next == null) // next结点为空
                    // 设置condition队列的尾结点
                    lastWaiter = trail;
            }
            else // t结点的状态为CONDTION状态
                // 设置trail结点
                trail = t;
            // 设置t结点
            t = next;
        }
    }

    // public methods

    /**
        * Moves the longest-waiting thread, if one exists, from the
        * wait queue for this condition to the wait queue for the
        * owning lock.
        *
        * @throws IllegalMonitorStateException if {@link #isHeldExclusively}
        *         returns {@code false}
        */
    // 唤醒一个等待线程。如果所有的线程都在等待此条件，则选择其中的一个唤醒。在从 await 返回之前，该线程必须重新获取锁。
    public final void signal() {
        if (!isHeldExclusively()) // 不被当前线程独占，抛出异常
            throw new IllegalMonitorStateException();
        // 保存condition队列头节点
        Node first = firstWaiter;
        if (first != null) // 头节点不为空
            // 唤醒一个等待线程
            doSignal(first);
    }

    /**
        * Moves all threads from the wait queue for this condition to
        * the wait queue for the owning lock.
        *
        * @throws IllegalMonitorStateException if {@link #isHeldExclusively}
        *         returns {@code false}
        */
    // 唤醒所有等待线程。如果所有的线程都在等待此条件，则唤醒所有线程。在从 await 返回之前，每个线程都必须重新获取锁。
    public final void signalAll() {
        if (!isHeldExclusively()) // 不被当前线程独占，抛出异常
            throw new IllegalMonitorStateException();
        // 保存condition队列头节点
        Node first = firstWaiter;
        if (first != null) // 头节点不为空
            // 唤醒所有等待线程
            doSignalAll(first);
    }

    /**
        * Implements uninterruptible condition wait.
        * &lt;ol&gt;
        * &lt;li&gt; Save lock state returned by {@link #getState}.
        * &lt;li&gt; Invoke {@link #release} with saved state as argument,
        *      throwing IllegalMonitorStateException if it fails.
        * &lt;li&gt; Block until signalled.
        * &lt;li&gt; Reacquire by invoking specialized version of
        *      {@link #acquire} with saved state as argument.
        * &lt;/ol&gt;
        */
    // 等待，当前线程在接到信号之前一直处于等待状态，不响应中断
    public final void awaitUninterruptibly() {
        // 添加一个结点到等待队列
        Node node = addConditionWaiter();
        // 获取释放的状态
        int savedState = fullyRelease(node);
        boolean interrupted = false;
        while (!isOnSyncQueue(node)) { // 
            // 阻塞当前线程
            LockSupport.park(this);
            if (Thread.interrupted()) // 当前线程被中断
                // 设置interrupted状态
                interrupted = true; 
        }
        if (acquireQueued(node, savedState) || interrupted) // 
            selfInterrupt();
    }

    /*
        * For interruptible waits, we need to track whether to throw
        * InterruptedException, if interrupted while blocked on
        * condition, versus reinterrupt current thread, if
        * interrupted while blocked waiting to re-acquire.
        */

    /** Mode meaning to reinterrupt on exit from wait */
    private static final int REINTERRUPT =  1;
    /** Mode meaning to throw InterruptedException on exit from wait */
    private static final int THROW_IE    = -1;

    /**
        * Checks for interrupt, returning THROW_IE if interrupted
        * before signalled, REINTERRUPT if after signalled, or
        * 0 if not interrupted.
        */
    private int checkInterruptWhileWaiting(Node node) {
        return Thread.interrupted() ?
            (transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) :
            0; 
    }

    /**
        * Throws InterruptedException, reinterrupts current thread, or
        * does nothing, depending on mode.
        */
    private void reportInterruptAfterWait(int interruptMode)
        throws InterruptedException {
        if (interruptMode == THROW_IE)
            throw new InterruptedException();
        else if (interruptMode == REINTERRUPT)
            selfInterrupt();
    }

    /**
        * Implements interruptible condition wait.
        * &lt;ol&gt;
        * &lt;li&gt; If current thread is interrupted, throw InterruptedException.
        * &lt;li&gt; Save lock state returned by {@link #getState}.
        * &lt;li&gt; Invoke {@link #release} with saved state as argument,
        *      throwing IllegalMonitorStateException if it fails.
        * &lt;li&gt; Block until signalled or interrupted.
        * &lt;li&gt; Reacquire by invoking specialized version of
        *      {@link #acquire} with saved state as argument.
        * &lt;li&gt; If interrupted while blocked in step 4, throw InterruptedException.
        * &lt;/ol&gt;
        */
    // // 等待，当前线程在接到信号或被中断之前一直处于等待状态
    public final void await() throws InterruptedException {
        if (Thread.interrupted()) // 当前线程被中断，抛出异常
            throw new InterruptedException();
        // 在wait队列上添加一个结点
        Node node = addConditionWaiter();
        // 
        int savedState = fullyRelease(node);
        int interruptMode = 0;
        while (!isOnSyncQueue(node)) {
            // 阻塞当前线程
            LockSupport.park(this);
            if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) // 检查结点等待时的中断类型
                break;
        }
        if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)
            interruptMode = REINTERRUPT;
        if (node.nextWaiter != null) // clean up if cancelled
            unlinkCancelledWaiters();
        if (interruptMode != 0)
            reportInterruptAfterWait(interruptMode);
    }

    /**
        * Implements timed condition wait.
        * &lt;ol&gt;
        * &lt;li&gt; If current thread is interrupted, throw InterruptedException.
        * &lt;li&gt; Save lock state returned by {@link #getState}.
        * &lt;li&gt; Invoke {@link #release} with saved state as argument,
        *      throwing IllegalMonitorStateException if it fails.
        * &lt;li&gt; Block until signalled, interrupted, or timed out.
        * &lt;li&gt; Reacquire by invoking specialized version of
        *      {@link #acquire} with saved state as argument.
        * &lt;li&gt; If interrupted while blocked in step 4, throw InterruptedException.
        * &lt;/ol&gt;
        */
    // 等待，当前线程在接到信号、被中断或到达指定等待时间之前一直处于等待状态 
    public final long awaitNanos(long nanosTimeout)
            throws InterruptedException {
        if (Thread.interrupted())
            throw new InterruptedException();
        Node node = addConditionWaiter();
        int savedState = fullyRelease(node);
        final long deadline = System.nanoTime() + nanosTimeout;
        int interruptMode = 0;
        while (!isOnSyncQueue(node)) {
            if (nanosTimeout &lt;= 0L) {
                transferAfterCancelledWait(node);
                break;
            }
            if (nanosTimeout &gt;= spinForTimeoutThreshold)
                LockSupport.parkNanos(this, nanosTimeout);
            if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)
                break;
            nanosTimeout = deadline - System.nanoTime();
        }
        if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)
            interruptMode = REINTERRUPT;
        if (node.nextWaiter != null)
            unlinkCancelledWaiters();
        if (interruptMode != 0)
            reportInterruptAfterWait(interruptMode);
        return deadline - System.nanoTime();
    }

    /**
        * Implements absolute timed condition wait.
        * &lt;ol&gt;
        * &lt;li&gt; If current thread is interrupted, throw InterruptedException.
        * &lt;li&gt; Save lock state returned by {@link #getState}.
        * &lt;li&gt; Invoke {@link #release} with saved state as argument,
        *      throwing IllegalMonitorStateException if it fails.
        * &lt;li&gt; Block until signalled, interrupted, or timed out.
        * &lt;li&gt; Reacquire by invoking specialized version of
        *      {@link #acquire} with saved state as argument.
        * &lt;li&gt; If interrupted while blocked in step 4, throw InterruptedException.
        * &lt;li&gt; If timed out while blocked in step 4, return false, else true.
        * &lt;/ol&gt;
        */
    // 等待，当前线程在接到信号、被中断或到达指定最后期限之前一直处于等待状态
    public final boolean awaitUntil(Date deadline)
            throws InterruptedException {
        long abstime = deadline.getTime();
        if (Thread.interrupted())
            throw new InterruptedException();
        Node node = addConditionWaiter();
        int savedState = fullyRelease(node);
        boolean timedout = false;
        int interruptMode = 0;
        while (!isOnSyncQueue(node)) {
            if (System.currentTimeMillis() &gt; abstime) {
                timedout = transferAfterCancelledWait(node);
                break;
            }
            LockSupport.parkUntil(this, abstime);
            if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)
                break;
        }
        if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)
            interruptMode = REINTERRUPT;
        if (node.nextWaiter != null)
            unlinkCancelledWaiters();
        if (interruptMode != 0)
            reportInterruptAfterWait(interruptMode);
        return !timedout;
    }

    /**
        * Implements timed condition wait.
        * &lt;ol&gt;
        * &lt;li&gt; If current thread is interrupted, throw InterruptedException.
        * &lt;li&gt; Save lock state returned by {@link #getState}.
        * &lt;li&gt; Invoke {@link #release} with saved state as argument,
        *      throwing IllegalMonitorStateException if it fails.
        * &lt;li&gt; Block until signalled, interrupted, or timed out.
        * &lt;li&gt; Reacquire by invoking specialized version of
        *      {@link #acquire} with saved state as argument.
        * &lt;li&gt; If interrupted while blocked in step 4, throw InterruptedException.
        * &lt;li&gt; If timed out while blocked in step 4, return false, else true.
        * &lt;/ol&gt;
        */
    // 等待，当前线程在接到信号、被中断或到达指定等待时间之前一直处于等待状态。此方法在行为上等效于: awaitNanos(unit.toNanos(time)) &gt; 0
    public final boolean await(long time, TimeUnit unit)
            throws InterruptedException {
        long nanosTimeout = unit.toNanos(time);
        if (Thread.interrupted())
            throw new InterruptedException();
        Node node = addConditionWaiter();
        int savedState = fullyRelease(node);
        final long deadline = System.nanoTime() + nanosTimeout;
        boolean timedout = false;
        int interruptMode = 0;
        while (!isOnSyncQueue(node)) {
            if (nanosTimeout &lt;= 0L) {
                timedout = transferAfterCancelledWait(node);
                break;
            }
            if (nanosTimeout &gt;= spinForTimeoutThreshold)
                LockSupport.parkNanos(this, nanosTimeout);
            if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)
                break;
            nanosTimeout = deadline - System.nanoTime();
        }
        if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)
            interruptMode = REINTERRUPT;
        if (node.nextWaiter != null)
            unlinkCancelledWaiters();
        if (interruptMode != 0)
            reportInterruptAfterWait(interruptMode);
        return !timedout;
    }

    //  support for instrumentation

    /**
        * Returns true if this condition was created by the given
        * synchronization object.
        *
        * @return {@code true} if owned
        */
    final boolean isOwnedBy(AbstractQueuedSynchronizer sync) {
        return sync == AbstractQueuedSynchronizer.this;
    }

    /**
        * Queries whether any threads are waiting on this condition.
        * Implements {@link AbstractQueuedSynchronizer#hasWaiters(ConditionObject)}.
        *
        * @return {@code true} if there are any waiting threads
        * @throws IllegalMonitorStateException if {@link #isHeldExclusively}
        *         returns {@code false}
        */
    //  查询是否有正在等待此条件的任何线程
    protected final boolean hasWaiters() {
        if (!isHeldExclusively())
            throw new IllegalMonitorStateException();
        for (Node w = firstWaiter; w != null; w = w.nextWaiter) {
            if (w.waitStatus == Node.CONDITION)
                return true;
        }
        return false;
    }

    /**
        * Returns an estimate of the number of threads waiting on
        * this condition.
        * Implements {@link AbstractQueuedSynchronizer#getWaitQueueLength(ConditionObject)}.
        *
        * @return the estimated number of waiting threads
        * @throws IllegalMonitorStateException if {@link #isHeldExclusively}
        *         returns {@code false}
        */
    // 返回正在等待此条件的线程数估计值
    protected final int getWaitQueueLength() {
        if (!isHeldExclusively())
            throw new IllegalMonitorStateException();
        int n = 0;
        for (Node w = firstWaiter; w != null; w = w.nextWaiter) {
            if (w.waitStatus == Node.CONDITION)
                ++n;
        }
        return n;
    }

    /**
        * Returns a collection containing those threads that may be
        * waiting on this Condition.
        * Implements {@link AbstractQueuedSynchronizer#getWaitingThreads(ConditionObject)}.
        *
        * @return the collection of threads
        * @throws IllegalMonitorStateException if {@link #isHeldExclusively}
        *         returns {@code false}
        */
    // 返回包含那些可能正在等待此条件的线程集合
    protected final Collection&lt;Thread&gt; getWaitingThreads() {
        if (!isHeldExclusively())
            throw new IllegalMonitorStateException();
        ArrayList&lt;Thread&gt; list = new ArrayList&lt;Thread&gt;();
        for (Node w = firstWaiter; w != null; w = w.nextWaiter) {
            if (w.waitStatus == Node.CONDITION) {
                Thread t = w.thread;
                if (t != null)
                    list.add(t);
            }
        }
        return list;
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br></div></div><p>此类实现了Condition接口，Condition接口定义了条件操作规范，具体如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public interface Condition {

    // 等待，当前线程在接到信号或被中断之前一直处于等待状态
    void await() throws InterruptedException;
    
    // 等待，当前线程在接到信号之前一直处于等待状态，不响应中断
    void awaitUninterruptibly();
    
    //等待，当前线程在接到信号、被中断或到达指定等待时间之前一直处于等待状态 
    long awaitNanos(long nanosTimeout) throws InterruptedException;
    
    // 等待，当前线程在接到信号、被中断或到达指定等待时间之前一直处于等待状态。此方法在行为上等效于: awaitNanos(unit.toNanos(time)) &gt; 0
    boolean await(long time, TimeUnit unit) throws InterruptedException;
    
    // 等待，当前线程在接到信号、被中断或到达指定最后期限之前一直处于等待状态
    boolean awaitUntil(Date deadline) throws InterruptedException;
    
    // 唤醒一个等待线程。如果所有的线程都在等待此条件，则选择其中的一个唤醒。在从 await 返回之前，该线程必须重新获取锁。
    void signal();
    
    // 唤醒所有等待线程。如果所有的线程都在等待此条件，则唤醒所有线程。在从 await 返回之前，每个线程都必须重新获取锁。
    void signalAll();
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>Condition接口中定义了await、signal方法，用来等待条件、释放条件。之后会详细分析CondtionObject的源码。</p> <h3 id="类的属性"><a href="#类的属性" class="header-anchor">#</a> 类的属性</h3> <p>属性中包含了头节点head，尾结点tail，状态state、自旋时间spinForTimeoutThreshold，还有AbstractQueuedSynchronizer抽象的属性在内存中的偏移地址，通过该偏移地址，可以获取和设置该属性的值，同时还包括一个静态初始化块，用于加载内存偏移地址。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public abstract class AbstractQueuedSynchronizer extends AbstractOwnableSynchronizer
    implements java.io.Serializable {    
    // 版本号
    private static final long serialVersionUID = 7373984972572414691L;    
    // 头节点
    private transient volatile Node head;    
    // 尾结点
    private transient volatile Node tail;    
    // 状态
    private volatile int state;    
    // 自旋时间
    static final long spinForTimeoutThreshold = 1000L;
    
    // Unsafe类实例
    private static final Unsafe unsafe = Unsafe.getUnsafe();
    // state内存偏移地址
    private static final long stateOffset;
    // head内存偏移地址
    private static final long headOffset;
    // state内存偏移地址
    private static final long tailOffset;
    // tail内存偏移地址
    private static final long waitStatusOffset;
    // next内存偏移地址
    private static final long nextOffset;
    // 静态初始化块
    static {
        try {
            stateOffset = unsafe.objectFieldOffset
                (AbstractQueuedSynchronizer.class.getDeclaredField(&quot;state&quot;));
            headOffset = unsafe.objectFieldOffset
                (AbstractQueuedSynchronizer.class.getDeclaredField(&quot;head&quot;));
            tailOffset = unsafe.objectFieldOffset
                (AbstractQueuedSynchronizer.class.getDeclaredField(&quot;tail&quot;));
            waitStatusOffset = unsafe.objectFieldOffset
                (Node.class.getDeclaredField(&quot;waitStatus&quot;));
            nextOffset = unsafe.objectFieldOffset
                (Node.class.getDeclaredField(&quot;next&quot;));

        } catch (Exception ex) { throw new Error(ex); }
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="类的构造方法"><a href="#类的构造方法" class="header-anchor">#</a> 类的构造方法</h3> <p>此类构造方法为从抽象构造方法，供子类调用。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>protected AbstractQueuedSynchronizer() { } 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="类的核心方法-acquire方法"><a href="#类的核心方法-acquire方法" class="header-anchor">#</a> 类的核心方法 - acquire方法</h3> <p>该方法以独占模式获取(资源)，忽略中断，即线程在aquire过程中，中断此线程是无效的。源码如下:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public final void acquire(int arg) {
    if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg))
        selfInterrupt();
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>由上述源码可以知道，当一个线程调用acquire时，调用方法流程如下</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVAAAAIWCAIAAACOY0JiAAAl50lEQVR4Xu2d7ZmyOhBAacM2tgm72BJswyq2AMuwDHuwB+/AvM4dEwFRA/k458c+bkDEMIcZwofdDQCaoQsbAKBeEP5Vrtfr4XDY7/e73a6Dz5A+/Pn5kf6UXg07GlKC8C9xPp8lRiVA5QUx+jnSh9KT0p/Sq/IinAzJQPh5JDolLk+nUzgBPkb3pOxDVwPh5zkMhK3wJY7H4+/vb9gKaUD4eeS4nbIzHZfLRY7nw1ZIA8LPQ82Zmq4jDleCjp6niHCUwjhsGtDTCmHr8KVkUti6EUX0cB3Q0fNsGI4P57LmeCqw2B7vC+QIRebP5zil266HW4OOnieTcBRvg7HDoCUWWA6Pn668vCveC2zI05WEFNDR82QSjrPCx5xOp6dp376R7CNyON2YSQ+3AB09TybhGOsdtwT4TC7fQt2WFi+5Xj5o/25CJj3cAnT0PJmEY6x33KLoIboiMttr8VyK/FjvsYG91cikh1uAjp4nk3CM9Y5bAmzN9YI23RHchqxuewFjw9q+y6OHW4COnieTcIz19i3yOpBWXttUe60JP3Z724uLMunhFqCj59kqHH36nUWP1f0eQV6b2P5gPkO6jXq4QejoeTIJx8OAb4lzvkdqeDliD17L36fpPWhZmUx6uAXo6HkyCUfRMnB1Qng/OKcH8Nb+WBn8Y1vnuzx6uAXo6HkyCcf41vEJ4WXXIKutWd3P9vRSnHjJKxOvEiSCjp4nh3D0WdqYEF7Z3R/OYz4jfOPQ0fPkEI5xPX97QfjbffRe0DkRvnHo6Hk2D8exK2RnhTe97W4ZhG8cOnqebcPx6bVxyqzwfqBeZkZ4oKPn2TAcnx66G+Lw2L7g9mi7MTZKj/CNQEfPs1U47gfCVsdYelerY9t1UjwW8HTONdmqhxuEjp6HcEwNPbwadPQ8O55plxiEXw06ep6fn59tD3Hr5sJTa1cE4eeJL2KHL3LkufQrgvDz6C/PkORToKchNh81bAeEfwmNS8lFhOa3kJ6U/tzxG17rgvCvIgEqlaccbbqz1/A+0pPSn+xAVwbhK6Rj0BtGIDIqBOFhDCKjQhAexiAyKgThYQwio0IQHsYgMioE4WEMIqNCEB7GIDIqBOFhDCKjQhAexiAyKgThYQwio0IQHsYgMioE4WEMIqNCEB7GIDIqBOFhDCKjQhAexiAyKgThYQwio0IQHsYgMioE4WEMIqNCEB7GIDIqBOFhDCKjQhAexiAyKgThYQwio0IQHsYgMioE4WEMIqNCEB7GIDIqBOFhDCKjQhAexiAyKgThYQwiox70x1gFEV5fSEs4E7QNwtfD9XrtHuG3WSEA4avicDiY7b+/v+FkaB6Erwqf5EnvEIPwtaFJnvQOT0H42tAkT3qHpyD8q4hIkjx/fn6sZoYPkc6ULpWODfsakoHwL3E+n3e7nUSnvAinwbtIZ0qXSsfSq6uB8PNICpKgPJ1O4QT4BrozJc+vA8LPcxgIW+F7SPcyyrgOCD/Pfr+n5kzK5XKR4/mwFRKA8PNQcK5Ax/X/q0Avz0MsrgCdvA708jzE4grQyetAL89TWSyez2f5Rn9/f+GETamsk7OFXp6nslg8nU4I3yz08jzE4grQyetAL89DLK4AnbwO9PI8SWPxcrn8/v7aY2qCZ9TI8bZdvS+z2S0xemG/vmu/30u7f+9+4P+lDGcWrSU4hteZpc7XpdkVB/r8HF2rFa54T9rJYNDL8ySNRX/Rrjgmn2X/qpkqmyCK2uVooqhdgi7tauaE8Lpf0Ne6WD/zbkD2GvpBt+HSN1u+XhWT+sKYpJ0MBr08z5qxqJlcX4tjYt3j9B4x0O8XbvdxuLeF94n99mz5+pakdxOs2cktQy/Ps2YsejO7Ib0/Tu/RQiC44/1D4f+f9YXlp2DNTm4ZenmepLEo+tkxvOKFf+qYChk0Bg5/LnxM0jN5XfSNIAX08jzpYtGO0i2ddrlm+NSk62Tw0MvzpItFVcsPgHszdSzNJhnxEXV8DO/fqMfkrwsfL38F0nUyeOjledLFohdVz8/FZtopMZk5GM/TJByP0vvFnofHS+yi03ITwmujjdLfhrfIJybN+fE6QAro5XmSxuLRne6W12KafxSEmtYNSLsZKLsA3TvoHkFzuDl8c4uVt8u7fJGvwvvz8HEdIcu3JQQfnYguZSeDQS/PU0QsBsIXRxGdXAH08jxFxCLCwyvQy/MUEYsID69AL89TRCwiPLwCvTzPjmfapQfh14FenkcHusNW+B6X4W6/sBUSgPDz8Fz61MjBCM+lXweEn+c6/PIMST4RemlQ0qt6wED4l9CglEREXH4R6Uy9vGfly3hbBuFfRS9us4vP4HOkM/1jfGAFEL5C9vw2FoyA8BWC8DAGwlcIwsMYCF8hCA9jIHyFIDyMgfAVgvAwBsJXCMLDGAhfIQgPYyB8hSA8jIHwFZL6gZNQLghfIdyLAmMgfIUgPIyB8BWC8DAGwlcIwsMYCF8hCA9jIHyFIDyMgfAVgvAwBsJXCMLDGAhfIQgPYyB8hSA8jIHwFYLwMAbCVwjCwxgIXyEID2MgfIUgPIyB8BWC8DAGwlcIwsMYCF8hCA9jIHyFIDyMgfD18Pf3txvQ32kU+Fl7CED4etDfsfc/z0qehwCEr4rj8Wi27/f7cDI0D8JXhU/ypHeIQfja0CRPeoenIHxtaJInvcNTEL5C+NkZGAPhARoC4atCcvvhcJCS/vf3lzwPMQhfA3LcfjwefwbkhRzA//39yWsxX/6VqeEboFUQvmxOp9N+v9eL6uKUbglf5pE5g6nQIAhfJJLDF5ns9wsM4LcMwpeEFOe+Vl+qrlb+8l5ZgiyHUr9BEL4MpDj//f391mjcd5cGBYHwWZM0J39YL0CJIHymrHnUvXREAMoF4fNiW/emx/yhAhA+C4Lq+rul+1KCs/rbrgx8F4TfmJzHz2zdNik3IAUIvw1Suqcbjfs6soarDShAUhB+bcqVp6ydFDwF4Veipqtccz4MgWkQPi0VD4BlNdAIL4LwqWjnFFdNxUv1IPyX2fZE+rasebEQvAfCfwcuUzUY28sZhP8URrDGoGcyBOHfJOltLTVB7ZMVCL+Y9Y9URZhu+Lm4dXYr8qU0LYcTPqPl0Y18QPhX2TBeJT2KfuL8Op+bSHijnfMXgv3ylyecaUW2/OwiePtssyoati5H9JPliBhJJVyfiq9Q8MQxELesyZafnTkfjjlJEvvKptV6Xl5IPpQX9YlR9y06Lq//TzjTimz52Xny+VklzckeWeDt/qtvWjBrozrsBwKuww9F+Uwuq7EffihOxOiiql7eq6WEIHP6HZN+i244+FepdDm3+6L8zLpbsRZ5besQr7a2y8zyifrRMvPnwxnl3mUwQRfpHbesyZafnRvfDbg4w6s5snyVVj5CxTOFbsPxrRdP9x2yYrdhX9A9/kqk7h3EOl1bLft1kn6WvlHbd0MK1amx8Dq/F95mjlf7dl9PWzEd3fi8027f2OFmRb87jAhnWpEtPzsTzmmuDB0T3ustqIr2rxa39m9QAmhGtX/jAsHYDbst+1fz8yfCx6vtl687I9/yOVqV7N49pIKntCt86kGjMeGD2PW1dKxNsDvwefs2fISsvE011GebTdkP+BkWCe9n1rcHO0e//C/y9qDp5nRzhG9YhW0+dVvWOS30ovBatKvkKr9lbD9JUdNM8jHHYp9vCYSPSXoS4ZymEFuNbiPDA7JYiXW4rHsi/UXhb66M13LD2rVif4ruFPY5ZfjV8Pvrp4czWdHdY8BtvZ7HudZjsw9ejaAmXC1E1JO4JRZe/QnK9VtUzytaBehsY8fw8aHB02N4/1k61P+i8PHy10ePyHbZj+1ZDGwouSeLlUjEedNRH39wrk7G5hjqdudOs6uTsVQqmyZ201iXfx7Ok+lsui/QJHyORulv90+UN9oY++vCW6OZdhnODgY1xTpsu5WnUcn9383JYiW+Syb7fvlcO0Ou4qkkcUK2Sf4YeCx7B5PUNP0U+b6+zDaNRV0xwZf0+sb9cNCxu49ldI/Cx+fh7b2KfNbP/Ty8dnUww5psVcdN0DnDtZcC3Lzrsc2nJqKsozuPntZOelQcCF8rl3VHaoqjBuEr2MaapZMWI40Ib6xzLqY4Cha+3DO0AXpYnvSc1q094RU9vtPTH0UHybcoUvicx2neIDh+TkSbwhsWM+WWgV+hJOEvdV1lDZvw99U7JoqjDOEb30jwdZpNHrkLL9WXnluKz0gDfI6edCyXpUM/uQt/q2hwDvKhjsE88aJC4Y1z4bdPQA7UdLqucuGNci+wga2o4GKNmFaEV5odd0mKnb7qhqtuj4/PvSiODC+5/SJtCW9Udlp+WyQN2jHt33D/T6HDpS1ERaPCK3Xvy7fC36hTBDoa10jd17TwRpVHa4p+qbA1JXpXTxEZssGRHYR/oKbxWKV7fGrtCqxz2e8nVLx/nwXhn1DHGVfNtB6VcLhAvg90HWbzjf7tQWlwdQ+9mB6Zy7ak5+qMG8JPU8HtE12U4bWE2d2fXaNxHwvv3yjz6O5PNT4Pz8N5OjKn6X1pSKWmhdG4F0H4l/jL6cp8n7Q94XwD3TPhu6jknhZex979F4/TuF5wql2USfLkLGwMwi+gxAAaE963aOOE8Lqz81PjA3UV3s2yJVntoLMC4d+hoBLxW8L3JUREnOHt3004cyX1HAj/PlsNAoXa3QnnG+i+JHyQ4WO09glbV6GOQdZ1QPgvkHNiiU0eE97rehl+wcbeGB+xZ0J9p1FTg/DfJMMLOfTQIxiQj4XXc3h6sk0H4XX/pVOvj785K//qWT2/hN/hoZrrfOtLwyfSPwThv49WmGrI5mN74sbP8Ch41f4WJXND17m7/2h8UBqYY7qoeI+2gvDBMVTSz6oVhE9IQWN7mUNPfguETw556W2yqpXqAOHXgyPP18lwNKQOEH4DGFseg31iahB+Mzh7bARHPS13RWoQfntsRKrBtMZo3MogfEb8NXMF+KXAuxLqAOGzo24Z2tmp5QnC50tN5W7OVx83BcLnTtEDWgxM5gbCF0NZSZJTj3mC8OWR80UpnEjPHIQvlazG9rh8uBQQvni2Hdvb9tNhKQhfCSvnWG5rKRSEr43UR9E5jyDALAhfLd8dJ0+9H4F1QPjK+fBMeNFXAUAMwrfC0lt0GI2rEoRvjr/Jq9mzOtsHXwfhGyUWe3pHAHWA8K2jpbs+hf6VUh+KBuGhJ35SPVQJwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwldFN0f4hjsTk6AmEL5mXtf49TmhaBC+WqZTesDrc0LRIHydqMD2d9bn2RmgDhC+NrzeXuNp7ScmQU0gfD3ESscaxy3KWDtUBsLXzOsavz4nFA3C14bm+aeEszqmp0I1IHxtjKk71q5MT4VqQPjaGFN3rF2ZngrVgPC1MabuWLsyPRWqAeFr437A/oRwVsf0VKgGhK+NMXXH2pXpqVANCA89CN8ICA89CN8ICA89CN8ICA89CN8ICA89CN8ICA89CN8ICA89CN8ICA89CN8ICA89CN8ICN80+gOyggivL6QlnAkqAuGb5nq99hfZO/ih6LpB+NY5HA5m+9JQgOJA+NbxSZ70Xj0ID/+S/NI4gBJBePiX5EnvLYDw73A6naTXdHAbskI2yn6/l7AOtxkMIPwyJBlKf/38/IjzpMQMkQ0km0Y2kGgvr8PJzYPwy5DOkiPesBXy43g8ivNha/Mg/AI0dYStkCvU9jEIvwDpKXE+bIVckY1Fkg9A+AXsdjuO2wtCjuFlk4WtbYPwC+i4w6Q02GQBCL8Aoqc42GQBCL8Aoqc42GQBCL+ArKLneDxOrM/5fJap8jec0BgTXdQmCL+ArKLndeH1UvlguPF0OkljfE3Bz8/P7EDX0wXmyUQXtQnCLyCr6HldeHU7OCOt0gZu60X18V4gQD8a4UsE4ReQVfS8LrxqHGxmuxHAe6vvWnqtgSx5Yk22JdsV2wqEX0BW0fO68LeoUBfJdRcQ6K1pf+kl6Pv9fmJNtiXbFdsKhF9A6ugRD3/vN+HFj5cTe8VbmxQIr+/tBsTbQPigCNci37S3hfwM6OuJlbGl6RI8NptfH1mmHz7cD8g66MKTjix2iTdZcSD8AlJHjwhg+Valsn9VYDFZ0q+4JMKoLTpVLykTr2SSvJbZApfUTLNRZ7gN1bhlfq38bZ6JldF/beFxhpePk7fr2t6GIAvm3w3o2i4tKBaRepMVB8IvYOXo6Vz69WbeBjk12+u/apQl8Nu9OPfJczfcKG6vdWTOvzEoCgL8yswKH6zt7fGYQucf+6DvsvImyx+EX8DK0SMfZ4p63xRf0mvO9FNje7XAvt2zvaZrfa0D+Jb2n+JXZlb4LhrqD9Z2tZ5c7YNKAeEXkDp6RCE7bFa88P4o+hYpZHMqsfB63C4tdgCv7Zb55YUPhYmVeUX4mCDD+/nTsdoHlQLCLyBp9KiikhhNxe6rGV6T+WHAz6zFv0/7t7mVeUX4IMN74vnTsdoHlQLCLyBp9KhFfgTLOxacVwuO4U1amyE+hr/dB+HtAF7RhK8Fvy1hemUC4f2uRwnWNgDhNwThF5A0elQ8rdsv93Na5pilXJ2qRtn66Ki4NOqgt+bwWHjdC3SP5951cL4bTp5Z4/TKBML7QXg//mcFgvyVt1icIfyGIPwCUkfPcfilt+5+3lvE8NvGTlzL378Bvz66F9Cph+g8vM0zqB1eFasGxmMEYyujwttCrsODPXXJ/qDAGnWVrF6ID0DS0SXeZMWB8AsgeoqDTRaA8AsgeoqDTRaA8AsgeoqDTRaA8AsgeoqDTRaA8AsgeoqDTRaA8AvYDfd7hK2QK1ceUx2B8AvYDzd1hq2QKyd+iCIC4RcgneWvToHMEduDiwsA4ZdBDJWCbCb2zjEIvww5LNwPSLmY9MkN8B7X4eeiZQPphcbh5OZB+HeQXtPrQ/XSUciH3XC3L1XYGAgPPR2nr9oA4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4aEH4RsB4ZvmeDzuBrrhZxgFfoaxbhC+aa7Xa/fI5XIJZ4KKQPjWORwOZvvSUIDiQPjW8Ume9F49CA//kvzSOIASQXj4l+RJ7y2A8NBzPp/DJqgRhG8XSeziudTzPwPy4nQ6SWM4H1QEwjeHlO7H43G/3+92O/krry8D2ii1vTaS86sE4ZtA8rZuaZFck/mEz5b2ZWZ5i7yRtF8NCF8zH6orM0uRH+wmFi0BcgPhayNRcR4fCHxlsbAyCF8DcSpON/zmh/reKxxgQxC+YGLxVj6XvmhoAHIA4QvDl9biWD6ltaxGPPgfzgRbg/AF4Ct2IWnF/jm6tr70yHltWwPh80Vzpmijw2/rV+yfIytMzZ8VCJ8XakiGFfvn2P6Lmn9DEH57rAYuomL/nOD7UvOvCcJvRpDxSqzYPyeo+WuqaPIE4VfF4lsOy4nvAPaAK4DwyaGCXQo9lg6ETwVjVF+h4lHMTUD4b8JZqKRUcJ5ycxD+U7jOZH3KuhIpKxD+TexKUrspjWyzCdlea5wnCL+AK/eK5IF0u+xn484/b303Uf4g/DxxGGVVPWr0y1qFE5Yg38gOj7vhZ6fk36y+pmdMeMPX/LprpuZXEP45vlDMvGKXUP5QePlqKoYpJC90B5fnt54V3mOb8rtPBMkB3TtPEL4B4T1PK/YW0oK6HXxT+Vd3dr4xExYJ78m8WPuQp4YHIHzlQTCLyiNlQjjh/os0GSb5t4U36tu5W0ofy+1Ko8KnK/NkyRpG3f1I2E/VUlk3icxmLkmo6YVluj5aY9t79wP/L+V287lXo99Kep1ZBNal6ffyyw/WSl53I1YHS5bX/o3ylrjld7hquBsuHPZdOv0VbpNreHtcssppX+1zCjp8e4p2i77wjf/P4WhI+HUGcmThli3VJftXw1Q+9zrgu16jTSNY2jXuJ4Tvhv2CvtbF+pl3AxK1+kHCz4DGscy/G85d2/xjwREs2b+Op+pOSr/dbfgW3snprzC9htfh4EKnXt1+4VvCG9fSHtfXiz4u+dPNWr/w8SZcc//duR9p1HV4nN6jqdIX1ToO97bwgQzqnv/Wvlb/lvC6J7Wpt8fvO/0VptdwbOrXhffYHln3NVpWhDNlxth29NQpvC/Sfja9GMOHdTek98fpPVoIBLsh79K0LU+F/3/We873LfoW7ZN4fmOR8PG30++lr6e/wuwaTkxdgXNFF1nVI/w1j8stJTjsGF6xsA6EMbwYhp952pZXhLeV8WjU+lwaoEu20qObEz7mxQw/vYbxe1cW3tAY8wXjJjHmCbvMEc46ULzwuvf9yeOGCg1ECQhbB10re51Jhvfo4cPEKL0FtP+UW/S5Y99Omf4K02sYT91KeM8ljxulgm1tjLUXKbz2tcbBthV7gKrrd/k+rLX0sElGkEhvz47h/RsvwzH/68JP5PCbGxIL2vVTvMOdG4+43Q+t7XPHRiiU6a8wvYbx1BWO4RdhWWe3+jj/mNhj7cUIb9WUapNDNRXjRb3czyQFZh7u49h6AKKTNFY0Sv6iUXq/2PMwgq2B5Rc7Ibwf5dZ/T8NJO5tB/90PpwN9SyCV1yxeyaC6uQzDKPYFp7/C9Bpe7hcCXgc0BrIS3lg/SrtxwlkHchc+2HduW7G/gqythuNuOJks6+z79/x4Ht5CVmJC9w7d3ZnusX62xf4M57f3A7bM7vE8vKliyALNk90wwBF0o59BP8WUtplVNp3hd7iIIFjJ8zB+oTPop/hYn/gKt7k1lNfabzpJv3KGwnsu9zpUv/IxTR3ajYg91p6j8NpTdnSUqKcyJ3BpE0yzseiBF8knb+Ui/Pq1UObkILyimTlshbfQONdkptXKynG+sfC659OyZ7/uaEfm5CM8JMJq/jUr2Q2EDyp2PSQLZ2oehG8Kq/m7YXwkXc2/kvDX6CrllSsZgCJIXfOnFd4q9t3q5ycBSufyeIW4Hvl+go4XphXeZ/V0hQpAfVwT3MCTVnjDFyq66t8tVACqIU6TXzRlJeE9vlDROv/z/RZA0awmxQbCe/Tce6KdGUDOxGXvOf1jtjYW3khxuALrcHZ3BO+ip1NBQNKKfZZchPcwtl8WEr7H+0Ps/4Zb6A7j98m2iVXsOlSermKfJUfhjfjs/cq7Q3iDQ3Q3a5ukPqP+HlkL76Hmfw+tksLWlJyGO2Gb3Tpxispq31eM8B6r+a1AyqpPs0K7KGxNybmEe1e/yyZXxb9HkcIbWjX5HWoOVVMmaKb1aBTuB06Pj7jQRv/2oDS4Tj433tNISZ9nxT5L2cJ7uCfnKV2U4TURCZf7g+u1MZjNv/E6+dx4j6b3pSFVEFpd/uTxDMU3qEd4j20VTVPFbZVpXM5+IJxvoHsmfBeV3NPC69i778M4jR+H5/npjiD/RLcIq9i7lM+uWYc6hTes5tec1mDNPya8b9HGCeH30WOz4gN1Fd7NUja1Rk7lwntq2k+/zreE754RZ3j7t1Dqrg1vTQnvKfpILNTuTjjfQPcl4YMMH3Ms9klYTY3+NCq8UehY6+vEJo8J73W9LHlufInUWrHP0rrwHqv5dU9fR82v+7JgQD4WXs/h6ck2HYTfvfzceOV3eEB15jsFrey0B/ZNXsGB8M8553291Otc3BPd9SuM1edak3dvPTf+lrHwV67RdCD8DNXX/FVyje7CYKspCL+ASzb3PMFTrGLX45EGK/ZZEP5Nqqn5S4eKfREI/ym+5reAo3pMTbzDpc9fAeG/idX8VlKSbb4I3fs5CJ8KPc1LCvoQCqjvgvDJ4SDzDeKKnSGSr4Dwq8Iw8gS+Yq/mwqfcQPht4ESxwmUOK4Pw23Np6eYNRSsdKvb1Qfi8sJq/vou9db9Gxb4tCJ8pWuvq5evl1vxU7LmB8AVQXM3vK/Z9aY8bqBuEL4xsXbKKXe+3o2LPE4QvlRxq/hzWARaB8DWwcnYNqoyaRharB+Frw2zUcf5v1fzFjSPAUxC+Wj4fIbeKvfGrg2oC4Ztg0Tnwiq8FAIRvjuCSXq35r9zh0wYI3y6+5u+GH4T74x7e2kF46IkfXA1VgvDQg/CNgPDQg/CNgPDQg/CNgPDQg/CNgPDQg/CNgPBN0D0jmMH/C7WC8E0Q+4zwbYLwTfCY2v8RzOD/hVpB+CaIfUb4NkH4JnhM7f8IZvD/Qq0gPPQgfCMgfOWEaT3CZnt8H9QJwrfFmNhj7VAZCN8EPpN74hmgbhC+Cbzwj1P+MdYOlYHw9aMy+78xY+1QGQhfOUHdHhPPBhWD8NCD8I2A8NCD8I2A8NCD8I2A8NCD8I2A8NCD8I2A8NCD8I2A8NCD8I2A8NCD8I2A8NCD8I2A8NCD8I2A8E1zPB711+NFeH0hLeFMUBEI3zTX61WvqDf4Kfi6QfjWORwOZvvSUIDiQPjW8Ume9F49CA//kvzSOIASQXj4l+RJ7y2A8NBzPp/DJqgRhF+M5EOpgX9+fuzQF7JCNo1sIAqWpyD8Mk6n0263k3iSlCjmh5Nha2SjyKbR6wtkY4WTmwfhFyDBJGFE9VsEsplkY5HnAxB+AYeBsBVyRfL80uCuHoRfgBwckt4LQtK7bLKwtW0QfgFd13HcXhYdNwU9gvALIHqKg00WgPALIHqKg00WgPALyCF65LhUVsOfcNKbWzsulXtGDpssKxB+ATlETyD88Xj0a7UfsH8hh02WFQi/gByiJxA+MPxF4eMyYStkNZI+ciOHTZYVCL+AHKIH4ReRwybLCoRfQKLoOZ/P3R1/nt8/msKsMFf1haGee+Flnm44sLd51HA9CjBsft/ury/S517JbDaz/NVrkLrhwVja4nc09tH6Wuexhet30XkMnefrdGk2Wbkg/AJSRE+QbC3uvUI6j3ryeoY3o/Rf9VkljDO82OuV65zzOijo8/B+kN/vFILVCITX1dB/de9mHx0s+evY1wcF4ReQInpi9253K9QQxYRcKrwtxL8xWIj+64sLPxYon+s/4jZ8SpCQZ4X338XPjPArg/ALSBQ9VrqbFUG5q3wo/M3ZFSzEH1N4dKreHWgLuUUfGrdMC++riQ7h1wXhF5A0evZDnawmxJIY6YQfu00A4WsC4ReQOnpMvAkDvyK8vraFBMsMeEX4YAhgWnj/9l3iJ+Gn3mTFgfALSBE94oPp5MfVdKjMZjsO3CI5PxE+GHXzM/u1ekV4/SzdQ+nrQPjgX1v/eIDgu/g+hBvCLyJR9Khsis/qvt2U+5bw5qEt2YYSOneu7vaa8Df39t3wjJDu0XA/TOBLCWuPF/gVujSbrFwQfgFEzxvE+501YZMFIPwCiJ43QPisQPgFED1vgPBZgfALIHqKg00WgPALIHqKg00WgPAL4CGWZXHhIZYRCL8A6amkV4nAdznymOoIhF+AZIzdbrfV+BMsgo31FIRfhvSXXg1KJGWLbJrj8FNTsrHCac2D8IuReJIu48cks0U2jWwg9shPQXjoYWyiERAeejpOX7UBwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwkMPwjcCwjeN/qyyIMLrC35Vsm4Qvmmu12v3CL+yXDcI3zqHw8FsXxoKUBwI3zo+yZPeqwfh4V+SXxoHUCIID/+SPOm9BRAees7nc9gENYLwayC9vN/v9ewXvIF0nXSgdGPYs7AQhE+O9O/Pz8/pdJLKOZwGryFdJzWIdKNoH06DJSB8WqR/JUxR/VtIZ5LnPwHh0yIZSXJ72Arvonk+bIWXQfi0yMFnhun99etnTwNh63boCYWwFV4G4dOybXSKq7IC8Qi8NL7o/NgSNmTbLi0dhE/LttF5OBye5ufX10reLgsJGuU4JW5cjddXHmIQPi0bRuflchkb0/ZrZer6i+qnkYQvO4Kt0n63XZdWAMKnZcPolKJdnRTz5XVo7R1Rd6K8f5rht6XbrksrAOHTsmF0BqnbT5pYKz1on2bbi3C78ZWHWRA+LVtFpxXzkuR3u93jxKm1EuH9gUCQ4XNI+MHKyyr9/Pxsuw8qCIRPy4Ra6ZDo9wk5nHxfK50tGNWTHUQpwqvq+h0R/kUQPi1PfVsNkdOG1uSF3wV0wwXqt0Eb/5ZZ4ccGAldDd1KmunI8Hv/gBX4Hwj6dZMsILg61axNOA2HrHKe5Y/gchJeQDdZK4xhe4W/htcmbRXCJdBsJr5lZ5DQlpOh9erteUKL7HK73qB0GtCWHyrm7H4/8Ou1zWLFa2SaCC0Wjc31U9eBUuTQGYsTjeYZ6biX95ond8F1q2iN8OraJ4ELZSvinvC68HBKr4SZ8DkfvStyl8qUyvGGhGsLuhgni6FwZG6tTY18R3my/PQ7a6dU7m+fSzbu0NejuBWwSnf60nE/LrwgvevsL74LEbkN68RtXY5MubRm6ewFbRefT8fmng3Z+hi46Lf+0ktcdx1apPlhnSA3dvYCsovPpXsB4mrTtgvx8yKpLW4DuXkCeD8AoGoRfGbp7AVL95pYhi4ZHXK0Pwi/gb3iIZdgK7yI70ImbeSEFCL8MiVFxXlITtf0n6EX+8QgipAbhFyNJKbjZA5YiHUhu3wSEB2gIhAdoCIQHaAiEB2gIhAdoCIQHaAiEB2gIhAdoCIQHaAiEB2gIhAdoCIQHaAiEB2iI/wClOz41wEnnMAAAAABJRU5ErkJggg==" alt="image"></p> <ul><li><p>首先调用tryAcquire方法，调用此方法的线程会试图在独占模式下获取对象状态。此方法应该查询是否允许它在独占模式下获取对象状态，如果允许，则获取它。在AbstractQueuedSynchronizer源码中默认会抛出一个异常，即需要子类去重写此方法完成自己的逻辑。之后会进行分析。</p></li> <li><p>若tryAcquire失败，则调用addWaiter方法，addWaiter方法完成的功能是将调用此方法的线程封装成为一个结点并放入Sync queue。</p></li> <li><p>调用acquireQueued方法，此方法完成的功能是Sync queue中的结点不断尝试获取资源，若成功，则返回true，否则，返回false。</p></li> <li><p>由于tryAcquire默认实现是抛出异常，所以此时，不进行分析，之后会结合一个例子进行分析。</p></li></ul> <p>首先分析addWaiter方法</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 添加等待者
private Node addWaiter(Node mode) {
    // 新生成一个结点，默认为独占模式
    Node node = new Node(Thread.currentThread(), mode);
    // Try the fast path of enq; backup to full enq on failure
    // 保存尾结点
    Node pred = tail;
    if (pred != null) { // 尾结点不为空，即已经被初始化
        // 将node结点的prev域连接到尾结点
        node.prev = pred; 
        if (compareAndSetTail(pred, node)) { // 比较pred是否为尾结点，是则将尾结点设置为node 
            // 设置尾结点的next域为node
            pred.next = node;
            return node; // 返回新生成的结点
        }
    }
    enq(node); // 尾结点为空(即还没有被初始化过)，或者是compareAndSetTail操作失败，则入队列
    return node;
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>addWaiter方法使用快速添加的方式往sync queue尾部添加结点，如果sync queue队列还没有初始化，则会使用enq插入队列中，enq方法源码如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>private Node enq(final Node node) {
    for (;;) { // 无限循环，确保结点能够成功入队列
        // 保存尾结点
        Node t = tail;
        if (t == null) { // 尾结点为空，即还没被初始化
            if (compareAndSetHead(new Node())) // 头节点为空，并设置头节点为新生成的结点
                tail = head; // 头节点与尾结点都指向同一个新生结点
        } else { // 尾结点不为空，即已经被初始化过
            // 将node结点的prev域连接到尾结点
            node.prev = t; 
            if (compareAndSetTail(t, node)) { // 比较结点t是否为尾结点，若是则将尾结点设置为node
                // 设置尾结点的next域为node
                t.next = node; 
                return t; // 返回尾结点
            }
        }
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>enq方法会使用无限循环来确保节点的成功插入。</p> <p>现在，分析acquireQueue方法。其源码如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// sync队列中的结点在独占且忽略中断的模式下获取(资源)
final boolean acquireQueued(final Node node, int arg) {
    // 标志
    boolean failed = true;
    try {
        // 中断标志
        boolean interrupted = false;
        for (;;) { // 无限循环
            // 获取node节点的前驱结点
            final Node p = node.predecessor(); 
            if (p == head &amp;&amp; tryAcquire(arg)) { // 前驱为头节点并且成功获得锁
                setHead(node); // 设置头节点
                p.next = null; // help GC
                failed = false; // 设置标志
                return interrupted; 
            }
            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;
                parkAndCheckInterrupt())
                interrupted = true;
        }
    } finally {
        if (failed)
            cancelAcquire(node);
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>首先获取当前节点的前驱节点，如果前驱节点是头节点并且能够获取(资源)，代表该当前节点能够占有锁，设置头节点为当前节点，返回。否则，调用shouldParkAfterFailedAcquire和parkAndCheckInterrupt方法，首先，我们看shouldParkAfterFailedAcquire方法，代码如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 当获取(资源)失败后，检查并且更新结点状态
private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {
    // 获取前驱结点的状态
    int ws = pred.waitStatus;
    if (ws == Node.SIGNAL) // 状态为SIGNAL，为-1
        /*
            * This node has already set status asking a release
            * to signal it, so it can safely park.
            */
        // 可以进行park操作
        return true; 
    if (ws &gt; 0) { // 表示状态为CANCELLED，为1
        /*
            * Predecessor was cancelled. Skip over predecessors and
            * indicate retry.
            */
        do {
            node.prev = pred = pred.prev;
        } while (pred.waitStatus &gt; 0); // 找到pred结点前面最近的一个状态不为CANCELLED的结点
        // 赋值pred结点的next域
        pred.next = node; 
    } else { // 为PROPAGATE -3 或者是0 表示无状态,(为CONDITION -2时，表示此节点在condition queue中) 
        /*
            * waitStatus must be 0 or PROPAGATE.  Indicate that we
            * need a signal, but don't park yet.  Caller will need to
            * retry to make sure it cannot acquire before parking.
            */
        // 比较并设置前驱结点的状态为SIGNAL
        compareAndSetWaitStatus(pred, ws, Node.SIGNAL); 
    }
    // 不能进行park操作
    return false;
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>只有当该节点的前驱结点的状态为SIGNAL时，才可以对该结点所封装的线程进行park操作。否则，将不能进行park操作。再看parkAndCheckInterrupt方法，源码如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 进行park操作并且返回该线程是否被中断
private final boolean parkAndCheckInterrupt() {
    // 在许可可用之前禁用当前线程，并且设置了blocker
    LockSupport.park(this);
    return Thread.interrupted(); // 当前线程是否已被中断，并清除中断标记位
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>parkAndCheckInterrupt方法里的逻辑是首先执行park操作，即禁用当前线程，然后返回该线程是否已经被中断。再看final块中的cancelAcquire方法，其源码如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 取消继续获取(资源)
private void cancelAcquire(Node node) {
    // Ignore if node doesn't exist
    // node为空，返回
    if (node == null)
        return;
    // 设置node结点的thread为空
    node.thread = null;

    // Skip cancelled predecessors
    // 保存node的前驱结点
    Node pred = node.prev;
    while (pred.waitStatus &gt; 0) // 找到node前驱结点中第一个状态小于0的结点，即不为CANCELLED状态的结点
        node.prev = pred = pred.prev;

    // predNext is the apparent node to unsplice. CASes below will
    // fail if not, in which case, we lost race vs another cancel
    // or signal, so no further action is necessary.
    // 获取pred结点的下一个结点
    Node predNext = pred.next;

    // Can use unconditional write instead of CAS here.
    // After this atomic step, other Nodes can skip past us.
    // Before, we are free of interference from other threads.
    // 设置node结点的状态为CANCELLED
    node.waitStatus = Node.CANCELLED;

    // If we are the tail, remove ourselves.
    if (node == tail &amp;&amp; compareAndSetTail(node, pred)) { // node结点为尾结点，则设置尾结点为pred结点
        // 比较并设置pred结点的next节点为null
        compareAndSetNext(pred, predNext, null); 
    } else { // node结点不为尾结点，或者比较设置不成功
        // If successor needs signal, try to set pred's next-link
        // so it will get one. Otherwise wake it up to propagate.
        int ws;
        if (pred != head &amp;&amp;
            ((ws = pred.waitStatus) == Node.SIGNAL ||
                (ws &lt;= 0 &amp;&amp; compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &amp;&amp;
            pred.thread != null) { // (pred结点不为头节点，并且pred结点的状态为SIGNAL)或者 
                                // pred结点状态小于等于0，并且比较并设置等待状态为SIGNAL成功，并且pred结点所封装的线程不为空
            // 保存结点的后继
            Node next = node.next;
            if (next != null &amp;&amp; next.waitStatus &lt;= 0) // 后继不为空并且后继的状态小于等于0
                compareAndSetNext(pred, predNext, next); // 比较并设置pred.next = next;
        } else {
            unparkSuccessor(node); // 释放node的前一个结点
        }

        node.next = node; // help GC
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>该方法完成的功能就是取消当前线程对资源的获取，即设置该结点的状态为CANCELLED，接着我们再看unparkSuccessor方法，源码如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 释放后继结点
private void unparkSuccessor(Node node) {
    /*
        * If status is negative (i.e., possibly needing signal) try
        * to clear in anticipation of signalling.  It is OK if this
        * fails or if status is changed by waiting thread.
        */
    // 获取node结点的等待状态
    int ws = node.waitStatus;
    if (ws &lt; 0) // 状态值小于0，为SIGNAL -1 或 CONDITION -2 或 PROPAGATE -3
        // 比较并且设置结点等待状态，设置为0
        compareAndSetWaitStatus(node, ws, 0);

    /*
        * Thread to unpark is held in successor, which is normally
        * just the next node.  But if cancelled or apparently null,
        * traverse backwards from tail to find the actual
        * non-cancelled successor.
        */
    // 获取node节点的下一个结点
    Node s = node.next;
    if (s == null || s.waitStatus &gt; 0) { // 下一个结点为空或者下一个节点的等待状态大于0，即为CANCELLED
        // s赋值为空
        s = null; 
        // 从尾结点开始从后往前开始遍历
        for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev)
            if (t.waitStatus &lt;= 0) // 找到等待状态小于等于0的结点，找到最前的状态小于等于0的结点
                // 保存结点
                s = t;
    }
    if (s != null) // 该结点不为为空，释放许可
        LockSupport.unpark(s.thread);
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>该方法的作用就是为了释放node节点的后继结点。</p> <p>对于cancelAcquire与unparkSuccessor方法，如下示意图可以清晰的表示:</p> <p><img src="data:image/png;base64,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" alt="image"></p> <p>其中node为参数，在执行完cancelAcquire方法后的效果就是unpark了s结点所包含的t4线程。</p> <p>现在，再来看acquireQueued方法的整个的逻辑。逻辑如下:</p> <ul><li>判断结点的前驱是否为head并且是否成功获取(资源)。</li> <li>若步骤1均满足，则设置结点为head，之后会判断是否finally模块，然后返回。</li> <li>若步骤2不满足，则判断是否需要park当前线程，是否需要park当前线程的逻辑是判断结点的前驱结点的状态是否为SIGNAL，若是，则park当前结点，否则，不进行park操作。</li> <li>若park了当前线程，之后某个线程对本线程unpark后，并且本线程也获得机会运行。那么，将会继续进行步骤①的判断。</li></ul> <h3 id="类的核心方法-release方法"><a href="#类的核心方法-release方法" class="header-anchor">#</a> 类的核心方法 - release方法</h3> <p>以独占模式释放对象，其源码如下:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public final boolean release(int arg) {
    if (tryRelease(arg)) { // 释放成功
        // 保存头节点
        Node h = head; 
        if (h != null &amp;&amp; h.waitStatus != 0) // 头节点不为空并且头节点状态不为0
            unparkSuccessor(h); //释放头节点的后继结点
        return true;
    }
    return false;
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>其中，tryRelease的默认实现是抛出异常，需要具体的子类实现，如果tryRelease成功，那么如果头节点不为空并且头节点的状态不为0，则释放头节点的后继结点，unparkSuccessor方法已经分析过，不再累赘。</p> <p>对于其他方法我们也可以分析，与前面分析的方法大同小异，所以，不再累赘。</p> <h2 id="abstractqueuedsynchronizer示例详解一"><a href="#abstractqueuedsynchronizer示例详解一" class="header-anchor">#</a> AbstractQueuedSynchronizer示例详解一</h2> <hr> <p>借助下面示例来分析AbstractQueuedSyncrhonizer内部的工作机制。示例源码如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

class MyThread extends Thread {
    private Lock lock;
    public MyThread(String name, Lock lock) {
        super(name);
        this.lock = lock;
    }
    
    public void run () {
        lock.lock();
        try {
            System.out.println(Thread.currentThread() + &quot; running&quot;);
        } finally {
            lock.unlock();
        }
    }
}
public class AbstractQueuedSynchronizerDemo {
    public static void main(String[] args) {
        Lock lock = new ReentrantLock();
        
        MyThread t1 = new MyThread(&quot;t1&quot;, lock);
        MyThread t2 = new MyThread(&quot;t2&quot;, lock);
        t1.start();
        t2.start();    
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>运行结果(可能的一种):</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Thread[t1,5,main] running
Thread[t2,5,main] running 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>结果分析: 从示例可知，线程t1与t2共用了一把锁，即同一个lock。可能会存在如下一种时序。</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASUAAAEvCAIAAACMnkBGAAAQRUlEQVR4Xu3dQXLjthaFYe4gE8/Sc1VlBz1NVXcvwgvIVFvIPJvQAt5mvBrP+qF9ZQS5lEhegIKgo/8rDNw0RQm4OCYot6npJ4BeJr8BwM2QN6Af8gb0Q96Afsgb0A95A/ohb0A/5A3opzVvp9Pp+49vL7//NuG6ND5plNJY+eEbDwXdorqgTXlLT3n4+iU96/v7u/8eCml83t7e0lilEfPfGwkF3ai6oPV5S1VJz0dhtnj/kL6w2ey/PQYKul11QevzVnc+fXL2Q9FvHQMFrRAtaH3e0iqWn4VRacTSuPmtY6CgFaIFDezqhJ4G2bDjNuwLG1xo3AK7OqGnQTbsuA37wgYXGrfArk7oaZANO27DvrDBhcYtsKsTehpkw47bsC9scKFxC+zqhJ7mpk6n08vvv7mN9hvbt7c3t/3uxhk3Z6gXlspXvlmavp4+jfYmamjcArs6oae5KZc3q01KGnkLGeqFubzl15aLm791d6FxC+zqhJ7mdv7+++/PH3y//pdN3k7eosZ5Ybmg06Wz2WhlDY1bYFcn9DQ3dXE9Sd6ihnph7vyWDVjW0LgFdnVCT3NT5G0XQ72wa3n7/uNbWtH4rXcVGrfArk7oaW6KvO1iqBd2MW8pafNC311o3AK7OqGnuSnytouhXtg8b3ahXm4ZROhVBXZ1Qk9zUxatixvJ23ZDvTC3bhzzzGZC4xbY1Qk9za3Zb9vsj5HK39WYoVI31LiVhnphuYhvH8pqTp+FHsQUGbfArk7oaZANO27DvrDBhcYtsKsTehpkw47bsC9scKFxC+zqhJ4G2bDjNuwLG1xo3AK7OhN/nhgX/fPEnihohWhBA7s6h69fhnof4iG8Bf/8vicKWiFa0Pq8nbi9TFAaqwH/e0RGQaMqClqft5+ft09LEadIy94/bp+Whiu1kceKgm5UXdCmvKVnSuFOFZqwJo1SGqtQbfqjoNvVFbQpb8OaIpewGJ9MQUW64ciUB0amoCLdcGTKAyNTUJFuOKG3jDA+mYJq5g0YE3kD+tHMm8zyA0amoJp5k7m8hpEpqEg3HJnywMgUVKQbjkx5YGQKKtINR2a5DyNTUM28AWMib0A/mnmTWX7AyBRUM28yl9cwMgUV6YYjUx4YmYKKdMORKQ+MTEFFuuHILPdhZAqqmTdgTOQN6EczbzLLDxiZgmrmTebyGkamoCLdcGTKAyNTUJFuODLlgZEpqEg3HJnlPoxMQTXzBoyJvAH9aOZNZvkBI1NQzbzJXF7DyBRUpBuOTHlgZAoq0g1HpjwwMgUV6YYjs9yHkSmoZt6AMZE3oB/NvMksP2BkCqqZN5nLaxiZgop0w5EpD4xMQUW64ciUB0amoCLdcGSW+zAyBdXMGzAm8gb0o5k3meUHjExBNfMmc3kNI1NQkW44MuWBkSmoSDccmfLAyBRUpBuOzHIfRqagmnkDxkTegH408yaz/ICRKahm3mQur2FkCirSDUemPDAyBRXphiNTHhiZgop0w5FZ7sPIFFQzb8CYyBvQj2beZJYfMDIF1cybzOU1jExBRbrhyJQHRqagIt1wZMoDI1NQkW44Mst9GJmCauYNGBN5A/rRzJvM8gNGpqD75O10On3/8e3l998mfEhDcfj6JQ2LHylUmXi/JLOk/fnXH8f//aBZe/3na2ppWNLg+PFCHHk7Sz/C06yaTziatTQ4MmuhOyJvZ+nnN2e2hZbOcmlh6UcNQTI/s1rzxslttcn8bEa71qmQJtN8htHKRt6QtU4F8rbayFs71pNn7XlLl3/pCme+fbmlRy0vZW902IpG3trJjGFrN8jbapOZK3ckM4at3SBvq01mrtyRzBi2dmP3vJX/SaXcLW+0Xz+UwbD/zLF82PxwF6foYSvapDJX7ojrt7Np17yVUzx9UU59y4N9bY+yL9JuF1NRHjbHye1fcdiKRt6QtU6FHfP2+s/X8mj2T/uPUfNnsWAspCIftjxl5cOWX7hHLR+2opE3ZK1TYT5lo63M23yxl/8j4vxRH8vAf09c8x1y3srwlDGuOGxFI2/tWE+e7Zu38mhbzm/2rYvZaDm/LRy2opG3djJj2NqN+ZSNtvL8Y2s5+7pc1JWz311o2RkpJWT+9cWHVxy2scnMlTuSGcPWbuybt2PxhuF8EWhynPJZK+1pL+Na3sqHVxy2sU0qc+WOZMawtRu7zEjtJjNX7ojrtzPyttrIG7LWqUDeVht5Q9Y6FcjbaiNv7VhPns1/hUVzjby1kxnD1m4cvn7Z5U1z1fb68Vt1P2oIIm9n3C9ouaWfRzJroTsib/+y++FxlnPt9eNOQWlw3t/f/ZAhSOZn1g55+/kxHPbbYWQvH3fCI2wo7ZM3AFto5k1m+QEjU1DNvE0ql9cwMgUV6YYjUx4YmYKKdMORKQ+MTEFFuuHILPdhZAqqmTdgTOQN6EczbzLLDxiZgmrmTebyGkamoCLdcGTKAyNTUJFuODLlgZEpqEg3HJnlPoxMQTXzhj5Op9MT/l1I6nLquB+LbcgbKj3t3z3a3+yn7vsR2UAzbzLLj2Hxd/2p+xVnOc28TSqX18PivjX29/t+XNZozkvydmsT90GsuvNa+AEPoWIgEELejuQt4/rt1sjbkbyhm4q82acRzbcvN3vUwrViy2Hn20ONvKGTislaN8XJ2wNgPXlrFZO1boqTtwdQMRAIqZisboqX/zGljFPebp+MWebt4idgthw2f6vud4lTfJqFH/AQKgYCIfN5v9quTfHyU2kPxac926/4ct7Kj55dOGx+uB12vr08rPtWtFVMs/ADHkLFQCCkMW85YNZSkOyD1N32/KiFU1A+bE5m/lb+58Jhq8N2JG8Z12+3tm/e0qRfzptlY37MvEP5RW6rMV447JZG3tDJvnlbDcbrx38RvpgNl7fy4fmf1w5r37KnrmjkDZ005q1cH2650MpfWDbmX88fXl7vXTtsfrhL48ZG3s5YT95aY96OxRuG7lApJLaxjJPlIb+zci1v5cPd9d7Fw9q3yjdsQm0ib6ZiIBBSTvGnbRXTLPyAh1AxEAghb0fyllUMBELI25G8ZVy/3Rp5O5I3dEPejuQN3di76vMp+Dzt9eNXgn5c1mjmjfXkrXG/oPQTp2Kaaeat4kSPqGe+H14KW+r++/u7H5Q1mvOSvHWQZlv6AV/+2vpJ2JmtImw/yRsegkxBRbrhVCysMTKZgu6Tt+e8j/yyQ8Nd5qFqh7w97XXzcrP3i+vuMg9VrXnjfeHlVveuMRyZMWzNW/r5Xf3nes/Q7L1jP2oImni/xHByW20yc+WOZMawtRsT/49urcnMlTuSGcPWbpC31SYzV+6I67cz8rbayBuy1qmwPW/lPVu2tz//+qPiUQut7oDlzWeijbwha50K5G21kbd2rCfPtuft+49vdRO94lELre6A5O2+ZMawtRvb8+bOb9MnN4/zdvu1XhmP6dLdcA+ft+Y9zm5yZs9YHs0d8FjcJi0/0G3PLyO/zpcrNx691iaVuXJHMmPY2g03TRdambcyAOX2l8/77NrXxyIe5bfcYa/lrUxLub18uvz1obgDqXtJ9ij7ovzWxiYzV+5IZgxbu1GRt/JccSxC4m7cac3icS1sx8W8lcGYinuG2nb3dPbP1+KGvuWz2GuuCNuRvO2B67ezeUKutXz95pJQTvT5NZKdmqbrN3lvydt8KZvzVm63Ry2/jIVG3pC1ToX51LzWWs5vF885+bDVeSufroz9/LnsNdu3opEjb8hap8I8IddauRgrZ+217e76zc4w9i33dU7vy8ebHHn7ct5s//x1+TLK7e76zZ76YvKvNfLWjvXkWV3e7ERhylSU2+fxOHy+pVHm7fjf9xLz9i15s+2m3Fhut/yXqT5c+lTbhTaRt2YyY9jajdDMe84mM1fuSGYMW7tB3labzFy5I5kxbO0GeVttMnPljrh+O5u/g09zjbwha50Kh6e/j/xye626yzxUteaN+wUttwP3C9qDzBi25u0n98O70l4b7jIPR2ZNvkM3nvY+8svSz6Dqu8zDmcjbyGTKAyNTUJFuODLLfRiZgmrmDRgTeQP60cybzPIDRqagmnmTubyGkSmoSDccmfLAyBRUpBuOTHlgZAoq0g1HZrkPI1NQzbwBYyJvWMGHs88daj+cXTNvMsuPu7P/jJ5v4kSzZn9mVfHh7Jp5m1Qur++LP7ZabhV/bKU5L8nbLvhj4uVmf3LlR22R5rwkb7uYuDnNWovOtNjejyJ6lsdF5G21kTfshrytNvKG3ZC31UbefmE9uYvteTtUfVKXu7d8e6s7YHmz+mgjb79ERwEXkbfVFp1psb0fRXQUcNH2vPHh7BvF9n4U0VHARdvzVp7f6j78yO1srfyvLe4jiuyf5dHcAe2YxsUpb7eDl0d+ufGHs8f2fhRcv+1iiufNQpVDUk7fvN1+TXws4nHtv4wt5G0qQpu3uwDnx5Y/Dspj2gPzEcrdNjbyht1U5M2dYfJULlNRfvew+OHsC3nLz2IJLw/odi73KXfOzXauCNuRvGFH86l5rS1/OPt8u7U/1z4VfXve3AL14st4rf2M+IVG3n5hPbmL7XlrOb+VgZkftjpv0fObfSsaOfL2S3QUcNF8al5rOQBu1uYTVLn9dXb9ZmcYe0j5dZmrqXjbYzVvtn9+Ge445cuzR+UvriX/WovOtNjejyI6CrioIm/H/74PWZ4uyu3zeByufDh7eahQ3sqnyxvd9vyo8sjT5l4fyZuJjgIuCs2852zRmRbb+1Fw/bYL8rbayBt2Q95WG3nDbsjbaiNvv7Ce3MWB+yksttf4h7Nr5i36UwcXcb+g5XbgfkGGvO2FD2e/2OxXiBUfzq45L8nbXvhw9oteaj+cXXNeRs/yGJxMQTXzBoyJvAH9aOZNZvkBI1NQzbxNvF+iRaagIt1wZMoDI1NQkW44MuWBkSmoSDccmeU+jExBNfMGjIm8Af1o5k1m+QEjU1DNvMlcXsPIFFSkG45MeWBkCirSDUemPDAyBRXphiOz3IeRKahm3oAxkTegH828ySw/YGQKqpk3mctrGJmCinTDkSkPjExBRbrhyJQHRqagIt1wZJb7MDIF1cwbMCbyBvSjmTeZ5QeMTEE18yZzeQ0jU1CRbjgy5YGRKahINxyZ8sDIFFSkG47Mch9GpqCaeQPGRN6AfjTzJrP8gJEpqGbeZC6vYWQKKtINR6Y8MDIFFemGI1MeGJmCinTDkVnuw8gUVDNvwJjIG9CPZt5klh8wMgXVzJvM5TWMTEFFuuHIlAdGpqAi3XBkygMjU1CRbjgyy30YmYJq5g0YE3kD+tHMm8zyA0amoJp5k7m8hpEpqEg3HJnywMgUVKQbjkx5YGQKKtINR2a5DyNTUM28AWMib0A/mnmTWX7AyBRUM28yl9cwMgUV6YYjUx4YmYKKdMORKQ+MTEFFuuHILPdhZAqqmTdgTOQN6EczbzLLDxiZgmrmTebyGkamoCLdcGTKAyNTUJFuODLlgZEpqEg3HJnlPoxMQTXzBoyJvAH9kDegH/IG9EPegH7IG9APeQP6IW9AP+QN6Ie8Af2QN6Af8gb0839mCxZS/MEmTwAAAABJRU5ErkJggg==" alt="image"></p> <p>说明: 首先线程t1先执行lock.lock操作，然后t2执行lock.lock操作，然后t1执行lock.unlock操作，最后t2执行lock.unlock操作。基于这样的时序，分析AbstractQueuedSynchronizer内部的工作机制。</p> <ul><li>t1线程调用lock.lock方法，其方法调用顺序如下，只给出了主要的方法调用。</li></ul> <p><img src="data:image/png;base64,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" alt="image"></p> <p>说明: 其中，前面的部分表示哪个类，后面是具体的类中的哪个方法，AQS表示AbstractQueuedSynchronizer类，AOS表示AbstractOwnableSynchronizer类。</p> <ul><li>t2线程调用lock.lock方法，其方法调用顺序如下，只给出了主要的方法调用。</li></ul> <p><img src="/assets/img/thread_java-thread-x-juc-aqs-6.8297388c.png" alt="image"></p> <p>说明: 经过一系列的方法调用，最后达到的状态是禁用t2线程，因为调用了LockSupport.park。</p> <ul><li>t1线程调用lock.unlock，其方法调用顺序如下，只给出了主要的方法调用。</li></ul> <p><img src="/assets/img/thread_java-thread-x-juc-aqs-7.52370ac0.png" alt="image"></p> <p>说明: t1线程中调用lock.unlock后，经过一系列的调用，最终的状态是释放了许可，因为调用了LockSupport.unpark。这时，t2线程就可以继续运行了。此时，会继续恢复t2线程运行环境，继续执行LockSupport.park后面的语句，即进一步调用如下。</p> <p><img src="/assets/img/thread_java-thread-x-juc-aqs-8.438932dd.png" alt="image"></p> <p>说明: 在上一步调用了LockSupport.unpark后，t2线程恢复运行，则运行parkAndCheckInterrupt，之后，继续运行acquireQueued方法，最后达到的状态是头节点head与尾结点tail均指向了t2线程所在的结点，并且之前的头节点已经从sync队列中断开了。</p> <ul><li>t2线程调用lock.unlock，其方法调用顺序如下，只给出了主要的方法调用。</li></ul> <p><img src="/assets/img/thread_java-thread-x-juc-aqs-9.91faefdf.png" alt="image"></p> <p>说明: t2线程执行lock.unlock后，最终达到的状态还是与之前的状态一样。</p> <h2 id="abstractqueuedsynchronizer示例详解二"><a href="#abstractqueuedsynchronizer示例详解二" class="header-anchor">#</a> AbstractQueuedSynchronizer示例详解二</h2> <hr> <p>下面我们结合Condition实现生产者与消费者，来进一步分析AbstractQueuedSynchronizer的内部工作机制。</p> <ul><li>Depot(仓库)类</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.locks.Condition;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

public class Depot {
    private int size;
    private int capacity;
    private Lock lock;
    private Condition fullCondition;
    private Condition emptyCondition;
    
    public Depot(int capacity) {
        this.capacity = capacity;    
        lock = new ReentrantLock();
        fullCondition = lock.newCondition();
        emptyCondition = lock.newCondition();
    }
    
    public void produce(int no) {
        lock.lock();
        int left = no;
        try {
            while (left &gt; 0) {
                while (size &gt;= capacity)  {
                    System.out.println(Thread.currentThread() + &quot; before await&quot;);
                    fullCondition.await();
                    System.out.println(Thread.currentThread() + &quot; after await&quot;);
                }
                int inc = (left + size) &gt; capacity ? (capacity - size) : left;
                left -= inc;
                size += inc;
                System.out.println(&quot;produce = &quot; + inc + &quot;, size = &quot; + size);
                emptyCondition.signal();
            }
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
    }
    
    public void consume(int no) {
        lock.lock();
        int left = no;
        try {            
            while (left &gt; 0) {
                while (size &lt;= 0) {
                    System.out.println(Thread.currentThread() + &quot; before await&quot;);
                    emptyCondition.await();
                    System.out.println(Thread.currentThread() + &quot; after await&quot;);
                }
                int dec = (size - left) &gt; 0 ? left : size;
                left -= dec;
                size -= dec;
                System.out.println(&quot;consume = &quot; + dec + &quot;, size = &quot; + size);
                fullCondition.signal();
            }
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><ul><li>测试类</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>class Consumer {
    private Depot depot;
    public Consumer(Depot depot) {
        this.depot = depot;
    }
    
    public void consume(int no) {
        new Thread(new Runnable() {
            @Override
            public void run() {
                depot.consume(no);
            }
        }, no + &quot; consume thread&quot;).start();
    }
}

class Producer {
    private Depot depot;
    public Producer(Depot depot) {
        this.depot = depot;
    }
    
    public void produce(int no) {
        new Thread(new Runnable() {
            
            @Override
            public void run() {
                depot.produce(no);
            }
        }, no + &quot; produce thread&quot;).start();
    }
}

public class ReentrantLockDemo {
    public static void main(String[] args) throws InterruptedException {
        Depot depot = new Depot(500);
        new Producer(depot).produce(500);
        new Producer(depot).produce(200);
        new Consumer(depot).consume(500);
        new Consumer(depot).consume(200);
    }
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><ul><li>运行结果(可能的一种):</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>produce = 500, size = 500
Thread[200 produce thread,5,main] before await
consume = 500, size = 0
Thread[200 consume thread,5,main] before await
Thread[200 produce thread,5,main] after await
produce = 200, size = 200
Thread[200 consume thread,5,main] after await
consume = 200, size = 0 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>说明: 根据结果，我们猜测一种可能的时序如下</p> <p><img src="/assets/img/thread_java-thread-x-juc-aqs-10.52756dbd.png" alt="image"></p> <p>说明: p1代表produce 500的那个线程，p2代表produce 200的那个线程，c1代表consume 500的那个线程，c2代表consume 200的那个线程。</p> <ul><li>p1线程调用lock.lock，获得锁，继续运行，方法调用顺序在前面已经给出。</li> <li>p2线程调用lock.lock，由前面的分析可得到如下的最终状态。</li></ul> <p><img src="data:image/png;base64,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" alt="image"></p> <p>说明: p2线程调用lock.lock后，会禁止p2线程的继续运行，因为执行了LockSupport.park操作。</p> <ul><li>c1线程调用lock.lock，由前面的分析得到如下的最终状态。</li></ul> <p><img src="data:image/png;base64,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" alt="image"></p> <p>说明: 最终c1线程会在sync queue队列的尾部，并且其结点的前驱结点(包含p2的结点)的waitStatus变为了SIGNAL。</p> <ul><li>c2线程调用lock.lock，由前面的分析得到如下的最终状态。</li></ul> <p><img src="/assets/img/thread_java-thread-x-juc-aqs-13.56330aa6.png" alt="image"></p> <p>说明: 最终c1线程会在sync queue队列的尾部，并且其结点的前驱结点(包含c1的结点)的waitStatus变为了SIGNAL。</p> <ul><li>p1线程执行emptyCondition.signal，其方法调用顺序如下，只给出了主要的方法调用。</li></ul> <p><img src="data:image/png;base64,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" alt="image"></p> <p>说明: AQS.CO表示AbstractQueuedSynchronizer.ConditionObject类。此时调用signal方法不会产生任何其他效果。</p> <ul><li>p1线程执行lock.unlock，根据前面的分析可知，最终的状态如下。</li></ul> <p><img src="data:image/png;base64,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" alt="image"></p> <p>说明: 此时，p2线程所在的结点为头节点，并且其他两个线程(c1、c2)依旧被禁止，所以，此时p2线程继续运行，执行用户逻辑。</p> <ul><li>p2线程执行fullCondition.await，其方法调用顺序如下，只给出了主要的方法调用。</li></ul> <p><img src="/assets/img/thread_java-thread-x-juc-aqs-17-1.636ddd83.png" alt="image"></p> <p>说明: 最终到达的状态是新生成了一个结点，包含了p2线程，此结点在condition queue中；并且sync queue中p2线程被禁止了，因为在执行了LockSupport.park操作。从方法一些调用可知，在await操作中线程会释放锁资源，供其他线程获取。同时，head结点后继结点的包含的线程的许可被释放了，故其可以继续运行。由于此时，只有c1线程可以运行，故运行c1。</p> <ul><li>继续运行c1线程，c1线程由于之前被park了，所以此时恢复，继续之前的步骤，即还是执行前面提到的acquireQueued方法，之后，c1判断自己的前驱结点为head，并且可以获取锁资源，最终到达的状态如下。</li></ul> <p><img src="data:image/png;base64,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" alt="image"></p> <p>说明: 其中，head设置为包含c1线程的结点，c1继续运行。</p> <ul><li>c1线程执行fullCondtion.signal，其方法调用顺序如下，只给出了主要的方法调用。</li></ul> <p><img src="/assets/img/thread_java-thread-x-juc-aqs-17.2d6f5830.png" alt="image"></p> <p>说明: signal方法达到的最终结果是将包含p2线程的结点从condition queue中转移到sync queue中，之后condition queue为null，之前的尾结点的状态变为SIGNAL。</p> <ul><li>c1线程执行lock.unlock操作，根据之前的分析，经历的状态变化如下。</li></ul> <p><img src="/assets/img/thread_java-thread-x-juc-aqs-18.d2fecd83.png" alt="image"></p> <p>说明: 最终c2线程会获取锁资源，继续运行用户逻辑。</p> <ul><li>c2线程执行emptyCondition.await，由前面的第七步分析，可知最终的状态如下。</li></ul> <p><img src="/assets/img/thread_java-thread-x-juc-aqs-19.fe3093ba.png" alt="image"></p> <p>说明: await操作将会生成一个结点放入condition queue中与之前的一个condition queue是不相同的，并且unpark头节点后面的结点，即包含线程p2的结点。</p> <ul><li>p2线程被unpark，故可以继续运行，经过CPU调度后，p2继续运行，之后p2线程在AQS:await方法中被park，继续AQS.CO:await方法的运行，其方法调用顺序如下，只给出了主要的方法调用。</li></ul> <p><img src="/assets/img/thread_java-thread-x-juc-aqs-20.161de33f.png" alt="image"></p> <ul><li>p2继续运行，执行emptyCondition.signal，根据第九步分析可知，最终到达的状态如下。</li></ul> <p><img src="data:image/png;base64,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" alt="image"></p> <p>说明: 最终，将condition queue中的结点转移到sync queue中，并添加至尾部，condition queue会为空，并且将head的状态设置为SIGNAL。</p> <ul><li>p2线程执行lock.unlock操作，根据前面的分析可知，最后的到达的状态如下。</li></ul> <p><img src="data:image/png;base64,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" alt="image"></p> <p>说明: unlock操作会释放c2线程的许可，并且将头节点设置为c2线程所在的结点。</p> <ul><li><p>c2线程继续运行，执行fullCondition. signal，由于此时fullCondition的condition queue已经不存在任何结点了，故其不会产生作用。</p></li> <li><p>c2执行lock.unlock，由于c2是sync队列中最后一个结点，故其不会再调用unparkSuccessor了，直接返回true。即整个流程就完成了。</p></li></ul> <h2 id="abstractqueuedsynchronizer总结"><a href="#abstractqueuedsynchronizer总结" class="header-anchor">#</a> AbstractQueuedSynchronizer总结</h2> <hr> <p>对于AbstractQueuedSynchronizer的分析，最核心的就是sync queue的分析。</p> <ul><li>每一个结点都是由前一个结点唤醒</li> <li>当结点发现前驱结点是head并且尝试获取成功，则会轮到该线程运行。</li> <li>condition queue中的结点向sync queue中转移是通过signal操作完成的。</li> <li>当结点的状态为SIGNAL时，表示后面的结点需要运行。</li></ul> <h2 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h2> <hr> <ul><li>文章主要参考自leesf的https://www.cnblogs.com/leesf456/p/5350186.html，在此基础上做了增改。</li> <li>http://ifeve.com/introduce-abstractqueuedsynchronizer/</li> <li>http://blog.csdn.net/chen77716/article/details/6641477</li> <li>https://blog.csdn.net/mulinsen77/article/details/84583716</li></ul></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://fanxgit.github.io/fanxNotes/edit/master/docs/Java/03.Java多线程与并发/11.JUC锁-锁核心类AQS详解.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/16/2023, 3:53:15 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/3f52bd/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">JUC锁-LockSupport详解</div></a> <a href="/pages/e5e4ff/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">JUC锁-ReentrantLock详解</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/3f52bd/" class="prev">JUC锁-LockSupport详解</a></span> <span class="next"><a href="/pages/e5e4ff/">JUC锁-ReentrantLock详解</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/797621/"><div>
            VuePress+GithubPages教程
            <!----></div></a> <span class="date">11-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/016620/"><div>
            java打jar包整理
            <!----></div></a> <span class="date">11-19</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/b23a10/"><div>
            多线程问题总结
            <!----></div></a> <span class="date">11-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.38fd400a.js" defer></script><script src="/assets/js/3.e11db813.js" defer></script><script src="/assets/js/21.ae1e88a3.js" defer></script>
  </body>
</html>
