<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>activiti7实战 | Fanx 知识库</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/logo.svg">[object Object]
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.6ece31e0.css" as="style"><link rel="preload" href="/assets/js/app.38fd400a.js" as="script"><link rel="preload" href="/assets/js/3.e11db813.js" as="script"><link rel="preload" href="/assets/js/16.ace3b806.js" as="script"><link rel="prefetch" href="/assets/js/10.939e2dd4.js"><link rel="prefetch" href="/assets/js/100.4a08f581.js"><link rel="prefetch" href="/assets/js/101.45cd45c9.js"><link rel="prefetch" href="/assets/js/102.ac1359d1.js"><link rel="prefetch" href="/assets/js/103.22344102.js"><link rel="prefetch" href="/assets/js/104.5071cdfd.js"><link rel="prefetch" href="/assets/js/105.7767c121.js"><link rel="prefetch" href="/assets/js/106.809b79f1.js"><link rel="prefetch" href="/assets/js/107.62fd626a.js"><link rel="prefetch" href="/assets/js/108.0583fdc1.js"><link rel="prefetch" href="/assets/js/109.fa127771.js"><link rel="prefetch" href="/assets/js/11.6463adc8.js"><link rel="prefetch" href="/assets/js/110.5cf9f09c.js"><link rel="prefetch" href="/assets/js/111.9d963667.js"><link rel="prefetch" href="/assets/js/112.bc2b8a6e.js"><link rel="prefetch" href="/assets/js/113.2ae29573.js"><link rel="prefetch" href="/assets/js/114.0b2cedfa.js"><link rel="prefetch" href="/assets/js/115.652e433e.js"><link rel="prefetch" href="/assets/js/116.bcc5d64a.js"><link rel="prefetch" href="/assets/js/117.30b02d0d.js"><link rel="prefetch" href="/assets/js/118.87f4f927.js"><link rel="prefetch" href="/assets/js/119.05839492.js"><link rel="prefetch" href="/assets/js/12.a17960e5.js"><link rel="prefetch" href="/assets/js/120.3d772c9c.js"><link rel="prefetch" href="/assets/js/121.bd8fcebf.js"><link rel="prefetch" href="/assets/js/122.e58d2205.js"><link rel="prefetch" href="/assets/js/123.f2c2826d.js"><link rel="prefetch" href="/assets/js/124.12d9ff87.js"><link rel="prefetch" href="/assets/js/125.c7e4bf1c.js"><link rel="prefetch" href="/assets/js/126.71c358fb.js"><link rel="prefetch" href="/assets/js/127.fb1922e5.js"><link rel="prefetch" href="/assets/js/128.25cbf771.js"><link rel="prefetch" href="/assets/js/129.50047ea3.js"><link rel="prefetch" href="/assets/js/13.727ebfda.js"><link rel="prefetch" href="/assets/js/130.a77cfa28.js"><link rel="prefetch" href="/assets/js/131.1618c1f5.js"><link rel="prefetch" href="/assets/js/132.4073573b.js"><link rel="prefetch" href="/assets/js/133.f6e4882f.js"><link rel="prefetch" href="/assets/js/134.1de81973.js"><link rel="prefetch" href="/assets/js/135.43148a0c.js"><link rel="prefetch" href="/assets/js/136.12b3ef34.js"><link rel="prefetch" href="/assets/js/137.accefc34.js"><link rel="prefetch" href="/assets/js/138.8d3115ff.js"><link rel="prefetch" href="/assets/js/139.6e492e2b.js"><link rel="prefetch" href="/assets/js/14.bc6d3062.js"><link rel="prefetch" href="/assets/js/140.3d98f006.js"><link rel="prefetch" href="/assets/js/141.542d08af.js"><link rel="prefetch" href="/assets/js/142.c91a19a2.js"><link rel="prefetch" href="/assets/js/143.0c681ed2.js"><link rel="prefetch" href="/assets/js/144.62e9c646.js"><link rel="prefetch" href="/assets/js/145.ebc34777.js"><link rel="prefetch" href="/assets/js/146.d94a04a7.js"><link rel="prefetch" href="/assets/js/147.b45158de.js"><link rel="prefetch" href="/assets/js/148.5dfa6740.js"><link rel="prefetch" href="/assets/js/149.cb6f2cb0.js"><link rel="prefetch" href="/assets/js/15.a9468bf1.js"><link rel="prefetch" href="/assets/js/150.9f58dbc6.js"><link rel="prefetch" href="/assets/js/151.0a1c07e3.js"><link rel="prefetch" href="/assets/js/152.eafe4843.js"><link rel="prefetch" href="/assets/js/153.fb94cab5.js"><link rel="prefetch" href="/assets/js/154.07f7a11d.js"><link rel="prefetch" href="/assets/js/155.7f6da40b.js"><link rel="prefetch" href="/assets/js/156.2f007ca1.js"><link rel="prefetch" href="/assets/js/157.a35b5249.js"><link rel="prefetch" href="/assets/js/158.540f7a5a.js"><link rel="prefetch" href="/assets/js/159.f62e0315.js"><link rel="prefetch" href="/assets/js/160.e043c758.js"><link rel="prefetch" href="/assets/js/161.d90141bf.js"><link rel="prefetch" href="/assets/js/162.ddcdbfb9.js"><link rel="prefetch" href="/assets/js/163.f1ba395e.js"><link rel="prefetch" href="/assets/js/164.9f398973.js"><link rel="prefetch" href="/assets/js/165.0db3da51.js"><link rel="prefetch" href="/assets/js/166.b5305797.js"><link rel="prefetch" href="/assets/js/167.e7b2f76b.js"><link rel="prefetch" href="/assets/js/168.a2ecf883.js"><link rel="prefetch" href="/assets/js/169.88bd4d26.js"><link rel="prefetch" href="/assets/js/17.60481837.js"><link rel="prefetch" href="/assets/js/170.fb1699e2.js"><link rel="prefetch" href="/assets/js/171.47268bef.js"><link rel="prefetch" href="/assets/js/172.79002327.js"><link rel="prefetch" href="/assets/js/173.3b1813fb.js"><link rel="prefetch" href="/assets/js/174.362811a9.js"><link rel="prefetch" href="/assets/js/175.bb48bcd7.js"><link rel="prefetch" href="/assets/js/176.97bbf32c.js"><link rel="prefetch" href="/assets/js/177.0717ff7a.js"><link rel="prefetch" href="/assets/js/178.75bff3b7.js"><link rel="prefetch" href="/assets/js/179.3e7db0a2.js"><link rel="prefetch" href="/assets/js/18.dd3c5709.js"><link rel="prefetch" href="/assets/js/180.c81da8dd.js"><link rel="prefetch" href="/assets/js/181.142d6d1c.js"><link rel="prefetch" href="/assets/js/182.fb312040.js"><link rel="prefetch" href="/assets/js/183.3684267e.js"><link rel="prefetch" href="/assets/js/184.ec2a13bc.js"><link rel="prefetch" href="/assets/js/185.a7acace4.js"><link rel="prefetch" href="/assets/js/186.7df28551.js"><link rel="prefetch" href="/assets/js/187.347e9348.js"><link rel="prefetch" href="/assets/js/188.07356026.js"><link rel="prefetch" href="/assets/js/189.0816176d.js"><link rel="prefetch" href="/assets/js/19.cc2d4ad1.js"><link rel="prefetch" href="/assets/js/190.fd5dd8cc.js"><link rel="prefetch" href="/assets/js/191.a938967e.js"><link rel="prefetch" href="/assets/js/192.859b71a1.js"><link rel="prefetch" href="/assets/js/193.adcf2ec3.js"><link rel="prefetch" href="/assets/js/194.69d1169c.js"><link rel="prefetch" href="/assets/js/195.ad7cbcc4.js"><link rel="prefetch" href="/assets/js/196.b65138da.js"><link rel="prefetch" href="/assets/js/197.b4fca73b.js"><link rel="prefetch" href="/assets/js/198.2494a23f.js"><link rel="prefetch" href="/assets/js/199.404b9ce1.js"><link rel="prefetch" href="/assets/js/2.938bab56.js"><link rel="prefetch" href="/assets/js/20.361e2bf6.js"><link rel="prefetch" href="/assets/js/200.42b54eae.js"><link rel="prefetch" href="/assets/js/201.ab495eb8.js"><link rel="prefetch" href="/assets/js/202.2cbc5c9a.js"><link rel="prefetch" href="/assets/js/203.abf3fde5.js"><link rel="prefetch" href="/assets/js/204.4fdd4cfb.js"><link rel="prefetch" href="/assets/js/205.411987d7.js"><link rel="prefetch" href="/assets/js/206.dbcab3ae.js"><link rel="prefetch" href="/assets/js/207.f1429354.js"><link rel="prefetch" href="/assets/js/208.f763286c.js"><link rel="prefetch" href="/assets/js/209.c1edbca5.js"><link rel="prefetch" href="/assets/js/21.ae1e88a3.js"><link rel="prefetch" href="/assets/js/210.b2a1501d.js"><link rel="prefetch" href="/assets/js/211.fe1fd5f7.js"><link rel="prefetch" href="/assets/js/212.0fd39a8f.js"><link rel="prefetch" href="/assets/js/213.bb3fc163.js"><link rel="prefetch" href="/assets/js/214.c42e1ef3.js"><link rel="prefetch" href="/assets/js/215.4f0fa915.js"><link rel="prefetch" href="/assets/js/216.07c485c9.js"><link rel="prefetch" href="/assets/js/217.ada25e7a.js"><link rel="prefetch" href="/assets/js/218.2f761d3c.js"><link rel="prefetch" href="/assets/js/219.32d1a663.js"><link rel="prefetch" href="/assets/js/22.0b09d67f.js"><link rel="prefetch" href="/assets/js/220.36c56cf4.js"><link rel="prefetch" href="/assets/js/221.3e0431e2.js"><link rel="prefetch" href="/assets/js/222.90aa0ff7.js"><link rel="prefetch" href="/assets/js/223.5966d7df.js"><link rel="prefetch" href="/assets/js/224.7e2329e1.js"><link rel="prefetch" href="/assets/js/225.2ed3675d.js"><link rel="prefetch" href="/assets/js/226.fa3cef02.js"><link rel="prefetch" href="/assets/js/227.07bf7bca.js"><link rel="prefetch" href="/assets/js/228.9ac2589a.js"><link rel="prefetch" href="/assets/js/229.b980e141.js"><link rel="prefetch" href="/assets/js/23.31ed5c2f.js"><link rel="prefetch" href="/assets/js/230.2c32e874.js"><link rel="prefetch" href="/assets/js/231.723e20cb.js"><link rel="prefetch" href="/assets/js/232.1f94511c.js"><link rel="prefetch" href="/assets/js/233.2d477f71.js"><link rel="prefetch" href="/assets/js/234.10141c75.js"><link rel="prefetch" href="/assets/js/235.a328b127.js"><link rel="prefetch" href="/assets/js/236.42419c3b.js"><link rel="prefetch" href="/assets/js/237.648ca44e.js"><link rel="prefetch" href="/assets/js/238.4b363b75.js"><link rel="prefetch" href="/assets/js/239.fe711a73.js"><link rel="prefetch" href="/assets/js/24.fe75e3fa.js"><link rel="prefetch" href="/assets/js/240.6baa12bf.js"><link rel="prefetch" href="/assets/js/241.6f375dc4.js"><link rel="prefetch" href="/assets/js/242.aee8e39d.js"><link rel="prefetch" href="/assets/js/243.bfc7f6e1.js"><link rel="prefetch" href="/assets/js/244.c73a14a7.js"><link rel="prefetch" href="/assets/js/245.a2352aa1.js"><link rel="prefetch" href="/assets/js/246.b12c3ae6.js"><link rel="prefetch" href="/assets/js/247.2f768275.js"><link rel="prefetch" href="/assets/js/248.3f79dfb1.js"><link rel="prefetch" href="/assets/js/249.7fd0cb75.js"><link rel="prefetch" href="/assets/js/25.f2e379df.js"><link rel="prefetch" href="/assets/js/250.df3f1d0a.js"><link rel="prefetch" href="/assets/js/251.a3865750.js"><link rel="prefetch" href="/assets/js/252.d62542df.js"><link rel="prefetch" href="/assets/js/253.59b2f200.js"><link rel="prefetch" href="/assets/js/254.522d17b5.js"><link rel="prefetch" href="/assets/js/255.0f95a196.js"><link rel="prefetch" href="/assets/js/256.31b37cbe.js"><link rel="prefetch" href="/assets/js/257.ff22ad12.js"><link rel="prefetch" href="/assets/js/258.15205e0b.js"><link rel="prefetch" href="/assets/js/259.f3b7c5aa.js"><link rel="prefetch" href="/assets/js/26.45264b04.js"><link rel="prefetch" href="/assets/js/260.fec3c7aa.js"><link rel="prefetch" href="/assets/js/261.d965ee56.js"><link rel="prefetch" href="/assets/js/262.76a7105b.js"><link rel="prefetch" href="/assets/js/263.e684cc46.js"><link rel="prefetch" href="/assets/js/264.59297da0.js"><link rel="prefetch" href="/assets/js/265.66182ed2.js"><link rel="prefetch" href="/assets/js/266.eec50d90.js"><link rel="prefetch" href="/assets/js/267.c85bce12.js"><link rel="prefetch" href="/assets/js/268.ef544f0c.js"><link rel="prefetch" href="/assets/js/269.8cfb5c6a.js"><link rel="prefetch" href="/assets/js/27.4e065810.js"><link rel="prefetch" href="/assets/js/270.b66cab3c.js"><link rel="prefetch" href="/assets/js/271.c1b7d136.js"><link rel="prefetch" href="/assets/js/272.0d7950c3.js"><link rel="prefetch" href="/assets/js/273.06349cca.js"><link rel="prefetch" href="/assets/js/274.9b442c09.js"><link rel="prefetch" href="/assets/js/275.11082d81.js"><link rel="prefetch" href="/assets/js/276.ce0abe31.js"><link rel="prefetch" href="/assets/js/277.4b7fcc53.js"><link rel="prefetch" href="/assets/js/278.129d0397.js"><link rel="prefetch" href="/assets/js/279.5c021f7c.js"><link rel="prefetch" href="/assets/js/28.126ecd33.js"><link rel="prefetch" href="/assets/js/280.d183c9e3.js"><link rel="prefetch" href="/assets/js/281.0df67750.js"><link rel="prefetch" href="/assets/js/282.8fdd2372.js"><link rel="prefetch" href="/assets/js/283.dae956df.js"><link rel="prefetch" href="/assets/js/284.c5dc7189.js"><link rel="prefetch" href="/assets/js/285.7f5a7367.js"><link rel="prefetch" href="/assets/js/286.d9bfcef5.js"><link rel="prefetch" href="/assets/js/287.4fa6a5c5.js"><link rel="prefetch" href="/assets/js/288.57904d2d.js"><link rel="prefetch" href="/assets/js/289.b96d7c2f.js"><link rel="prefetch" href="/assets/js/29.8f5db82a.js"><link rel="prefetch" href="/assets/js/290.8dda9646.js"><link rel="prefetch" href="/assets/js/291.ab433493.js"><link rel="prefetch" href="/assets/js/292.e2d59796.js"><link rel="prefetch" href="/assets/js/293.30f9fcc4.js"><link rel="prefetch" href="/assets/js/294.158492dc.js"><link rel="prefetch" href="/assets/js/295.33e3a53d.js"><link rel="prefetch" href="/assets/js/296.49d7a2de.js"><link rel="prefetch" href="/assets/js/297.1b7572ac.js"><link rel="prefetch" href="/assets/js/298.00e4586a.js"><link rel="prefetch" href="/assets/js/299.d8fb6ff9.js"><link rel="prefetch" href="/assets/js/30.ef97cb8e.js"><link rel="prefetch" href="/assets/js/300.90e9dadf.js"><link rel="prefetch" href="/assets/js/301.d5592ea1.js"><link rel="prefetch" href="/assets/js/302.b08dc1ea.js"><link rel="prefetch" href="/assets/js/303.bef541c8.js"><link rel="prefetch" href="/assets/js/304.be3f7081.js"><link rel="prefetch" href="/assets/js/305.13718421.js"><link rel="prefetch" href="/assets/js/306.41685aa2.js"><link rel="prefetch" href="/assets/js/307.6d569102.js"><link rel="prefetch" href="/assets/js/308.aaabab89.js"><link rel="prefetch" href="/assets/js/309.910ecc42.js"><link rel="prefetch" href="/assets/js/31.795b3334.js"><link rel="prefetch" href="/assets/js/310.104b7753.js"><link rel="prefetch" href="/assets/js/311.45f4a7da.js"><link rel="prefetch" href="/assets/js/312.180c7e45.js"><link rel="prefetch" href="/assets/js/313.87d3a801.js"><link rel="prefetch" href="/assets/js/314.7739b1ef.js"><link rel="prefetch" href="/assets/js/315.54a1fac0.js"><link rel="prefetch" href="/assets/js/316.a978a787.js"><link rel="prefetch" href="/assets/js/317.84f65f2c.js"><link rel="prefetch" href="/assets/js/318.7f8caff8.js"><link rel="prefetch" href="/assets/js/319.0b5276f3.js"><link rel="prefetch" href="/assets/js/32.e65c7229.js"><link rel="prefetch" href="/assets/js/320.ba90589a.js"><link rel="prefetch" href="/assets/js/321.b6810c5a.js"><link rel="prefetch" href="/assets/js/322.2eaa727d.js"><link rel="prefetch" href="/assets/js/323.17573ee3.js"><link rel="prefetch" href="/assets/js/324.806fd6ca.js"><link rel="prefetch" href="/assets/js/325.4cd65079.js"><link rel="prefetch" href="/assets/js/326.fe0e2e22.js"><link rel="prefetch" href="/assets/js/327.a64d0209.js"><link rel="prefetch" href="/assets/js/328.aca1c89a.js"><link rel="prefetch" href="/assets/js/329.53ccf1dd.js"><link rel="prefetch" href="/assets/js/33.9a57aab8.js"><link rel="prefetch" href="/assets/js/330.92822a09.js"><link rel="prefetch" href="/assets/js/331.6b82baff.js"><link rel="prefetch" href="/assets/js/332.fc20f585.js"><link rel="prefetch" href="/assets/js/333.005ba8e3.js"><link rel="prefetch" href="/assets/js/334.9d3309b8.js"><link rel="prefetch" href="/assets/js/335.0e938f19.js"><link rel="prefetch" href="/assets/js/336.01fe9903.js"><link rel="prefetch" href="/assets/js/337.e207d67c.js"><link rel="prefetch" href="/assets/js/338.bfcf6bc8.js"><link rel="prefetch" href="/assets/js/339.a502aa64.js"><link rel="prefetch" href="/assets/js/34.3835d35c.js"><link rel="prefetch" href="/assets/js/340.3888b147.js"><link rel="prefetch" href="/assets/js/341.20297f95.js"><link rel="prefetch" href="/assets/js/342.9cd149e9.js"><link rel="prefetch" href="/assets/js/343.faac8369.js"><link rel="prefetch" href="/assets/js/344.da8cd079.js"><link rel="prefetch" href="/assets/js/345.78303b88.js"><link rel="prefetch" href="/assets/js/346.d8eaca82.js"><link rel="prefetch" href="/assets/js/347.edd389a1.js"><link rel="prefetch" href="/assets/js/348.21ee9617.js"><link rel="prefetch" href="/assets/js/349.0251471a.js"><link rel="prefetch" href="/assets/js/35.76dc7096.js"><link rel="prefetch" href="/assets/js/350.710b7d30.js"><link rel="prefetch" href="/assets/js/351.535f8d60.js"><link rel="prefetch" href="/assets/js/352.c66fe42e.js"><link rel="prefetch" href="/assets/js/353.ebbcd333.js"><link rel="prefetch" href="/assets/js/354.7cbba2f1.js"><link rel="prefetch" href="/assets/js/355.0106db16.js"><link rel="prefetch" href="/assets/js/356.7debf350.js"><link rel="prefetch" href="/assets/js/357.a43eb887.js"><link rel="prefetch" href="/assets/js/358.28e5d2ed.js"><link rel="prefetch" href="/assets/js/359.956fc3b8.js"><link rel="prefetch" href="/assets/js/36.fc54452c.js"><link rel="prefetch" href="/assets/js/360.13fb600a.js"><link rel="prefetch" href="/assets/js/361.d100f85b.js"><link rel="prefetch" href="/assets/js/362.35277df2.js"><link rel="prefetch" href="/assets/js/363.d993a7fc.js"><link rel="prefetch" href="/assets/js/364.0168c2b0.js"><link rel="prefetch" href="/assets/js/365.bc8af0bb.js"><link rel="prefetch" href="/assets/js/366.2645dc0d.js"><link rel="prefetch" href="/assets/js/367.87368acb.js"><link rel="prefetch" href="/assets/js/368.0b7d41fc.js"><link rel="prefetch" href="/assets/js/369.4bf3f46e.js"><link rel="prefetch" href="/assets/js/37.5a47cee9.js"><link rel="prefetch" href="/assets/js/370.ea5f965e.js"><link rel="prefetch" href="/assets/js/371.1af764ef.js"><link rel="prefetch" href="/assets/js/372.bf6c68e2.js"><link rel="prefetch" href="/assets/js/373.1a605cc8.js"><link rel="prefetch" href="/assets/js/374.34a41a4a.js"><link rel="prefetch" href="/assets/js/375.1d2d3776.js"><link rel="prefetch" href="/assets/js/376.4b7b0b10.js"><link rel="prefetch" href="/assets/js/377.b3d9748a.js"><link rel="prefetch" href="/assets/js/378.7f00fa88.js"><link rel="prefetch" href="/assets/js/379.adcd298a.js"><link rel="prefetch" href="/assets/js/38.6614c565.js"><link rel="prefetch" href="/assets/js/380.6d08bb56.js"><link rel="prefetch" href="/assets/js/381.164bb4e3.js"><link rel="prefetch" href="/assets/js/382.f71f0ca4.js"><link rel="prefetch" href="/assets/js/383.01ba70ad.js"><link rel="prefetch" href="/assets/js/384.22b98cde.js"><link rel="prefetch" href="/assets/js/385.5f1298a9.js"><link rel="prefetch" href="/assets/js/386.01a912bc.js"><link rel="prefetch" href="/assets/js/387.3db4713f.js"><link rel="prefetch" href="/assets/js/388.4cde7d0f.js"><link rel="prefetch" href="/assets/js/389.d96bafad.js"><link rel="prefetch" href="/assets/js/39.1a09ed15.js"><link rel="prefetch" href="/assets/js/390.343bbc06.js"><link rel="prefetch" href="/assets/js/391.68b3e72a.js"><link rel="prefetch" href="/assets/js/392.f4f15e43.js"><link rel="prefetch" href="/assets/js/393.82475934.js"><link rel="prefetch" href="/assets/js/394.3101ea10.js"><link rel="prefetch" href="/assets/js/395.34083342.js"><link rel="prefetch" href="/assets/js/396.780d6efe.js"><link rel="prefetch" href="/assets/js/397.cb686f39.js"><link rel="prefetch" href="/assets/js/398.c4ad669f.js"><link rel="prefetch" href="/assets/js/399.ee8d28ad.js"><link rel="prefetch" href="/assets/js/4.c1dcb1a7.js"><link rel="prefetch" href="/assets/js/40.4216f4f9.js"><link rel="prefetch" href="/assets/js/400.23d48a38.js"><link rel="prefetch" href="/assets/js/401.319d7a68.js"><link rel="prefetch" href="/assets/js/402.25b27bd0.js"><link rel="prefetch" href="/assets/js/403.9a898a40.js"><link rel="prefetch" href="/assets/js/404.e3b49b79.js"><link rel="prefetch" href="/assets/js/405.7695b9f1.js"><link rel="prefetch" href="/assets/js/406.edb801f7.js"><link rel="prefetch" href="/assets/js/407.03c3f725.js"><link rel="prefetch" href="/assets/js/408.4345ef1f.js"><link rel="prefetch" href="/assets/js/409.77c34447.js"><link rel="prefetch" href="/assets/js/41.f035663a.js"><link rel="prefetch" href="/assets/js/410.7f6c0744.js"><link rel="prefetch" href="/assets/js/411.cb19323e.js"><link rel="prefetch" href="/assets/js/412.4b16959d.js"><link rel="prefetch" href="/assets/js/413.ff4f1ca2.js"><link rel="prefetch" href="/assets/js/414.b1ca1298.js"><link rel="prefetch" href="/assets/js/415.c2111593.js"><link rel="prefetch" href="/assets/js/416.a6d18039.js"><link rel="prefetch" href="/assets/js/417.dc36c66d.js"><link rel="prefetch" href="/assets/js/418.e7eba879.js"><link rel="prefetch" href="/assets/js/419.57673b9e.js"><link rel="prefetch" href="/assets/js/42.9c8cf569.js"><link rel="prefetch" href="/assets/js/420.ccd41fe0.js"><link rel="prefetch" href="/assets/js/421.ea69f0b0.js"><link rel="prefetch" href="/assets/js/422.093448e2.js"><link rel="prefetch" href="/assets/js/423.ae003f31.js"><link rel="prefetch" href="/assets/js/424.f670cd2b.js"><link rel="prefetch" href="/assets/js/425.6e814335.js"><link rel="prefetch" href="/assets/js/426.faf45206.js"><link rel="prefetch" href="/assets/js/427.cf6be942.js"><link rel="prefetch" href="/assets/js/428.9ff6199c.js"><link rel="prefetch" href="/assets/js/429.b6ef4678.js"><link rel="prefetch" href="/assets/js/43.717fe06b.js"><link rel="prefetch" href="/assets/js/430.e9575d07.js"><link rel="prefetch" href="/assets/js/431.8bf26a3e.js"><link rel="prefetch" href="/assets/js/432.5eaa2162.js"><link rel="prefetch" href="/assets/js/433.6dab12a1.js"><link rel="prefetch" href="/assets/js/434.fca918e8.js"><link rel="prefetch" href="/assets/js/435.4c8f9ad9.js"><link rel="prefetch" href="/assets/js/436.0f0de1a8.js"><link rel="prefetch" href="/assets/js/437.2221ab9f.js"><link rel="prefetch" href="/assets/js/438.37f28cfb.js"><link rel="prefetch" href="/assets/js/439.1e3f3611.js"><link rel="prefetch" href="/assets/js/44.705dc411.js"><link rel="prefetch" href="/assets/js/440.28ab35e8.js"><link rel="prefetch" href="/assets/js/441.8d006af8.js"><link rel="prefetch" href="/assets/js/442.2618a6e3.js"><link rel="prefetch" href="/assets/js/443.a7723674.js"><link rel="prefetch" href="/assets/js/444.18f23e7c.js"><link rel="prefetch" href="/assets/js/445.f4807c5a.js"><link rel="prefetch" href="/assets/js/446.77a5afc2.js"><link rel="prefetch" href="/assets/js/447.7f653483.js"><link rel="prefetch" href="/assets/js/448.1143c566.js"><link rel="prefetch" href="/assets/js/449.b788a288.js"><link rel="prefetch" href="/assets/js/45.6a225373.js"><link rel="prefetch" href="/assets/js/450.b6463ba3.js"><link rel="prefetch" href="/assets/js/451.fd4d46b9.js"><link rel="prefetch" href="/assets/js/452.e8de4fc2.js"><link rel="prefetch" href="/assets/js/453.4125e5e6.js"><link rel="prefetch" href="/assets/js/454.30af5d0a.js"><link rel="prefetch" href="/assets/js/455.9c919e58.js"><link rel="prefetch" href="/assets/js/456.22dbfa8f.js"><link rel="prefetch" href="/assets/js/457.e9c5248a.js"><link rel="prefetch" href="/assets/js/458.c0a9cf1d.js"><link rel="prefetch" href="/assets/js/459.b5e96042.js"><link rel="prefetch" href="/assets/js/46.515d085a.js"><link rel="prefetch" href="/assets/js/460.b4097efb.js"><link rel="prefetch" href="/assets/js/461.5d545741.js"><link rel="prefetch" href="/assets/js/462.402d4cdd.js"><link rel="prefetch" href="/assets/js/463.e6d6ea07.js"><link rel="prefetch" href="/assets/js/464.df817445.js"><link rel="prefetch" href="/assets/js/465.18a6bc2b.js"><link rel="prefetch" href="/assets/js/466.da313c0c.js"><link rel="prefetch" href="/assets/js/467.41294182.js"><link rel="prefetch" href="/assets/js/468.41c59467.js"><link rel="prefetch" href="/assets/js/469.d55da13c.js"><link rel="prefetch" href="/assets/js/47.a41193df.js"><link rel="prefetch" href="/assets/js/470.7457a92e.js"><link rel="prefetch" href="/assets/js/471.ed739bdf.js"><link rel="prefetch" href="/assets/js/472.83882459.js"><link rel="prefetch" href="/assets/js/473.fe2df51c.js"><link rel="prefetch" href="/assets/js/474.d40797b8.js"><link rel="prefetch" href="/assets/js/475.a00992a2.js"><link rel="prefetch" href="/assets/js/476.c7687189.js"><link rel="prefetch" href="/assets/js/477.fd4fd227.js"><link rel="prefetch" href="/assets/js/478.1ae08c3b.js"><link rel="prefetch" href="/assets/js/479.04a246c6.js"><link rel="prefetch" href="/assets/js/48.fe693306.js"><link rel="prefetch" href="/assets/js/480.36acb4ff.js"><link rel="prefetch" href="/assets/js/481.05d3129e.js"><link rel="prefetch" href="/assets/js/482.1741a02c.js"><link rel="prefetch" href="/assets/js/483.44cf2d25.js"><link rel="prefetch" href="/assets/js/484.9c14e5c6.js"><link rel="prefetch" href="/assets/js/485.ea0c1de1.js"><link rel="prefetch" href="/assets/js/486.8c683697.js"><link rel="prefetch" href="/assets/js/487.8b1eb604.js"><link rel="prefetch" href="/assets/js/488.ae16fca6.js"><link rel="prefetch" href="/assets/js/489.7f674a0d.js"><link rel="prefetch" href="/assets/js/49.a7d05a3d.js"><link rel="prefetch" href="/assets/js/490.52983854.js"><link rel="prefetch" href="/assets/js/491.968e7af4.js"><link rel="prefetch" href="/assets/js/492.e7f58bac.js"><link rel="prefetch" href="/assets/js/493.55afbb68.js"><link rel="prefetch" href="/assets/js/494.ac17d05b.js"><link rel="prefetch" href="/assets/js/495.d1ca2a12.js"><link rel="prefetch" href="/assets/js/496.d6841a0e.js"><link rel="prefetch" href="/assets/js/497.99431b4b.js"><link rel="prefetch" href="/assets/js/498.cacac1d8.js"><link rel="prefetch" href="/assets/js/499.c6b7fab0.js"><link rel="prefetch" href="/assets/js/5.f74a04c4.js"><link rel="prefetch" href="/assets/js/50.f59b29ea.js"><link rel="prefetch" href="/assets/js/500.abba24c7.js"><link rel="prefetch" href="/assets/js/501.e9496674.js"><link rel="prefetch" href="/assets/js/502.3ece0e86.js"><link rel="prefetch" href="/assets/js/503.974421d1.js"><link rel="prefetch" href="/assets/js/504.6e8d8539.js"><link rel="prefetch" href="/assets/js/505.b8161483.js"><link rel="prefetch" href="/assets/js/506.a6a6f2de.js"><link rel="prefetch" href="/assets/js/507.9c6955ee.js"><link rel="prefetch" href="/assets/js/508.223e145d.js"><link rel="prefetch" href="/assets/js/509.553e6f2c.js"><link rel="prefetch" href="/assets/js/51.428c5495.js"><link rel="prefetch" href="/assets/js/510.46e2eab7.js"><link rel="prefetch" href="/assets/js/511.24962b3f.js"><link rel="prefetch" href="/assets/js/512.a29fe236.js"><link rel="prefetch" href="/assets/js/513.8729b339.js"><link rel="prefetch" href="/assets/js/514.41199019.js"><link rel="prefetch" href="/assets/js/515.b1a71e99.js"><link rel="prefetch" href="/assets/js/516.001e3634.js"><link rel="prefetch" href="/assets/js/517.4de05581.js"><link rel="prefetch" href="/assets/js/518.57697c31.js"><link rel="prefetch" href="/assets/js/519.e962365e.js"><link rel="prefetch" href="/assets/js/52.c97c3911.js"><link rel="prefetch" href="/assets/js/520.e7775961.js"><link rel="prefetch" href="/assets/js/521.05b0ce57.js"><link rel="prefetch" href="/assets/js/522.49f7412e.js"><link rel="prefetch" href="/assets/js/523.b3d821b2.js"><link rel="prefetch" href="/assets/js/524.ab2395b7.js"><link rel="prefetch" href="/assets/js/525.25559bb4.js"><link rel="prefetch" href="/assets/js/526.23111d2a.js"><link rel="prefetch" href="/assets/js/527.c61f6e86.js"><link rel="prefetch" href="/assets/js/528.032fa7b6.js"><link rel="prefetch" href="/assets/js/529.3953f346.js"><link rel="prefetch" href="/assets/js/53.77f22b1a.js"><link rel="prefetch" href="/assets/js/530.b882066e.js"><link rel="prefetch" href="/assets/js/531.62dddf23.js"><link rel="prefetch" href="/assets/js/532.1826fe1a.js"><link rel="prefetch" href="/assets/js/533.a2e014bb.js"><link rel="prefetch" href="/assets/js/534.d5d89c00.js"><link rel="prefetch" href="/assets/js/535.4e5d7739.js"><link rel="prefetch" href="/assets/js/536.f2c700db.js"><link rel="prefetch" href="/assets/js/537.80aa278c.js"><link rel="prefetch" href="/assets/js/538.95e2f471.js"><link rel="prefetch" href="/assets/js/539.4e4ecfe8.js"><link rel="prefetch" href="/assets/js/54.d85b2f2e.js"><link rel="prefetch" href="/assets/js/540.00bd44e5.js"><link rel="prefetch" href="/assets/js/541.d740df14.js"><link rel="prefetch" href="/assets/js/542.5aadeaee.js"><link rel="prefetch" href="/assets/js/543.d42c9d9a.js"><link rel="prefetch" href="/assets/js/544.29704685.js"><link rel="prefetch" href="/assets/js/545.7fdb1a83.js"><link rel="prefetch" href="/assets/js/546.6b5655ea.js"><link rel="prefetch" href="/assets/js/547.c98e27c4.js"><link rel="prefetch" href="/assets/js/548.8edec06f.js"><link rel="prefetch" href="/assets/js/549.33b8eae3.js"><link rel="prefetch" href="/assets/js/55.80a4fa71.js"><link rel="prefetch" href="/assets/js/550.cb706b0e.js"><link rel="prefetch" href="/assets/js/551.79598cc6.js"><link rel="prefetch" href="/assets/js/552.69aa5f8b.js"><link rel="prefetch" href="/assets/js/553.7ccb8831.js"><link rel="prefetch" href="/assets/js/554.954013b2.js"><link rel="prefetch" href="/assets/js/555.960d7f8b.js"><link rel="prefetch" href="/assets/js/556.5c054c14.js"><link rel="prefetch" href="/assets/js/557.890045ea.js"><link rel="prefetch" href="/assets/js/558.f72f6668.js"><link rel="prefetch" href="/assets/js/559.452d8ff3.js"><link rel="prefetch" href="/assets/js/56.009b0340.js"><link rel="prefetch" href="/assets/js/560.1656e33f.js"><link rel="prefetch" href="/assets/js/561.bb4650eb.js"><link rel="prefetch" href="/assets/js/562.7322fd81.js"><link rel="prefetch" href="/assets/js/563.a34a68ea.js"><link rel="prefetch" href="/assets/js/564.6da92e18.js"><link rel="prefetch" href="/assets/js/565.01d288e5.js"><link rel="prefetch" href="/assets/js/566.6a3459a1.js"><link rel="prefetch" href="/assets/js/567.e3eb8e54.js"><link rel="prefetch" href="/assets/js/568.f95e0fba.js"><link rel="prefetch" href="/assets/js/569.a42d134c.js"><link rel="prefetch" href="/assets/js/57.25e8dd1c.js"><link rel="prefetch" href="/assets/js/570.87887d15.js"><link rel="prefetch" href="/assets/js/571.ce4b478b.js"><link rel="prefetch" href="/assets/js/572.634418a6.js"><link rel="prefetch" href="/assets/js/573.cd4cf02b.js"><link rel="prefetch" href="/assets/js/574.8bf073fa.js"><link rel="prefetch" href="/assets/js/575.c194dddb.js"><link rel="prefetch" href="/assets/js/576.7750193f.js"><link rel="prefetch" href="/assets/js/577.5daa388a.js"><link rel="prefetch" href="/assets/js/578.54bb0029.js"><link rel="prefetch" href="/assets/js/579.92f58c76.js"><link rel="prefetch" href="/assets/js/58.9c1eb9e5.js"><link rel="prefetch" href="/assets/js/580.0e543efb.js"><link rel="prefetch" href="/assets/js/581.4e0b0b47.js"><link rel="prefetch" href="/assets/js/582.8c172f83.js"><link rel="prefetch" href="/assets/js/583.c91c43e0.js"><link rel="prefetch" href="/assets/js/584.ca68d52b.js"><link rel="prefetch" href="/assets/js/585.663b17d3.js"><link rel="prefetch" href="/assets/js/586.9494847d.js"><link rel="prefetch" href="/assets/js/587.f3805773.js"><link rel="prefetch" href="/assets/js/588.8ae14be1.js"><link rel="prefetch" href="/assets/js/589.b4af88be.js"><link rel="prefetch" href="/assets/js/59.2a730e41.js"><link rel="prefetch" href="/assets/js/590.fb77fea8.js"><link rel="prefetch" href="/assets/js/591.a3aaa57c.js"><link rel="prefetch" href="/assets/js/592.54ec5f32.js"><link rel="prefetch" href="/assets/js/593.96eab5cb.js"><link rel="prefetch" href="/assets/js/594.e356725c.js"><link rel="prefetch" href="/assets/js/595.0a2c4ad4.js"><link rel="prefetch" href="/assets/js/596.2c075cd8.js"><link rel="prefetch" href="/assets/js/597.e904811b.js"><link rel="prefetch" href="/assets/js/598.f6ca8b71.js"><link rel="prefetch" href="/assets/js/599.ae3d12c4.js"><link rel="prefetch" href="/assets/js/6.451e012f.js"><link rel="prefetch" href="/assets/js/60.e6b60343.js"><link rel="prefetch" href="/assets/js/600.e71a0062.js"><link rel="prefetch" href="/assets/js/601.2571a19d.js"><link rel="prefetch" href="/assets/js/602.0f4fa961.js"><link rel="prefetch" href="/assets/js/603.d8387c37.js"><link rel="prefetch" href="/assets/js/604.69433906.js"><link rel="prefetch" href="/assets/js/605.1bc7d87a.js"><link rel="prefetch" href="/assets/js/606.ec419517.js"><link rel="prefetch" href="/assets/js/607.b473fb0b.js"><link rel="prefetch" href="/assets/js/608.a361b48c.js"><link rel="prefetch" href="/assets/js/609.9186f226.js"><link rel="prefetch" href="/assets/js/61.d50a156d.js"><link rel="prefetch" href="/assets/js/610.ff3cf241.js"><link rel="prefetch" href="/assets/js/611.c3c7e648.js"><link rel="prefetch" href="/assets/js/612.2a520ebd.js"><link rel="prefetch" href="/assets/js/613.42936ffc.js"><link rel="prefetch" href="/assets/js/614.3ca0de21.js"><link rel="prefetch" href="/assets/js/615.ecf60a47.js"><link rel="prefetch" href="/assets/js/616.17185e83.js"><link rel="prefetch" href="/assets/js/617.769d4cdf.js"><link rel="prefetch" href="/assets/js/618.015c6376.js"><link rel="prefetch" href="/assets/js/619.3af186d0.js"><link rel="prefetch" href="/assets/js/62.e24b7811.js"><link rel="prefetch" href="/assets/js/620.f8ff3784.js"><link rel="prefetch" href="/assets/js/621.4c21311f.js"><link rel="prefetch" href="/assets/js/622.355178df.js"><link rel="prefetch" href="/assets/js/623.45a30695.js"><link rel="prefetch" href="/assets/js/624.61e89d34.js"><link rel="prefetch" href="/assets/js/625.49e0d1ce.js"><link rel="prefetch" href="/assets/js/626.1b7ae767.js"><link rel="prefetch" href="/assets/js/627.b8c507cf.js"><link rel="prefetch" href="/assets/js/628.c5a43517.js"><link rel="prefetch" href="/assets/js/629.274eb0fd.js"><link rel="prefetch" href="/assets/js/63.b804baab.js"><link rel="prefetch" href="/assets/js/630.69e055ce.js"><link rel="prefetch" href="/assets/js/631.0892fc51.js"><link rel="prefetch" href="/assets/js/632.6a68e9a2.js"><link rel="prefetch" href="/assets/js/633.d536fe74.js"><link rel="prefetch" href="/assets/js/634.24695f39.js"><link rel="prefetch" href="/assets/js/635.3aeede9c.js"><link rel="prefetch" href="/assets/js/636.3628d8a6.js"><link rel="prefetch" href="/assets/js/637.40af5a79.js"><link rel="prefetch" href="/assets/js/638.15e257ae.js"><link rel="prefetch" href="/assets/js/639.31e6597c.js"><link rel="prefetch" href="/assets/js/64.eb5699ff.js"><link rel="prefetch" href="/assets/js/640.a071f6df.js"><link rel="prefetch" href="/assets/js/641.f9edd7bf.js"><link rel="prefetch" href="/assets/js/642.adcb583f.js"><link rel="prefetch" href="/assets/js/643.7c98a990.js"><link rel="prefetch" href="/assets/js/644.fb1213d8.js"><link rel="prefetch" href="/assets/js/645.220a5034.js"><link rel="prefetch" href="/assets/js/646.d66a419b.js"><link rel="prefetch" href="/assets/js/647.12ef89ab.js"><link rel="prefetch" href="/assets/js/648.a3112300.js"><link rel="prefetch" href="/assets/js/649.f457dfa5.js"><link rel="prefetch" href="/assets/js/65.0d8501b5.js"><link rel="prefetch" href="/assets/js/650.cc63d03b.js"><link rel="prefetch" href="/assets/js/651.16d1bbd6.js"><link rel="prefetch" href="/assets/js/652.0f5343f0.js"><link rel="prefetch" href="/assets/js/653.28f7710a.js"><link rel="prefetch" href="/assets/js/654.b343d473.js"><link rel="prefetch" href="/assets/js/655.215fe67b.js"><link rel="prefetch" href="/assets/js/656.79aa1653.js"><link rel="prefetch" href="/assets/js/657.c57f2b5c.js"><link rel="prefetch" href="/assets/js/658.d0aa0b95.js"><link rel="prefetch" href="/assets/js/659.2dfaed93.js"><link rel="prefetch" href="/assets/js/66.8361cc16.js"><link rel="prefetch" href="/assets/js/660.c00b347e.js"><link rel="prefetch" href="/assets/js/661.ecc4f968.js"><link rel="prefetch" href="/assets/js/662.06f83919.js"><link rel="prefetch" href="/assets/js/663.67d8849e.js"><link rel="prefetch" href="/assets/js/664.74dba1a9.js"><link rel="prefetch" href="/assets/js/665.28b450f0.js"><link rel="prefetch" href="/assets/js/666.0f4bb6ba.js"><link rel="prefetch" href="/assets/js/667.586074e3.js"><link rel="prefetch" href="/assets/js/668.b13c0e70.js"><link rel="prefetch" href="/assets/js/669.9d0d4cbc.js"><link rel="prefetch" href="/assets/js/67.37f46ba2.js"><link rel="prefetch" href="/assets/js/670.6b36ca72.js"><link rel="prefetch" href="/assets/js/671.33b2e754.js"><link rel="prefetch" href="/assets/js/672.3b02c287.js"><link rel="prefetch" href="/assets/js/673.3f274929.js"><link rel="prefetch" href="/assets/js/674.7d75584f.js"><link rel="prefetch" href="/assets/js/675.0de52334.js"><link rel="prefetch" href="/assets/js/676.6734133e.js"><link rel="prefetch" href="/assets/js/677.c6f4a973.js"><link rel="prefetch" href="/assets/js/678.1344b6be.js"><link rel="prefetch" href="/assets/js/679.23fed56f.js"><link rel="prefetch" href="/assets/js/68.27dbce5b.js"><link rel="prefetch" href="/assets/js/680.c49329d6.js"><link rel="prefetch" href="/assets/js/681.8df66615.js"><link rel="prefetch" href="/assets/js/682.77b4bff8.js"><link rel="prefetch" href="/assets/js/683.6cf41cf4.js"><link rel="prefetch" href="/assets/js/684.58deecd5.js"><link rel="prefetch" href="/assets/js/685.d2f7480e.js"><link rel="prefetch" href="/assets/js/686.0b77a241.js"><link rel="prefetch" href="/assets/js/687.2cc04b4f.js"><link rel="prefetch" href="/assets/js/688.da24cbae.js"><link rel="prefetch" href="/assets/js/689.a9961f74.js"><link rel="prefetch" href="/assets/js/69.8052a977.js"><link rel="prefetch" href="/assets/js/690.cb736269.js"><link rel="prefetch" href="/assets/js/691.21c13be1.js"><link rel="prefetch" href="/assets/js/692.3ed557d0.js"><link rel="prefetch" href="/assets/js/693.066efe93.js"><link rel="prefetch" href="/assets/js/694.5368f98a.js"><link rel="prefetch" href="/assets/js/695.4fdb93d5.js"><link rel="prefetch" href="/assets/js/696.9c055ac6.js"><link rel="prefetch" href="/assets/js/697.51e0c47c.js"><link rel="prefetch" href="/assets/js/698.08ca1dbd.js"><link rel="prefetch" href="/assets/js/699.ce7e9e2a.js"><link rel="prefetch" href="/assets/js/7.7e21c947.js"><link rel="prefetch" href="/assets/js/70.19faeb78.js"><link rel="prefetch" href="/assets/js/700.3676fa7f.js"><link rel="prefetch" href="/assets/js/701.82db4887.js"><link rel="prefetch" href="/assets/js/702.73425f22.js"><link rel="prefetch" href="/assets/js/703.d9391c74.js"><link rel="prefetch" href="/assets/js/704.d6e275cf.js"><link rel="prefetch" href="/assets/js/705.d2f23969.js"><link rel="prefetch" href="/assets/js/706.1c66dcc1.js"><link rel="prefetch" href="/assets/js/707.0fc5a26a.js"><link rel="prefetch" href="/assets/js/708.97471ee6.js"><link rel="prefetch" href="/assets/js/709.9b4d5665.js"><link rel="prefetch" href="/assets/js/71.d1683810.js"><link rel="prefetch" href="/assets/js/710.75fa8103.js"><link rel="prefetch" href="/assets/js/711.43777b40.js"><link rel="prefetch" href="/assets/js/712.5c583e39.js"><link rel="prefetch" href="/assets/js/713.5aa72111.js"><link rel="prefetch" href="/assets/js/714.e8215702.js"><link rel="prefetch" href="/assets/js/715.46614e7c.js"><link rel="prefetch" href="/assets/js/716.eaac6d69.js"><link rel="prefetch" href="/assets/js/717.c344c042.js"><link rel="prefetch" href="/assets/js/718.437bf0b2.js"><link rel="prefetch" href="/assets/js/719.23aa3deb.js"><link rel="prefetch" href="/assets/js/72.9fa783f0.js"><link rel="prefetch" href="/assets/js/720.9456a449.js"><link rel="prefetch" href="/assets/js/721.67fd324a.js"><link rel="prefetch" href="/assets/js/722.fc5e79ca.js"><link rel="prefetch" href="/assets/js/723.46db8115.js"><link rel="prefetch" href="/assets/js/724.31a11b8c.js"><link rel="prefetch" href="/assets/js/725.49cef603.js"><link rel="prefetch" href="/assets/js/726.7d0a2e7f.js"><link rel="prefetch" href="/assets/js/727.a1de6f02.js"><link rel="prefetch" href="/assets/js/728.7e0a727e.js"><link rel="prefetch" href="/assets/js/729.b6bf04fa.js"><link rel="prefetch" href="/assets/js/73.1ac0ac37.js"><link rel="prefetch" href="/assets/js/730.1c102528.js"><link rel="prefetch" href="/assets/js/731.80403e3d.js"><link rel="prefetch" href="/assets/js/732.cf8b4a6d.js"><link rel="prefetch" href="/assets/js/733.aab88d38.js"><link rel="prefetch" href="/assets/js/734.965a0adc.js"><link rel="prefetch" href="/assets/js/735.f9d33608.js"><link rel="prefetch" href="/assets/js/736.d1621f9e.js"><link rel="prefetch" href="/assets/js/737.a12ea0d3.js"><link rel="prefetch" href="/assets/js/738.96e61512.js"><link rel="prefetch" href="/assets/js/739.9bce4dfe.js"><link rel="prefetch" href="/assets/js/74.1913daec.js"><link rel="prefetch" href="/assets/js/740.c1a0bf7b.js"><link rel="prefetch" href="/assets/js/741.0185115e.js"><link rel="prefetch" href="/assets/js/742.21e99d78.js"><link rel="prefetch" href="/assets/js/743.e5f2407e.js"><link rel="prefetch" href="/assets/js/744.53d4e25a.js"><link rel="prefetch" href="/assets/js/745.9fb6722c.js"><link rel="prefetch" href="/assets/js/746.893e3a2f.js"><link rel="prefetch" href="/assets/js/747.ad94fed4.js"><link rel="prefetch" href="/assets/js/748.3421b09b.js"><link rel="prefetch" href="/assets/js/749.15c364e9.js"><link rel="prefetch" href="/assets/js/75.d63a9540.js"><link rel="prefetch" href="/assets/js/750.4e5379b7.js"><link rel="prefetch" href="/assets/js/751.18b0273f.js"><link rel="prefetch" href="/assets/js/752.24717596.js"><link rel="prefetch" href="/assets/js/753.5868bcc4.js"><link rel="prefetch" href="/assets/js/754.77808a6c.js"><link rel="prefetch" href="/assets/js/755.af7f7a71.js"><link rel="prefetch" href="/assets/js/76.342d837c.js"><link rel="prefetch" href="/assets/js/77.466349c3.js"><link rel="prefetch" href="/assets/js/78.886d05b6.js"><link rel="prefetch" href="/assets/js/79.b478bdab.js"><link rel="prefetch" href="/assets/js/8.9f40767d.js"><link rel="prefetch" href="/assets/js/80.9205cc43.js"><link rel="prefetch" href="/assets/js/81.77f831c9.js"><link rel="prefetch" href="/assets/js/82.650475d1.js"><link rel="prefetch" href="/assets/js/83.aa7e3d4b.js"><link rel="prefetch" href="/assets/js/84.2fc92fb4.js"><link rel="prefetch" href="/assets/js/85.0f633e10.js"><link rel="prefetch" href="/assets/js/86.e862f4bc.js"><link rel="prefetch" href="/assets/js/87.8a869468.js"><link rel="prefetch" href="/assets/js/88.6c584051.js"><link rel="prefetch" href="/assets/js/89.3ab84e02.js"><link rel="prefetch" href="/assets/js/9.7ed864ce.js"><link rel="prefetch" href="/assets/js/90.41e6925d.js"><link rel="prefetch" href="/assets/js/91.55055993.js"><link rel="prefetch" href="/assets/js/92.ced7b439.js"><link rel="prefetch" href="/assets/js/93.41cc8a7f.js"><link rel="prefetch" href="/assets/js/94.6d2b144f.js"><link rel="prefetch" href="/assets/js/95.399a7909.js"><link rel="prefetch" href="/assets/js/96.556f8f9f.js"><link rel="prefetch" href="/assets/js/97.47ecdf46.js"><link rel="prefetch" href="/assets/js/98.fdbe6822.js"><link rel="prefetch" href="/assets/js/99.db8442e4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6ece31e0.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Fanx 知识库" class="logo"> <span class="site-name can-hide">Fanx 知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/779590/" class="nav-link">Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/dc7834/" class="nav-link">Java集合框架</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d7db/" class="nav-link">Java多线程并发</a></li><li class="dropdown-item"><!----> <a href="/pages/dbec4d/" class="nav-link">JavaIo&amp;NIO&amp;AIO</a></li><li class="dropdown-item"><!----> <a href="/pages/b908ce/" class="nav-link">JDK相关特性</a></li><li class="dropdown-item"><!----> <a href="/pages/e59bea/" class="nav-link">JVM相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f8c059/" class="nav-link">数据库基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/d192fd/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/8aa877/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/077e7c/" class="nav-link">MogoDb</a></li><li class="dropdown-item"><!----> <a href="/pages/68281b/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><!----> <span class="title" style="display:;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonFrameworks/mybatis/" class="nav-link">mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/8f6500/" class="nav-link">Spring Framework 5基础</a></li><li class="dropdown-item"><!----> <a href="/pages/7c08d4/" class="nav-link">SpringBoot 2.5.x系列</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源代码学习" class="dropdown-title"><!----> <span class="title" style="display:;">源代码学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/23a632/" class="nav-link">mybatis源码学习</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/java/" class="nav-link">java源代码</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/spring/" class="nav-link">Spring源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试相关" class="dropdown-title"><!----> <span class="title" style="display:;">面试相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2cef48/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/ad2692/" class="nav-link">Spring 框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用的技术工具" class="dropdown-title"><!----> <span class="title" style="display:;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/linux/common/" class="nav-link">linux常用命令实践</a></li><li class="dropdown-item"><!----> <a href="/tool/maven/" class="nav-link">Mavan</a></li><li class="dropdown-item"><!----> <a href="/pages/b25802/" class="nav-link">开发工具详解</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它语言" class="dropdown-title"><!----> <span class="title" style="display:;">其它语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fc414d/" class="nav-link">Python基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题总结" class="dropdown-title"><!----> <span class="title" style="display:;">问题总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/question/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4d0fa7/" class="nav-link">团队相关</a></li><li class="dropdown-item"><!----> <a href="/pages/75c3d7/" class="nav-link">fanx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><!----> <span class="title" style="display:;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/caf303/" class="nav-link">数据结构基础</a></li><li class="dropdown-item"><!----> <a href="/pages/395e23/" class="nav-link">常见排序算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fa3dd3/" class="nav-link">算法思想</a></li><li class="dropdown-item"><!----> <a href="/pages/79d342/" class="nav-link">一些领域算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fdb54d/" class="nav-link">其它算法相关</a></li></ul></div></div> <a href="https://fanxgit.github.io/fanxNotes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/779590/" class="nav-link">Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/dc7834/" class="nav-link">Java集合框架</a></li><li class="dropdown-item"><!----> <a href="/pages/f2d7db/" class="nav-link">Java多线程并发</a></li><li class="dropdown-item"><!----> <a href="/pages/dbec4d/" class="nav-link">JavaIo&amp;NIO&amp;AIO</a></li><li class="dropdown-item"><!----> <a href="/pages/b908ce/" class="nav-link">JDK相关特性</a></li><li class="dropdown-item"><!----> <a href="/pages/e59bea/" class="nav-link">JVM相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f8c059/" class="nav-link">数据库基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/d192fd/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/8aa877/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/077e7c/" class="nav-link">MogoDb</a></li><li class="dropdown-item"><!----> <a href="/pages/68281b/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><!----> <span class="title" style="display:;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonFrameworks/mybatis/" class="nav-link">mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/8f6500/" class="nav-link">Spring Framework 5基础</a></li><li class="dropdown-item"><!----> <a href="/pages/7c08d4/" class="nav-link">SpringBoot 2.5.x系列</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源代码学习" class="dropdown-title"><!----> <span class="title" style="display:;">源代码学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/23a632/" class="nav-link">mybatis源码学习</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/java/" class="nav-link">java源代码</a></li><li class="dropdown-item"><!----> <a href="/sourceCode/spring/" class="nav-link">Spring源码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试相关" class="dropdown-title"><!----> <span class="title" style="display:;">面试相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2cef48/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/ad2692/" class="nav-link">Spring 框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用的技术工具" class="dropdown-title"><!----> <span class="title" style="display:;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/linux/common/" class="nav-link">linux常用命令实践</a></li><li class="dropdown-item"><!----> <a href="/tool/maven/" class="nav-link">Mavan</a></li><li class="dropdown-item"><!----> <a href="/pages/b25802/" class="nav-link">开发工具详解</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它语言" class="dropdown-title"><!----> <span class="title" style="display:;">其它语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fc414d/" class="nav-link">Python基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题总结" class="dropdown-title"><!----> <span class="title" style="display:;">问题总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/question/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/pages/4d0fa7/" class="nav-link">团队相关</a></li><li class="dropdown-item"><!----> <a href="/pages/75c3d7/" class="nav-link">fanx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><!----> <span class="title" style="display:;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/caf303/" class="nav-link">数据结构基础</a></li><li class="dropdown-item"><!----> <a href="/pages/395e23/" class="nav-link">常见排序算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fa3dd3/" class="nav-link">算法思想</a></li><li class="dropdown-item"><!----> <a href="/pages/79d342/" class="nav-link">一些领域算法</a></li><li class="dropdown-item"><!----> <a href="/pages/fdb54d/" class="nav-link">其它算法相关</a></li></ul></div></div> <a href="https://fanxgit.github.io/fanxNotes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mybatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>poi</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>activiti7</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/d092a1/" aria-current="page" class="active sidebar-link">activiti7实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/d092a1/#一、activiti7介绍" class="sidebar-link">一、Activiti7介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_1-1-工作流workflow" class="sidebar-link">1.1 工作流WorkFlow</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_1-2-activiti工作流引擎" class="sidebar-link">1.2 Activiti工作流引擎</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_1-3-建模语言bpmn" class="sidebar-link">1.3 建模语言BPMN</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_1-4-activiti使用步骤" class="sidebar-link">1.4 Activiti使用步骤</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d092a1/#二、activiti环境搭建" class="sidebar-link">二、Activiti环境搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_2-1-安装插件" class="sidebar-link">2.1 安装插件</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_2-2-初始化数据库表" class="sidebar-link">2.2 初始化数据库表</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_2-3-表结构解读" class="sidebar-link">2.3 表结构解读</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_2-4-activiti核心类" class="sidebar-link">2.4 Activiti核心类</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#repositoryservice" class="sidebar-link">RepositoryService</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#runtimeservice" class="sidebar-link">RuntimeService</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#taskservice" class="sidebar-link">TaskService</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#historyservice" class="sidebar-link">HistoryService</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#managementservice" class="sidebar-link">ManagementService</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d092a1/#三、activiti入门" class="sidebar-link">三、Activiti入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_3-1-流程符号详解" class="sidebar-link">3.1 流程符号详解</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_3-2-定制一个简单的请假流程" class="sidebar-link">3.2 定制一个简单的请假流程</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_3-3-部署请假流程" class="sidebar-link">3.3 部署请假流程</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_3-4-启动流程实例" class="sidebar-link">3.4 启动流程实例</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_3-5-任务查询" class="sidebar-link">3.5 任务查询</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_3-6-流程任务处理" class="sidebar-link">3.6 流程任务处理</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_3-7-流程信息查询" class="sidebar-link">3.7 流程信息查询</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_3-8-删除流程" class="sidebar-link">3.8 删除流程</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_3-9-流程资源下载" class="sidebar-link">3.9 流程资源下载</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_3-10-流程历史信息查看" class="sidebar-link">3.10 流程历史信息查看</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_3-11-篇章总结" class="sidebar-link">3.11 篇章总结</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d092a1/#四、activiti进阶" class="sidebar-link">四、Activiti进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_4-1-流程定义与流程实例" class="sidebar-link">4.1 流程定义与流程实例</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-1-1-启动流程实例时-添加businesskey" class="sidebar-link">4.1.1 启动流程实例时，添加Businesskey</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-1-2-挂起、激活流程实例" class="sidebar-link">4.1.2 挂起、激活流程实例</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_4-2-流程变量" class="sidebar-link">4.2 流程变量</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-2-1-流程变量的作用域" class="sidebar-link">4.2.1 流程变量的作用域</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-2-2-使用流程变量" class="sidebar-link">4.2.2 使用流程变量</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-2-3-设置global流程变量" class="sidebar-link">4.2.3 设置Global流程变量</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-2-4-设置local流程变量" class="sidebar-link">4.2.4 设置Local流程变量</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_4-3-网关" class="sidebar-link">4.3 网关</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-3-1-排他网关exclusivegateway" class="sidebar-link">4.3.1 排他网关ExclusiveGateway</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-3-2-并行网关parallelgateway" class="sidebar-link">4.3.2 并行网关ParallelGateway</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-3-3-包含网关inclusivegateway" class="sidebar-link">4.3.3 包含网关InclusiveGateway</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-3-4-事件网关eventgateway" class="sidebar-link">4.3.4 事件网关EventGateway</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_4-4-个人任务管理" class="sidebar-link">4.4 个人任务管理</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-4-1-分配任务负责人" class="sidebar-link">4.4.1 分配任务负责人</a></li><li class="sidebar-sub-header level3"><a href="/pages/d092a1/#_4-5-组任务分配" class="sidebar-link">4.5 组任务分配</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-5-1-设置多个候选责任人" class="sidebar-link">4.5.1 设置多个候选责任人</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#_4-5-2-组任务办理流程" class="sidebar-link">4.5.2 组任务办理流程</a></li><li class="sidebar-sub-header level4"><a href="/pages/d092a1/#数据库表操作" class="sidebar-link">数据库表操作</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d092a1/#五、activiti与spring整合" class="sidebar-link">五、Activiti与Spring整合</a></li><li class="sidebar-sub-header level2"><a href="/pages/d092a1/#六、activiti7与springboot整合开发" class="sidebar-link">六、Activiti7与SpringBoot整合开发</a></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E5%B8%B8%E7%94%A8%E6%A1%86%E6%9E%B6" title="分类" data-v-06225672>常用框架</a></li><li data-v-06225672><a href="/categories/?category=activiti7" title="分类" data-v-06225672>activiti7</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/FanXGit" target="_blank" title="作者" class="beLink" data-v-06225672>fanx</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-09-13</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">activiti7实战<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="一、activiti7介绍"><a href="#一、activiti7介绍" class="header-anchor">#</a> 一、Activiti7介绍</h2> <p>Activiti是目前使用最为广泛的开源工作流引擎，2010年5月就正是启动了。在了 解Activiti之前，我们首先要了解下什么是工作流。</p> <h3 id="_1-1-工作流workflow"><a href="#_1-1-工作流workflow" class="header-anchor">#</a> 1.1 工作流WorkFlow</h3> <p>关于什么是工作流，有一个官方的定义： 工作流是指一类能够完全自动执行的经营过程，根据一系列规程规则，将文档、信息或任务在不同的执行者之间进行传递 和执行。其实说直白一点，就是业务上一个完整的审批流程。例如员工的入职、请 假、出差、采购等等、还有一些关键业务如订单申请、合同审核等等，这些过程， 都是一个工作流</p> <p>对于工作流，传统的处理方式往往需要有人拿着各类的文件，在多个执行部门之间不断的审批。而当我们开始用软件来协助处理这一类审批流程时，就开始出现了工作流系统。工作流系统可以减少大量的线下沟通成本，提高工作效率。</p> <p>有了工作流系统之后，才开始出现工作流引擎。在没有专门的工作流引擎之前，我们为了实现这样的流程控制，通常的做法都是采用状态字段的方式来跟踪流程的变化情况。例如对一个员工请假请求，我们会定义已申请、组长已审核、部门经理已审核等等这样一些状态，然后通过这些状态来控制不同的业务行为，比如部门经理角色只能看到组长已审核通过的，并且请假天数超过3天的订单等等。</p> <p>这种实现方式实现起来比较简单，也是软件系统中非常常用的一种方式。但是这种通过状态字段来进行流程控制的方式还是有他的弊端。</p> <p>一方面：整个流程定义不够清晰。业务流程是分散在各个业务阶段中的，从代码的角度非常难以看到整个流程是如何定义的。</p> <p>另一方面：当流程发生变更时，这种方式编写的代码就需要做非常大的变更。例如从三级审批要增加为四级审批甚至是协同审批，那各个业务阶段的审批流程都需要随之做大量的变更。</p> <p>正是出于这些痛点，后面才有了工作流引擎。使用工作流引擎后，整个审批流程可以在同一个地方进行整体设计，并且当审批流程发生变更时，业务程序也可以不用改变。这样业务系统的适应能力就得到了极大提升。</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>其实引擎的思想无处不在。我们有Drools规则引擎，可以在程序不发生
变动的情况下，集中定义业务规则并进行修改。Aviator表达式引擎，可
以快速计算某一个表达式的结果。搜索引擎，可以快速进行统一搜索等
等。其核心思想都是将业务之间的共性抽取出来，减少业务变动对程序
的影响。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_1-2-activiti工作流引擎"><a href="#_1-2-activiti工作流引擎" class="header-anchor">#</a> 1.2 Activiti工作流引擎</h3> <p>Activiti正是目前使用最为广泛的开源工作流引擎。Activiti的官网地址是 https://www.activiti.org 历经6.x和5.x两个大的版本，目前最新的版本是 Activiti Cloud
7.1.0-M11。</p> <p>他可以将业务系统中复杂的业务流程抽取出来，使用专门的建模语言BPMN2.0进行定义。业务流程按照预先定义的流程执行，整个实现流程完全由activiti进行管理，从而减少业务系统由于流程变更进行系统改造的工作量，从而减少系统开发维护成本，提高系统的健壮性。所以使用Activiti，重点就是两个步骤，首先使用BPMN定义流程，然后使用Activiti框架实现流程。</p> <h3 id="_1-3-建模语言bpmn"><a href="#_1-3-建模语言bpmn" class="header-anchor">#</a> 1.3 建模语言BPMN</h3> <p>谈到BPMN，首先就要谈BPM。 BPM即Business Process Managemenet，业务流程管理。是一种规范化的构造端到端的业务流程，以持续的提高组织业务效率。在常见的商业管理教育如EMBA、MBA中都包含了BPM的课程。</p> <p>有了BPM的需求，就出现了BPM软件。他是根据企业中业务环境的变化，推进人与人之间，人与系统之间以及系统与系统之间的整合及调整的经营方法域解决方案的IT工具。通过对企业业务流程的整个生命周期进行建模、自动化、管理监控和优化，使企业成本降低，利润得到提升。BPM软件在企业中应用非常广泛，凡是有业务流程的地方都可以使用BPM进行管理。比如企业人事办公管理、采购流程管理、公文审批流程管理、财务管理等。</p> <p>而BPMN是Business Process Model And Notation 业务流程模型和符号，就是用来描述业务流程的一种建模标准。BPMN最早由BPMI(BusinessProcess Management Initiative)方案提出。由一整套标准的业务流程建模符号组成。使用BPMN可以快速定义业务流程。</p> <p>BPMN最早在2004年5月发布。2005年9月开始并入OMG(The Object Managemenet Group)组织。OMG于2011年1月发布BPMN2.0的最终版本。BPMN是目前被各大BPM厂商广泛接受的BPM标准。Activiti就是使用BPMN2.0进行流程建模、流程执行管理。</p> <p>整个BPMN是用一组符号来描述业务流程中发生的各种事件的。BPMN通过在这些符号事件之间连线来描述一个完整的业务流程。</p> <p><img src="/assets/img/bpmn.f14d34cf.png" alt=""></p> <p>而对于一个完整的BPMN图形流程，其实最终是通过XML进行描述的。通常，会将BPMN流程最终保存为一个.bpmn的文件，然后可以使用文本编辑器打开进行查看。而图形与xml文件之间，会有专门的软件来进行转换。</p> <p>关于如何配置一个工作流，在后面的实战过程中我们会接触到。</p> <h3 id="_1-4-activiti使用步骤"><a href="#_1-4-activiti使用步骤" class="header-anchor">#</a> 1.4 Activiti使用步骤</h3> <p>通常使用Activiti时包含以下几个步骤</p> <ul><li>部署activiti： Activiti包含一堆Jar包，因此需要把业务系统和Activiti的环境集成在一起进行部署。</li> <li>定义流程： 使用Activiti的建模工具定义业务流程.bpmn文件。</li> <li>部署流程定义： 使用Activiti提供的API把流程定义内容存储起来，在Acitivti执行过程汇总可以查询定义的内容。Activiti是通过数据库来存储业务流程的。</li> <li>启动流程实例： 流程实例也叫ProcessInstance。启动一个流程实例表示开始一次业务流程的运作。例如员工提交请假申请后，就可以开启一个流程实例，从而推动后续的审批等操作。</li> <li>用户查询待办任务(task)：因为现在系统的业务流程都交给了activiti管理，通过 activiti就可以查询当前流程执行到哪个步骤了。当前用户需要办理哪些任务也就同样可以由activiti帮我们管理，开发人员不需要自己编写sql语句进行查询了。</li> <li>用户办理任务：用户查询到自己的待办任务后，就可以办理某个业务，如果这个业务办理完成还需要其他用户办理，就可以由activiti帮我们把工作流程往后面的步骤推动。</li> <li>流程结束：当任务办理完成没有下一个任务节点后，这个流程实例就执行完成了。</li></ul> <p>了解这些后，我们来开始进入实战内容</p> <h2 id="二、activiti环境搭建"><a href="#二、activiti环境搭建" class="header-anchor">#</a> 二、Activiti环境搭建</h2> <p>使用Activiti需要的基本环境包括： JDK 8或以上版本；然后需要一个数据库用来保存流程定义数据，建议mysql 5或以上版本。</p> <h3 id="_2-1-安装插件"><a href="#_2-1-安装插件" class="header-anchor">#</a> 2.1 安装插件</h3> <p>开发工具IDEA，在IDEA中需要安装Activiti的流程定义工具插件actiBPM。目前该插件从2014年11月后就没有再更新，对于IDEA版本只支持到2019.1。新版本的IDEA 已经无法从插件市场搜索到该插件。安装时，可以到jetBrain的插件市场 https://pl ugins.jetbrains.com/ 搜索actiBPM插件，下载到本地后，从本地安装该插件。
<img src="/assets/img/activitiIdeaPlugin.9d728262.png" alt=""></p> <p>安装完成后，就可以使用这个插件在项目中编辑.bpmn的文件来定义业务流程了。但是这个文件之前介绍过，他的本质是一个xml文本文件，所以还是需要更多的了解xml的配置方式。</p> <h3 id="_2-2-初始化数据库表"><a href="#_2-2-初始化数据库表" class="header-anchor">#</a> 2.2 初始化数据库表</h3> <p>activiti支持多种数据库，详细的版本情况如下：</p> <table><thead><tr><th style="text-align:center;">数据库类型</th> <th>版本</th> <th>JDBC连接示例</th> <th>说明</th></tr></thead> <tbody><tr><td style="text-align:center;">h2</td> <td>1.3.168</td> <td>jdbc:h2:tcp://localhost/activiti</td> <td>默认配置的数据库</td></tr> <tr><td style="text-align:center;">mysql</td> <td>5.1.21</td> <td>jdbc:mysql://localhost:3306/activiti?autoReconnect=true</td> <td>使用 mysql-connector-java 驱动测试</td></tr> <tr><td style="text-align:center;">oracle</td> <td>11.2.0.1.0</td> <td>jdbc:oracle:thin:@localhost:1521:xe</td> <td>使用oracle驱动测试</td></tr> <tr><td style="text-align:center;">postgres</td> <td>8.1</td> <td>jdbc:postgresql://localhost:5432/activiti</td> <td>使用postgres驱动测试</td></tr> <tr><td style="text-align:center;">db2</td> <td>DB2  10.1</td> <td>jdbc:db2://localhost:50000/activiti</td> <td>使用db2jcc4驱动测试</td></tr> <tr><td style="text-align:center;">mssql</td> <td>2008</td> <td>jdbc:sqlserver://localhost:1433/activiti</td> <td>使用sqljdbc4驱动测试</td></tr></tbody></table> <p>我们这里选择mysql数据库。接下来按照以下步骤来初始化activiti所需要的数据表。</p> <p>1- 在mysql中创建一个数据库activiti，将会用来创建activiti相关的表。</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>CREATE DATABASE activiti DEFAULT CHARACTER SET utf8;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后，activiti需要依赖的业务表有25张，而activiti中提供了工具帮我们生成所需要的表。</p> <p>2- 创建一个maven工程BasicDemo，在pom.xml中引入以下依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>1.6.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log4j.version</span><span class="token punctuation">&gt;</span></span>1.2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>log4j.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activiti.version</span><span class="token punctuation">&gt;</span></span>7.1.0.M6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activiti.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activiti.cloud.version</span><span class="token punctuation">&gt;</span></span>7.0.0.Beta1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activiti.cloud.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mysql.version</span><span class="token punctuation">&gt;</span></span>8.0.20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mysql.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${activiti.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${activiti.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- bpmn 模型处理 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-bpmn-model<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${activiti.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- bpmn 转换 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-bpmn-converter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${activiti.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- bpmn json数据转换 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-json-converter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${activiti.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- bpmn 布局 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-bpmn-layout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${activiti.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- activiti 云支持 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-cloud-services-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${activiti.cloud.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- mysql驱动 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mysql.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- mybatis --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 链接池 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-dbcp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-dbcp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- log start --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${log4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${slf4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${slf4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><p>3- 添加log4j日志配置
这里采用的是log4j来记录日志，所以需要在resources目录下创建log4j.properties文件来对日志进行配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># Set root category priority to INFO and its only appender to CONSOLE. 
#log4j.rootCategory=INFO, CONSOLE debug info warn error fatal 
log4j.rootCategory=debug, CONSOLE, LOGFILE 
# Set the enterprise logger category to FATAL and its only appender to CONSOLE. 
log4j.logger.org.apache.axis.enterprise=FATAL, CONSOLE 
# CONSOLE is set to be a ConsoleAppender using a PatternLayout. 
log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender 
log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout 
log4j.appender.CONSOLE.layout.ConversionPattern=%d{ISO8601} %-6r[%15.15t] %-5p %30.30c %x - %m\n 
# LOGFILE is set to be a File appender using a PatternLayout. 
log4j.appender.LOGFILE=org.apache.log4j.FileAppender 
log4j.appender.LOGFILE.File=f:\act\activiti.log 
log4j.appender.LOGFILE.Append=true 
log4j.appender.LOGFILE.layout=org.apache.log4j.PatternLayout 
log4j.appender.LOGFILE.layout.ConversionPattern=%d{ISO8601} %-6r[%15.15t] %-5p %30.30c %x - %m\n
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>4- 添加activiti的配置文件
activiti默认就会使用mysql来创建表。创建时需要先创建一个配置文件activiti.cfg.xml，来对数据源信息进行定义</p> <p>在resources目录下创建activiti.cfg.xml文件。</p> <p>注意：这个目录其实就是classpath下的默认位置。这是activiti默认读取 的目录和文件。</p> <p>创建在其他目录下也是可以的，但是就需要在生成时指定文件的目录和 名字。</p> <p>配置文件的基础内容如下： -这里主要是定义几个namespace。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/tx<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/contex 
       http://www.springframework.org/schema/context/spring-context.xsd 
       http://www.springframework.org/schema/tx 
       http://www.springframework.org/schema/tx/spring-tx.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>5- 在activiti.cfg.xml中进行配置</p> <p>我们可以在activiti.cfg.xml中添加关于数据库的基础配置</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/tx<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/contex 
       http://www.springframework.org/schema/context/spring-context.xsd 
       http://www.springframework.org/schema/tx 
       http://www.springframework.org/schema/tx/spring-tx.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
    <span class="token comment">&lt;!-- 这里可以使用 链接池 dbcp--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.commons.dbcp.BasicDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driverClassName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mysql.cj.jdbc.Driver<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://localhost:3306/activiti? serverTimezone=GMT%2B8<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>maxActive<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>maxIdle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>processEngineConfiguration<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
        <span class="token comment">&lt;!-- 引用数据源 上面已经设置好了--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span> 
        <span class="token comment">&lt;!-- activiti数据库表处理策略 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>databaseSchemaUpdate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>注意：</p> <ul><li>1、processEngineConfiguration这个名字最好不要修改。这是activiti读取的默认Bean名字。</li> <li>2、在processEngineConfiguration中也可以直接配置jdbcDriver、jdbcUrl、jdbcUsername、jdbcPassword几个属性。</li> <li>3、关于databaseSchemaUpdate这个属性，稍微跟踪一下源码就能看 到他的配置方式： 默认是false；表示不创建数据库，只是检查数据库中的表结构，不满足 就会抛出异常 create-drop：表示在引擎启动时创建表结构，引擎处理结束时删除表结构。true：表示创建完整表结构，并在必要时更新表结构。</li></ul> <p>6- 编写java程序生成表。
创建一个测试类，调用activiti的工具类，直接生成activiti需要的数据库表。代码如下</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCreateTable</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 生成 activiti的数据库表
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCreateDbTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//默认创建方式</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通用的创建方式，指定配置文件名和Bean名称</span>
<span class="token comment">//        ProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(&quot;activiti.cfg.xml&quot;, &quot;processEngineConfiguration&quot;);</span>
<span class="token comment">//        ProcessEngine processEngine1 = processEngineConfiguration.buildProcessEngine();</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>processEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>注意：
从这个代码就能看出我们之前那些默认配置的作用。ProcessEngines.getDefaultProcessEngine()这行代码默认就会去读取classpath:下的activiti.cfg.xml和activiti-context.xml两个配置文件。并且从spring容器中加载名为processEngineConfiguration的Bean。</p> <p>执行这个脚本就会完成mysql的表结构创建。如果执行正常，可以看到执行了一大堆的sql语句，最终打印出一行日志</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>org.activiti.engine.impl.ProcessEngineImpl@77307458
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这就表示引擎创建成功了。同时在mysql中可以看到activiti用到的25张表。
<img src="/assets/img/activitiTables.effc7368.png" alt="activitiTables"></p> <p>这些表机构通常也可以导出成sql文件，然后直接进行移植。但是考虑到不同版本可能会有微调，所以通常不建议以sql文件的方式移植。</p> <h3 id="_2-3-表结构解读"><a href="#_2-3-表结构解读" class="header-anchor">#</a> 2.3 表结构解读</h3> <p>从这些刚才创建的表中可以看到，activiti的表都以act_开头。第二个部分表示表的用途。用途也和服务的API对应。</p> <p>ACT_RE ：'RE'表示 repository。 这个前缀的表包含了流程定义和流程静态资源（图片，规则，等等）。</p> <p>ACT_RU：'RU'表示 runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti 只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。</p> <p>ACT_HI：'HI'表示 history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。</p> <p>ACT_GE ： GE 表示 general。 通用数据， 用于不同场景下</p> <p>完整的数据库表作用如下：</p> <table><thead><tr><th>表分类</th> <th>表名</th> <th>解释</th></tr></thead> <tbody><tr><td>一般数据</td> <td></td> <td></td></tr> <tr><td></td> <td>[ACT_GE_BYTEARRAY]</td> <td>通用的流程定义和流程资源</td></tr> <tr><td></td> <td>[ACT_GE_PROPERTY]</td> <td>系统相关属性</td></tr> <tr><td>流程历史记录</td> <td></td> <td></td></tr> <tr><td></td> <td>[ACT_HI_ACTINST]</td> <td>历史的流程实例</td></tr> <tr><td></td> <td>[ACT_HI_ATTACHMENT]</td> <td>历史的流程附件</td></tr> <tr><td></td> <td>[ACT_HI_COMMENT]</td> <td>历史的说明性信息</td></tr> <tr><td></td> <td>[ACT_HI_DETAIL]</td> <td>历史的流程运行中的细节信息</td></tr> <tr><td></td> <td>[ACT_HI_IDENTITYLINK]</td> <td>历史的流程运行过程中用户关系</td></tr> <tr><td></td> <td>[ACT_HI_PROCINST]</td> <td>历史的流程实例</td></tr> <tr><td></td> <td>[ACT_HI_TASKINST]</td> <td>历史的任务实例</td></tr> <tr><td></td> <td>[ACT_HI_VARINST]</td> <td>历史的流程运行中的变量信息</td></tr> <tr><td>流程定义表</td> <td></td> <td></td></tr> <tr><td></td> <td>[ACT_RE_DEPLOYMENT]</td> <td>部署单元信息</td></tr> <tr><td></td> <td>[ACT_RE_MODEL]</td> <td>模型信息</td></tr> <tr><td></td> <td>[ACT_RE_PROCDEF]</td> <td>已部署的流程定义</td></tr> <tr><td>流程定义表</td> <td></td> <td></td></tr> <tr><td></td> <td>[ACT_RU_EVENT_SUBSCR]</td> <td>运行时事件</td></tr> <tr><td></td> <td>[ACT_RU_EXECUTION]</td> <td>运行时流程执行实例</td></tr> <tr><td></td> <td>[ACT_RU_IDENTITYLINK]</td> <td>运行时用户关系信息，存储任务节点与参与者的相关信息</td></tr> <tr><td></td> <td>[ACT_RU_JOB]</td> <td>运行时作业</td></tr> <tr><td></td> <td>[ACT_RU_TASK]</td> <td>运行时任务</td></tr> <tr><td></td> <td>[ACT_RU_VARIABLE]</td> <td>运行时变量表</td></tr></tbody></table> <h3 id="_2-4-activiti核心类"><a href="#_2-4-activiti核心类" class="header-anchor">#</a> 2.4 Activiti核心类</h3> <p>当拿到ProcessEngine之后，我们可以简单的看一下他的方法
<img src="/assets/img/processEngineMethod.563fec5a.png" alt=""></p> <p>这几个service就是activiti最为核心的几个服务实现类。围绕activiti的核心业务功能大都通过这几个service来组成</p> <table><thead><tr><th>service名称</th> <th>service作用</th></tr></thead> <tbody><tr><td>RepositoryService</td> <td>activiti的资源管理类</td></tr> <tr><td>RuntimeService</td> <td>activiti的流程运行管理类</td></tr> <tr><td>TaskService</td> <td>activiti的任务管理类</td></tr> <tr><td>HistoryService</td> <td>activiti的历史管理类</td></tr> <tr><td>ManagerService</td> <td>activiti的引擎管理类</td></tr></tbody></table> <p>简单介绍：</p> <h4 id="repositoryservice"><a href="#repositoryservice" class="header-anchor">#</a> RepositoryService</h4> <p>是activiti的资源管理类，提供了管理和控制流程发布包和流程定义的操作。使用工 作流建模工具设计的业务流程图需要使用此service将流程定义文件的内容部署到计算机.</p> <p>除了部署流程定义以外还可以：查询引擎中的发布包和流程定义。</p> <p>暂停或激活发布包，对应全部和特定流程定义。 暂停意味着它们不能再执行任何操作了，激活是对应的反向操作。获得多种资源，像是包含在发布包里的文件， 或引擎自动生成的流程图。</p> <p>获得流程定义的pojo版本， 可以用来通过java解析流程，而不必通过xml。</p> <h4 id="runtimeservice"><a href="#runtimeservice" class="header-anchor">#</a> RuntimeService</h4> <p>Activiti的流程运行管理类。可以从这个服务类中获取很多关于流程执行相关的信息</p> <h4 id="taskservice"><a href="#taskservice" class="header-anchor">#</a> TaskService</h4> <p>Activiti的任务管理类。可以从这个类中获取任务的信息。</p> <h4 id="historyservice"><a href="#historyservice" class="header-anchor">#</a> HistoryService</h4> <p>Activiti的历史管理类，可以查询历史信息，执行流程时，引擎会保存很多数据（根据配置），比如流程实例启动时间，任务的参与者， 完成任务的时间，每个流程实例的执行路径，等等。 这个服务主要通过查询功能来获得这些数据。</p> <h4 id="managementservice"><a href="#managementservice" class="header-anchor">#</a> ManagementService</h4> <p>Activiti的引擎管理类，提供了对 Activiti 流程引擎的管理和维护功能，这些功能不在工作流驱动的应用程序中使用，主要用于 Activiti 系统的日常维护。</p> <h2 id="三、activiti入门"><a href="#三、activiti入门" class="header-anchor">#</a> 三、Activiti入门</h2> <p>在这一章，我们就来创建一个Activiti工作流，并启动这个工作流。了解Activiti的基础开发流程。</p> <p>创建Activiti工作流的主要步骤包含以下几步：</p> <ul><li><ol><li>定义流程。按照BPMN的规范，使用流程定义工具，将整个流程描述出来</li></ol></li> <li><ol start="2"><li>部署流程。把画好的BPMN流程定义文件加载到数据库中，生成相关的表数据</li></ol></li> <li><ol start="3"><li>启动流程。使用java代码来操作数据库表中的内容。</li></ol></li></ul> <h3 id="_3-1-流程符号详解"><a href="#_3-1-流程符号详解" class="header-anchor">#</a> 3.1 流程符号详解</h3> <p>接下来我们来了解下在流程设计中常见的符号。BPMN2.0的基本符号主要包含以下几类：</p> <ul><li>1、事件 Event</li></ul> <p><img src="/assets/img/Event.0cf4ad18.png" alt=""></p> <p>事件是驱动工作流发展的核心对象，在工作流的流程定制过程中会经常看到</p> <ul><li>2、活动 Activity</li></ul> <p><img src="/assets/img/Activity.bad10ada.png" alt=""></p> <p><strong>活动是工作或任务的一个通用术</strong>语。一个活动可以是一个任务，也可以是当前流程的子处理流程。并且，活动会有不同的类型。例如Activiti中定义了UserTask,ScriptTask,ServiceTask,MailTask等等多种类型。这些活动是构成整个业务流程的主体。</p> <ul><li>3、网关 GateWay</li></ul> <p><img src="/assets/img/GateWay.ed9d8015.png" alt=""></p> <p>网关是用来处理角色的，他决定了工作流的业务走向。有几种常用的网关需要了解一下：</p> <ul><li><ul><li>3.1 排他网关</li></ul> <p>只有一条路径会被选择。流程执行到该网关时，会按照输出流的顺序逐个计算，当条件的结果为true时，继续执行当前网关的输出流。</p> <p>如果有多条线路计算结构都是true，则会执行第一个值为true的路线。如果所有网关计算结果都没有true，引擎会抛出异常。</p> <p>排他网关需要和条件顺序流结合使用，default属性指定默认顺序流，当所有的条件不满足时会执行默认顺序流。</p></li> <li><ul><li>3.2 并行网关</li></ul></li></ul> <p>所有路径会被同时选择。</p> <p>并行执行所有输出顺序流，为每一条顺序流创建一个并行执行路线。最终，在所有的执行路线都执行完后才继续向下执行。</p> <ul><li><ul><li>3.3 包容网关</li></ul></li></ul> <p>可以同时执行多条路线。相当于是排他网关和并行网关的结合。</p> <p>可以在网关上设置条件，计算每条路线上的表达式。当表达式计算结果为true时，创建一个并行线路并继续执行。最终，当所有需要执行的线路都执行完成后才继续向下执行</p> <ul><li><ul><li>3.4 事件网关</li></ul></li></ul> <p>专门为中间捕获事件而设置。允许设置多个输出流指向多个不同的中间捕获事件。当流程执行到事件网关后，流程出于等待状态，需要等待抛出对应的事件才能将等待状态转换为活动状态。</p> <ul><li>4、流向 Flow</li></ul> <p><img src="/assets/img/Flow.be38e01a.png" alt=""></p> <p>流就是连接两个流程节点的连线，代表了流程之间的关联关系。</p> <p>注意：Activiti的BPMN符号是在标准符号基础上做了一定的扩展。你可以新建一个BPMN文件，然后对照actBPM工具提供的工作流图形来理解</p> <h3 id="_3-2-定制一个简单的请假流程"><a href="#_3-2-定制一个简单的请假流程" class="header-anchor">#</a> 3.2 定制一个简单的请假流程</h3> <p>首先在resources目录下创建bpmn目录，然后在目录下创建一个Bomn文件，起名Leave，表示是一个请假流程。</p> <p>然后我们在流程图中拖拽出下图的流程图</p> <p><img src="/assets/img/leaveEnvent.1402a7a0.png" alt=""></p> <p>这里注意每个模块都可以选中后在左侧设置他的属性。</p> <p><img src="/assets/img/leaveEnvent1.74f620d1.png" alt=""></p> <p>这里，Assignee属性表示是这个任务的负责人。这里我们给 创建出差申请 设置负责人 worker；部门经理审批 设置负责人 manager；财务审批 设置负责人financer。</p> <p>设置完成后，记得点击一下流程的空白页，在左侧设置整个流程的属性。</p> <p><img src="/assets/img/leaveEnvent2.1042d492.png" alt=""></p> <p>这样，我们整个员工出差申请的流程就定义完成了。之前介绍过，这个文件实际上是一个xml文件，所以，这个文件是可以用文本编辑器直接打开的。整个文件大致是这样</p> <p><img src="/assets/img/leaveEnvent3.2261cc68.png" alt=""></p> <p>其中根节点是definitions节点。在这个节点中，可以定义多个工作流程process节点。这也就意味着可以在一个图中定义多个工作流，但是通常在使用过程中建议一个文件只包含一个流程定义，这样可以简化维护难度。definitions节点中，xmlns和tagetNamespace两个属性是必须要包含的。</p> <p>然后在文件中，包含了以标签描述的流程定义部分以及以&lt;bpmndi:BPMNDiagram &gt;标签描述的流程布局定义部分。分别用来定义工作流程以及流程图的布局信息。</p> <p>文件关闭后，重新打开，可能会出现中文乱码的问题。这是因为IDEA的 字符集问题。此时，需要修改IDEA的配置文件。 在IDEA中选Help -&gt;Edit Custom VM Options 菜单，在打开的文件最后加上一行 -Dfile.encoding=UTF-8配置，然后重启IDEA即可。</p> <h3 id="_3-3-部署请假流程"><a href="#_3-3-部署请假流程" class="header-anchor">#</a> 3.3 部署请假流程</h3> <p>接下来，需要将设计器中定义的流程部署到activiti的数据库中。activiti提供了api将流程定义的bpmn和png文件部署到activiti中。</p> <p>要获取png图片文件，可以直接截图，也可以使用IDEA导出。导出时，先将文件修改为Leave.bpmn.xml，然后右键该文件，选择Diagrams -&gt; Shwo BPMN 2.0Diagrams，可以打开图片工具，然后选择上方的导出按钮，就可以导出一个png文件</p> <p><img src="/assets/img/leaveEnvent4.be3ab57f.png" alt=""></p> <p>部署流程时，可以分别上传bpmn文件和png文件，也可以将两个文件打成zip压缩包一起上传。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActivitiDemo</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 部署流程定义  文件上传方式
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//        1、创建ProcessEngine</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        2、得到RepositoryService实例</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        3、使用RepositoryService进行部署</span>
        <span class="token class-name">Deployment</span> deployment <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">&quot;bpmn/Leave.bpmn&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 添加bpmn资源</span>
                <span class="token comment">//png资源命名是有规范的。Leave.myLeave.png|jpg|gif|svg  或者Leave.png|jpg|gif|svg</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">&quot;bpmn/Leave.myLeave.png&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 添加png资源</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;请假申请流程&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        4、输出部署信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程部署id：&quot;</span> <span class="token operator">+</span> deployment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程部署名称：&quot;</span> <span class="token operator">+</span> deployment<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * zip压缩文件上传方式
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deployProcessByZip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 定义zip输入流</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">this</span>
                <span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>
                        <span class="token string">&quot;bpmn/Leave.zip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ZipInputStream</span> zipInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipInputStream</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取repositoryService</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine
                <span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 流程部署</span>
        <span class="token class-name">Deployment</span> deployment <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addZipInputStream</span><span class="token punctuation">(</span>zipInputStream<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程部署id：&quot;</span> <span class="token operator">+</span> deployment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程部署名称：&quot;</span> <span class="token operator">+</span> deployment<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>这个过程中，最重要的就是要去找repositoryService。执行完成后可以在日志中看到部署的情况</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>流程部署id：<span class="token number">1</span> 
流程部署名称：请假申请流程 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>并且，从日志中可以分析出整个部署过程操作了三张数据表:</p> <ul><li>act_re_deployment 流程定义部署表，每部署一次增加一条记录</li> <li>act_re_procdef 流程定义表，部署每个新的流程定义都会在这张表中增加一条记录。记录中的key就是流程定义中最为重要的字段。</li> <li>act_ge_bytearray 流程资源表 ，每个流程定义对应两个资源记录，bpmn和png。</li></ul> <p>一次部署可以部署多个流程定义 即act_re_deployment和act_re_procdef中的数据其实是一对多的。但是在实际开发中，建议一次部署只不是一个流程。</p> <h3 id="_3-4-启动流程实例"><a href="#_3-4-启动流程实例" class="header-anchor">#</a> 3.4 启动流程实例</h3> <p>一个业务流程部署到activiti后，就可以使用了。例如这个出差申请的流程部署完成后，就可以启动一个流程进行一次出差申请了。流程的执行过程主要通过RuntimeService服务来管理。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActivitiDemo</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 启动流程实例
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        1、创建ProcessEngine</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        2、获取RunTimeService</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        3、根据流程定义Id启动流程</span>
        <span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService
                <span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        输出内容</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义id：&quot;</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程实例id：&quot;</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前活动Id：&quot;</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getActivityId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>执行结果可以看到流程实例的情况：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>流程定义id：myLeave<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">4</span> 
流程实例id：<span class="token number">2501</span> 
当前活动<span class="token class-name">Id</span>：<span class="token keyword">null</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>继续查看日志，可以看到这个过程中涉及到的数据表：</p> <ul><li>act_hi_actinst 流程实例执行历史</li> <li>act_hi_identitylink 流程的参与用户历史信息</li> <li>act_hi_procinst 流程实例历史信息</li> <li>act_hi_taskinst 流程任务历史信息</li> <li>act_ru_execution 流程执行信息</li> <li>act_ru_identitylink 流程的参与用户信息</li> <li>act_ru_task 任务信息</li></ul> <h3 id="_3-5-任务查询"><a href="#_3-5-任务查询" class="header-anchor">#</a> 3.5 任务查询</h3> <p>流程启动后，任务的负责人就可以查询自己当前需要处理的待办任务了。任务相关的服务都是由TaskService管理。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token comment">/**
     * 查询当前个人待执行的任务
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindPersonalTaskList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//        任务负责人</span>
        <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">&quot;worker&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        创建TaskService</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        根据流程key 和 任务负责人 查询任务</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">)</span> <span class="token comment">//流程Key</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span><span class="token comment">//只查询该任务负责人的任务</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程实例id：&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务id：&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务负责人：&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务名称：&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>执行完成后可以看到当前流程的任务列表</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>流程实例id：<span class="token number">2501</span>
任务id：<span class="token number">2505</span> 
任务负责人：worker 
任务名称：创建请假申请
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当前请假流程启动后，就该等待worker用户提交请假申请了。实际中的请假申请流程应该是从worker提交请假申请开始，但是在activiti工作流中，都是从starter事件开始，这个关系要理清楚</p> <h3 id="_3-6-流程任务处理"><a href="#_3-6-流程任务处理" class="header-anchor">#</a> 3.6 流程任务处理</h3> <p>任务负责人查询到代办任务后，可以选择任务进行处理，完成任务。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token comment">// 完成任务</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        获取引擎</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        获取taskService</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        根据流程key 和 任务的负责人 查询任务</span>
<span class="token comment">//        返回一个任务对象</span>
        <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">)</span> <span class="token comment">//流程Key</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span><span class="token string">&quot;worker&quot;</span><span class="token punctuation">)</span>  <span class="token comment">//要查询的负责人</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        完成任务,参数：任务id</span>
        taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>这个任务完成后，这一个请假流程就推动到了下一个步骤，部门经理审批了。后续可以用不同的用户来推动流程结束。</p> <p>其实在完成审批任务的过程中，可以针对这个taskId，进行其他一些补充操作。例如添加Comment，添加附件，添加子任务，添加候选负责人等等。具体可以看下taskService的API。</p> <h3 id="_3-7-流程信息查询"><a href="#_3-7-流程信息查询" class="header-anchor">#</a> 3.7 流程信息查询</h3> <p>这一步可以查询流程相关信息，包含流程定义，流程部署，流程版本。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">/**
     * 查询流程定义
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryProcessDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//        获取引擎</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        repositoryService</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        得到ProcessDefinitionQuery 对象</span>
        <span class="token class-name">ProcessDefinitionQuery</span> processDefinitionQuery <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//          查询出当前所有的流程定义</span>
<span class="token comment">//          条件：processDefinitionKey =evection</span>
<span class="token comment">//          orderByProcessDefinitionVersion 按照版本排序</span>
<span class="token comment">//        desc倒叙</span>
<span class="token comment">//        list 返回集合</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> definitionList <span class="token operator">=</span> processDefinitionQuery<span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orderByProcessDefinitionVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//      输出流程定义信息</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> processDefinition <span class="token operator">:</span> definitionList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义 id=&quot;</span><span class="token operator">+</span>processDefinition<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义 name=&quot;</span><span class="token operator">+</span>processDefinition<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义 key=&quot;</span><span class="token operator">+</span>processDefinition<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义 Version=&quot;</span><span class="token operator">+</span>processDefinition<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程部署ID =&quot;</span><span class="token operator">+</span>processDefinition<span class="token punctuation">.</span><span class="token function">getDeploymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>执行后可以看到查询结果</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>流程定义 id<span class="token operator">=</span>myLeave<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">4</span> 
流程定义 name<span class="token operator">=</span>员工请假审批流程 
流程定义 key<span class="token operator">=</span>myLeave 
流程定义 <span class="token class-name">Version</span><span class="token operator">=</span><span class="token number">1</span> 
流程部署<span class="token constant">ID</span> <span class="token operator">=</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-8-删除流程"><a href="#_3-8-删除流程" class="header-anchor">#</a> 3.8 删除流程</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 流程部署id</span>
        <span class="token class-name">String</span> deploymentId <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>

        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 通过流程引擎获取repositoryService</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine
                <span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//删除流程定义，如果该流程定义已有流程实例启动则删除时出错</span>
        repositoryService<span class="token punctuation">.</span><span class="token function">deleteDeployment</span><span class="token punctuation">(</span>deploymentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置true 级联删除流程定义，即使该流程有流程实例启动也可以删除，设置为false非级别删除方式，如果流程</span>
<span class="token comment">//        repositoryService.deleteDeployment(deploymentId, true);</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>注：</p> <ul><li>1、这里只删除了流程定义，不会删除历史表信息</li> <li>2、删除任务时，可以选择传入一个boolean型的变量cascade ，表示是 否级联删除。默认是false，表示普通删除。如果该流程下存在已经运行的流程，使用普通删除会报错，而级联删除 可以将流程及相关记录全部删除。删除没有完成的流程节点后，就可以完全删除流程定义信息了。项目开发中，级联删除操作一般只开放给管理员使用。</li></ul> <h3 id="_3-9-流程资源下载"><a href="#_3-9-流程资源下载" class="header-anchor">#</a> 3.9 流程资源下载</h3> <p>在流程执行过程中，可以上传流程资源文件。我们之前在部署流程时，已经将bpmn和描述bpmn的png图片都上传了，并且在流程执行过程中，也可以上传资源文件。如果其他用户想要查看这些资源文件，可以从数据库中把资源文件下载下来。</p> <p>但是文件是以Blob的方式存在数据库中的，要获取Blob文件，可以使用JDBC来处理。也可以使用activiti提供的api来辅助实现。我们这里采用activiti的方式来实现。</p> <p>首先引入commons-io依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>然后，就可以通过流程定义对象来获取流程资源。这里获取我们之前上传的bpmn和png文件</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">queryBpmnFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
<span class="token comment">//        1、得到引擎</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        2、获取repositoryService</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        3、得到查询器：ProcessDefinitionQuery，设置查询条件,得到想要的流程定义</span>
        <span class="token class-name">ProcessDefinition</span> processDefinition <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        4、通过流程定义信息，得到部署ID</span>
        <span class="token class-name">String</span> deploymentId <span class="token operator">=</span> processDefinition<span class="token punctuation">.</span><span class="token function">getDeploymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        5、通过repositoryService的方法，实现读取图片信息和bpmn信息</span>
<span class="token comment">//        png图片的流</span>
        <span class="token class-name">InputStream</span> pngInput <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>deploymentId<span class="token punctuation">,</span> processDefinition<span class="token punctuation">.</span><span class="token function">getDiagramResourceName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        bpmn文件的流</span>
        <span class="token class-name">InputStream</span> bpmnInput <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>deploymentId<span class="token punctuation">,</span> processDefinition<span class="token punctuation">.</span><span class="token function">getResourceName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        6、构造OutputStream流</span>
        <span class="token class-name">File</span> file_png <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;d:/myLeave.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> file_bpmn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;d:/myLeave.bpmn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileOutputStream</span> bpmnOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>file_bpmn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileOutputStream</span> pngOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>file_png<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        7、输入流，输出流的转换</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>pngInput<span class="token punctuation">,</span>pngOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>bpmnInput<span class="token punctuation">,</span>bpmnOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        8、关闭流</span>
        pngOut<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bpmnOut<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pngInput<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bpmnInput<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>注：
在获取资源文件名时，png图片资源的文件名是processDefinition.getDiagramResourceName()，他来自于ACT_RE_PROCDEF表中的DGRM_RESOURCE_NAME字段。这个字段的值是在部署流程时根据文件名后缀判断出来的。 支持的格式为[ResourceName].[key].[png|jpg|gif|svg]或者[ResourceName].[png|jpg|gif|svg]而bpmn文件的文件名是processDefinition.getResourceName()，他来自于ACT_RE_PROCDEF表中的RESOURCE_NAME字段</p> <h3 id="_3-10-流程历史信息查看"><a href="#_3-10-流程历史信息查看" class="header-anchor">#</a> 3.10 流程历史信息查看</h3> <p>流程的历史信息都保存在activiti的act_hi_*相关的表中，我们可以查询流程执行的历史信息。这里需要通过HistoryService来查看相关的历史记录。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">/**
     * 查看历史信息
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findHistoryInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//      获取引擎</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        获取HistoryService</span>
        <span class="token class-name">HistoryService</span> historyService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getHistoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        获取 actinst表的查询对象</span>
        <span class="token class-name">HistoricActivityInstanceQuery</span> instanceQuery <span class="token operator">=</span> historyService<span class="token punctuation">.</span><span class="token function">createHistoricActivityInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        查询 actinst表，条件：根据 InstanceId 查询，查询一个流程的所有历史信息</span>
        instanceQuery<span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span><span class="token string">&quot;2501&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        查询 actinst表，条件：根据 DefinitionId 查询，查询一种流程的所有历史信息</span>
<span class="token comment">//        instanceQuery.processDefinitionId(&quot;myLeave:1:22504&quot;);</span>
<span class="token comment">//        增加排序操作,orderByHistoricActivityInstanceStartTime 根据开始时间排序 asc 升序</span>
        instanceQuery<span class="token punctuation">.</span><span class="token function">orderByHistoricActivityInstanceStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        查询所有内容</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HistoricActivityInstance</span><span class="token punctuation">&gt;</span></span> activityInstanceList <span class="token operator">=</span> instanceQuery<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        输出</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HistoricActivityInstance</span> hi <span class="token operator">:</span> activityInstanceList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hi<span class="token punctuation">.</span><span class="token function">getActivityId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hi<span class="token punctuation">.</span><span class="token function">getActivityName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hi<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hi<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;==========================&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>这样可以查询到之前的步骤处理结果</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>_2
<span class="token class-name">StartEvent</span> 
myLeave<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">22504</span> 
<span class="token number">25001</span> 
<span class="token operator">&lt;=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> 
_3
创建请假申请 
myLeave<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">22504</span> 
<span class="token number">25001</span> 
<span class="token operator">&lt;=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> 
_4
部门经理审批 
myLeave<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">22504</span> 
<span class="token number">25001</span> 
<span class="token operator">&lt;=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>注：
1、关于流程历史信息，要注意，在删除流程时，如果是采取级联删除的方式，那这个历史信息也会随着一起删除。而普通删除方式不会删除历史信息。
2、历史信息有不同的种类，具体可以通过historyService构建不同类型的Query对象来获取结果。</p> <h3 id="_3-11-篇章总结"><a href="#_3-11-篇章总结" class="header-anchor">#</a> 3.11 篇章总结</h3> <p>通过这一章的内容，我们已经完成了一个工作流的基础流程，也能对activiti的工作机制有个大致的了解。</p> <p>activiti的强大之处在于，他围绕BPMN2.0构建的工作流程定义，提供了一系列完整的后台工作流功能。这些后台功能可以构成一个稳定的后台程序，针对不同的业务流程，只需要提供不同的BPMN定义文件，而不需要修改后台程度代码。并且，当业务流程发生变动时，也只需要修改BPMN文件中的流程定义，相应的后台代码基本不需要动。</p> <p>但是也要看到，activiti只提供了后台功能，并没有配套的前端整合。并且，当需要对某一个任务或者某一个工作流做一些细致性的操作时，还是需要传入一些特定的业务参数，而这些业务参数，还是需要有个系统来进行整体的处理的。所以，activiti是一个强大的工作流引擎，但是距离一个完整的工作流系统还是有点差距的</p> <p>另外，在学习activiti时，数据库中的25张表也是非常关键的地方，这些最终保存的数据中包含了工作流运行过程中的所有数据。在实际使用中，我们基本不可能完全搞明白这25张表的数据内容，但是对于一些关键的操作数据还是需要了解下的，这是我们以后掌握整个工作流引擎运行状态的重要依据。</p> <p>在我们对Activiti有了大致的理解后，接下来将深入一些Activiti的进阶功能。</p> <h2 id="四、activiti进阶"><a href="#四、activiti进阶" class="header-anchor">#</a> 四、Activiti进阶</h2> <h3 id="_4-1-流程定义与流程实例"><a href="#_4-1-流程定义与流程实例" class="header-anchor">#</a> 4.1 流程定义与流程实例</h3> <p>流程定义 ProcessDefinition 和流程实例 ProcessInstance是Activiti中非常重要的两个概念。他们的关系其实类似于JAVA中类和对象的概念。</p> <p>流程定义ProcessDefinition是以BPMN文件定义的一个工作流程，是一组工作规范。例如我们之前定义的请假流程。流程实例ProcessInstance则是指一个具体的业务流程。例如某个员工发起一次请假，就会实例化一个请假的流程实例，并且每个不同的流程实例之间是互不影响的。</p> <p>在后台的表结构中，有很多张表都包含了流程定义ProcessDefinetion和流程实例ProcessInstance的字段。流程定义的字段通常是PROC_DEF_ID，而流程实例的字段通常是PROC_INST_ID。</p> <h4 id="_4-1-1-启动流程实例时-添加businesskey"><a href="#_4-1-1-启动流程实例时-添加businesskey" class="header-anchor">#</a> 4.1.1 启动流程实例时，添加Businesskey</h4> <p>在之前的简单案例中，我们启动一个流程实例的关键代码其实就是这一行。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService <span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当我们去查看下startProcessInstanceByKey这个方法时，会看到这个方法有好几个重载的实现方法，可以传一些不同的参数。其中几个重要的参数包括</p> <ul><li>String processDefinitionKey：流程定义的唯一键 不能为空</li> <li>String businessKey：每个线程实例上下文中关联的唯一键。这个也是我们这一章节要介绍的重点。</li> <li>Map&lt;String,Object&gt; variables：在线程实例中传递的流程变量。这个流程变量可以在整个流程实例中使用，后面会介绍到。</li> <li>String tenantId：租户ID，这是Activiti的多租户设计。相当于每个租户可以上来获取一个相对独立的运行环境。
这一章节我们来介绍这个businessKey，业务关键字。这是Activiti提供的一个非常重要的便利，用来将activiti的工作流程与实际业务进行关联。</li></ul> <p>例如，当我们需要对一个业务订单进行审批时，订单的详细信息并不在activiti的数据当中，但是在审批时确实需要查看这些订单的详细信息。这个时候，就可以用这个businessKey来关联订单ID，这样在业务系统中，就可以通过这个订单ID去关联订单详细信息，审批人员就可以快速拿来进行参考。</p> <p>进行实际业务整合时，这个businessKey可以根据业务场景，设计成不同的数据格式，比如关键信息逗号拼接，甚至是json都可以，唯一需要注意的是这个字段的数据库长度设计是255，不要超出了数据库的长度限制。</p> <p>接下来，我们看看如何在流程实例执行过程中获取这个业务关键字：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token comment">/**
     * 查询流程实例
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryProcessInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 流程定义key</span>
        <span class="token class-name">String</span> processDefinitionKey <span class="token operator">=</span> <span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取RunTimeService</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessInstance</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> runtimeService
                <span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span>processDefinitionKey<span class="token punctuation">)</span><span class="token comment">//</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----------------------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程实例id：&quot;</span>
                    <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;所属流程定义id：&quot;</span>
                    <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;是否执行完成：&quot;</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">isEnded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;是否暂停：&quot;</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">isSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前活动标识：&quot;</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getActivityId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;业务关键字：&quot;</span><span class="token operator">+</span>processInstance<span class="token punctuation">.</span><span class="token function">getBusinessKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>通过最后面的一行processInstance.getBusinessKey()就能获取到当前流程实例中的业务关键字。在数据库中，act_ru_execution表中的BUSINESS_KEY字段就是用来保存这个业务关键字的。</p> <h4 id="_4-1-2-挂起、激活流程实例"><a href="#_4-1-2-挂起、激活流程实例" class="header-anchor">#</a> 4.1.2 挂起、激活流程实例</h4> <p>之前我们已经测试了如何删除一个流程，有很多时候，我们只是需要暂时停止一个流程，过一段时间就要恢复。例如月底不接受报销审批流程，年底不接受借贷审批流程，或者非工作日不接受售后报销流程等，这个时候，就可以将流程进行挂起操作。挂起后的流程就不会再继续执行。</p> <p>在挂起流程时，有两种操作方式。</p> <p>一种是将整个流程定义Process Definition挂起，这样，这个流程定义下的所有流程实例都将挂起，无法继续执行</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">/**
     * 全部流程实例的 挂起和 激活
     * suspend 暂停
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">suspendAllProcessInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        1、获取流程引擎</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        2、获取Repositoryservice</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        3、查询流程定义,获取流程定义的查询对象</span>
        <span class="token class-name">ProcessDefinition</span> processDefinition <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        4、获取当前流程定义的实例是否都是挂起状态</span>
        <span class="token keyword">boolean</span> suspended <span class="token operator">=</span> processDefinition<span class="token punctuation">.</span><span class="token function">isSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        5、获取流程定义的id</span>
        <span class="token class-name">String</span> definitionId <span class="token operator">=</span> processDefinition<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        6、如果是挂起状态，改为激活状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>suspended<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//            如果是挂起，可以执行激活的操作,参数1：流程定义id 参数2：是否激活，参数3：激活时间</span>
            repositoryService<span class="token punctuation">.</span><span class="token function">activateProcessDefinitionById</span><span class="token punctuation">(</span>definitionId<span class="token punctuation">,</span>
                    <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义id:&quot;</span><span class="token operator">+</span>definitionId<span class="token operator">+</span><span class="token string">&quot;，已激活&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token comment">//        7、如果是激活状态，改为挂起状态,参数1：流程定义id 参数2：是否暂停 参数3 ：暂停的时间</span>
            repositoryService<span class="token punctuation">.</span><span class="token function">suspendProcessDefinitionById</span><span class="token punctuation">(</span>definitionId<span class="token punctuation">,</span>
                    <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义id:&quot;</span><span class="token operator">+</span>definitionId<span class="token operator">+</span><span class="token string">&quot;，已挂起&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>另一种方式是将某一个具体的流程实例挂起。例如对某一个有问题的请假申请进行挂起操作，数据调整完成后再进行激活。继续执行挂起状态的流程将会抛出异常</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * 挂起、激活单个流程实例
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">suspendSingleProcessInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        1、获取流程引擎</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        2、RuntimeService</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        3、通过RuntimeService获取流程实例对象</span>
        <span class="token class-name">ProcessInstance</span> instance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span><span class="token string">&quot;7501&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        4、得到当前流程实例的暂停状态,true-已暂停  false -激活</span>
        <span class="token keyword">boolean</span> suspended <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">isSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        5、获取流程实例id</span>
        <span class="token class-name">String</span> instanceId <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        6、判断是否已经暂停，如果已经暂停，就执行激活操作</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>suspended<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//            如果已经暂停，就执行激活</span>
            runtimeService<span class="token punctuation">.</span><span class="token function">activateProcessInstanceById</span><span class="token punctuation">(</span>instanceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程实例id:&quot;</span><span class="token operator">+</span>instanceId<span class="token operator">+</span><span class="token string">&quot;已经激活&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token comment">//        7、如果是激活状态，就执行暂停操作</span>
            runtimeService<span class="token punctuation">.</span><span class="token function">suspendProcessInstanceById</span><span class="token punctuation">(</span>instanceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程实例id:&quot;</span><span class="token operator">+</span>instanceId<span class="token operator">+</span><span class="token string">&quot;已经暂停&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_4-2-流程变量"><a href="#_4-2-流程变量" class="header-anchor">#</a> 4.2 流程变量</h3> <p>流程变量也是Activiti中非常重要的角色。我们之前定义的请假流程并没有用到流程变量，每个步骤都是非常固定的，但是，当我们需要实现一些复杂的业务流程，比如请假3天以内由部门经理审批，3天以上需要增加总经理审批这样的流程时，就需要用到流程变量了。</p> <p>注：这个流程变量和之前介绍的业务关键字其实是有些相似的，都可以携带业务信息。并且也都可以通过activiti的api查询出来。但是通常在使用过程中，应该尽量减少流程变量中的业务信息，这样能够减少业务代码对activiti工作流的代码侵入。</p> <p>在上一章节介绍到，流程变量的类型是Map&lt;String,Object&gt;。所以，流程变量比业务关键字要强大很多。变量值不仅仅是字符串，也可以是POJO对象。但是当需要将一个POJO对象放入流程变量时，要注意这个对象必须要实现序列化接口serializable</p> <h4 id="_4-2-1-流程变量的作用域"><a href="#_4-2-1-流程变量的作用域" class="header-anchor">#</a> 4.2.1 流程变量的作用域</h4> <p>变量的作用域可以设置为Global和Local两种。</p> <ul><li><p>Global变量
这个是流程变量的默认作用域，表示是一个完整的流程实例。 Global变量中变量名不能重复。如果设置了相同的变量名，后面设置的值会直接覆盖前面设置的变量值。</p></li> <li><p>Local 变量
Local变量的作用域只针对一个任务或一个执行实例的范围，没有流程实例大。Local变量由于作用在不同的任务或不同的执行实例中，所以不同变量的作用域是互不影响的，变量名可以相同。Local变量名也可以和Global变量名相同，不会有影响。</p></li></ul> <h4 id="_4-2-2-使用流程变量"><a href="#_4-2-2-使用流程变量" class="header-anchor">#</a> 4.2.2 使用流程变量</h4> <p>定义好流程变量后，就可以在整个流程定义中使用这些流程变量了。例如可以在某些任务属性如assignee上使用${assignee}，或者在某些连线上使用${day&lt;3}。</p> <p>Activiti中可以使用UEL表达式来使用这些流程变量。UEL表达式可以直接获取一个变量的值，可以计算一个Boolean结果的表达式，还可以直接使用某些对象的属性。例如对于之前创建的请假流程，如果要实现3天以内部门经理审核，3天以上增加总经理审核，可以做如下调整：</p> <p><img src="/assets/img/leaveEnvent5.be6c376b.png" alt=""></p> <p>1）、出差天数大于等于3连线条件</p> <p><img src="/assets/img/leaveEnvent6.814fb16e.png" alt=""></p> <p>也可以使用对象参数命名，如evection.num：</p> <p><img src="/assets/img/leaveEnvent7.49d29eed.png" alt=""></p> <p>2）、出差天数小于3连线条件</p> <p><img src="/assets/img/leaveEnvent8.9e880cad.png" alt=""></p> <p>也可以使用对象参数命名，如：</p> <p><img src="/assets/img/leaveEnvent9.5cb7fc73.png" alt=""></p> <h4 id="_4-2-3-设置global流程变量"><a href="#_4-2-3-设置global流程变量" class="header-anchor">#</a> 4.2.3 设置Global流程变量</h4> <p>在流程定义中使用到了流程变量，就需要在后台JAVA代码中设置对应的流程变量。实际上在流程执行的很多过程中都可以设计自流程变量。</p> <ul><li>1） 启动流程时设置变量
在启动流程实例时设置流程变量，这时流程变量的作用域是整个流程实例。相当于是Global作用域。核心代码：</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>2）任务办理时设置变量
在完成任务时设置流程变量，该流程变量只有在该任务完成后其它结点才可使用该变量，它的作用域是整个流程实例，如果设置的流程变量的key在流程实例中已存在相同的名字则后设置的变量替换前边设置的变量。核心代码：</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：这种方式设置流程变量，如果当前执行的任务ID不存在，则会抛出异常，流程变量也会设置失败</p> <ul><li>3） 通过当前流程实例设置</li></ul> <p>通过流程实例id设置全局变量，该流程实例必须未执行完成。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setGlobalVariableByExecutionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 当前流程实例执行 id，通常设置为当前执行的流程实例</span>
        <span class="token class-name">String</span> executionId<span class="token operator">=</span><span class="token string">&quot;2601&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取processEngine</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取RuntimeService</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建出差pojo对象</span>
        <span class="token class-name">Evection</span> evection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Evection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置天数</span>
        evection<span class="token punctuation">.</span><span class="token function">setNum</span><span class="token punctuation">(</span><span class="token number">3d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 通过流程实例 id设置流程变量</span>
        runtimeService<span class="token punctuation">.</span><span class="token function">setVariable</span><span class="token punctuation">(</span>executionId<span class="token punctuation">,</span> <span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">,</span> evection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一次设置多个值</span>
        <span class="token comment">//  runtimeService.setVariables(executionId, variables)</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>注意：ececutionId必须是当前未完成的流程实例的执行ID。通常此ID设置流程实例的ID。流程变量设计完成后，也可以通过runtimeService.getVariable()获取流程变量</p> <ul><li>4） 通过当前任务设置</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setGlobalVariableByTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//当前待办任务id</span>
        <span class="token class-name">String</span> taskId<span class="token operator">=</span><span class="token string">&quot;1404&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取processEngine</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Evection</span> evection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Evection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        evection<span class="token punctuation">.</span><span class="token function">setNum</span><span class="token punctuation">(</span><span class="token number">3d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通过任务设置流程变量</span>
        taskService<span class="token punctuation">.</span><span class="token function">setVariable</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> <span class="token string">&quot;evection&quot;</span><span class="token punctuation">,</span> evection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//一次设置多个值</span>
        <span class="token comment">// taskService.setVariables(taskId, variables)</span>
        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>注： 任务id必须是当前待办任务id，act_ru_task中存在。如果该任务已结束，会报错。也可以通过taskService.getVariable()获取流程变量。</p> <p>注意事项
1、 如果UEL表达式中流程变量名不存在则报错。
2、 如果UEL表达式中流程变量值为空NULL，流程不按UEL表达式去执行，而流程结束 。
3、 如果UEL表达式都不符合条件，流程结束
4、 如果连线不设置条件，会走flow序号小的那条线
5、设置流程变量会在当前执行流程变量表act_ru_variable中插入记录，同时也会在历史流量变量表act_hi_varinst中也插入记录。</p> <h4 id="_4-2-4-设置local流程变量"><a href="#_4-2-4-设置local流程变量" class="header-anchor">#</a> 4.2.4 设置Local流程变量</h4> <p>local流程变量同样可以有多个设置的地方。</p> <p>1） 任务办理时设置
任务办理时设置local流程变量，当前运行的流程实例只能在该任务结束前使用，任务结束该变量无法在当前流程实例使用，可以通过查询历史任务查询。关键代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 设置local变量，作用域为该任务 </span>
taskService<span class="token punctuation">.</span><span class="token function">setVariablesLocal</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 完成任务 </span>
taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2）通过当前任务设置</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLocalVariableByTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 当前待办任务id </span>
        <span class="token class-name">String</span> taskId <span class="token operator">=</span> <span class="token string">&quot;1404&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取processEngine </span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Evection</span> evection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Evection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        evection<span class="token punctuation">.</span><span class="token function">setNum</span><span class="token punctuation">(</span><span class="token number">3d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 通过任务设置流程变量 </span>
        taskService<span class="token punctuation">.</span><span class="token function">setVariableLocal</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> <span class="token string">&quot;evection&quot;</span><span class="token punctuation">,</span> evection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一次设置多个值 </span>
        <span class="token comment">// taskService.setVariablesLocal(taskId, variables) </span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>注： 任务ID必须是当前待办任务id，要在act_ru_task中存在</p> <h3 id="_4-3-网关"><a href="#_4-3-网关" class="header-anchor">#</a> 4.3 网关</h3> <p>网关是用来控制流程流向的重要组件，通常都会要结合流程变量来使用。</p> <h4 id="_4-3-1-排他网关exclusivegateway"><a href="#_4-3-1-排他网关exclusivegateway" class="header-anchor">#</a> 4.3.1 排他网关ExclusiveGateway</h4> <p>排他网关，用来在流程中实现决策。 当流程执行到这个网关，所有分支都会判断条件是否为true，如果为true则执行该分支，</p> <p>注意：排他网关只会选择一个为true的分支执行。如果有两个分支条件都为true，排他网关会选择id值较小的一条分支去执行。</p> <p>为什么要用排他网关？</p> <p>不用排他网关也可以实现分支，如：在连线的condition条件上设置分支条件。</p> <p>在连线设置condition条件的缺点：如果条件都不满足，流程就结束了(是异常结束)。</p> <p>如果 使用排他网关决定分支的走向，如下：</p> <p><img src="/assets/img/ExclusiveGateway.b35eb00b.png" alt=""></p> <p>如果从网关出去的线所有条件都不满足则系统抛出异常。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span>ActivitiException</span><span class="token operator">:</span> <span class="token class-name">No</span> outgoing sequence flow of the exclusive gateway 'exclusivegateway1' could be selected <span class="token keyword">for</span> continuing the process
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4-3-2-并行网关parallelgateway"><a href="#_4-3-2-并行网关parallelgateway" class="header-anchor">#</a> 4.3.2 并行网关ParallelGateway</h4> <p>并行网关允许将流程分成多条分支，也可以把多条分支汇聚到一起，并行网关的功能是基于进入和外出顺序流的：</p> <p>fork分支：并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。</p> <p>join汇聚： 所有到达并行网关，在此等待的进入分支， 直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。</p> <p>注意，如果同一个并行网关有多个进入和多个外出顺序流， 它就同时具有分支和汇聚功能。 这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。</p> <p>与其他网关的主要区别是，并行网关不会解析条件。 即使顺序流中定义了条件，也会被忽略。</p> <p><img src="/assets/img/ParallelGateway.3adf1242.png" alt=""></p> <p>说明：此时会要求技术经理和项目经理都进行审批。而连线上的条件会被忽略。</p> <p>技术经理和项目经理是两个execution分支，在act_ru_execution表有两条记录分别是技术经理和项目经理，act_ru_execution还有一条记录表 示该流程实例。</p> <p>待技术经理和项目经理任务全部完成，在汇聚点汇聚，通过parallelGateway并行网关。并行网关在业务应用中常用于会签任务，会签任务即多个参与者共同办理的任务</p> <h4 id="_4-3-3-包含网关inclusivegateway"><a href="#_4-3-3-包含网关inclusivegateway" class="header-anchor">#</a> 4.3.3 包含网关InclusiveGateway</h4> <p>包含网关可以看做是排他网关和并行网关的结合体。</p> <p>和排他网关一样，你可以在外出顺序流上定义条件，包含网关会解析它们。 但是主要的区别是包含网关可以选择多于一条顺序流，这和并行网关一样。</p> <p>包含网关的功能是基于进入和外出顺序流的:</p> <p>分支： 所有外出顺序流的条件都会被解析，结果为true的顺序流会以并行方式继续执行， 会为每个顺序流创建一个分支。</p> <p>汇聚： 所有并行分支到达包含网关，会进入等待状态， 直到每个包含流程token的进入顺序流的分支都到达。 这是与并行网关的最大不同。换句话说，包含网关只会等待被选中执行了的进入顺序流。 在汇聚之后，流程会穿过包含网关继续执行。</p> <p><img src="/assets/img/InclusiveGateway.fedbebba.png" alt=""></p> <p>说明：这里当请假天数超过3天，需要项目经理和人事经理一起审批。而请假天数不超过3填，需要技术经理和人事经理一起审批。</p> <p>所有符合条件的分支也会在后面进行汇聚。</p> <h4 id="_4-3-4-事件网关eventgateway"><a href="#_4-3-4-事件网关eventgateway" class="header-anchor">#</a> 4.3.4 事件网关EventGateway</h4> <p>事件网关允许根据事件判断流向。网关的每个外出顺序流都要连接到一个中间捕获事件。 当流程到达一个基于事件网关，网关会进入等待状态：会暂停执行。与此同时，会为每个外出顺序流创建相对的事件订阅。</p> <p>事件网关的外出顺序流和普通顺序流不同，这些顺序流不会真的&quot;执行&quot;， 相反它们让流程引擎去决定执行到事件网关的流程需要订阅哪些事件。 要考虑以下条件：</p> <ul><li>1.事件网关必须有两条或以上外出顺序流；</li> <li>2.事件网关后，只能使用intermediateCatchEvent类型（activiti不支持基于事件网关后连接ReceiveTask）</li> <li>3.连接到事件网关的中间捕获事件必须只有一个入口顺序流</li></ul> <p>与事件网关配合使用的intermediateCatchEvent:</p> <p><img src="/assets/img/intermediateCatchEvent.277dbefb.png" alt=""></p> <p>这个事件支持多种事件类型：</p> <p>Message Event：消息事件</p> <p>Singal Event： 信号事件</p> <p>Timer Event： 定时事件</p> <p><img src="/assets/img/EventTYPE.e2af94a4.png" alt=""></p> <p>使用事件网关定义流程：</p> <p><img src="/assets/img/eventType1.5d43872b.png" alt=""></p> <h3 id="_4-4-个人任务管理"><a href="#_4-4-个人任务管理" class="header-anchor">#</a> 4.4 个人任务管理</h3> <h4 id="_4-4-1-分配任务负责人"><a href="#_4-4-1-分配任务负责人" class="header-anchor">#</a> 4.4.1 分配任务负责人</h4> <p>在之前的简单示例中，我们已经可以通过配置Assignee属性来指定任务的负责人。但是我们之前的示例中，是简单的配置为worker、manager、finacer等这样的固定的任务人。但是在实际工作中，往往不会是这样固定的人。可能是对应某个职位或者某个角色的系统用户。这时，这种固定分配的方式就非常不灵活了。这时，就可以使用UEL表达式配合流程变量来灵活指定。例如这样：</p> <p><img src="/assets/img/assignee.8cd7f387.png" alt=""></p> <p>这个assignee0就对应activiti中的一个流程变量。</p> <p>而如果配置成${user.assignee}表示通过user的getter方法获取属性值</p> <p>也可以配置成使用具体的方法${user.getUserId()}。</p> <p>甚至可以结合Spring容易来使用。例如 ${ldapService.findManagerForEmployee(emp)} ldapService 是 spring 容器的一个 bean，findManagerForEmployee 是该 bean 的一个方法，emp 是 activiti 流程变量， emp 作为参数传到 ldapService.findManagerForEmployee 方法中。</p> <p>配置了这个流程后，可以配合流程变量使用。例如：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">startAssigneeUel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        获取流程引擎</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        获取RunTimeService</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        设定assignee的值，用来替换uel表达式</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> assigneeMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        assigneeMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;assignee0&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        assigneeMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;assignee1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;李经理&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        assigneeMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;assignee2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;王总经理&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        assigneeMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;assignee3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;赵财务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        启动流程实例</span>
        runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">&quot;myEvection1&quot;</span><span class="token punctuation">,</span>assigneeMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>执行完成后，可以在act_ru_variable表中看到刚才map中的数据</p> <p><img src="/assets/img/variableData.7f05f746.png" alt=""></p> <p>注意事项
由于使用表达式分配，必须保证在任务执行过程中表达式执行成功。否则会抛出activiti异常</p> <h3 id="_4-5-组任务分配"><a href="#_4-5-组任务分配" class="header-anchor">#</a> 4.5 组任务分配</h3> <h4 id="_4-5-1-设置多个候选责任人"><a href="#_4-5-1-设置多个候选责任人" class="header-anchor">#</a> 4.5.1 设置多个候选责任人</h4> <p>之前我们已经可以给任务灵活的设定负责人。但是在日常工作中，还有一类非常常见的需求无法支持。例如某个订单合同，需要找部门经理级别的负责人签字。而公司中有多个部门经理，业务上只需要找其中任意一个人完成审批就可以了。 这种场景下，我们就无法通过设置流程变量的方式来设置负责人。这时，就需要用到Activiti提供的另一个利器-任务候选人Candidate Users。</p> <p>这时，可以给任务设置多个候选人 candidate-uses，多个候选人之间用逗号隔开。</p> <p><img src="/assets/img/candidateUses.0b374b2f.png" alt="">
在BPMN文件中可以看到</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">&lt;</span>userTask activiti<span class="token operator">:</span>candidateUsers<span class="token operator">=</span><span class="token string">&quot;lisi,wangwu&quot;</span> activiti<span class="token operator">:</span>exclusive<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;_3&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;经理审批&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样就给这个任务设置了一组候选人。</p> <h4 id="_4-5-2-组任务办理流程"><a href="#_4-5-2-组任务办理流程" class="header-anchor">#</a> 4.5.2 组任务办理流程</h4> <p>给任务分配了候选人后，后续就需要这些候选人主动认领自己的业务，然后进行处理。</p> <p>1、查询组任务
指定候选人，查询该候选人当前的待办任务。候选人不能立即办理任务，需要先认领业务。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">/**
     * 查询组任务
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findGroupTaskList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//        流程定义的Key</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">&quot;testCandidate&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//        任务候选人</span>
        <span class="token class-name">String</span> candidateUser <span class="token operator">=</span> <span class="token string">&quot;wangwu&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//        获取引擎</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        获取TaskService</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        查询组任务</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskCandidateUser</span><span class="token punctuation">(</span>candidateUser<span class="token punctuation">)</span> <span class="token comment">//根据候选人查询任务</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> taskList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;========================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程实例ID=&quot;</span><span class="token operator">+</span>task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务id=&quot;</span><span class="token operator">+</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务负责人=&quot;</span><span class="token operator">+</span>task<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>2、拾取(claim)任务</p> <p>该组任务的所有候选人都能拾取。将候选人的组任务，变成个人任务。原来候选人就变成了该任务的负责人。如果拾取后不想办理该任务，负责人也可以将已经拾取的个人任务归还到组里边，将个人任务变成了组任务。</p> <p>候选人认领组任务</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token comment">/**
     * 候选人拾取任务
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">claimTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        获取引擎</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        获取TaskService</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        当前任务的id</span>
        <span class="token class-name">String</span> taskId <span class="token operator">=</span> <span class="token string">&quot;75002&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//        任务候选人</span>
        <span class="token class-name">String</span> candidateUser <span class="token operator">=</span> <span class="token string">&quot;wangwu&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//        查询任务</span>
        <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskId</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskCandidateUser</span><span class="token punctuation">(</span>candidateUser<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//            拾取任务</span>
            taskService<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span>candidateUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;taskid-&quot;</span><span class="token operator">+</span>taskId<span class="token operator">+</span><span class="token string">&quot;-用户-&quot;</span><span class="token operator">+</span>candidateUser<span class="token operator">+</span><span class="token string">&quot;-拾取任务完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>注：Activiti中，即使该用户不是候选人，也能认领任务。所以建议要在业务中自行校验是否有资格。</p> <p>任务被认领后，该任务就有了具体的负责人。其他候选人将查询不到该任务。</p> <p>3、查询个人任务</p> <p>与原有的流程相同</p> <p>4、办理个人任务</p> <p>与原有的流程相同</p> <p>5、归还组任务</p> <p>如果个人不想办理该组任务，可以在认领之后归还组任务，归还后该用户就不再是该任务的负责人了</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">/**
     * 任务的归还
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAssigneeToGroupTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        获取引擎</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        获取TaskService</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        当前任务的id</span>
        <span class="token class-name">String</span> taskId <span class="token operator">=</span> <span class="token string">&quot;75002&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//        任务负责人</span>
        <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">&quot;wangwu&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//        根据key 和负责人来查询任务</span>
        <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskId</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//            归还任务 ,就是把负责人 设置为空</span>
            taskService<span class="token punctuation">.</span><span class="token function">setAssignee</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;taskid-&quot;</span><span class="token operator">+</span>taskId<span class="token operator">+</span><span class="token string">&quot;-归还任务完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>注：从这个代码中可以看到，实际上是允许直接给任务设定责任人的，即使被委托用户不是候选人，也可以直接指定。</p> <p>这就是任务交接的流程。</p> <h4 id="数据库表操作"><a href="#数据库表操作" class="header-anchor">#</a> 数据库表操作</h4> <p>查询当前任务执行表</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> act_ru_task
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>任务执行表，记录当前执行的任务，由于该任务当前是组任务，所有assignee为空，当拾取任务后该字段就是拾取用户的id</p> <p>查询任务参与者</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> act_ru_identitylink
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>任务参与者，记录当前参考任务用户或组，当前任务如果设置了候选人，会向该表插入候选人记录，有几个候选就插入几个</p> <p>与act_ru_identitylink对应的还有一张历史表act_hi_identitylink，向act_ru_identitylink插入记录的同时也会向历史表插入记录。任务完成</p> <h2 id="五、activiti与spring整合"><a href="#五、activiti与spring整合" class="header-anchor">#</a> 五、Activiti与Spring整合</h2> <p>Activiti与Spring整合的基本思想是将Activiti最为核心的ProcessEngine类交由Spring容器进行管理。</p> <p>核心的pom依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.0.0.Beta1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然后在classpath下创建activiti-spring.xml文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;
    &lt;!-- 数据源 --&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/activiti?serverTimezone=GMT&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;
        &lt;property name=&quot;maxActive&quot; value=&quot;3&quot;/&gt;
        &lt;property name=&quot;maxIdle&quot; value=&quot;1&quot;/&gt;
    &lt;/bean&gt;
    &lt;!-- 工作流引擎配置bean --&gt;
    &lt;bean id=&quot;processEngineConfiguration&quot; class=&quot;org.activiti.spring.SpringProcessEngineConfiguration&quot;&gt;
        &lt;!-- 数据源 --&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
        &lt;!-- 使用spring事务管理器 --&gt;
        &lt;property name=&quot;transactionManager&quot; ref=&quot;transactionManager&quot;/&gt;
        &lt;!-- 数据库策略 --&gt;
        &lt;property name=&quot;databaseSchemaUpdate&quot; value=&quot;drop-create&quot;/&gt;
    &lt;/bean&gt;
    &lt;!-- 流程引擎 --&gt;
    &lt;bean id=&quot;processEngine&quot; class=&quot;org.activiti.spring.ProcessEngineFactoryBean&quot;&gt;
        &lt;property name=&quot;processEngineConfiguration&quot; ref=&quot;processEngineConfiguration&quot;/&gt;
    &lt;/bean&gt;
    &lt;!-- 资源服务service --&gt;
    &lt;bean id=&quot;repositoryService&quot; factory-bean=&quot;processEngine&quot; factory-method=&quot;getRepositoryService&quot;/&gt;
    &lt;!-- 流程运行service --&gt;
    &lt;bean id=&quot;runtimeService&quot; factory-bean=&quot;processEngine&quot;  factory-method=&quot;getRuntimeService&quot;/&gt;
    &lt;!-- 任务管理service --&gt;
    &lt;bean id=&quot;taskService&quot; factory-bean=&quot;processEngine&quot; factory-method=&quot;getTaskService&quot;/&gt;
    &lt;!-- 历史管理service --&gt;
    &lt;bean id=&quot;historyService&quot; factory-bean=&quot;processEngine&quot; factory-method=&quot;getHistoryService&quot;/&gt;
    &lt;!-- 事务管理器 --&gt;
    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
    &lt;/bean&gt;
    &lt;!-- 通知 --&gt;
    &lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;
        &lt;tx:attributes&gt;
            &lt;!-- 传播行为 --&gt;
            &lt;tx:method name=&quot;save*&quot; propagation=&quot;REQUIRED&quot;/&gt;
            &lt;tx:method name=&quot;insert*&quot; propagation=&quot;REQUIRED&quot;/&gt;
            &lt;tx:method name=&quot;delete*&quot; propagation=&quot;REQUIRED&quot;/&gt;
            &lt;tx:method name=&quot;update*&quot; propagation=&quot;REQUIRED&quot;/&gt;
            &lt;tx:method name=&quot;find*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot;/&gt;
            &lt;tx:method name=&quot;get*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot;/&gt;
        &lt;/tx:attributes&gt;
    &lt;/tx:advice&gt;
&lt;/beans&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>然后就可以从Spring容器中直接引用对应的service，进行具体的业务操作了。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>roy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">RepositoryService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ContextConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringJUnit4ClassRunner</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">&quot;classpath:activiti-spring.xml&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActivitiTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RepositoryService</span> repositoryService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;部署对象:&quot;</span><span class="token operator">+</span>repositoryService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>下面我们一起来分析Activiti与Spring整合加载的过程。</p> <ul><li>1、加载activiti-spring.xml配置文件</li> <li>2、加载SpringProcessEngineConfiguration对象，这个对象它需要依赖注入dataSource对象和transactionManager对象。</li> <li>3、加载ProcessEngineFactoryBean工厂来创建ProcessEngine对象，而ProcessEngineFactoryBean工厂又需要依赖注入processEngineConfiguration对象。</li> <li>4、processEngine对象来负责创建我们的Service对象，从而简化Activiti的开发过程。</li></ul> <h2 id="六、activiti7与springboot整合开发"><a href="#六、activiti7与springboot整合开发" class="header-anchor">#</a> 六、Activiti7与SpringBoot整合开发</h2> <p>Activiti7正式版发布后，就已经支持与SpringBoot2.X版本完全整合开发了。</p> <p>1、引入maven依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ActivitiDemo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.roy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ActSpringBootDemo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${activiti.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>核心的依赖就是org.activiti:activiti-spring-boot-starter</p> <p>2、创建配置文件application.yml</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>spring<span class="token operator">:</span>
  datasource<span class="token operator">:</span>
    driver<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>name<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Driver</span>
    url<span class="token operator">:</span> jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span>activiti<span class="token operator">?</span>useUnicode<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>characterEncoding<span class="token operator">=</span>utf8<span class="token operator">&amp;</span>serverTimezone<span class="token operator">=</span><span class="token constant">GMT</span>
    username<span class="token operator">:</span> root
    password<span class="token operator">:</span> root
  activiti<span class="token operator">:</span>
    #<span class="token number">1.f</span>lase：默认值。activiti在启动时，对比数据库表中保存的版本，如果没有表或者版本不匹配，将抛出异常
    #<span class="token number">2.</span><span class="token boolean">true</span>： activiti会对数据库中所有表进行更新操作。如果表不存在，则自动创建
    #<span class="token number">3.</span>create_drop： 在activiti启动时创建表，在关闭时删除表（必须手动关闭引擎，才能删除表）
    #<span class="token number">4.d</span>rop<span class="token operator">-</span>create： 在activiti启动时删除原来的旧表，然后在创建新表（不需要手动关闭引擎）
    database<span class="token operator">-</span>schema<span class="token operator">-</span>update<span class="token operator">:</span> <span class="token boolean">true</span>
    #activiti7默认不生成历史信息表，开启历史表
    db<span class="token operator">-</span>history<span class="token operator">-</span>used<span class="token operator">:</span> <span class="token boolean">true</span>
    #记录历史等级 可配置的历史级别有none<span class="token punctuation">,</span> activity<span class="token punctuation">,</span> audit<span class="token punctuation">,</span> full
    #none：不保存任何的历史数据，因此，在流程执行过程中，这是最高效的。
    #activity：级别高于none，保存流程实例与流程行为，其他数据不保存。
    #audit：除activity级别会保存的数据外，还会保存全部的流程任务及其属性。audit为history的默认值。
    #full：保存历史数据的最高级别，除了会保存audit级别的数据外，还会保存其他全部流程相关的细节数据，包括一些流程参数等。
    history<span class="token operator">-</span>level<span class="token operator">:</span> full
    check<span class="token operator">-</span>process<span class="token operator">-</span>definitions<span class="token operator">:</span> <span class="token boolean">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>3、编写启动类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>roy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ：楼兰
 * @date ：Created in 2021/4/8
 * @description:
 **/</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ActApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>4、创建BPMN文件</p> <p>Activiti7可以自动部署流程，前提是在resources目录下，创建一个新的目录processes，用来放置bpmn文件。</p> <p>创建一个简单的Bpmn流程文件，并设置任务的用户组Candidate Groups。</p> <p>Candidate Groups中的内容与上面DemoApplicationConfiguration类中出现的用户组名称要保持一致，可以填写：activitiTeam 或者 otherTeam。</p> <p>这样填写的好处：当不确定到底由谁来负责当前任务的时候，只要是Groups内的用户都可以拾取这个任务</p> <p><img src="/assets/img/candidateGroups.ce108c54.png" alt=""></p> <p>并且，将我们之前创建的myLeave.bpmn也放到这个目录下。</p> <p>5、使用junit方式测试
使用SpringBoot集成Activiti后，每次启动项目时，会自动部署之前放的bpmn文件，并且，会在Spring容器中自动注入Activiti的几个核心Service。</p> <p>这时关注下启动日志，并且到MySQL当中查看下关键的数据表。</p> <p>这样，我们可以快速的将之前的流程移植过来。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>roy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">ProcessRuntime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>task<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">TaskRuntime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>history<span class="token punctuation">.</span></span><span class="token class-name">HistoricActivityInstance</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>history<span class="token punctuation">.</span></span><span class="token class-name">HistoricActivityInstanceQuery</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ProcessDefinition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ProcessDefinitionQuery</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">ProcessInstance</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>task<span class="token punctuation">.</span></span><span class="token class-name">Task</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringRunner</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ：楼兰
 * @date ：Created in 2021/4/9
 * @description:
 **/</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpingBootActivitiDemo</span> <span class="token punctuation">{</span>
<span class="token comment">//</span>
<span class="token comment">//    @Autowired</span>
<span class="token comment">//    private ProcessRuntime processRuntime;</span>
<span class="token comment">//</span>
<span class="token comment">//    @Autowired</span>
<span class="token comment">//    private TaskRuntime taskRuntime;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RuntimeService</span> runtimeService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TaskService</span> taskService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RepositoryService</span> repositoryService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">HistoryService</span> historyService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 启动流程实例
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService
                <span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        输出内容</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义id：&quot;</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程实例id：&quot;</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前活动Id：&quot;</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getActivityId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查询当前个人待执行的任务
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindPersonalTaskList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//        任务负责人</span>
        <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">&quot;worker&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//        根据流程key 和 任务负责人 查询任务</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">)</span> <span class="token comment">//流程Key</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span><span class="token comment">//只查询该任务负责人的任务</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程实例id：&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务id：&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务负责人：&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务名称：&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 完成任务</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        根据流程key 和 任务的负责人 查询任务</span>
<span class="token comment">//        返回一个任务对象</span>
        <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">)</span> <span class="token comment">//流程Key</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span><span class="token string">&quot;worker&quot;</span><span class="token punctuation">)</span>  <span class="token comment">//要查询的负责人</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        完成任务,参数：任务id</span>
        taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查询流程定义
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryProcessDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        得到ProcessDefinitionQuery 对象</span>
        <span class="token class-name">ProcessDefinitionQuery</span> processDefinitionQuery <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//          查询出当前所有的流程定义</span>
<span class="token comment">//          条件：processDefinitionKey =evection</span>
<span class="token comment">//          orderByProcessDefinitionVersion 按照版本排序</span>
<span class="token comment">//        desc倒叙</span>
<span class="token comment">//        list 返回集合</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> definitionList <span class="token operator">=</span> processDefinitionQuery<span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orderByProcessDefinitionVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//      输出流程定义信息</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> processDefinition <span class="token operator">:</span> definitionList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义 id=&quot;</span><span class="token operator">+</span>processDefinition<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义 name=&quot;</span><span class="token operator">+</span>processDefinition<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义 key=&quot;</span><span class="token operator">+</span>processDefinition<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义 Version=&quot;</span><span class="token operator">+</span>processDefinition<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程部署ID =&quot;</span><span class="token operator">+</span>processDefinition<span class="token punctuation">.</span><span class="token function">getDeploymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查询流程实例
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryProcessInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 流程定义key</span>
        <span class="token class-name">String</span> processDefinitionKey <span class="token operator">=</span> <span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessInstance</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> runtimeService
                <span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span>processDefinitionKey<span class="token punctuation">)</span><span class="token comment">//</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----------------------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程实例id：&quot;</span>
                    <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;所属流程定义id：&quot;</span>
                    <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;是否执行完成：&quot;</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">isEnded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;是否暂停：&quot;</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">isSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前活动标识：&quot;</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getActivityId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;业务关键字：&quot;</span><span class="token operator">+</span>processInstance<span class="token punctuation">.</span><span class="token function">getBusinessKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 流程部署id</span>
        <span class="token class-name">String</span> deploymentId <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">//删除流程定义，如果该流程定义已有流程实例启动则删除时出错</span>
        repositoryService<span class="token punctuation">.</span><span class="token function">deleteDeployment</span><span class="token punctuation">(</span>deploymentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置true 级联删除流程定义，即使该流程有流程实例启动也可以删除，设置为false非级别删除方式，如果流程</span>
<span class="token comment">//        repositoryService.deleteDeployment(deploymentId, true);</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">queryBpmnFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
<span class="token comment">//        3、得到查询器：ProcessDefinitionQuery，设置查询条件,得到想要的流程定义</span>
        <span class="token class-name">ProcessDefinition</span> processDefinition <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;myLeave&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        4、通过流程定义信息，得到部署ID</span>
        <span class="token class-name">String</span> deploymentId <span class="token operator">=</span> processDefinition<span class="token punctuation">.</span><span class="token function">getDeploymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        5、通过repositoryService的方法，实现读取图片信息和bpmn信息</span>
<span class="token comment">//        png图片的流</span>
        <span class="token class-name">InputStream</span> pngInput <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>deploymentId<span class="token punctuation">,</span> processDefinition<span class="token punctuation">.</span><span class="token function">getDiagramResourceName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        bpmn文件的流</span>
        <span class="token class-name">InputStream</span> bpmnInput <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>deploymentId<span class="token punctuation">,</span> processDefinition<span class="token punctuation">.</span><span class="token function">getResourceName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        6、构造OutputStream流</span>
        <span class="token class-name">File</span> file_png <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;d:/myLeave.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> file_bpmn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;d:/myLeave.bpmn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileOutputStream</span> bpmnOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>file_bpmn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileOutputStream</span> pngOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>file_png<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        7、输入流，输出流的转换</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>pngInput<span class="token punctuation">,</span>pngOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>bpmnInput<span class="token punctuation">,</span>bpmnOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        8、关闭流</span>
        pngOut<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bpmnOut<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pngInput<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bpmnInput<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查看历史信息
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findHistoryInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        获取 actinst表的查询对象</span>
        <span class="token class-name">HistoricActivityInstanceQuery</span> instanceQuery <span class="token operator">=</span> historyService<span class="token punctuation">.</span><span class="token function">createHistoricActivityInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        查询 actinst表，条件：根据 InstanceId 查询，查询一个流程的所有历史信息</span>
        instanceQuery<span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span><span class="token string">&quot;25001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        查询 actinst表，条件：根据 DefinitionId 查询，查询一种流程的所有历史信息</span>
<span class="token comment">//        instanceQuery.processDefinitionId(&quot;myLeave:1:22504&quot;);</span>
<span class="token comment">//        增加排序操作,orderByHistoricActivityInstanceStartTime 根据开始时间排序 asc 升序</span>
        instanceQuery<span class="token punctuation">.</span><span class="token function">orderByHistoricActivityInstanceStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        查询所有内容</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HistoricActivityInstance</span><span class="token punctuation">&gt;</span></span> activityInstanceList <span class="token operator">=</span> instanceQuery<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        输出</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HistoricActivityInstance</span> hi <span class="token operator">:</span> activityInstanceList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hi<span class="token punctuation">.</span><span class="token function">getActivityId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hi<span class="token punctuation">.</span><span class="token function">getActivityName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hi<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hi<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;==========================&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br></div></div><p>6、快速集成SpringSecurity安全框架</p> <p>因为Activiti7与SpringBoot整合后，默认情况下，集成了SpringSecurity安全框架，这样便于我们快速与SpringSecurity进行集成。</p> <p>我们可以去准备SpringSecurity整合进来的相关用户权限配置信息。SpringBoot的依赖包已经将SpringSecurity的依赖包也添加进项目中。</p> <p>添加SecurityUtil类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>roy<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Authentication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">GrantedAuthority</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SecurityContextHolder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SecurityContextImpl</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetails</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ：楼兰
 * @date ：Created in 2021/4/8
 * @description:
 **/</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">SecurityUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;myUserDetailsService&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDetailsService</span> userDetailsService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDetails</span> user <span class="token operator">=</span> userDetailsService<span class="token punctuation">.</span><span class="token function">loadUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;User &quot;</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">&quot; doesn't exist, please provide a valid user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;&gt; Logged in as: &quot;</span> <span class="token operator">+</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">SecurityContextImpl</span><span class="token punctuation">(</span>
                        <span class="token keyword">new</span> <span class="token class-name">Authentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> user<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> user<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAuthenticated</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isAuthenticated<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalArgumentException</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>identity<span class="token punctuation">.</span></span>Authentication</span><span class="token punctuation">.</span><span class="token function">setAuthenticatedUserId</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><p>这个类可以从Activiti7官方提供的example中找到。</p> <p>添加DemoApplicationConfig配置类</p> <p>在Activiti7官方下载的Example中找到DemoApplicationConfig类，它的作用是为了实现SpringSecurity框架的用户权限的配置，这样我们就可以在系统中使用用户权限信息。</p> <p>本次项目中基本是在文件中定义出来的用户信息，当然也可以是数据库中查询的用户权限信息</p> <p>后面处理流程时用到的任务负责人，需要添加在这里</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>roy<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>authority<span class="token punctuation">.</span></span><span class="token class-name">SimpleGrantedAuthority</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>bcrypt<span class="token punctuation">.</span></span><span class="token class-name">BCryptPasswordEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>password<span class="token punctuation">.</span></span><span class="token class-name">PasswordEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>provisioning<span class="token punctuation">.</span></span><span class="token class-name">InMemoryUserDetailsManager</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ：楼兰
 * @date ：Created in 2021/4/8
 * @description:
 **/</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoApplicationConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 添加Security的用户
     * @return
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">myUserDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        把用户存储在内存中</span>
        <span class="token class-name">InMemoryUserDetailsManager</span> inMemoryUserDetailsManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        构造用户的信息</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> usersGroupAndRoles<span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token punctuation">{</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">&quot;rose&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">&quot;jerry&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">&quot;other&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;GROUP_otherTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ROLE_ACTIVITI_ADMIN&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> users <span class="token operator">:</span> usersGroupAndRoles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//            用户的角色和组</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> authStrList <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOfRange</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> users<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;&gt; Registering new user: {} with the following Authorities[{}]&quot;</span><span class="token punctuation">,</span>users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>authStrList<span class="token punctuation">)</span><span class="token punctuation">;</span>

            inMemoryUserDetailsManager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    authStrList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> inMemoryUserDetailsManager<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><p>6、测试与Security的集成</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>roy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>roy<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">SecurityUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">ProcessDefinition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">ProcessInstance</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>model<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">ProcessPayloadBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">ProcessRuntime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">Pageable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>task<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Task</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>task<span class="token punctuation">.</span>model<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">TaskPayloadBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>task<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">TaskRuntime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringRunner</span></span><span class="token punctuation">;</span>


<span class="token comment">/**
 * @author ：楼兰
 * @date ：Created in 2021/4/8
 * @description: SpringBoot的Demo代码，但是都有问题，一个都跑不过去。
 **/</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestSecurityActiviti</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">SecurityUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ProcessRuntime</span> processRuntime<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TaskRuntime</span> taskRuntime<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SecurityUtil</span> securityUtil<span class="token punctuation">;</span>


    <span class="token comment">/**
     * 查看流程定义内容
     * Activiti7可以自动部署流程
     * 跑不通，只能有一个bpmn，多了就不行。 看ProcessRuntimeImpl的selectLatestDeployment
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token class-name">ProcessDefinition</span> processDefinition <span class="token operator">=</span> processRuntime<span class="token punctuation">.</span><span class="token function">processDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;mydemo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义内容：{}&quot;</span><span class="token punctuation">,</span>processDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> processDefinitionPage <span class="token operator">=</span> processRuntime<span class="token punctuation">.</span><span class="token function">processDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> definition <span class="token operator">:</span> processDefinitionPage<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;2- 流程定义内容:  {}&quot;</span><span class="token punctuation">,</span>definition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 启动流程
     * 报application version版本号不对。
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">startProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        设置登录用户</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> processRuntime<span class="token punctuation">.</span>
                <span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">ProcessPayloadBuilder</span><span class="token punctuation">.</span>
                        <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">withProcessDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;mydemo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;流程实例的内容，{}&quot;</span><span class="token punctuation">,</span>processInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 执行任务
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        设置登录用户</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token string">&quot;jerry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        查询任务</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskPage <span class="token operator">=</span> taskRuntime<span class="token punctuation">.</span><span class="token function">tasks</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>taskPage <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> taskPage<span class="token punctuation">.</span><span class="token function">getTotalItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> taskPage<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//        拾取任务</span>
                taskRuntime<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token class-name">TaskPayloadBuilder</span><span class="token punctuation">.</span>
                        <span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">withTaskId</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;任务内容,{}&quot;</span><span class="token punctuation">,</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//        完成任务</span>
                taskRuntime<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token class-name">TaskPayloadBuilder</span><span class="token punctuation">.</span>
                        <span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">withTaskId</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br></div></div></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://fanxgit.github.io/fanxNotes/edit/master/docs/常用框架/03.activiti7/01.activiti7实战.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">9/15/2023, 3:33:42 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/5b9616/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">XSLFShape</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/5b9616/" class="prev">XSLFShape</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/797621/"><div>
            VuePress+GithubPages教程
            <!----></div></a> <span class="date">11-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/016620/"><div>
            java打jar包整理
            <!----></div></a> <span class="date">11-19</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/b23a10/"><div>
            多线程问题总结
            <!----></div></a> <span class="date">11-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.38fd400a.js" defer></script><script src="/assets/js/3.e11db813.js" defer></script><script src="/assets/js/16.ace3b806.js" defer></script>
  </body>
</html>
